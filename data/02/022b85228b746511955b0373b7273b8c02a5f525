<p>Just the other day, I received a restaurant menu split into a handful of image files. I wanted to forward the menu to others but figured I should probably send it as a single file.</p>
<p>ImageMagick's <a href="https://imagemagick.org/script/convert.php">convert</a> command-line utility works great for this purpose. Feed it some images and it creates a pdf for you:</p>
<pre><code class="language-{.bash">convert image1.png image2.png image3.png combined.pdf
</code></pre>
<p>Using <code>convert</code> for this purpose was pretty straightforward. I'm sure I'll use it again in a similar context, but what if I can make future usage more seamless? In the past, I would just make a note of usage and revisit when needed. Though this works well enough, it often requires some amount of manual work (looking things up, tweaking command, etc) if you happen to forget the command syntax.</p>
<p>I wanted common one-liners (or <a href="https://xenodium.com/png-to-icns-emacs-dwim-style/">longer shell scripts</a>) to be easily reusable and accessible from Emacs. Turns out, the <a href="https://github.com/xenodium/dwim-shell-command">dwim-shell-command</a> experiment is working fairly well for this purpose. In addition to providing template expansion, it generally <a href="https://xenodium.com/emacs-dwim-shell-command/">tries to do what I mean</a> (focus when needed, reveal new files, rename buffers, etc).</p>
<p>Here's how I saved the <code>convert</code> command instance for future usage:</p>
<pre><code class="language-{.commonlisp">(defun dwim-shell-commands-join-as-pdf ()
  &quot;Join all marked images as a single pdf.&quot;
  (interactive)
  (dwim-shell-command-on-marked-files
   &quot;Join as pdf&quot;
   &quot;convert -verbose '&lt;&lt;*&gt;&gt;' '&lt;&lt;joined.pdf(u)&gt;&gt;'&quot;
   :utils &quot;convert&quot;))
</code></pre>
<p>From now on, any time I'd like to join multiple files into a pdf, I can now select them all and invoke <code>dwim-shell-commands-join-as-pdf</code>.</p>
<p><img src="https://xenodium.github.io/images/seamless-command-line-utils/joined_minimal_x1.2.webp" alt=""></p>
<p>In the saved command, <code>'&lt;&lt;*&gt;&gt;'</code> expands to either <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Dired.html">dired</a> selected files or whatever file happens to be open in the current buffer. The buffer file isn't of much help for joining multiple items, but can be handy for other instances (say I want to convert current image to jpeg).</p>
<p>Moving on to <code>'&lt;&lt;joined.pdf(u)&gt;&gt;'</code>, we could have just written as <code>joined.pdf</code>, but wrapping it ensures the resulting file name is unique. That is, if <code>joined.pdf</code> already exists, write <code>joined(1).pdf</code> instead.</p>
<p>These kinds of command-line integrations are working well for me. Take the webp animation above, it was created by invoking <code>dwim-shell-commands-video-to-webp</code> on a <code>.mov</code> file. Easy peasy. While I can easily memorize the <code>convert</code> command for the pdf instance, I'm hopeless in the webp scenario:</p>
<pre><code class="language-{.bash">ffmpeg -i '&lt;&lt;f&gt;&gt;' -vcodec libwebp -filter:v fps=fps=10 -compression_level 3 -lossless 1 -loop 0 -preset default -an -vsync 0 '&lt;&lt;fne&gt;&gt;'.webp
</code></pre>
<p>While searching through command line history helps to quickly re-spin previous commands, it requires remembering the actual utility used for any particular action. On the other hand, wrapping with Emacs functions enables me to remember the action itself, using more memorable names. Also, fuzzy searching works a treat.</p>
<p><img src="https://xenodium.github.io/images/seamless-command-line-utils/fuzzy.png" alt=""></p>
<p>It's been roughly a month since I started playing around with this idea of wrapping command-line utilities more seamlessly. Since then, I've brought in a bunch of use-cases that are now quickly accessible (all in <a href="https://github.com/xenodium/dwim-shell-command/blob/main/dwim-shell-commands.el">dwim-shell-commands.el</a>):</p>
<ul>
<li>dwim-shell-commands-audio-to-mp3</li>
<li>dwim-shell-commands-clipboard-to-qr</li>
<li>dwim-shell-commands-copy-to-desktop</li>
<li>dwim-shell-commands-copy-to-downloads</li>
<li>dwim-shell-commands-docx-to-pdf</li>
<li>dwim-shell-commands-download-clipboard-stream-url</li>
<li>dwim-shell-commands-drop-video-audio</li>
<li>dwim-shell-commands-epub-to-org</li>
<li>dwim-shell-commands-external-ip</li>
<li>dwim-shell-commands-files-combined-size</li>
<li>dwim-shell-commands-git-clone-clipboard-url</li>
<li>dwim-shell-commands-git-clone-clipboard-url-to-downloads</li>
<li>dwim-shell-commands-http-serve-dir</li>
<li>dwim-shell-commands-image-browse-location</li>
<li>dwim-shell-commands-image-exif-metadata</li>
<li>dwim-shell-commands-image-reverse-geocode-location</li>
<li>dwim-shell-commands-image-to-grayscale</li>
<li>dwim-shell-commands-image-to-icns</li>
<li>dwim-shell-commands-image-to-jpg</li>
<li>dwim-shell-commands-image-to-png</li>
<li>dwim-shell-commands-install-iphone-device-ipa</li>
<li>dwim-shell-commands-join-as-pdf</li>
<li>dwim-shell-commands-kill-gpg-agent</li>
<li>dwim-shell-commands-kill-process</li>
<li>dwim-shell-commands-macos-bin-plist-to-xml</li>
<li>dwim-shell-commands-macos-caffeinate</li>
<li>dwim-shell-commands-macos-hardware-overview</li>
<li>dwim-shell-commands-macos-open-with</li>
<li>dwim-shell-commands-macos-reveal-in-finder</li>
<li>dwim-shell-commands-macos-set-default-app</li>
<li>dwim-shell-commands-macos-share</li>
<li>dwim-shell-commands-macos-toggle-dark-mode</li>
<li>dwim-shell-commands-macos-toggle-display-rotation</li>
<li>dwim-shell-commands-make-transparent-png</li>
<li>dwim-shell-commands-move-to-desktop</li>
<li>dwim-shell-commands-move-to-downloads</li>
<li>dwim-shell-commands-open-clipboard-url</li>
<li>dwim-shell-commands-open-externally</li>
<li>dwim-shell-commands-pdf-password-protect</li>
<li>dwim-shell-commands-pdf-to-txt</li>
<li>dwim-shell-commands-ping-google</li>
<li>dwim-shell-commands-rename-all</li>
<li>dwim-shell-commands-reorient-image</li>
<li>dwim-shell-commands-resize-gif</li>
<li>dwim-shell-commands-resize-image</li>
<li>dwim-shell-commands-resize-video</li>
<li>dwim-shell-commands-speed-up-gif</li>
<li>dwim-shell-commands-speed-up-video</li>
<li>dwim-shell-commands-stream-clipboard-url</li>
<li>dwim-shell-commands-svg-to-png</li>
<li>dwim-shell-commands-unzip</li>
<li>dwim-shell-commands-url-browse</li>
<li>dwim-shell-commands-video-to-gif</li>
<li>dwim-shell-commands-video-to-optimized-gif</li>
<li>dwim-shell-commands-video-to-webp</li>
</ul>
<p>What other use-cases would you consider? <code>dwim-shell-command</code> is <a href="https://melpa.org/#/dwim-shell-command">available on melpa</a>.</p>
<h2>Update</h2>
<p>2022-11-14 dwim-shell-commands.el list updated.</p>
