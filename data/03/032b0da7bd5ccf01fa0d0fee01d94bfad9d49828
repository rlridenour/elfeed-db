<p><strong>EDIT - 2021-08-16:</strong> See the <a href="#edits">Edits section</a> further down.
<strong>EDIT - 2024-11-09:</strong> See the newer post <a href="https://macowners.club/posts/update-mu4e-save-attachments-faster/">Mu4e - Update - save attachments faster</a>.</p>
<h2 id="issue-i-want-to-fix">Issue I want to fix</h2>
<p>The default way of saving my attachments is to hit a keybinding for <code>mu4e-view-attachment-action</code>.</p>
<p>I then get asked to select between <em>save</em> or <em>save multi</em>. After the selection, the chosen completion framework takes over and I can then save my attachments(s) in the directory dictated by the variable <code>mu4e-attachment-dir</code>. I cannot change the directory in which to save the attachments.</p>
<p>This grinds my gear to no end. Why you ask? Well, most of the time i can see the number of the attachments in my email. Sometime I want to save all of them and sometime I want to save just one or a range. The worst thing though is that I get prompted for <em>save</em> or <em>save multi</em> even if I only have one attachment ðŸ˜ .</p>
<p>I want two different functions (two different keybindings) for single and for multi. Then to be able to complete (for me with ivy) to the destination directory I want.</p>
<h2 id="my-solution-to-the-issue">My Solution to the issue</h2>
<p>The crucial part upfront. The variable <code>mu4e-save-multiple-attachments-without-asking</code> needs to be set to true. From the documentation:</p>
<blockquote>
<p>If non-nil, saving multiple attachments asks once for a
directory and saves all attachments in the chosen directory.</p>
</blockquote>
<p>Let us set it then.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">mu4e-save-multiple-attachments-without-asking</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></div><p>Setting the keybindings should be trivial.</p>
<p>Now to the functions.</p>
<h3 id="case-1-i-want-to-save-all-attachments-in-the-email">case #1 - I want to save all attachments in the email</h3>
<p>I took the default <code>mu4e-view-save-attachment-multi</code> and hacked on it till I got a custom function that preselects <em>all</em> (attachments). Plus, That way I can skip the prompt since I skipped the <code>mu4e-view-attachment-action</code> function. This is particularly sexy since I can use the function if I only have one attachment in the email as well.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my/mu4e-view-save-attachments</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Save All Attachements in a selected directory using </span><span class="ss">`ivy&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">This is a modified version of </span><span class="ss">`mu4e-view-save-attachment-multi&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">msg</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">msg</span> <span class="p">(</span><span class="nv">mu4e-message-at-point</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">attachstr</span> <span class="s">&#34;a&#34;</span><span class="p">)</span> <span class="c1">;; this is the part that preselects all</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">count</span> <span class="p">(</span><span class="nf">hash-table-count</span> <span class="nv">mu4e~view-attach-map</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">attachnums</span> <span class="p">(</span><span class="nv">mu4e-split-ranges-to-numbers</span> <span class="nv">attachstr</span> <span class="nv">count</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">mu4e-save-multiple-attachments-without-asking</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">path</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">mu4e~get-attachment-dir</span><span class="p">)</span> <span class="s">&#34;/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">attachdir</span> <span class="p">(</span><span class="nv">mu4e~view-request-attachments-dir</span> <span class="nv">path</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">num</span> <span class="nv">attachnums</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">att</span> <span class="p">(</span><span class="nv">mu4e~view-get-attach</span> <span class="nv">msg</span> <span class="nv">num</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">fname</span>  <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">att</span> <span class="nb">:name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">index</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">att</span> <span class="nb">:index</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">retry</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="nv">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">while</span> <span class="nv">retry</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">setq</span> <span class="nv">fpath</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">attachdir</span> <span class="nv">fname</span><span class="p">)</span> <span class="nv">path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">setq</span> <span class="nv">retry</span>
</span></span><span class="line"><span class="cl">                      <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">y-or-n-p</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">mu4e-format</span> <span class="s">&#34;Overwrite &#39;%s&#39;?&#34;</span> <span class="nv">fpath</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">mu4e~proc-extract</span>
</span></span><span class="line"><span class="cl">               <span class="ss">&#39;save</span> <span class="p">(</span><span class="nv">mu4e-message-field</span> <span class="nv">msg</span> <span class="nb">:docid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="nv">index</span> <span class="nv">mu4e-decryption-policy</span> <span class="nv">fpath</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">num</span> <span class="nv">attachnums</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">mu4e-view-save-attachment-single</span> <span class="nv">msg</span> <span class="nv">num</span><span class="p">)))))</span>
</span></span></code></pre></div><h3 id="case-2-i-want-to-select-a-range-or-a-single-attachment-in-the-email">case #2 - I want to select a range or a single attachment in the email</h3>
<p>This is rather the defaults function. Just copied it and renamed it in case I want to hack on it some more</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my/mu4e-view-save-attachment</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Save All Attachements in a selected directory using </span><span class="ss">`ivy&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">This is a modified version of </span><span class="ss">`mu4e-view-save-attachment-multi&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">msg</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">msg</span> <span class="p">(</span><span class="nv">mu4e-message-at-point</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">attachstr</span> <span class="p">(</span><span class="nv">mu4e~view-get-attach-num</span>
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;Attachment number range (or &#39;a&#39; for &#39;all&#39;)&#34;</span> <span class="nv">msg</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">count</span> <span class="p">(</span><span class="nf">hash-table-count</span> <span class="nv">mu4e~view-attach-map</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">attachnums</span> <span class="p">(</span><span class="nv">mu4e-split-ranges-to-numbers</span> <span class="nv">attachstr</span> <span class="nv">count</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">mu4e-save-multiple-attachments-without-asking</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">path</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">mu4e~get-attachment-dir</span><span class="p">)</span> <span class="s">&#34;/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">attachdir</span> <span class="p">(</span><span class="nv">mu4e~view-request-attachments-dir</span> <span class="nv">path</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">num</span> <span class="nv">attachnums</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">att</span> <span class="p">(</span><span class="nv">mu4e~view-get-attach</span> <span class="nv">msg</span> <span class="nv">num</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">fname</span>  <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">att</span> <span class="nb">:name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">index</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">att</span> <span class="nb">:index</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">retry</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="nv">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">while</span> <span class="nv">retry</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">setq</span> <span class="nv">fpath</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">attachdir</span> <span class="nv">fname</span><span class="p">)</span> <span class="nv">path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">setq</span> <span class="nv">retry</span>
</span></span><span class="line"><span class="cl">                      <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">y-or-n-p</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">mu4e-format</span> <span class="s">&#34;Overwrite &#39;%s&#39;?&#34;</span> <span class="nv">fpath</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">mu4e~proc-extract</span>
</span></span><span class="line"><span class="cl">               <span class="ss">&#39;save</span> <span class="p">(</span><span class="nv">mu4e-message-field</span> <span class="nv">msg</span> <span class="nb">:docid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="nv">index</span> <span class="nv">mu4e-decryption-policy</span> <span class="nv">fpath</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">num</span> <span class="nv">attachnums</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">mu4e-view-save-attachment-single</span> <span class="nv">msg</span> <span class="nv">num</span><span class="p">)))))</span>
</span></span></code></pre></div><h2 id="edits">Edits</h2>
<h3 id="2021-08-16-fixing-breaking-mu-mu4e-1-dot-6-updates">2021-08-16 - Fixing breaking mu/mu4e 1.6 updates:</h3>
<p>As of version 1.6 mu/mu4e implemented new functionalities â€“ including the new <code>gnus-article-mode</code> â€“ and deprecated others. See the <a href="https://github.com/djcb/mu/releases">release notes</a>. In the snippets above I use <code>mu4e-view-save-attachment-multi</code>, which was carved out in the process.</p>
<p>I had to rewrite my functions to use <code>mu4e-view-save-attachments</code>. Below is the result.</p>
<p>&lt;span style=&ldquo;color:#f7821b;&quot;&gt;BONUS: This works with any completion framework if you set <code>mu4e-completing-read-function</code> correctly.&lt;/span&gt;</p>
<p><strong>for case #1:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu/mu4e-view-save-attachments</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Save All Attachements in a selected directory using completion.
</span></span></span><span class="line"><span class="cl"><span class="s">This is a modified version of </span><span class="ss">`mu4e-view-save-attachments&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="ne">cl-assert</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;mu4e-view-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;gnus-article-mode</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">parts</span> <span class="p">(</span><span class="nv">mu4e~view-gather-mime-parts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">handles</span> <span class="o">&#39;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">files</span> <span class="o">&#39;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">         <span class="nv">dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">part</span> <span class="nv">parts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">fname</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;filename</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;attachment&#34;</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">part</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="nv">fname</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">push</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">fname</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nf">cdr</span> <span class="nv">part</span><span class="p">))</span> <span class="nv">handles</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">push</span> <span class="nv">fname</span> <span class="nv">files</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">files</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">dir</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&#34;Save to directory: &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">cl-loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">f</span> <span class="o">.</span> <span class="nv">h</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">handles</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">when</span> <span class="p">(</span><span class="nf">member</span> <span class="nv">f</span> <span class="nv">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">do</span> <span class="p">(</span><span class="nv">mm-save-part-to-file</span> <span class="nv">h</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">f</span> <span class="nv">dir</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">mu4e-message</span> <span class="s">&#34;No attached files found&#34;</span><span class="p">))))</span>
</span></span></code></pre></div><p><strong>for case #2:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu/mu4e-view-save-attachment</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Save one attachements in a selected directory using completion.
</span></span></span><span class="line"><span class="cl"><span class="s">This is a modified version of </span><span class="ss">`mu4e-view-save-attachments&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="ne">cl-assert</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;mu4e-view-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;gnus-article-mode</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">parts</span> <span class="p">(</span><span class="nv">mu4e~view-gather-mime-parts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">handles</span> <span class="o">&#39;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">files</span> <span class="o">&#39;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">         <span class="nv">dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">part</span> <span class="nv">parts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">fname</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;filename</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;attachment&#34;</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">part</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="nv">fname</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">push</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">fname</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nf">cdr</span> <span class="nv">part</span><span class="p">))</span> <span class="nv">handles</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">push</span> <span class="nv">fname</span> <span class="nv">files</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">files</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">files</span> <span class="p">(</span><span class="nv">completing-read-multiple</span> <span class="s">&#34;Save part(s): &#34;</span> <span class="nv">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nv">dir</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&#34;Save to directory: &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">cl-loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">f</span> <span class="o">.</span> <span class="nv">h</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">handles</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">when</span> <span class="p">(</span><span class="nf">member</span> <span class="nv">f</span> <span class="nv">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">do</span> <span class="p">(</span><span class="nv">mm-save-part-to-file</span> <span class="nv">h</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">f</span> <span class="nv">dir</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">mu4e-message</span> <span class="s">&#34;No attached files found&#34;</span><span class="p">))))</span>
</span></span></code></pre></div>