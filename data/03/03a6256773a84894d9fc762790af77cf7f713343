
         
         <p>I was asked if I knew of a way to copy a single file to many
destinations in one go. I initially replied that I was not aware of
such a piece of functionality. Then I decided to give it a try. So
after ~20 minutes I came up with this prototype (which I promptly sent
to my correspondent):</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">prot/copy-file-to-destinations--directory-prompt</span> <span class="p">()</span>
  <span class="s">"Produce the directory/destinations prompt of `prot/copy-file-to-destinations'."</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">skip-initial</span> <span class="no">t</span><span class="p">)</span>
        <span class="nv">destinations</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">skip-initial</span> <span class="p">(</span><span class="nb">y-or-n-p</span> <span class="s">"Add more destinations? "</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">skip-initial</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">skip-initial</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">push</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">"Select destination directory: "</span><span class="p">)</span> <span class="nv">destinations</span><span class="p">))</span>
    <span class="nv">destinations</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">prot/copy-file-to-destinations</span> <span class="p">(</span><span class="nv">file</span> <span class="nv">destinations</span><span class="p">)</span>
  <span class="s">"Copy FILE to DESTINATIONS.
FILE is a string pointing to a file system path.  DESTINATIONS is a list
of strings representing directories.

In interactive use, prompt for FILE and then for DESTINATIONS.  For each
selected destination, produce a `y-or-n-p' prompt on whether to add
another destination or perform the operation with the selected ones."</span>
  <span class="p">(</span><span class="nv">interactive</span>
   <span class="p">(</span><span class="nb">list</span>
    <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">"File to copy: "</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">prot/copy-file-to-destinations--directory-prompt</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">destination</span> <span class="nv">destinations</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">copy-file</span> <span class="nv">file</span> <span class="nv">destination</span> <span class="ss">:overwrite-if-it-exists</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">message</span> <span class="s">"Copied %s to %s"</span> <span class="nv">file</span> <span class="p">(</span><span class="nv">mapconcat</span> <span class="nf">#'</span><span class="nb">identity</span> <span class="nv">destinations</span> <span class="s">", "</span><span class="p">)))</span>
</code></pre></div></div>

<p>I find the pattern of <code class="language-plaintext highlighter-rouge">(while...(read-directory-name ...))</code>
intriguing. It seems like a decent alternative to <code class="language-plaintext highlighter-rouge">completing-read-multiple</code>
when we need to use a familiar prompt a number of times.</p>

<p>I do not have a use-case for this, so I will probably not elaborate on
it further. Just sharing it in case you want to edit it. I had a fun
time writing it!</p>
        
      