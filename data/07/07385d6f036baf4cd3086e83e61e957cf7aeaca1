<p>Following up from <a href="#change-emacs-shells-cwd-with-helm-projectile">changing CWD with helm projectile</a>, here's a way to search your bash history with helm:</p>
<p><img src="https://xenodium.github.io/images/search-bash-history-with-emacs-helm/helm-bash-history.gif" alt=""></p>
<pre><code class="language-{.commonlisp">(defun ar/helm-helm (title candidates on-select-function)
  &quot;Helm with TITLE CANDIDATES and ON-SELECT-FUNCTION.&quot;
  (helm :sources `((name . ,title)
                   (candidates . ,candidates)
                   (action . ,on-select-function))
        :buffer &quot;*helm-exec*&quot;
        :candidate-number-limit 10000))

(defun ar/shell-send-command (command)
  &quot;Send COMMAND to shell mode.&quot;
  (assert (string-equal mode-name &quot;Shell&quot;) nil &quot;Not in Shell mode&quot;)
  (goto-char (point-max))
  (comint-kill-input)
  (insert command)
  (comint-send-input))

(defun ar/helm-shell-search-history ()
  &quot;Narrow down bash history with helm.&quot;
  (interactive)
  (assert (string-equal mode-name &quot;Shell&quot;) nil &quot;Not in Shell mode&quot;)
  (ar/helm-helm &quot;bash history&quot;
                (with-temp-buffer
                  (insert-file-contents &quot;~/.bash_history&quot;)
                  (reverse
                   (delete-dups
                    (split-string (buffer-string) &quot;\n&quot;))))
                #'ar/shell-send-command))
</code></pre>
<p>Bonus: Replace existing M-r binding to use ar/helm-shell-search-history.</p>
<pre><code class="language-{.commonlisp">(bind-key &quot;M-r&quot; #'ar/helm-shell-search-history shell-mode-map)
</code></pre>
