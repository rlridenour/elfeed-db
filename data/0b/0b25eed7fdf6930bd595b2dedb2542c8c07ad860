<h2 id="intro">Intro</h2>
<blockquote>
<p>Capture lets you quickly store notes with little interruption of your work flow. Org’s method for capturing new items is heavily inspired by John Wiegley’s excellent Remember package.</p>
</blockquote>
<p style="text-align:right;"><a href="https://orgmode.org/manual/Capture.html">The Org Manual – 10.1 Capture</a></p>
<h2 id="need">Need</h2>
<p>I use Emacs for recording almost anything notes, stream of conscience, interesting tidbits from the internet, documentations, To-Dos &amp; more. Which in turn means that I sometimes want to quickly jot down any of the above and then go on with my day.</p>
<p>As we all know frequent context switching is not conducive to productivity. In that spirit I wanted to get a system with which I can quickly bring up an Emacs capture frame – regardless of the focused application – and capture whatever and then let the frame &ldquo;disappear&rdquo;.</p>
<figure><img src="https://macowners.club/images/org-capture-everywhere-macos-1.png" width="800px">
</figure>

<blockquote>
<p>How I go about it?</p>
</blockquote>
<h2 id="first-things-first">First things first</h2>
<p>I will not cover how to setup capturing in general, since this is far better and extensively <a href="https://www.reddit.com/r/emacs/comments/7zqc7b/share_your_org_capture_templates/">discussed</a> and <a href="https://orgmode.org/manual/Capture.html">documented</a> online. But if of interest, you can take a peak at my <a href="https://gitlab.com/aimebertrand/dotemacs/-/blob/main/libraries/timu-org.el">capture templates</a>.</p>
<p>What I want to focus on in this post is the integration into the OS as a whole.</p>
<h2 id="default-org-capture">Default Org capture</h2>
<p>Bringing up a capture window/frame in Emacs is as simple as calling the command <code>org-capture</code> or of course using the corresponding keybinding.</p>
<p>The hard(isch) part is accomplishing this outside of Emacs – meaning from everywhere in macOS.</p>
<p>Not to worry, Emacs comes with a client binary, <code>emacsclient</code>, to connect to a running instance of Emacs. This however requires Emacs to be running in <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Emacs-Server.html">server mode</a>, which can simply be achieved with the following lines.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">server-running-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">server-start</span><span class="p">))</span>
</span></span></code></pre></div><p>All of the above can be used to run almost all functions in Emacs from the command line. I have the following function and advices after <code>org-capture-finalize</code> and <code>org-capture-destroy</code> in my configuration to popup a capture frame and close it afterwards&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-make-capture-frame</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Create a new frame and run </span><span class="ss">`org-capture&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">make-frame</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">name</span> <span class="o">.</span> <span class="s">&#34;capture&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">top</span> <span class="o">.</span> <span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">left</span> <span class="o">.</span> <span class="mi">700</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">width</span> <span class="o">.</span> <span class="mi">80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">height</span> <span class="o">.</span> <span class="mi">25</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">select-frame-by-name</span> <span class="s">&#34;capture&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">delete-other-windows</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">noflet</span> <span class="p">((</span><span class="nv">switch-to-buffer-other-window</span> <span class="p">(</span><span class="nv">buf</span><span class="p">)</span> <span class="p">(</span><span class="nv">switch-to-buffer</span> <span class="nv">buf</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">org-capture</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defadvice</span> <span class="nv">org-capture-finalize</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">after</span> <span class="nv">delete-capture-frame</span> <span class="nv">activate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Advise capture-finalize to close the frame.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="s">&#34;capture&#34;</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">delete-frame</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defadvice</span> <span class="nv">org-capture-destroy</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">after</span> <span class="nv">delete-capture-frame</span> <span class="nv">activate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Advise capture-destroy to close the frame.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="s">&#34;capture&#34;</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">delete-frame</span><span class="p">)))</span>
</span></span></code></pre></div><p>&hellip; which I then call from the terminal like so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">/usr/local/bin/emacsclient -ne <span class="s2">&#34;(timu-func-make-capture-frame)&#34;</span>
</span></span></code></pre></div><p>The next step is then to be able to call this not just from the command line but from everywhere on the system.</p>
<p>In comes <code>Automator.app</code>. Using the <strong>&ldquo;Run Shell Script&rdquo;</strong> Action I can create a <code>Quick Action</code> accessible from the everywhere on the system with the shell command above.</p>
<figure><img src="https://macowners.club/images/org-capture-everywhere-macos-2.png" width="800px">
</figure>

<p>In macOS Services a.k.a. Quick Actions can be bound to keyboard shortcuts:</p>
<p><code>System Preferences -&gt; Keyboard -&gt; Shortcuts -&gt; Services</code></p>
<figure><img src="https://macowners.club/images/org-capture-everywhere-macos-3.png" width="800px">
</figure>

<p><strong><a href="https://macowners.club/posts/context-menu-item-automator/">This article</a> goes into more details on how to create a macOS Service/Quick Action with Automator.app.</strong></p>
<h2 id="capture-an-url-from-safari">Capture an URL from Safari</h2>
<p>Simply put this is a much more elegant way of collecting what are essentially bookmarks for later review. I could of course store found treasures on the internet in the bookmarks in Safari (yes, I do <strong>not</strong> use Chrome), but bookmarks are notoriously awful to parse in my mind.</p>
<p>I have a file, <code>~/org/files/notes.org</code>, where I store URLs to content that I mostly find on the internet with a <code>datetree</code>.</p>
<figure><img src="https://macowners.club/images/org-capture-everywhere-macos-4.png" width="800px">
</figure>

<p>This uses the following</p>
<p><strong>a) package:</strong></p>
<p><strong><a href="https://gitlab.com/aimebertrand/org-mac-link">org-mac-link</a></strong> (Shameless plug: I have taken over the maintenance of the package and moved it out of <a href="https://elpa.nongnu.org/nongnu/org-contrib.html">org-contrib</a>. The Package <a href="https://git.sr.ht/~bzg/org-contrib/commit/e69be2c33885033e9706148568a2250c19587cb8">will be removed from the collection</a> with the next release.)</p>
<p><strong>b) Function:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-url-safari-capture-to-org</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Call </span><span class="ss">`org-capture-string&#39;</span><span class="s"> on the current front most Safari window.
</span></span></span><span class="line"><span class="cl"><span class="s">Use </span><span class="ss">`org-mac-link-safari-get-frontmost-url&#39;</span><span class="s"> to capture url from Safari.
</span></span></span><span class="line"><span class="cl"><span class="s">Triggered by a custom macOS Quick Action with a keyboard shortcut.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-capture-string</span> <span class="p">(</span><span class="nv">org-mac-link-safari-get-frontmost-url</span><span class="p">)</span> <span class="s">&#34;u&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">ignore-errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-capture-finalize</span><span class="p">))</span>
</span></span></code></pre></div><p><strong>c) <a href="https://orgmode.org/manual/Capture-templates.html">capture template</a>:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-capture-templates</span>
</span></span><span class="line"><span class="cl">             <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;u&#34;</span> <span class="s">&#34;URL capture from Safari&#34;</span> <span class="nv">entry</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">file+olp+datetree</span> <span class="s">&#34;~/org/files/notes.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="s">&#34;* %i    :safari:url:\n%U\n\n&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p><strong>d) Automator.app Quick Action:</strong></p>
<p>Now to call this outside of Emacs, I use <code>AppleScript</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-applescript" data-lang="applescript"><span class="line"><span class="cl"><span class="k">on</span> <span class="nb">run</span> <span class="p">{</span><span class="nv">input</span><span class="p">,</span> <span class="nv">parameters</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">do shell script</span> <span class="s2">&#34;/usr/local/bin/emacsclient -n -e &#39;(timu-func-url-safari-capture-to-org)&#39;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">do shell script</span> <span class="s2">&#34;/usr/local/bin/emacsclient -n -e &#39;(find-file \&#34;~/org/files/notes.org\&#34;)&#39;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="no">return</span> <span class="nv">input</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="nb">run</span>
</span></span></code></pre></div><p>Which in turn can be of course made into a <strong>&ldquo;Run AppleScript&rdquo;</strong> Quick Action:</p>
<figure><img src="https://macowners.club/images/org-capture-everywhere-macos-5.png" width="800px">
</figure>

<h2 id="capture-an-url-and-content-from-safari">Capture an URL and content from Safari</h2>
<p>There some content on the web that I want to store for posterity however. In these cases I don&rsquo;t want to just capture the URL, but the content as well.</p>
<ol>
<li>Select the content to be stored</li>
<li>Hit a keyboard shortcut</li>
<li>Content is stored in an org file including proper formatting</li>
</ol>
<p>This takes a little more effort to work straight from Safari, which I collected from a bunch of people online and adjusted to my workflow.</p>
<p><strong>a) package:</strong></p>
<p><a href="https://gitlab.com/aimebertrand/org-mac-link">org-mac-link</a></p>
<p><strong>b) CLI program:</strong></p>
<p>For this I also need <a href="https://pandoc.org">Pandoc</a> on my system, which I get using <a href="https://brew.sh">Homebrew</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">brew install pandoc
</span></span></code></pre></div><p><strong>c) Functions:</strong></p>
<p>Bare in mind, that these do need the <code>cl-lib</code> library. So do not forget to require it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;;; capture and/or org-yank from macos clipboard</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; credit: http://www.howardism.org/Technical/Emacs/capturing-content.html</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; credit: https://gitlab.com/howardabrams/spacemacs.d/-/tree/master/layers</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-cmd-with-exit-code</span> <span class="p">(</span><span class="nv">program</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Run PROGRAM with ARGS and return the exit code and output in a list.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-temp-buffer</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">apply</span> <span class="ss">&#39;call-process</span> <span class="nv">program</span> <span class="no">nil</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)</span> <span class="no">nil</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">buffer-string</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-convert-applescript-to-html</span> <span class="p">(</span><span class="nv">contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return the Applescript&#39;s clipboard CONTENTS in a packed array.
</span></span></span><span class="line"><span class="cl"><span class="s">Convert and return this encoding into a UTF-8 string.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">cl-flet</span> <span class="p">((</span><span class="nv">hex-pack-bytes</span> <span class="p">(</span><span class="nv">tuple</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nf">string-to-number</span> <span class="p">(</span><span class="nf">apply</span> <span class="ss">&#39;string</span> <span class="nv">tuple</span><span class="p">)</span> <span class="mi">16</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">data</span> <span class="p">(</span><span class="nv">-&gt;</span> <span class="nv">contents</span> <span class="p">(</span><span class="nf">substring</span> <span class="mi">10</span> <span class="mi">-2</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-to-list</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nv">byte-seq</span> <span class="p">(</span><span class="nv">-&gt;&gt;</span> <span class="nv">data</span> <span class="p">(</span><span class="nv">-partition</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">mapcar</span> <span class="nf">#&#39;</span><span class="nv">hex-pack-bytes</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">decode-coding-string</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">mapconcat</span> <span class="nf">#&#39;byte-to-string</span> <span class="nv">byte-seq</span> <span class="s">&#34;&#34;</span><span class="p">)</span> <span class="ss">&#39;utf-8</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-get-mac-clipboard</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return a list where the first entry is the either :html or :text.
</span></span></span><span class="line"><span class="cl"><span class="s">The second is the clipboard contents.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">cl-destructuring-bind</span> <span class="p">(</span><span class="nv">exit-code</span> <span class="nv">contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">timu-func-cmd-with-exit-code</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;/usr/bin/osascript&#34;</span> <span class="s">&#34;-e&#34;</span> <span class="s">&#34;the clipboard as \&#34;HTML\&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">=</span> <span class="mi">0</span> <span class="nv">exit-code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">list</span> <span class="nb">:html</span> <span class="p">(</span><span class="nv">timu-func-convert-applescript-to-html</span> <span class="nv">contents</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">list</span> <span class="nb">:text</span> <span class="p">(</span><span class="nv">shell-command-to-string</span>
</span></span><span class="line"><span class="cl">                   <span class="s">&#34;/usr/bin/osascript -e &#39;the clipboard&#39;&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-org-clipboard</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return the contents of the clipboard in </span><span class="ss">`org-mode&#39;</span><span class="s"> format.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">cl-destructuring-bind</span> <span class="p">(</span><span class="nv">type</span> <span class="nv">contents</span><span class="p">)</span> <span class="p">(</span><span class="nv">timu-func-get-mac-clipboard</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-temp-buffer</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">insert</span> <span class="nv">contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nb">:html</span> <span class="nv">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">shell-command-on-region</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">&#34;pandoc&#34;</span><span class="p">)</span> <span class="s">&#34; -f html -t org --wrap=none&#34;</span><span class="p">)</span> <span class="no">t</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">shell-command-on-region</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">&#34;pandoc&#34;</span><span class="p">)</span> <span class="s">&#34; -f markdown -t org --wrap=none&#34;</span><span class="p">)</span> <span class="no">t</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-org-yank-clipboard</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Yank the contents of the Mac clipboard in an </span><span class="ss">`org-mode&#39;</span><span class="s"> compatible format.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">timu-func-org-clipboard</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-func-safari-capture-to-org</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Call </span><span class="ss">`org-capture-string&#39;</span><span class="s"> on the contents of the Apple clipboard.
</span></span></span><span class="line"><span class="cl"><span class="s">Use </span><span class="ss">`org-mac-link-safari-get-frontmost-url&#39;</span><span class="s"> to capture content from Safari.
</span></span></span><span class="line"><span class="cl"><span class="s">Triggered by a custom macOS Quick Action with keybinding.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-capture-string</span> <span class="p">(</span><span class="nv">timu-func-org-clipboard</span><span class="p">)</span> <span class="s">&#34;s&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">ignore-errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">org-mac-link-safari-get-frontmost-url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-capture-finalize</span><span class="p">))</span>
</span></span></code></pre></div><p><strong>d) <a href="https://orgmode.org/manual/Capture-templates.html">capture template</a>:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-capture-templates</span>
</span></span><span class="line"><span class="cl">             <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="s">&#34;macOS Safari clipboard capture&#34;</span> <span class="nv">entry</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">file+olp+datetree</span> <span class="s">&#34;~/org/files/notes.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="s">&#34;* %?    :safari:note:\n%U\n\n%i\n&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p><strong>e) Automator.app Quick Action:</strong></p>
<p>Following the already mentioned recipe, the next step is a Quick Action to be called with a keyboard shortcut:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-applescript" data-lang="applescript"><span class="line"><span class="cl"><span class="k">on</span> <span class="nb">run</span> <span class="p">{</span><span class="nv">input</span><span class="p">,</span> <span class="nv">parameters</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">tell</span> <span class="nb">application</span> <span class="s2">&#34;System Events&#34;</span> <span class="k">to</span> <span class="nv">keystroke</span> <span class="s2">&#34;c&#34;</span> <span class="nv">using</span> <span class="nv">command</span> <span class="nv">down</span>
</span></span><span class="line"><span class="cl">    <span class="nb">do shell script</span> <span class="s2">&#34;/usr/local/bin/emacsclient -n -e &#39;(timu-func-safari-capture-to-org)&#39;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">do shell script</span> <span class="s2">&#34;/usr/local/bin/emacsclient -n -e &#39;(find-file \&#34;~/org/files/notes.org\&#34;)&#39;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">application</span> <span class="s2">&#34;Emacs&#34;</span> <span class="ow">is</span> <span class="nv">running</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="k">tell</span> <span class="nb">application</span> <span class="s2">&#34;Emacs&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nb">activate</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span> <span class="k">tell</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">if</span>
</span></span><span class="line"><span class="cl">    <span class="no">return</span> <span class="nv">input</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="nb">run</span>
</span></span></code></pre></div><figure><img src="https://macowners.club/images/org-capture-everywhere-macos-6.png" width="800px">
</figure>

<h2 id="last-words">Last words</h2>
<p>As mentioned before, I &ldquo;stole&rdquo; quite a bit of code and made it mine to fit my workflow. I am reasonably happy with the state of things right now.</p>
<p>This prompted me to write this down in the hope, that it might help a few people needing a similar workflow like mine.</p>
<p>I have few other ways I capture stuff, i.e. from the Finder.app, Outlook, etc. Not gonna go into those however since there is not nead to repeat myself a lot. Plus I think that with the Safari.app examples, the concept is quite clear.</p>
<p>Functions and capture templates in Emacs, Automator.app actions to call the functions and then keyboard shortcuts to call those actions.</p>
<p>Check out my <a href="https://gitlab.com/aimebertrand/dotemacs">dotemacs repo</a> for more or just send me a quick <a href="mailto:aime.bertrand@macowners.club">email</a> if you are curious about more capture stuff.</p>
<dl>
<dt>Side note one:</dt>
<dd>As of a few versions ago macOS introduced the <a href="https://support.apple.com/en-gb/guide/shortcuts-mac/apdf22b0444c/mac">Shortcuts.app</a> on the mac, which can handle automation jobs as well. However I haven&rsquo;t gotten into those yet. Who knows, might be topic for future post.</dd>
<dt>Side note two:</dt>
<dd>One can use a wonderful app called Hammerspoon for a lot of automation, <a href="https://macowners.club/posts/favorite-apps-tools-5/">which I did use in the beginning</a> instead of Automator. However for some reason it failed me at some point and I gave up due to my lack of skills with Lua.</dd>
</dl>
<h2 id="meta">Meta</h2>
<ul>
<li><strong>Machine:</strong> MacBook Pro 13&quot; M1</li>
<li><strong>OS:</strong> macOS Monterey</li>
<li><strong>Emacs Version:</strong> GNU Emacs 28.1 (Emacs Mac Port version)</li>
<li><strong>Emacs installation using <a href="https://brew.sh">Homebrew</a>:</strong></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">brew tap railwaycat/emacsmacport
</span></span><span class="line"><span class="cl">brew install emacs-mac --with-native-comp --with-xwidgets --with-natural-title-bar
</span></span></code></pre></div>