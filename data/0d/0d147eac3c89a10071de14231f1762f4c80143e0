
	
<p>
In the 1980s and early 1990s, I spent a lot of time playing and writing text adventure games on my Atari 8-bit computer. Text adventures, or interactive fiction, are games where the player reads a story on the screen. The player can change the outcomes of the story by issuing text instructions to the computer. These lines are an extract from <a href="http://rickadams.org/adventure/">Colossal Cave</a>, by Will Crowther and Don Woods, the very first text adventure written in the mid-1970s:</p>
<pre class="example">
You are standing at the end of a road before a small brick building. Around you is a forest. A small stream flows out of the building and down a gully.
&gt; go south
You are in a valley in the forest beside a stream tumbling along a rocky bed.
&gt; enter stream
Your feet are now wet.
</pre>
<p>
The basic premise of a text adventure is that the player finds herself in a simulated world. Unlike contemporary simulations, this virtual world is created only with text. This might seem a strange idea to modern games, but simulated worlds through text have existed for thousands of years. A text adventure enhances the traditional book by giving the player the freedom to act within the narrative. The objective of these games is to solve problems to reach a specified goal. </p>
<p>
This article describes how to write a text adventure in the R language. This article replicates a game and the techniques described by Hal Renko and Sam Edwards in the Dutch book <em>Adventures!</em> (1986).</p>
<figure>
<img src="https://lucidmanager.org/images/rgames/renko-edwards.jpg" alt="Hal Renko and Sam Edwarks. Adventures! (1986)." title="Hal Renko and Sam Edwarks. Adventures! (1986)."/>
<figcaption>
Cover of the 1986 book <em>Adventures!</em>
</figcaption>
</figure>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Spoiler Alert!
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The sections below describe the detailed workings and the narrative of the game. If you don&#39;t like spoilers, then perhaps you should download the code and play <em>The Secret of Landusia</em> before reading further.</p>
<p>
<a href = "https://github.com/pprevos/RGames/" target="_blank"
   title="Download RGames from GitHub"
   alt="Download RGames from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">RGames</span>
  </button>
</a>

</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
The Secret of Landusia Text Adventure
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>This section explains the detailed workings of the Landusia game. The text adventure consists of four files:</p>
<ul>
<li><code class="verbatim">adventure.R</code>: The code.</li>
<li><code class="verbatim">actions.md</code>: Markdown file with descriptions of rooms and actions.</li>
<li><code class="verbatim">map.csv</code>: Matrix of the relationship between rooms.</li>
<li><code class="verbatim">objects.csv</code>: Matrix of the status of objects and actors.</li>
</ul>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
The Game Loop
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>The computer displays the current state of the game with a short piece of prose. The player then enters a command in natural language, which changes the state of the game. When the state of the player or the game reaches a certain point, the player has either won or lost the game. The game loop processes the commands of the player and determines the new state of the game. The state of the game consists of:</p>
<ul>
<li><em>Player</em>: The player can have many attributes, such as health, objects
they are carrying and their location.</li>
<li><em>Map</em>: Logic of the game localities and a description of each area.</li>
<li><em>Objects</em>: Are either placed in a room or are with the player.</li>
<li><em>Actors</em>: Can act independently.</li>
</ul>
<figure>
<img src="https://lucidmanager.org/images/rgames/landusia-flowchart.png" alt="Text adventure flowchart" title="Text adventure flowchart"/>
<figcaption>
Text adventure flowchart.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
Initialisation
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<p>The initialisation defines the vocabulary through a vector of verbs and a vector of directions. The code reads the map, objects and prose into memory and sets the starting variables for the player. The initialisation includes two auxiliary functions that the player cannot call directly.</p>
<p>
The prose function takes a key phrase and finds the location of the heading for that key in the <code class="verbatim">actions</code> variable. The following lines of code print the text up to the next heading indicator. The prose function describes rooms, actions, actors and so on. Using a markdown file simplifies writing the text so it is not hidden amongst code. The prose function reads keywords after double hashtags. Other headings are used for convenience.</p>
<p>
The inventory function lists all objects that the player carries. This function is a separate verb in most adventure games, but in this game, it is integrated with other verbs.</p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
The Player
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>The program simulates the player with a set of parameters, such as their location, level of health and whatever other aspect is relevant. A player can, for example, only carry a certain number of objects, can only endure two blows by a sword, and so on.</p>
<p>
In the Landusia game, the player has a level of <code class="verbatim">health</code> and maximum carrying <code class="verbatim">capacity</code>. The <code class="verbatim">room</code> variable keeps track of where the player is located.</p>
<div id="outline-container-headline-6" class="outline-4">
<h4 id="headline-6">
The Map
</h4>
<div id="outline-text-headline-6" class="outline-text-4">
<p>The game consists of 28 &#39;rooms&#39;. The map is stored in a matrix which indicates the relationships between the rooms. Each direction can have one or no exit. The map can also dynamically change during the game. Specific directions can, for example, only become available after the player opens a door. A rockfall could close an entrance, and so on. The player can move around the map by issuing directional commands. These commands are the four cardinal compass directions, and up and down.</p>
<p>
In Landusia, the first nine rooms are a forest. The blacksmith lives south of the forest. Clovar&#39;s castle lies to the south-east and the temple north-east of the forest. The connection between room 14 and 15 opens after the player uses the rope in room 14.</p>
<figure>
<img src="https://lucidmanager.org/images/rgames/landusia-map.png" alt="Secret of Landusia map" title="Secret of Landusia map"/>
<figcaption>
Secret of Landusia map.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-7" class="outline-4">
<h4 id="headline-7">
Objects
</h4>
<div id="outline-text-headline-7" class="outline-text-4">
<p>The descriptions of the different rooms of the game can contain objects. These objects are fixed in that their description is hard-coded into the game. A text adventure can also have movable objects. Each object can have its own properties, such as weight, and location. The location of the object can either be a room or the player (room zero). These properties are stored in another matrix.</p>
<p>
The Landusia game has four objects: bandage, sword, flute and rope. These objects are scattered around the map and have a certain weight. The <code class="verbatim">capacity</code> variable limits what the layer can carry simultaneously.</p>
<figure>
<img src="https://lucidmanager.org/images/rgames/landusia-battlements.jpg" alt="Landusia castle battlements" title="Landusia castle battlements"/>
<figcaption>
Landusia castle battlements.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-8" class="outline-4">
<h4 id="headline-8">
Actors
</h4>
<div id="outline-text-headline-8" class="outline-text-4">
<p>Actors are like objects, with the difference that they are active in the game. As the game progresses, actors take independent actions. Actors can move around the map and respond to the actions of the player. They can have properties, such as health and strength. Actors can be either friends or enemies that create a dynamic narrative.</p>
<p>
Landusia has four actors which are stored in the same matrix a the objects. Each actor has a name, location, health and status. The actors function controls their actions.</p>
<div id="outline-container-headline-9" class="outline-5">
<h5 id="headline-9">
Wizard
</h5>
<div id="outline-text-headline-9" class="outline-text-5">
<p>The wizard appears in the living quarters. His only task is to give the player the flute, once they manage to reach him. After this one action, the wizard vanishes by changing his location to room 100.</p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-5">
<h5 id="headline-10">
Crow
</h5>
<div id="outline-text-headline-10" class="outline-text-5">
<p>When the player is in the forest, a random variable determine whether they are swooped by a crow. Another random variable determines whether the player was hurt. If the crow manages to hit the player, the code reduces the <code class="verbatim">health</code> variable.</p>
<figure>
<img src="https://lucidmanager.org/images/rgames/landusia-crow.jpg" alt="Crow attacking the player" title="Crow attacking the player"/>
<figcaption>
Crow attacking the player.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-11" class="outline-5">
<h5 id="headline-11">
Dragon
</h5>
<div id="outline-text-headline-11" class="outline-text-5">
<p>The dragon sequence depends on the room the player is in. In room 17, the dragon has a 50% chance of hitting, while in room 18, the dragon is always sucessful. The player needs to kill the dragon with the sword (see below). The success of these fights depends on a random variable.</p>
</div>
</div>
<div id="outline-container-headline-12" class="outline-5">
<h5 id="headline-12">
Blacksmith
</h5>
<div id="outline-text-headline-12" class="outline-text-5">
<p>The blacksmith has the most complex handler of them all. He starts lying wounded on the floor. If the player does not help the blacksmith by using the bandage, he will die. If the player uses the bandage, the blacksmith is healed and move to the workshop to forge a sword for the player. The status variable controls the evolution of the blacksmith in the game.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-13" class="outline-4">
<h4 id="headline-13">
Command interpreter
</h4>
<div id="outline-text-headline-13" class="outline-text-4">
<p>The command interpreter asks the player for instructions, which the program then interprets. The state of the game (player, map, objects and actors) is changed, depending on the input. If the state of the game reaches a particular defined state, the game will end either successfully or miserably.</p>
<p>
The basic principle of all command translators in interactive fiction is that they analyse the input using
<a href="https://www.regular-expressions.info/rlanguage.html">regex</a>-type approaches. The interpreter compares the player&#39;s instructions with a vocabulary and strips verbs and nouns.</p>
<p>
For example, &#34;take lamp&#34; calls the take function and passes it the parameter <em>lamp</em>. The object <em>lamp</em> will then be moved from its current location to the player. The game could also check if the player still has enough carrying capacity and so on.</p>
<p>
If the player enters a command that the interpreter cannot parse, then a negative response follows. The better the text adventure, the higher the likelihood that the game understands the command. Traditional text adventures use elaborate command interpreters to maximise the level of realism of the simulated world. This text adventure uses a minimised vocabulary and each of the verbs has its own function.</p>
<figure>
<img src="https://lucidmanager.org/images/rgames/landusia-dragon.jpg" alt="The dragon of Landusia" title="The dragon of Landusia"/>
<figcaption>
The dragon of Landusia.
</figcaption>
</figure>
<div id="outline-container-headline-14" class="outline-5">
<h5 id="headline-14">
Look
</h5>
<div id="outline-text-headline-14" class="outline-text-5">
<p>The look function takes a room number as input and displays the prose related to the room. The next section lists the available passages and objects in the room. The final part of the look function displays any objects that the player is carrying.</p>
</div>
</div>
<div id="outline-container-headline-15" class="outline-5">
<h5 id="headline-15">
Take and Put
</h5>
<div id="outline-text-headline-15" class="outline-text-5">
<p>These two functions allow a player to take an object or place it on the ground. The weight of the object is added or subtracted to the carrying capacity. When the object is not present in the room or not carried by the player, the code responds appropriately.</p>
<p>
These functions cannot respond to objects mentioned in the room descriptions or actors, such as trees or the dragon. This can be easily remedied by creating two types of objects, moveable and immovable.</p>
</div>
</div>
<div id="outline-container-headline-16" class="outline-5">
<h5 id="headline-16">
Wait
</h5>
<div id="outline-text-headline-16" class="outline-text-5">
<p>The wait function does nothing. Waiting might be useful to let other actors do their thing. The wait function has a dummy parameter because there is none, but the main loop assigns one to each verb. This verb is needed to give the blacksmith enough time to forge the sword.</p>
</div>
</div>
<div id="outline-container-headline-17" class="outline-5">
<h5 id="headline-17">
Use
</h5>
<div id="outline-text-headline-17" class="outline-text-5">
<p>The use function starts by checking whether the player actually has the object in their possession. The remainder of the function contains instructions for each of the four objects. The bandage will either heal yourself or the blacksmith. The sword is not very useful in this context. The flute activates the magical teleportation by changing the <code class="verbatim">room</code> variable. Finally, using the rope changes the map by opening the connection between rooms 14 and 15. This action also changes the prose so that the room descriptions are enhanced.</p>
</div>
</div>
<div id="outline-container-headline-18" class="outline-5">
<h5 id="headline-18">
Kill
</h5>
<div id="outline-text-headline-18" class="outline-text-5">
<p>This last function is conditional upon having the sword. If the player has no sword, then their fists are the weapon of choice. If an opponent is present in the same room as the player, they have a 60% chance of hitting the opponent. The sword has a higher strength than a fist fight. The actor function controls the return hits.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-19" class="outline-3">
<h3 id="headline-19">
Expanding the Game
</h3>
<div id="outline-text-headline-19" class="outline-text-3">
<p>This game is modular in structure so that it should be easy to enhance this game or to write a completely different game. They key to writing a good adventure is simplicity. It is easy to get carried away with writing complex command structure that the player has to guess are available.</p>
<p>
Feel free to leave a message below if you find bugs or like to enhance the prose or code.</p>
<p>
A lot has changed in computing since the heyday of text adventures. Although these games provided an illusion of freedom to act in a simulated world, the player is always limited by what the writer intended them to do.</p>
<p>
Perhaps natural language processing, complex Markov chains and text-generating deep learning methods can generate the ultimate text adventure. Imagine a text adventure where the computer understands the basic structure but freely develops the prose and interactions.</p>
<p>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
</div>
</div>
</div>
</div>

      