<p>Where to place my Emacs configuration? That is the question!</p>

<p>This fairly simple question has surprisingly many answers, as it often happens with projects
as old as Emacs:</p>

<ul>
  <li>Historically Emacs’s user config was a file called <code class="language-plaintext highlighter-rouge">.emacs</code>, placed in your home directory</li>
  <li>Later you could use the name <code class="language-plaintext highlighter-rouge">init.el</code> as an alias to <code class="language-plaintext highlighter-rouge">.emacs</code></li>
  <li>And then there’s the option that’s probably most common today - placing your configuration
under the <code class="language-plaintext highlighter-rouge">.emacs.d</code> folder, where you usually have an <code class="language-plaintext highlighter-rouge">init.el</code> that potentially refers to
other Emacs Lisp libraries</li>
</ul>

<p>But wait, there’s more! Emacs 27.1 introduced <code class="language-plaintext highlighter-rouge">XDG_CONFIG_HOME</code> support, and Emacs 29.1 extended the
level of XDG base directory specification support in Emacs.</p>

<p>XDG, which stands for X Desktop Group, is a set of standards and specifications
developed by freedesktop.org to promote interoperability among different desktop
environments, primarily in Unix-like operating systems. The group focuses on
ensuring that applications can work seamlessly across various desktop
environments by adhering to common guidelines.</p>

<p>Their most notable work to date is the XDG base directory specification.  In a
nutshell this specification outlines the environment variables that define where
user-specific data files, configuration files, and cache files should be
stored. For instance, it specifies directories like <code class="language-plaintext highlighter-rouge">$XDG_CONFIG_HOME</code> for
configuration files and <code class="language-plaintext highlighter-rouge">$XDG_DATA_HOME</code> for data files.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>

<p>Most of the time the XDG config home would be <code class="language-plaintext highlighter-rouge">~/.config</code> and there would be
a subfolder there for the configuration of each application. In Emacs’s case that would be <code class="language-plaintext highlighter-rouge">~/.config/emacs</code>.
I hope it’s clear that the idea here is to reduce the clutter at the top-level and to make sure that each
application stores its configuration in a predictable place.</p>

<p>I think it’s really great that Emacs is (slowly) adopting the industry standards
and I believe that over the course of time the XDG config folder will become the
preferred place to store your Emacs configuration. That’s why I encourage
everyone to move in this direction and unclutter their home folder a bit.</p>

<p>Just keep in mind a couple of things:</p>

<ul>
  <li>You’ll have to make sure that folders like <code class="language-plaintext highlighter-rouge">~/.emacs.d</code> don’t exist anymore, as they’d have precedence over the XDG config folder. The configuration resolution happens like this:</li>
</ul>

<blockquote>
  <p>Emacs looks for your init file using the filenames <code class="language-plaintext highlighter-rouge">~/.emacs.el</code>, <code class="language-plaintext highlighter-rouge">~/.emacs</code>, or <code class="language-plaintext highlighter-rouge">~/.emacs.d/init.el</code> in that order; you can choose to use any one of these names. (Note that only the locations directly in your home directory have a leading dot in the location’s basename.)</p>

  <p>Emacs can also look in an XDG-compatible location for init.el, the default is the directory <code class="language-plaintext highlighter-rouge">~/.config/emacs</code>. This can be overridden by setting <code class="language-plaintext highlighter-rouge">XDG_CONFIG_HOME</code> in your environment, its value replaces <code class="language-plaintext highlighter-rouge">~/.config</code> in the name of the default XDG init file. However <code class="language-plaintext highlighter-rouge">~/.emacs.d</code>, <code class="language-plaintext highlighter-rouge">~/.emacs</code>, and <code class="language-plaintext highlighter-rouge">~/.emacs.el</code> are always preferred if they exist, which means that you must delete or rename them in order to use the XDG location.</p>

  <p>Note also that if neither the XDG location nor <code class="language-plaintext highlighter-rouge">~/.emacs.d</code> exist, then Emacs will create <code class="language-plaintext highlighter-rouge">~/.emacs.d</code> (and therefore use it during subsequent invocations).</p>

  <p>Emacs will set user-emacs-directory to the directory it decides to use.</p>
</blockquote>

<p>Not the best defaults IMO (especially falling back to creating <code class="language-plaintext highlighter-rouge">.emacs.d</code>), but you can’t fight tradition! Or rather - fighting tradition is pretty hard…</p>

<ul>
  <li>Some packages might have hardcoded the path in which they store their own configuration. In general they should be relying on <code class="language-plaintext highlighter-rouge">user-emacs-directory</code>, which will be auto-set to whatever directory Emacs discovered its configuration in, but there will always be some packages that probably didn’t do “the right thing”.</li>
</ul>

<p>I’m guessing that we’re not really getting rid of <code class="language-plaintext highlighter-rouge">~/.emacs.d</code> any time soon (or ever), but I’m hoping that article like this one might speed up a bit the process. Time will tell.</p>

<p>macOS users should keep in mind that unfortunately macOS doesn’t set the standard XDG environment variables, as it has its own notion of where things like configuration files, application cache, etc should be stored. Still, it’s fairly easy to just set the missing variables yourself (e.g. in your <code class="language-plaintext highlighter-rouge">.zshrc</code>):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span>XDG_CONFIG_HOME <span class="o">=</span> <span class="nv">$HOME</span>/.config
<span class="nb">export </span>XDG_DATA_HOME <span class="o">=</span> <span class="nv">$HOME</span>/.local/share
<span class="nb">export </span>XDG_STATE_HOME <span class="o">=</span> <span class="nv">$HOME</span>/.local/state
<span class="nb">export </span>XDG_CACHE_HOME <span class="o">=</span> <span class="nv">$HOME</span>/.cache
</code></pre></div></div>

<p>So, has anyone moved their Emacs config to respect the XDG conventions already? How smooth was the process for you?</p>

<p><strong>P.S.</strong> If you’re curious to learn more about how Emacs’s configuration discover process I’d suggest reading
<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Find-Init.html">this chapter</a> of the Emacs Manual. Good stuff!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Check out <a href="https://specifications.freedesktop.org/basedir-spec/latest/">the XDG base directory specification</a> for more details. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>