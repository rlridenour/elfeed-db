<p>My <a href="https://tfeb.org/fragments/documentation/tfeb-lisp-hax.html#tracing-macroexpansion-trace-macroexpand">macroexpansion tracer</a> can now print per-line prefixes when tracing, which can make things more readable.</p>
<!-- more-->

<p>I find <code>trace-macroexpand</code> pretty useful: if you write Lisp with lots of nontrivial macros<sup><a href="https://www.tfeb.org/fragments/feeds/lisp.rss.xml#2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-1-definition" name="2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-1-return">1</a></sup> then it can be fairly hard to understand what&rsquo;s going on when something is not working properly. <code>trace-macroexpand</code> lets you see this either for individual macros or many of them. It can, portably, trace any macro including ones defined by CL, which is even nicer.</p>

<p>However it&rsquo;s not always easy to distinguish its output from other output. So, I realised I could add a per-line prefix which can help distinguish its output. Here is an example.</p>

<pre class="brush: lisp"><code>&gt; (defvar *a* (cons nil nil))
*a*

&gt; (trace-macroexpand t)
nil

&gt; (trace-macro setf)
(setf)

&gt; (setf (car *a*) 10)
(setf (car *a*) 10)
 -&gt; (system::%rplaca *a* 10)
10

&gt; (setf *trace-macroexpand-per-line-prefix* "| ")
(setf *trace-macroexpand-per-line-prefix* "| ")
 -&gt; (let* (#) (setq *trace-macroexpand-per-line-prefix* #:|Store-Var-1692|))
"| "

&gt; (setf (car *a*) 11)
| (setf (car *a*) 11)
|  -&gt; (system::%rplaca *a* 11)
11</code></pre>

<p>This is in version 10.8.1<sup><a href="https://www.tfeb.org/fragments/feeds/lisp.rss.xml#2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-2-definition" name="2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-2-return">2</a></sup> of the <a href="https://tfeb.org/fragments/documentation/tfeb-lisp-hax.html">TFEB.ORG Lisp hax</a>, <a href="https://tfeb.org/computer/repos/tfeb-lisp-hax.git">git repo</a>.</p>

<hr />

<div class="footnotes">
 <ol>
  <li class="footnote-definition" id="2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-1-definition">
   <p>If you aren&rsquo;t doing that, why are you writing Lisp at all?&nbsp;<a href="https://www.tfeb.org/fragments/feeds/lisp.rss.xml#2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-1-return">&#8617;</a></p></li>
  <li class="footnote-definition" id="2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-2-definition">
   <p>10.8.0 had a stupid bug.&nbsp;<a href="https://www.tfeb.org/fragments/feeds/lisp.rss.xml#2025-10-08-optional-per-line-prefix-for-trace-macroexpand-footnote-2-return">&#8617;</a></p></li></ol></div>