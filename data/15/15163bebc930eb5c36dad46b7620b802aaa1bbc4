<style>.orange {color: #f7821b;}</style>
<div class="orange">
<p><strong>UPDATE - 13. Feb. 2024:</strong></p>
</div>
<p>From <a href="https://support.apple.com/en-gb/HT213893">What’s new for enterprise in macOS Sonoma</a>:</p>
<blockquote>
<p>Touch ID can be allowed for <code>sudo</code> with a configuration that persists across software updates using <code>/etc/pam.d/sudo_local</code>. See <code>/etc/pam.d/sudo_local.template</code> for details.</p>
</blockquote>
<p>This means the following steps will give you the result:</p>
<ol>
<li>
<p><code>sudo cp /etc/pam.d/sudo_local.template /etc/pam.d/sudo_local</code></p>
</li>
<li>
<p>Remove the comment <code>#</code> from the 3. line. This should be the result:</p>
</li>
</ol>
<!--listend-->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># sudo_local: local config file which survives system update and is included for sudo</span>
</span></span><span class="line"><span class="cl"><span class="c1"># uncomment following line to enable Touch ID for sudo</span>
</span></span><span class="line"><span class="cl">auth       sufficient     pam_tid.so
</span></span></code></pre></div><h2 id="motivation">Motivation</h2>
<p>I am lazy. Need I say more?</p>
<p>Listen, this is not a major thing, but I use sudo extensively. Therefore typing my password over and over again gets tedious at some point.</p>
<p>Lucky for me there is a solution&hellip;</p>
<p>Touch ID as an authentication method for sudo was at least envisioned by apple as it seems. However it is deactivated by default.</p>
<figure><img src="https://macowners.club/images/sudo-touch-id-dark.png" width="300px">
</figure>

<h2 id="how">How</h2>
<p>The file <code>/etc/pam.d/sudo</code> contains the authentication methods and rule sets for <code>sudo</code> on the command line.</p>
<p>All that remains is adding <code>auth sufficient pam_tid.so</code> at the beginning of the file. You will require sudo permissions to be able to write to the file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># sudo: auth account password session</span>
</span></span><span class="line"><span class="cl">auth       sufficient     pam_tid.so <span class="c1"># new line</span>
</span></span><span class="line"><span class="cl">auth       required       pam_opendirectory.so
</span></span><span class="line"><span class="cl">account    required       pam_permit.so
</span></span><span class="line"><span class="cl">password   required       pam_deny.so
</span></span><span class="line"><span class="cl">session    required       pam_permit.so
</span></span></code></pre></div><p><strong>Bonus:</strong> This works for all of the sudo prompts in my Emacs as well.</p>
<p><strong>Be advised:</strong></p>
<blockquote>
<p>You are messing with permission escalation here. Do be aware of the risks involved here. Read up if necessary.</p>
</blockquote>
<h2 id="iterm2">iTerm2</h2>
<p>This works with all the Terminal emulators, that I have used so far (Terminal, Kitty, Alacritty,&hellip;) out of the box.</p>
<p>However iTerm2 seems to be a diva in that regard. Meaning, that it needs more settings to go along. This is illustrated in this <a href="https://gitlab.com/gnachman/iterm2/-/issues/7608">GitLab issue</a>.</p>
<ul>
<li>Go to <code>Preferences &gt; Advanced</code></li>
<li>Search for <code>Allow sessions to survive after logging out and back in</code></li>
<li>Select &ldquo;No&rdquo; in the drop-down.</li>
</ul>
<figure><img src="https://macowners.club/images/sudo-touch-id-iterm.png" width="600px">
</figure>

