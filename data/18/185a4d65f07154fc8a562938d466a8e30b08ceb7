
         
         <p>Over at the <code class="language-plaintext highlighter-rouge">fontaine</code> repository, <a href="https://github.com/protesilaos/fontaine/issues/9">I was asked by
akartha</a> if we could
have a font preset for the minibuffer that is smaller than the others.
The minibuffer does not have its own face, so we cannot affect it with
Fontaine. We can, however, use the face remapping mechanism to change
the attributes of the <code class="language-plaintext highlighter-rouge">default</code> face locally in the minibuffer. Here
is the code for it.</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">defvar-local</span> <span class="nv">my-minibuffer-font-remap-cookie</span> <span class="no">nil</span>
  <span class="s">"The current face remap of `my-minibuffer-set-font'."</span><span class="p">)</span>

<span class="p">(</span><span class="nv">defface</span> <span class="nv">my-minibuffer-default</span>
  <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:height</span> <span class="mf">0.8</span><span class="p">))</span>
  <span class="s">"Face for the minibuffer and the Completions."</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">my-minibuffer-set-font</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">my-minibuffer-font-remap-cookie</span>
              <span class="p">(</span><span class="nv">face-remap-add-relative</span> <span class="ss">'default</span> <span class="ss">'my-minibuffer-default</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'minibuffer-mode-hook</span> <span class="nf">#'</span><span class="nv">my-minibuffer-set-font</span><span class="p">)</span>
</code></pre></div></div>

<p>[ Yes, I know <code class="language-plaintext highlighter-rouge">setq-local</code> is redundant for a <code class="language-plaintext highlighter-rouge">defvar-local</code>, but I
  prefer to be explicit. ]</p>

<p>In this example, the <code class="language-plaintext highlighter-rouge">my-minibuffer-default</code> is set to a height that
is 0.8 times the height of the <code class="language-plaintext highlighter-rouge">default</code> face. As such, if we increase
the height of the latter, the former will adapt gracefully. Only the
<code class="language-plaintext highlighter-rouge">default</code> needs an absolute <code class="language-plaintext highlighter-rouge">:height</code> value.</p>

<p>If you are using the generic completion user interface with the
<code class="language-plaintext highlighter-rouge">*Completions*</code> buffer, then you also need this:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'completion-list-mode-hook</span> <span class="nf">#'</span><span class="nv">my-minibuffer-set-font</span><span class="p">)</span>
</code></pre></div></div>

<p>Of course, we are not limited to changing the font height. Here is how
we can apply some different colours:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">defface</span> <span class="nv">my-minibuffer-default</span>
  <span class="o">'</span><span class="p">((((</span><span class="nc">class</span> <span class="nv">color</span><span class="p">)</span> <span class="p">(</span><span class="nv">min-colors</span> <span class="mi">88</span><span class="p">)</span> <span class="p">(</span><span class="nv">background</span> <span class="nv">dark</span><span class="p">))</span>
     <span class="ss">:background</span> <span class="s">"#181032"</span> <span class="ss">:foreground</span> <span class="s">"#a0d0ff"</span><span class="p">)</span>
    <span class="p">(((</span><span class="nc">class</span> <span class="nv">color</span><span class="p">)</span> <span class="p">(</span><span class="nv">min-colors</span> <span class="mi">88</span><span class="p">)</span> <span class="p">(</span><span class="nv">background</span> <span class="nv">light</span><span class="p">))</span>
     <span class="ss">:background</span> <span class="s">"#f2ede0"</span> <span class="ss">:foreground</span> <span class="s">"#6f2000"</span><span class="p">)</span>
    <span class="p">((</span><span class="no">t</span> <span class="ss">:height</span> <span class="mf">0.8</span><span class="p">)))</span>
  <span class="s">"Face for the minibuffer and the Completions."</span><span class="p">)</span>
</code></pre></div></div>

<p>If you are using any of my <code class="language-plaintext highlighter-rouge">modus-themes</code>, <code class="language-plaintext highlighter-rouge">ef-themes</code>, or
<code class="language-plaintext highlighter-rouge">standard-themes</code>, then you can also benefit from the macro that
exposes the palette of the effective theme. With Modus as an example:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-modus-themes-custom-faces</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">modus-themes-with-colors</span>
    <span class="p">(</span><span class="nv">custom-set-faces</span>
     <span class="o">`</span><span class="p">(</span><span class="nv">my-minibuffer-default</span> <span class="p">((</span><span class="no">t</span> <span class="ss">:background</span> <span class="o">,</span><span class="nv">bg-magenta-nuanced</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">magenta-cooler</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'enable-theme-functions</span> <span class="nf">#'</span><span class="nv">my-modus-themes-custom-faces</span><span class="p">)</span>
</code></pre></div></div>

<p>[ The palette can be previewed with <code class="language-plaintext highlighter-rouge">M-x modus-themes-preview-colors</code>.
  Check the manual of each of my packages for further details. ]</p>

<p>I can probably patch <code class="language-plaintext highlighter-rouge">minibuffer.el</code> to set its own face, but I have
not had the chance to look into the details. This “just works”, anyway.
Enjoy!</p>
        
      