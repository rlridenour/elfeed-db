<p>I <a href="https://taonaw.com/2025/04/27/a-month-with-journelly.html">mentioned</a> Rameriez&rsquo;s <a href="https://github.com/xenodium/dwim-shell-command">dwim tools</a>, and it&rsquo;s only natural to do some IT for fun when I rest from IT at work on the weekend, Rightâ€¦? Eh, don&rsquo;t answer that.</p>
<p>One of the important and excellent things about Rameriez&rsquo;s package is that it makes it easy to build something custom of your own using the &ldquo;Lego blocks&rdquo; he provided with the package.</p>
<p>For example, one of the commands that comes with the package is <code>dwim-shell-commands-resize-video</code>, which lets you resize the resolution of a video (and through that, its size). It does the job well, but I wanted something that compresses videos while retaining their resolution for quality. I know how to do this directly with ffmpeg, so I thought I&rsquo;d give dwim a go, and got something working pretty quickly:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lisp" data-lang="lisp">    (defun jtr/dwim-shell-command-compress-mp4-fast ()
      <span style="color:#e6db74">&#34;Compresses mp4 down further using slow preset.&#34;</span>
      (interactive)
      (dwim-shell-command-on-marked-files
       <span style="color:#e6db74">&#34;Compresses MP4s with libx265 using slow preset to bring down size&#34;</span>
       <span style="color:#e6db74">&#34;ffmpeg -i &#39;&lt;&lt;f&gt;&gt;&#39; -c:v libx265 -crf 25 -preset slow &#39;&lt;&lt;fne&gt;&gt;_compressed.mp4&#39;&#34;</span>
       <span style="color:#e6db74">:utils</span> <span style="color:#e6db74">&#34;ffmpeg&#34;</span>))
</code></pre></div><p>There are a couple of things at work here with ffmpeg:</p>
<p>First, <code>libx265</code>, which is a newer decoder than the default <code>libx264</code>. The newer version does a better job at retaining video quality when compressing, but at the cost of compatibility; some older systems might not be able to play the resulting MP4 file or say there&rsquo;s something wrong with it until you install the needed decoder. If you&rsquo;re playing with ffmpeg regularly, you probably won&rsquo;t have a problem - but the people you send these videos to might, so keep that in mind.</p>
<p>Second, the slow preset. This increases the time it takes ffmpeg to work on the video as it combs through the frames more carefully. I forget exactly what it does, but I believe it grabs a smaller group of frames each time, so more frame groups (hence more time) with different compression values.</p>
<p>Lastly, the CRF value is at 25, a bit less than the default 28 for libx265, so a bit less compression. I can probably push it up a bit further, but the above already reduces the file size dramatically.</p>
