<p>
As Irreal oldtimers know, My absolute favorite Computer Science paper is Ken Thompson&rsquo;s <a href="https://www.cs.cmu.edu/~rdriley/487/papers/Thompson_1984_ReflectionsonTrustingTrust.pdf">Reflections on Trusting Trust</a>. It is truly a thing of beauty. This is a beauty that should be appreciated in stages.
</p>
<p>
In the first stage, we&rsquo;re introduced to, as the Jargon File puts it, <a href="http://www.catb.org/~esr/jargon/html/B/back-door.html">a truly moby hack</a> perpetrated by Thompson. He changed the C compiler to recognize when the <code>login</code> function was being compiled and insert a backdoor that would allow anyone knowing a special password to login. There&rsquo;s nothing special about that, of course but the clever part was that he also changed the compiler to recognize when it was compiling itself and to insert the code that generated the back door. He used that compiler to compile a version of the compiler without the changes. Now he had a compiler that would insert the backdoor <i>and</i> replicate the code to insert the back door if the compiler itself was recompiled. But the compiler sources no longer showed any signs of this.
</p>
<p>
The second stage is understanding how this was done. It turns out to be pretty simple. Thompson worked at the source level by changing the C preprocessor so that he could work at the source level of the code being compiled. The login backdoor insertion code simply looked for some specific code that called <code>crypt</code> and installed the book door there.
</p>
<p>
The really clever part was installing the code to replicate the backdoor insertion code in a new compiler. Keep in mind that the source for that was no longer present in the C compiler source. Think, for a moment how you would do that. Remember, you&rsquo;re working at the source level. The answer has to do with quines.
</p>
<p>
Back in 2023, Russ Cox asked Thompson if he still had a copy of the code for the hack. Thompson did and he sent it to Cox who wrote an <a href="https://research.swtch.com/nih">excellent exegesis of it</a>. I <a href="https://irreal.org/blog/?p=11754">wrote about his explanation here</a>. Now Micah Kepe has revisited that code <a href="https://micahkepe.com/blog/thompson-trojan-horse/#5">and provided his own explanation of it</a>. Take a look at the explanation and try to understand it. You&rsquo;ll have to bear down but once you understand the details, a whole new world of understanding will be open to you.
</p>
<p>
The final stage of appreciation is realizing that it&rsquo;s really hard to be sure your computing environment is secure. Even if you&rsquo;re paranoid or use a distribution like Gentoo in which you compile everything by default, you still can&rsquo;t be sure someone hasn&rsquo;t slipped in a backdoor. There are, of course, ways of mitigating Thompson&rsquo;s type of attack but who knows what else is out there?</p>
