
         
         <p>I have been following the <code class="language-plaintext highlighter-rouge">master</code> branch of the emacs.git repository
for many years now. It helps me test new features and make necessary
adjustments to all the packages I develop/maintain. Below I explain
how I make this happen on my computer, which is running Debian stable
(Debian 12 “Bookworm” as of this writing). If you are a regular user,
there is no reason to build from source: just use the latest stable
release and you should be fine.</p>

<h2>Configure the <code class="language-plaintext highlighter-rouge">apt</code> development sources</h2>

<p>To build Emacs from source on Debian, you first need to have the
<code class="language-plaintext highlighter-rouge">deb-src</code> package archive enabled. In your <code class="language-plaintext highlighter-rouge">/etc/apt/sources.list</code>
file you must have something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deb http://deb.debian.org/debian/ bookworm main
deb-src http://deb.debian.org/debian/ bookworm main
</code></pre></div></div>

<p>After modifying the sources, run the following on the command line to
fetch the index with new package names+versions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt update
</code></pre></div></div>

<h2>Get the Emacs build dependencies</h2>

<p>Now that you have enabled the <code class="language-plaintext highlighter-rouge">deb-src</code> archive, you can install the
build dependencies of the Debian <code class="language-plaintext highlighter-rouge">emacs</code> package with the following on
the command line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt build-dep emacs
</code></pre></div></div>

<p>With this done, you are ready to build Emacs from source.</p>

<h2>Get the Emacs source code</h2>

<p>You need the <code class="language-plaintext highlighter-rouge">git</code> program to get the source code from the emacs.git
website. So install it with this command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install git
</code></pre></div></div>

<p>Now make a copy of the Emacs source code, using this on the command
line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://git.savannah.gnu.org/git/emacs.git ~/path/to/my/copy-of-emacs.git
</code></pre></div></div>

<p>Replace <code class="language-plaintext highlighter-rouge">~/path/to/my/copy-of-emacs.git</code> with the actual destination
of your preference. I have a <code class="language-plaintext highlighter-rouge">~/Builds</code> directory where I store all
the projects I build from source. I thus do:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://git.savannah.gnu.org/git/emacs.git ~/Builds/emacs.git
</code></pre></div></div>

<p>If the cloning process is too slow on your end, perform a <em>shallow
clone</em> instead. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone --depth 1 https://git.savannah.gnu.org/git/emacs.git ~/Builds/emacs.git
</code></pre></div></div>

<p>And if the Savannah website is not responsive, then clone from the
GitHub mirror (with the <code class="language-plaintext highlighter-rouge">--depth 1</code> if necessary):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/emacs-mirror/emacs.git ~/Builds/emacs.git
</code></pre></div></div>

<h2>Switch to the Emacs directory</h2>

<p>Assuming you have the copy of emacs.git stored at <code class="language-plaintext highlighter-rouge">~/Builds/emacs.git</code>,
you switch to that directory with the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/Builds/emacs.git
</code></pre></div></div>

<p>Keep in mind that unless you explicitly switch to another branch, you
are on <code class="language-plaintext highlighter-rouge">master</code>, i.e. the latest development target.</p>

<p><strong>NOTE:</strong> All subsequent commands are ran from your equivalent of
<code class="language-plaintext highlighter-rouge">~/Builds/emacs.git</code>.</p>

<h2>Run the <code class="language-plaintext highlighter-rouge">autogen.sh</code> the first time</h2>

<p>This script will generate the configuration scaffold. You only really
need to do this once (and I always forget about it for this very
reason). Simply do this on the command line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./autogen.sh
</code></pre></div></div>

<p>It checks that you have all you need to get started and prints output
like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Checking whether you have the necessary tools...
(Read INSTALL.REPO for more details on building Emacs)
Checking for autoconf (need at least version 2.65) ... ok
Your system has the required tools.
Building aclocal.m4 ...
Running 'autoreconf -fi -I m4' ...
Building 'aclocal.m4' in exec ...
Running 'autoreconf -fi' in exec ...
Configuring local git repository...
'.git/config' -&gt; '.git/config.~1~'
git config transfer.fsckObjects 'true'
git config diff.cpp.xfuncname '!^[ 	]*[A-Za-z_][A-Za-z_0-9]*:[[:space:]]*($|/[/*])
^((::[[:space:]]*)?[A-Za-z_][A-Za-z_0-9]*[[:space:]]*\(.*)$
^((#define[[:space:]]|DEFUN).*)$'
git config diff.elisp.xfuncname '^\([^[:space:]]*def[^[:space:]]+[[:space:]]+([^()[:space:]]+)'
git config diff.m4.xfuncname '^((m4_)?define|A._DEFUN(_ONCE)?)\([^),]*'
git config diff.make.xfuncname '^([$.[:alnum:]_].*:|[[:alnum:]_]+[[:space:]]*([*:+]?[:?]?|!?)=|define .*)'
git config diff.shell.xfuncname '^([[:space:]]*[[:alpha:]_][[:alnum:]_]*[[:space:]]*\(\)|[[:alpha:]_][[:alnum:]_]*=)'
git config diff.texinfo.xfuncname '^@node[[:space:]]+([^,[:space:]][^,]+)'
Installing git hooks...
'build-aux/git-hooks/commit-msg' -&gt; '.git/hooks/commit-msg'
'build-aux/git-hooks/pre-commit' -&gt; '.git/hooks/pre-commit'
'build-aux/git-hooks/prepare-commit-msg' -&gt; '.git/hooks/prepare-commit-msg'
'build-aux/git-hooks/post-commit' -&gt; '.git/hooks/post-commit'
'build-aux/git-hooks/pre-push' -&gt; '.git/hooks/pre-push'
'build-aux/git-hooks/commit-msg-files.awk' -&gt; '.git/hooks/commit-msg-files.awk'
'.git/hooks/applypatch-msg.sample' -&gt; '.git/hooks/applypatch-msg'
'.git/hooks/pre-applypatch.sample' -&gt; '.git/hooks/pre-applypatch'
You can now run './configure'.
</code></pre></div></div>

<p>Do not be intimidated by it. Focus on the final line instead, which
directs you to the <code class="language-plaintext highlighter-rouge">configure</code> directive.</p>

<h2>Explore the build flags</h2>

<p>How exactly you build Emacs depends on your preferences and
system-specific requirements. At the end of this post, I copy my
current configuration, though <strong>I advise against</strong> copying it without
understanding what it does.</p>

<p>If you have no specific preferences, just use the defaults by running
this on the command line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure
</code></pre></div></div>

<p>It will set up the build environment for you. If, however, you wish
to explore your options and customise the <code class="language-plaintext highlighter-rouge">emacs</code> program you will
get, then issue the following command and carefully read its output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure --help
</code></pre></div></div>

<p>The <strong>minimum I recommend</strong> is to specify where the build artefacts
are stored. I use this, which has not caused me any issues over the
years:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure --prefix=/usr/local
</code></pre></div></div>

<h2>Configure the build environment with your preferred flags</h2>

<p>Once you have understood the available options, go ahead and run
<code class="language-plaintext highlighter-rouge">configure</code>. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure --prefix=/usr/local --with-x-toolkit=gtk3
</code></pre></div></div>

<p>Whenever you need to rebuild Emacs with some new flags, run the
<code class="language-plaintext highlighter-rouge">configure</code> command again, passing it the relevant flags. If you wish
to keep the same options for a new build, then simply do not run
<code class="language-plaintext highlighter-rouge">configure</code> again.</p>

<h2>Make the program</h2>

<p>Once <code class="language-plaintext highlighter-rouge">configure</code> finishes its work, it is time to run the <code class="language-plaintext highlighter-rouge">make</code>
program. For new builds, this is as simple as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div></div>

<p>Sometimes you have old build artefacts that conflict with changes
upstream. When that happens, the build process will fail. You may then
need to use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make bootstrap
</code></pre></div></div>

<p>In general, <code class="language-plaintext highlighter-rouge">make</code> is enough. It will be slow the first time, but will
be faster on subsequent runs as it reuses what is already there. A
<code class="language-plaintext highlighter-rouge">make bootstrap</code> will always be slow though, as it generates
everything anew.</p>

<h2>Install the program that was made</h2>

<p>After <code class="language-plaintext highlighter-rouge">make</code> is done, you are ready to install Emacs:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo make install
</code></pre></div></div>

<p>You will not need escalated privileges (i.e. <code class="language-plaintext highlighter-rouge">sudo</code>) is you specified
a <code class="language-plaintext highlighter-rouge">--prefix</code> with a user directory during the <code class="language-plaintext highlighter-rouge">configure</code> step. How
you go about it is up to you.</p>

<h2>Keeping Emacs up-to-date</h2>

<p>Whenever you wish to update from source, go to where your copy of
emacs.git is (e.g. <code class="language-plaintext highlighter-rouge">~/Builds/emacs.git</code>) and pull the latest changes
using the <code class="language-plaintext highlighter-rouge">git</code> program:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull
</code></pre></div></div>

<p>Then repeat <code class="language-plaintext highlighter-rouge">make</code> and <code class="language-plaintext highlighter-rouge">make install</code>. Remember that you do not need
to re-run <code class="language-plaintext highlighter-rouge">configure</code> unless you specifically want to modify your
build (and if you do that, you probably need to <code class="language-plaintext highlighter-rouge">make bootstrap</code>).</p>

<h2>Learn about the latest <code class="language-plaintext highlighter-rouge">NEWS</code></h2>

<p>Emacs users can at all times learn about changes introduced in their
current version of Emacs with <code class="language-plaintext highlighter-rouge">M-x view-emacs-news</code>. It is bound to
the key <code class="language-plaintext highlighter-rouge">C-h n</code> by default. This command opens the current <code class="language-plaintext highlighter-rouge">NEWS</code>
file. With a numeric prefix argument, you get the <code class="language-plaintext highlighter-rouge">NEWS</code> of the given
Emacs version. For example, <code class="language-plaintext highlighter-rouge">C-u 27 C-h n</code> shows you what Emacs
version 27 introduced.</p>

<h2>Compare your <code class="language-plaintext highlighter-rouge">NEWS</code> to those of emacs.git</h2>

<p>With the help of the built-in Emacs <code class="language-plaintext highlighter-rouge">ediff</code> package, you can compare
your latest <code class="language-plaintext highlighter-rouge">NEWS</code> to those coming from emacs.git. I always do this
after pulling the latest changes from source (with <code class="language-plaintext highlighter-rouge">git pull</code>).</p>

<p>From the root directory of your copye of emacs.git (e.g.
<code class="language-plaintext highlighter-rouge">~/Builds/emacs.git</code>), and while using Emacs, you can do <code class="language-plaintext highlighter-rouge">M-x
project-find-file</code> (<code class="language-plaintext highlighter-rouge">C-x p f</code>) to search the Emacs “project” for a
file called <code class="language-plaintext highlighter-rouge">etc/NEWS</code>. This is where the latest user-facing changes
are recorded.</p>

<p>If you are not sure where you are on the filesystem while inside
Emacs, do <code class="language-plaintext highlighter-rouge">M-x cd</code> (or <code class="language-plaintext highlighter-rouge">M-x dired</code> or <code class="language-plaintext highlighter-rouge">M-x find-file</code>), select the
root directory of your emacs.git, hit <code class="language-plaintext highlighter-rouge">RET</code>, and then do <code class="language-plaintext highlighter-rouge">M-x
project-find-file</code>.</p>

<p>Now that you have <code class="language-plaintext highlighter-rouge">emacs.git/etc/NEWS</code> in a buffer, also load your
copy of <code class="language-plaintext highlighter-rouge">NEWS</code> with <code class="language-plaintext highlighter-rouge">M-x view-emacs-news</code> (<code class="language-plaintext highlighter-rouge">C-h n</code>).</p>

<p>Then do <code class="language-plaintext highlighter-rouge">M-x ediff-buffers</code>, which will prompt for two buffers to
compare. First select your version of <code class="language-plaintext highlighter-rouge">NEWS</code> and then that of emacs.git.</p>

<p><strong>NOTE:</strong> I think the default Ediff interface is problematic. Put the
following in your configuration to make it work in a single frame:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">setq</span> <span class="nv">ediff-split-window-function</span> <span class="ss">'split-window-horizontally</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">ediff-window-setup-function</span> <span class="ss">'ediff-setup-windows-plain</span><span class="p">)</span>
</code></pre></div></div>

<p>Also watch my video with the Ediff basics: <a href="https://protesilaos.com/codelog/2023-11-17-emacs-ediff-basics/">https://protesilaos.com/codelog/2023-11-17-emacs-ediff-basics/</a>.</p>

<p>This is it. You are now in the flow of building Emacs from source.
Good luck with everything!</p>

<h2>My current build options</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--prefix=/usr/local --without-xinput2 --without-compress-install --without-gpm --without-selinux --with-native-compilation=yes --with-sound=no --without-gif --without-tiff --with-cairo --with-harfbuzz --with-tree-sitter=ifavailable --with-json --without-gsettings --without-gconf --with-x-toolkit=no --without-toolkit-scroll-bars --without-xft --without-xaw3d
</code></pre></div></div>

<p>I am not updating old publications, unless otherwise noted. The most
up-to-date recode of my Emacs build is documented in my dotemacs:
<a href="https://protesilaos.com/emacs/dotemacs">https://protesilaos.com/emacs/dotemacs</a>.</p>

<p>Inspect the value of the Emacs variable <code class="language-plaintext highlighter-rouge">system-configuration-options</code>
to find out how your Emacs is built.</p>

<p>Have fun!</p>
        
      