
<figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper">
<div class='github_readme_md'><p><img decoding="async" src="https://github.com/jamescherti/kirigami.el/actions/workflows/ci.yml/badge.svg" alt="Build Status" />
<a href="https://melpa.org/#/kirigami"><img decoding="async" src="https://melpa.org/packages/kirigami-badge.svg" alt="MELPA" /></a>
<a href="https://stable.melpa.org/#/kirigami"><img decoding="async" src="https://stable.melpa.org/packages/kirigami-badge.svg" alt="MELPA Stable" /></a>
<img decoding="async" src="https://img.shields.io/github/license/jamescherti/kirigami.el" alt="License" />
<img decoding="async" src="https://jamescherti.com/misc/made-for-gnu-emacs.svg" alt="" /></p>
<p>The <strong>kirigami</strong> Emacs package offers a <strong>unified interface for opening and closing folds</strong> across a diverse set of major and minor modes in Emacs, including <code>outline-mode</code>, <code>outline-minor-mode</code>, <code>outline-indent-mode</code>, <code>org-mode</code>, <code>markdown-mode</code>, <code>gfm-mode</code>, <code>vdiff-mode</code>, <code>vdiff-3way-mode</code>, <code>hs-minor-mode</code>, <code>hide-ifdef-mode</code>, <code>origami-mode</code>, <code>yafolding-mode</code>, <code>folding-mode</code>, and <code>treesit-fold-mode</code>.</p>
<p>With Kirigami, folding key bindings only need to be configured <strong>once</strong>. After that, the same keys work consistently across all supported major and minor modes, providing a unified and predictable experience for opening and closing folds. The available commands include:</p>
<ul>
<li><code>kirigami-open-fold</code>: Open the fold at point.</li>
<li><code>kirigami-open-fold-rec</code>: Open the fold at point recursively.</li>
<li><code>kirigami-close-fold</code>: Close the fold at point.</li>
<li><code>kirigami-open-folds</code>: Open all folds in the buffer.</li>
<li><code>kirigami-close-folds</code>: Close all folds in the buffer.</li>
<li><code>kirigami-toggle-fold</code>: Toggle the fold at point.</li>
</ul>
<p>If <strong>kirigami</strong> enhances your workflow, please show your support by <strong><img src="https://s.w.org/images/core/emoji/17.0.2/72x72/2b50.png" alt="â­" class="wp-smiley" style="height: 1em; max-height: 1em;" /> starring kirigami.el on GitHub</strong> to help more Emacs users discover its benefits.</p>
<p>In addition to unified interface for opening and closing folds, the <strong>kirigami</strong> package:</p>
<ul>
<li><strong>Enhances Visual Stability on Fold Opening and Closing:</strong> Preserves the cursor&#8217;s exact vertical position when expanding or collapsing headings, maintaining a constant relative distance between the cursor and the window start. This Kirigami enhancement avoids the disruptive window jump or forced re-centering commonly observed during bulk folding operations.</li>
<li><strong>Enhances outline:</strong> Enhances folding behavior in <code>outline-mode</code>, <code>outline-minor-mode</code>, <code>markdown-mode</code>, <code>gfm-mode</code>, and <code>org-mode</code>. It ensures that deep folds open reliably and allows folds to be closed even when the cursor is positioned inside the content. When <strong>kirigami</strong> closes outline folds, it preserves the visibility of folded headings in the window.)</li>
<li><strong>Hooks for Folding Actions:</strong> Two hooks, <code>kirigami-pre-action-predicates</code> and <code>kirigami-post-action-functions</code>, let external code run before and after every folding operation. The pre-action hook runs just before a fold is opened or closed and can allow or block the action. The post-action hook runs once the change is complete and can be used to update UI elements or keep external packages in sync with the new folding state.</li>
</ul>
<h2>Features</h2>
<p>Here are the features that <strong>kirigami</strong> offers:</p>
<ul>
<li><strong>Uniform commands</strong>: The same commands and keys can be used to open, close, toggle, or check folds, no matter what mode is active. (Commands: <code>kirigami-open-fold</code>, <code>kirigami-open-fold-rec</code>, <code>kirigami-open-folds</code>, <code>kirigami-close-fold</code>, <code>kirigami-toggle-fold</code>, <code>kirigami-close-folds</code>)</li>
<li><strong>Automatic handler selection</strong>: Kirigami automatically chooses the right folding method based on the mode being used.</li>
<li><strong>Extensible fold list</strong>: Users can easily add or customize folding methods for different modes through the <code>kirigami-fold-list</code> alist.</li>
<li>Support for multiple folding backends, including:<ul>
<li><code>outline-mode</code>, <code>outline-minor-mode</code></li>
<li><code>outline-indent-mode</code> (<a href="https://github.com/jamescherti/outline-indent.el">outline-indent.el</a>, a package that enables code folding based on indentation)</li>
<li><code>org-mode</code></li>
<li><code>markdown-mode</code> and <code>gfm-mode</code></li>
<li><code>vdiff-mode</code> and <code>vdiff-3way-mode</code></li>
<li><code>hs-minor-mode</code></li>
<li><code>hide-ifdef-mode</code></li>
<li><code>origami-mode</code></li>
<li><code>treesit-fold-mode</code></li>
</ul>
</li>
<li>In addition to unified interface, the kirigami package enhances folding behavior in <code>outline-mode</code>, <code>outline-minor-mode</code>, <code>markdown-mode</code>, <code>gfm-mode</code>, and <code>org-mode</code>. It ensures that deep folds open reliably and allows folds to be closed even when the cursor is positioned inside the content. When Kirigami closes outline folds, it preserves the visibility of folded headings in the window. Additionally, it resolves upstream Emacs issues, such as <a href="https://lists.gnu.org/archive/html/bug-gnu-emacs/2025-08/msg01128.html">bug#79286</a>.</li>
</ul>
<p>The kirigami package supports Emacs version 26.3 and above.</p>
<h2>Installation</h2>
<p>To install <strong>kirigami</strong> from MELPA:</p>
<ol>
<li>
<p>If you haven&#8217;t already done so, <a href="https://melpa.org/#/getting-started">add MELPA repository to your Emacs configuration</a>.</p>
</li>
<li>
<p>Add the following code to your Emacs init file to install <strong>kirigami</strong> from MELPA:</p>
<pre><code class="language-elisp">(use-package kirigami
:ensure t)</code></pre>
</li>
</ol>
<h2>Usage</h2>
<h3>Vanilla Emacs Key bindings</h3>
<p>Here is an example of default key bindings:</p>
<pre><code class="language-elisp">(global-set-key (kbd "C-c k o") 'kirigami-open-fold)     ; Open fold at point
(global-set-key (kbd "C-c k O") 'kirigami-open-fold-rec) ; Open fold recursively
(global-set-key (kbd "C-c k m") 'kirigami-close-folds)   ; Close all folds
(global-set-key (kbd "C-c k c") 'kirigami-close-fold)    ; Close fold at point
(global-set-key (kbd "C-c k r") 'kirigami-open-folds)    ; Open all folds
(global-set-key (kbd "C-c k TAB") 'kirigami-toggle-fold) ; Toggle fold at point</code></pre>
<h3>Evil-mode Key Bindings</h3>
<p>Evil-mode users can override the default folding keys with the following configuration:</p>
<pre><code class="language-elisp">;; Configure Kirigami to replace the default Evil-mode folding key bindings
(with-eval-after-load 'evil
  (define-key evil-normal-state-map "zo" 'kirigami-open-fold)
  (define-key evil-normal-state-map "zO" 'kirigami-open-fold-rec)
  (define-key evil-normal-state-map "zc" 'kirigami-close-fold)
  (define-key evil-normal-state-map "za" 'kirigami-toggle-fold)
  (define-key evil-normal-state-map "zr" 'kirigami-open-folds)
  (define-key evil-normal-state-map "zm" 'kirigami-close-folds))</code></pre>
<h3>Commands</h3>
<p>Kirigami defines several interactive commands. These commands abstract over all supported folding systems:</p>
<ul>
<li>
<p><code>kirigami-open-fold</code>
Open the fold at point.</p>
</li>
<li>
<p><code>kirigami-open-fold-rec</code>
Open the fold at point recursively.</p>
</li>
<li>
<p><code>kirigami-open-folds</code>
Open all folds in the buffer.</p>
</li>
<li>
<p><code>kirigami-close-fold</code>
Close the fold at point.</p>
</li>
<li>
<p><code>kirigami-toggle-fold</code>
Toggle the fold at point.</p>
</li>
<li>
<p><code>kirigami-close-folds</code>
Close all folds in the buffer.</p>
</li>
</ul>
<h2>Customizations</h2>
<h3>Extending Kirigami: Adding other fold methods</h3>
<p>The core behavior is driven by <code>kirigami-fold-list</code>, a customizable list that associates folding actions with sets of major or minor modes. Each entry in the list specifies:</p>
<ul>
<li>A list of modes that act as a predicate.</li>
<li>A property list describing supported folding actions.</li>
</ul>
<p>Properties include:</p>
<ul>
<li>
<p><code>:open-all</code>
Function to open every fold in the current buffer.</p>
</li>
<li>
<p><code>:close-all</code>
Function to close every fold in the current buffer.</p>
</li>
<li>
<p><code>:toggle</code>
Function to toggle the fold at point.</p>
</li>
<li>
<p><code>:open</code>
Function to open the fold at point.</p>
</li>
<li>
<p><code>:open-rec</code>
Function to open the fold at point recursively.</p>
</li>
<li>
<p><code>:close</code>
Function to close the fold at point.</p>
</li>
</ul>
<p>Each property must specify a function. A value of <code>nil</code> indicates that the corresponding action is ignored for that handler.</p>
<p>Here is an example using the built-in <code>hs-minor-mode</code>, which Kirigami supports by default. This example demonstrates how additional folding actions can be configured:</p>
<pre><code class="language-elisp">(push
 '((hs-minor-mode)
   :open-all    hs-show-all
   :close-all   hs-hide-all
   :toggle      hs-toggle-hiding
   :open        hs-show-block
   :open-rec    nil
   :close       hs-hide-block)
 kirigami-fold-list)</code></pre>
<h2>Frequently Asked Questions</h2>
<h3>Maintaining Vertical Cursor Position During Folding</h3>
<p>Folding packages such as Outline, Outline Indent, and Org mode depend on the native Emacs redisplay engine to handle visibility changes. Expanding or collapsing folds can cause <code>window-start</code> to shift relative to the current line. When this displacement moves the cursor off-screen, Emacs triggers an abrupt recentering. This visual discontinuity disrupts spatial context and requires manual effort to relocate the cursor.</p>
<p>To address these issues, the following option can be used to eliminate visual discontinuities by preventing window shifts and suppressing forced recentering when headings are expanded or collapsed:</p>
<pre><code class="language-elisp">(setq kirigami-preserve-visual-position t)</code></pre>
<h3>What is the meaning of the word Kirigami?</h3>
<p>Kirigami is a form of Origami, the Japanese art that transforms a flat sheet of paper into a figure through controlled folds. In kirigami, the sheet is both folded and cut to form a three-dimensional structure that rises from the surface.</p>
<p>Kirigami and code folding in Emacs share a structural analogy based on selective concealment and controlled revelation. In kirigami, cuts and folds create regions that can be collapsed or expanded, revealing depth or hiding detail depending on how the paper is manipulated.</p>
<p>Code folding in Emacs operates on a similar principle. Blocks of text remain present in the buffer, but their visibility is adjusted by folding or unfolding sections.</p>
<h2>Comments from users</h2>
<ul>
<li><a href="https://github.com/jamescherti/kirigami.el/pull/1#issuecomment-3599434757">neurolit on GitHub</a>: &#8220;thank you very much for this package!&#8221;</li>
</ul>
<h2>Author and License</h2>
<p>The <em>kirigami</em> Emacs package has been written by <a href="https://www.jamescherti.com/">James Cherti</a> and is distributed under terms of the GNU General Public License version 3, or, at your choice, any later version. Special thanks to the developers of Evil mode. Kirigami builds upon the idea and function from Evil mode to provide enhanced and unified code folding functionality to all Emacs users.</p>
<p>Copyright (C) 2025-2026 James Cherti</p>
<p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program.</p>
<h2>Links</h2>
<ul>
<li><a href="https://github.com/jamescherti/kirigami.el">kirigami.el @GitHub</a></li>
</ul>
<p>Other Emacs packages by the same author:</p>
<ul>
<li><a href="https://github.com/jamescherti/minimal-emacs.d">minimal-emacs.d</a>: This repository hosts a minimal Emacs configuration designed to serve as a foundation for your vanilla Emacs setup and provide a solid base for an enhanced Emacs experience.</li>
<li><a href="https://github.com/jamescherti/compile-angel.el">compile-angel.el</a>: <strong>Speed up Emacs!</strong> This package guarantees that all .el files are both byte-compiled and native-compiled, which significantly speeds up Emacs.</li>
<li><a href="https://github.com/jamescherti/outline-indent.el">outline-indent.el</a>: An Emacs package that provides a minor mode that enables code folding and outlining based on indentation levels for various indentation-based text files, such as YAML, Python, and other indented text files.</li>
<li><a href="https://github.com/jamescherti/easysession.el">easysession.el</a>: Easysession is lightweight Emacs session manager that can persist and restore file editing buffers, indirect buffers/clones, Dired buffers, the tab-bar, and the Emacs frames (with or without the Emacs frames size, width, and height).</li>
<li><a href="https://github.com/jamescherti/vim-tab-bar.el">vim-tab-bar.el</a>: Make the Emacs tab-bar Look Like Vim&#8217;s Tab Bar.</li>
<li><a href="https://github.com/jamescherti/elispcomp">elispcomp</a>: A command line tool that allows compiling Elisp code directly from the terminal or from a shell script. It facilitates the generation of optimized .elc (byte-compiled) and .eln (native-compiled) files.</li>
<li><a href="https://github.com/jamescherti/tomorrow-night-deepblue-theme.el">tomorrow-night-deepblue-theme.el</a>: The Tomorrow Night Deepblue Emacs theme is a beautiful deep blue variant of the Tomorrow Night theme, which is renowned for its elegant color palette that is pleasing to the eyes. It features a deep blue background color that creates a calming atmosphere. The theme is also a great choice for those who miss the blue themes that were trendy a few years ago.</li>
<li><a href="https://github.com/jamescherti/ultyas/">Ultyas</a>: A command-line tool designed to simplify the process of converting code snippets from UltiSnips to YASnippet format.</li>
<li><a href="https://github.com/jamescherti/dir-config.el">dir-config.el</a>: Automatically find and evaluate .dir-config.el Elisp files to configure directory-specific settings.</li>
<li><a href="https://github.com/jamescherti/flymake-bashate.el">flymake-bashate.el</a>: A package that provides a Flymake backend for the bashate Bash script style checker.</li>
<li><a href="https://github.com/jamescherti/flymake-ansible-lint.el">flymake-ansible-lint.el</a>: An Emacs package that offers a Flymake backend for ansible-lint.</li>
<li><a href="https://github.com/jamescherti/inhibit-mouse.el">inhibit-mouse.el</a>: A package that disables mouse input in Emacs, offering a simpler and faster alternative to the disable-mouse package.</li>
<li><a href="https://github.com/jamescherti/quick-sdcv.el">quick-sdcv.el</a>: This package enables Emacs to function as an offline dictionary by using the sdcv command-line tool directly within Emacs.</li>
<li><a href="https://github.com/jamescherti/enhanced-evil-paredit.el">enhanced-evil-paredit.el</a>: An Emacs package that prevents parenthesis imbalance when using <em>evil-mode</em> with <em>paredit</em>. It intercepts <em>evil-mode</em> commands such as delete, change, and paste, blocking their execution if they would break the parenthetical structure.</li>
<li><a href="https://github.com/jamescherti/stripspace.el">stripspace.el</a>: Ensure Emacs Automatically removes trailing whitespace before saving a buffer, with an option to preserve the cursor column.</li>
<li><a href="https://github.com/jamescherti/persist-text-scale.el">persist-text-scale.el</a>: Ensure that all adjustments made with text-scale-increase and text-scale-decrease are persisted and restored across sessions.</li>
<li><a href="https://github.com/jamescherti/pathaction.el">pathaction.el</a>: Execute the pathaction command-line tool from Emacs. The pathaction command-line tool enables the execution of specific commands on targeted files or directories. Its key advantage lies in its flexibility, allowing users to handle various types of files simply by passing the file or directory as an argument to the pathaction tool. The tool uses a .pathaction.yaml rule-set file to determine which command to execute. Additionally, Jinja2 templating can be employed in the rule-set file to further customize the commands.</li>
<li><a href="https://github.com/jamescherti/kirigami.el">kirigami.el</a>: The <em>kirigami</em> Emacs package offers a unified interface for opening and closing folds across a diverse set of major and minor modes in Emacs, including <code>outline-mode</code>, <code>outline-minor-mode</code>, <code>outline-indent-mode</code>, <code>org-mode</code>, <code>markdown-mode</code>, <code>vdiff-mode</code>, <code>vdiff-3way-mode</code>, <code>hs-minor-mode</code>, <code>hide-ifdef-mode</code>, <code>origami-mode</code>, <code>yafolding-mode</code>, <code>folding-mode</code>, and <code>treesit-fold-mode</code>. With Kirigami, folding key bindings only need to be configured <strong>once</strong>. After that, the same keys work consistently across all supported major and minor modes, providing a unified and predictable folding experience.</li>
</ul></div>
</div></figure>
