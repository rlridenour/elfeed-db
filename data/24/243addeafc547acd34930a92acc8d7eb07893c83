
	
<p>
Yesterday, I delivered the International Keynote at the <a href="https://www.conferenz.co.nz/events/asset-data-insights-conference">Asset Data &amp; Insights Conference</a> in Auckland, New Zealand (the place where R was initially developed). My talk was about creating value from CADA data using a method I developed with my colleagues called &#34;Virtual Tags.&#34; My address started with my views on data science strategy, which I also presented to the <a href="https://lucidmanager.org/data-science/strategic-data-science/">R User Group</a> in Melbourne. In this post, I would like to explain what Virtual Tags are and how they can be used to improve the value of <a href="https://www.researchgate.net/publication/326533741_Health-Based_Targets_Performance_Reporting_Using_Virtual_SCADA_Tags_to_Facilitate_Data_Aalysis">SCADA data</a>.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
SCADA Systems at Water Treatment Plants
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Water treatment plants are mostly fully automated, using analysers and the SCADA system to communicate this data. For those of you not familiar with water treatment plants, the video below gives a cute summary of the process.</p>
<figure>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/rj44AkHmVCo?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

<figcaption>
Water Treatment — SCADA Plant IQ
</figcaption>
</figure>
<p>
Water treatment plants rely on sensors to track a broad range of parameters. These instruments capture data around the clock, supporting real-time operational decisions. When everything runs smoothly, all values stay within a precise band. Typically, these values are archived by the SCADA system for a year, then purged to manage storage needs.</p>
<p>
Turbidity measurements—essentially a gauge of water clarity—help assess filtration effectiveness at water treatment plants. Below, you’ll find a code snippet simulating five hours of turbidity readings from one such instrument. Most of the time, these water quality values follow a log-normal distribution and cluster tightly together, making them ideal for precise monitoring.</p>
<p>
<a href = "https://github.com/pprevos/r4h2o/" target="_blank"
   title="Download r4h2o from GitHub"
   alt="Download r4h2o from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">r4h2o</span>
  </button>
</a>

</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888"># Virtual tag simulation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888"># Generate turbidity measurements</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">set.seed</span>(<span style="color:#60e;font-weight:bold">1234</span>)
</span></span><span style="display:flex;"><span>  n <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">300</span>
</span></span><span style="display:flex;"><span>  wtp <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">data.frame</span>(timestamp <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">seq.POSIXt</span>(<span style="color:#06b;font-weight:bold">ISOdate</span>(<span style="color:#60e;font-weight:bold">1910</span>, <span style="color:#60e;font-weight:bold">1</span>, <span style="color:#60e;font-weight:bold">1</span>), length.out <span style="color:#333">=</span> n, by <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">60</span>),
</span></span><span style="display:flex;"><span>                    turbidity <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">rlnorm</span>(n, <span style="color:#06b;font-weight:bold">log</span>(<span style="color:#60e;font-weight:bold">.1</span>), <span style="color:#60e;font-weight:bold">.01</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p1 <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">ggplot</span>(wtp) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">aes</span>(x <span style="color:#333">=</span> timestamp, y <span style="color:#333">=</span> turbidity) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">geom_line</span>(colour <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;grey&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">ylim</span>(<span style="color:#60e;font-weight:bold">0.09</span>, <span style="color:#60e;font-weight:bold">0.11</span>) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">theme_bw</span>(base_size <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">10</span>) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">labs</span>(title <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;Turbidity simulation&#34;</span>, x <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;Timestamp&#34;</span>, y <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;Turbidity&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p1</span></span></code></pre></div>
</div>
<figure>
<img src="https://lucidmanager.org/images/hydroinformatics/turbidity-simulation.png" alt="Turbidity simulation" title="Turbidity simulation"/>
<figcaption>
Turbidity simulation.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
SCADA Historian
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>The data generated by the SCADA system is used to make operational decisions. The data is created and structured to make decisions in the present, not to solve problems in the future. SCADA Historian systems archive this information for future analysis. Historian systems only store new values when the new reading is more or less than a certain percentage of the previous one. This method saves storage space without sacrificing much accuracy.</p>
<p>
Imagine an instrument reads 0.20, and the limit is 5%: you’ll see new values recorded only when they fall below 0.19 or above 0.21. Each subsequent value gets stored only when it deviates by 5% from the last stored point. The following code snippet brings this process to life, simulating it using earlier turbidity readings. Notice: this Historian captures and stores only the data points shown in black.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888"># Historise using dead banding</span>
</span></span><span style="display:flex;"><span>  threshold <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">0.03</span>
</span></span><span style="display:flex;"><span>  h <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">1</span> <span style="color:#888"># First historised point</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  wtp<span style="color:#333">$</span>historised <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  wtp<span style="color:#333">$</span>historised<span style="color:#06b;font-weight:bold">[c</span>(<span style="color:#60e;font-weight:bold">1</span>, n)] <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">TRUE</span> <span style="color:#888"># Testing for delta &gt; threshold</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-weight:bold">for</span> (i <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">2</span><span style="color:#333">:</span><span style="color:#06b;font-weight:bold">nrow</span>(wtp)) {
</span></span><span style="display:flex;"><span>    delta <span style="color:#333">&lt;-</span> wtp<span style="color:#333">$</span>turbidity[i] <span style="color:#333">/</span> wtp<span style="color:#333">$</span>turbidity[h] 
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-weight:bold">if</span> (delta <span style="color:#333">&gt;</span> (<span style="color:#60e;font-weight:bold">1</span> <span style="color:#333">+</span> threshold) <span style="color:#333">|</span> delta <span style="color:#333">&lt;</span> (<span style="color:#60e;font-weight:bold">1</span> <span style="color:#333">-</span> threshold)) {
</span></span><span style="display:flex;"><span>      wtp<span style="color:#333">$</span>historised[i] <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">TRUE</span>
</span></span><span style="display:flex;"><span>      h <span style="color:#333">&lt;-</span> i
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  historian <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">subset</span>(wtp, historised)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p2 <span style="color:#333">&lt;-</span> p1 <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">geom_point</span>(data <span style="color:#333">=</span> historian, 
</span></span><span style="display:flex;"><span>               <span style="color:#06b;font-weight:bold">aes</span>(x <span style="color:#333">=</span> timestamp, y <span style="color:#333">=</span> turbidity), 
</span></span><span style="display:flex;"><span>               size <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">3</span>, alpha <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">.5</span>, color <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;blue&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">labs</span>(title <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;Historised data&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p2</span></span></code></pre></div>
</div>
<figure>
<img src="https://lucidmanager.org/images/hydroinformatics/turbidity-historised.png" alt="Historised simulated turbidity data" title="Historised simulated turbidity data"/>
<figcaption>
Historised simulated turbidity data.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Virtual Tags
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>This standard method for generating and storing SCADA data works well for operational systems but not for post hoc analysis. The data in Historian are unequally spaced, making them harder to analyse. Using constant interpolation, the Virtual Tag approach expands these unequal time series into an equally spaced time series.</p>
<p>
The <code class="verbatim">vt()</code> function undertakes the constant interpolation using the <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/approxfun">approx function</a>. The function <code class="verbatim">vt</code> is applied to all the <code class="verbatim">DateTime</code> values using the historised data points. The red line shows how the value is constant until it jumps by more than 5%. This example demonstrates that we have a steady process with some minor spikes, which is the expected outcome of this simulation.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888"># Virtual Tags extrapolation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  vt <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(t) {
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">approx</span>(historian<span style="color:#333">$</span>timestamp, historian<span style="color:#333">$</span>turbidity, xout <span style="color:#333">=</span> t, method <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;constant&#34;</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  turbidity <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">lapply</span>(<span style="color:#06b;font-weight:bold">as.data.frame</span>(wtp<span style="color:#333">$</span>timestamp), vt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  wtp<span style="color:#333">$</span>virtual_tag <span style="color:#333">&lt;-</span> turbidity[[1]]<span style="color:#333">$</span>y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p3 <span style="color:#333">&lt;-</span> p2 <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">geom_line</span>(data <span style="color:#333">=</span> wtp,
</span></span><span style="display:flex;"><span>              <span style="color:#06b;font-weight:bold">aes</span>(x <span style="color:#333">=</span> timestamp, y <span style="color:#333">=</span> virtual_tag), colour <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;red&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">ggtitle</span>(<span style="background-color:#fff0f0">&#34;Virtual Tags&#34;</span>)
</span></span><span style="display:flex;"><span>  p3</span></span></code></pre></div>
</div>
<figure>
<img src="https://lucidmanager.org/images/hydroinformatics/turbidity-virtual-tags.png" alt="Virtual tags for the simulated data" title="Virtual tags for the simulated data"/>
<figcaption>
Virtual tags for the simulated data.
</figcaption>
</figure>
<p>
The next step in Virtual Tags is to combine tags from different data points for richer insights. For instance, imagine you&#39;re curious about turbidity readings only when the filter is running. By combining this data with information such as the filter&#39;s valve status and flow, you can gain a clearer picture of system performance.</p>
<p>
Although this approach may seem cumbersome at first glance, it makes analysing data from SCADA Historian much more straightforward. With Virtual Tags, you can easily access a catalogue of analytical processes that would otherwise be challenging to perform. This system also provides valuable context for your SCADA information by linking tags to one another and to the operational processes they reflect. Curious to learn more? Download the <a href="http://colibanwater.github.io/HBT/">technical manual</a> for an in-depth look at Virtual Tags and their implementation in SQL.</p>
<p>
Interested in solving water challenges with R code? You might enjoy the book Data Science for Water Utilities, which goes deeper into practical techniques for the field.</p>
<p>

  <div class="box">
    <div class="media">
      <figure class="media-left">
        <p class="image is-128x128">
          <img src="https://lucidmanager.org/images/books/2023_ds4wu.jpg" alt = "Data Science for Water Utilities" title = "Data Science for Water Utilities">
        </p>
      </figure>
      <div class="media-content">
        <div class="content">
          <p class="is-size-5 has-text-weight-bold">Data Science for Water Utilities</p>
          <p class="mb-2">Data Science for Water Utilities published by CRC Press is an applied, practical guide that shows water professionals how to use data science to solve urban water management problems using the R language for statistical computing.</p>
          <div class="buttons">
            <a class="button is-info" href="https://routledge.com/9781032354545" target="_blank">
              <span class="icon">
                <i class="fas fa-shopping-cart"></i>
              </span>
              <span>Routledge</span>
            </a>
            <a class="button is-info" href="https://www.amazon.com/Data-Science-Water-Utilities-Chapman/dp/1032354550" target="_blank">
              <span class="icon">
                <i class="fas fa-shopping-cart"></i>
              </span>
              <span>Amazon</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</p>
<p>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
</div>
</div>

      