<p>Update: There's a DWIM <a href="https://xenodium.com/emacs-dwim-swiper-vs-isearch-vs-phi-search/">follow-up for searching</a>.</p>
<p><img src="https://xenodium.github.io/images/emacs-dwim-do-what-i-mean/do-what-i-mean.gif" alt=""></p>
<p>I was a rather puzzled the first time I spotted DWIM in an Emacs interactive command name. Don't think I remember what the command itself was, but what's important here is that <a href="https://en.wikipedia.org/wiki/DWIM">DWIM</a> stands for <a href="https://en.wikipedia.org/wiki/DWIM">do what I mean</a>.</p>
<p>I love DWIM interactive commands. They enable commands to be smarter and thus pack more functionality, without incurring the typical cognitive overhead associated with remembering multiple commands (or key bindings). The Emacs manual does a great job describing DWIM for the <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Comment-Commands.html">comment-dwim</a> command:</p>
<pre><code>The word “dwim” is an acronym for “Do What I Mean”; it indicates that this command can be used for many different jobs relating to comments, depending on the situation where you use it.
</code></pre>
<p>It's really great to find built-in DWIM-powered Emacs commands. Third-party packages often include them too. I typically gravitate towards these commands and bind them in my Emacs config. Examples being upcase-dwim, downcase-dwim, or mc/mark-all-dwim.</p>
<p>But what if the DWIM command doesn't exist or the author has written a command for what <em>they</em> mean? This is your editor, so you can make it do what <em>you</em> mean.</p>
<p>Take for example, <a href="https://orgmode.org/manual/Handling-Links.html">org-insert-link</a>, bound to <em>C-c C-l</em> by default. It's handy for inserting <a href="https://orgmode.org/guide/Hyperlinks.html">org mode links</a>. I used it so frequently that I quickly internalized its key binding. Having said that, I often found myself doing some lightweight preprocessing prior to invoking <em>org-insert-link</em>. What if I can <em>make org-insert-link do what I mean</em>?</p>
<h2>What do I mean?</h2>
<h3>Use URLs when in clipboard</h3>
<p>If the URL is already in the clipboard, don't ask me for it. Just use it.</p>
<h3>Use the region too</h3>
<p>If I have a region selected and there's a URL in the clipboard, just sort it out without user interaction.</p>
<p><img src="https://xenodium.github.io/images/emacs-dwim-do-what-i-mean/link-this-text.gif" alt=""></p>
<h3>Automatically fetch titles</h3>
<p>Automatically fetch URL titles from their HTML tag, but ask me for tweaks before insertion.</p>
<p><img src="https://xenodium.github.io/images/emacs-dwim-do-what-i-mean/do-what-i-mean.gif" alt=""></p>
<h3>Fallback to org-insert-link</h3>
<p>If my DWIM rules don't apply, fall back to using good ol' <a href="https://orgmode.org/manual/Handling-Links.html">org-insert-link</a>.</p>
<p>My most common use case here is when editing an existing link where I don't want neither its title nor URL automatically handled.</p>
<p><img src="https://xenodium.github.io/images/emacs-dwim-do-what-i-mean/edit-link.gif" alt=""></p>
<h2>The code</h2>
<p>This is your own DWIM command that does what <em>you</em> mean. Strive to write a clean implementation, but hey you can be forgiven for not handling all the cases that other folks <em>may</em> want or inlining more code than usual. The goal is to bend your editor a little, not write an Emacs package.</p>
<pre><code class="language-{.commonlisp">(defun ar/org-insert-link-dwim ()
  &quot;Like `org-insert-link' but with personal dwim preferences.&quot;
  (interactive)
  (let* ((point-in-link (org-in-regexp org-link-any-re 1))
         (clipboard-url (when (string-match-p &quot;^http&quot; (current-kill 0))
                          (current-kill 0)))
         (region-content (when (region-active-p)
                           (buffer-substring-no-properties (region-beginning)
                                                           (region-end)))))
    (cond ((and region-content clipboard-url (not point-in-link))
           (delete-region (region-beginning) (region-end))
           (insert (org-make-link-string clipboard-url region-content)))
          ((and clipboard-url (not point-in-link))
           (insert (org-make-link-string
                    clipboard-url
                    (read-string &quot;title: &quot;
                                 (with-current-buffer (url-retrieve-synchronously clipboard-url)
                                   (dom-text (car
                                              (dom-by-tag (libxml-parse-html-region
                                                           (point-min)
                                                           (point-max))
                                                          'title))))))))
          (t
           (call-interactively 'org-insert-link)))))
</code></pre>
<h2>Org web tools package</h2>
<p>I showed how to write your own DWIM command, so you can make Emacs do what ✨you✨ mean. <em>ar/org-insert-link-dwim</em> was built for my particular needs.</p>
<p>Having said all of this, alphapapa has built a great package with helpers for the org web/link space. It doesn't do what I mean (for now anyway), but it may work for you: <a href="https://github.com/alphapapa/org-web-tools">org-web-tools: View, capture, and archive Web pages in Org-mode</a>[^2].</p>
