<h2 id="spring-cleaning">Spring cleaning</h2>
<p>Let me start by saying this. Over the time I have accumulated some cruft (in this case function) that needed to be gone. Partly because some of the functionalities are built in and partly because my solutions were honestly nonsensical.</p>
<p>Now I have cleaned up the modules at issue today and we can go on talking about the remaining functions that are still of use to me.</p>
<img style="display:inline;float:left;margin:0px 40px;" src="https://macowners.club/images/emacs_fuzzy_matching.gif" width=""/>
<h2 id="the-remaining-stuff">The remaining stuff</h2>
<h3 id="windows-splitting">Windows splitting</h3>
<p>This are my versions of commands to split windows. The built in versions (split-window-below &amp; split-window-right) do keep the cursor in the original window. I don&rsquo;t like that one bit. About 95% of the time when I split a window, I want the cursor to follow and perform whatever task in the new window. Hence these two simple functions:</p>
<h4 id="split-like-i-think">Split like I think</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-split-and-follow-below</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Split the selected window in two with the new window is bellow.
</span></span></span><span class="line"><span class="cl"><span class="s">This uses </span><span class="ss">`split-window-below&#39;</span><span class="s"> but follows with the cursor.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">split-window-below</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-split-and-follow-right</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Split the selected window in two with the new window is to the right.
</span></span></span><span class="line"><span class="cl"><span class="s">This uses </span><span class="ss">`split-window-right&#39;</span><span class="s"> but follows with the cursor.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">split-window-right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="find-me-a-file-but-not-here">Find me a file - but not here</h4>
<p>I addition to splitting the window the following two functions put straight me into a minibuffer <code>find-file</code> completion.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-find-file-below</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open file with </span><span class="ss">`find-file&#39;</span><span class="s"> &amp; </span><span class="ss">`read-file-name&#39;</span><span class="s"> in a split window bellow.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">split-window-below</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&#34;Find file: &#34;</span> <span class="no">nil</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-find-file-right</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open file with </span><span class="ss">`find-file&#39;</span><span class="s"> &amp; </span><span class="ss">`read-file-name&#39;</span><span class="s"> in a split window to the right.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">split-window-right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&#34;Find file: &#34;</span> <span class="no">nil</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="split-at-the-bottom">Split at the bottom</h4>
<p>This one creates a spit bellow all other windows in the frame.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-split-bellow-all</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Split the current buffer horizontally with new window bellow all other one.
</span></span></span><span class="line"><span class="cl"><span class="s">The size ratio is 60 (top) to 40 (bottom).
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://emacs.stackexchange.com/a/60459/30874.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">split-window</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nf">frame-root-window</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nf">truncate</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">*</span> <span class="p">(</span><span class="nf">window-total-height</span> <span class="p">(</span><span class="nf">frame-root-window</span><span class="p">))</span> <span class="mf">0.60</span><span class="p">))</span> <span class="ss">&#39;below</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="i-don-t-like-this-order">I don&rsquo;t like this order</h4>
<p>When two windows are showing it can be useful or even warranted to switch the orientation of these:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-toggle-split-direction</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Toggle window split from vertical to horizontal.
</span></span></span><span class="line"><span class="cl"><span class="s">This work the other way around as well.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://github.com/olivertaylor/dotfiles/blob/master/emacs/init.el&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">length</span> <span class="p">(</span><span class="nf">window-list</span><span class="p">))</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Can&#39;t toggle with more than 2 windows&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">was-full-height</span> <span class="p">(</span><span class="nv">window-full-height-p</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">delete-other-windows</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">if</span> <span class="nv">was-full-height</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">split-window-vertically</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">split-window-horizontally</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-selected-window</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">switch-to-buffer</span> <span class="p">(</span><span class="nf">other-buffer</span><span class="p">))))))</span>
</span></span></code></pre></div><h3 id="elevate-me">Elevate me</h3>
<p>Some of the files that need editing of course require root privileges.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-find-file-as-root</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Like </span><span class="ss">`find-file&#39;</span><span class="s">, but automatically edit the file with root-privileges.
</span></span></span><span class="line"><span class="cl"><span class="s">This uses Tramp to apend sudo to path, if the file is not writable by user.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">file</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&#34;Open file as root: &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">file-writable-p</span> <span class="nv">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">find-file</span> <span class="nv">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;File is writable, no need to open as root.&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;/sudo::&#34;</span> <span class="nv">file</span><span class="p">)))))</span>
</span></span></code></pre></div><h3 id="what-about-tabs">What about tabs?</h3>
<p>The tab feature in Emacs is quite welcome addition, But I like my new tabs to always be created visiting the scratch buffer. Bare in mind <code>timu-scratch-create</code> in this command is a custom function as well. It will however be handled in a later post. For all intense and purposes for now it can be substituted by <code>startup--get-buffer-create-scratch</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-tab-bar-new-tab</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Create a new tab an then switch to the scratch buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">If it has been closed, then create one.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">tab-bar-new-tab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">timu-scratch-create</span><span class="p">))</span>
</span></span></code></pre></div><p>This one helps reducing the keybindings needed for navigating tabs. Either switch to the next tab or create a new one.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-switch-or-new-tab</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Switch to the next tab if there are more than 1 tab.
</span></span></span><span class="line"><span class="cl"><span class="s">Create a new tab if there are just 1 tab.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">length&gt;</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;tabs</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">tab-bar-switch-to-next-tab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">timu-nav-tab-bar-new-tab</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="pop-the-windows">Pop the windows!</h3>
<p><a href="https://github.com/karthink/popper">popper.el</a> is a package that now belongs in my arsenal. Effectively it is a corner stone of my navigation. This one sometimes help me to see all the popup windows at once.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-popper-toggle-all</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Toggle all pupups at once with </span><span class="ss">`popper.el&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">popper-toggle-latest</span> <span class="mi">16</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="let-s-find-stuff">Let&rsquo;s find stuff</h3>
<p>Both CLI commands <code>ripgrep</code> and <code>find</code> get a good use by <a href="https://github.com/minad/consult">consult</a> (which is part of my completion system) for searching.</p>
<p>Both consult commands at issue here (<code>consult-ripgrep</code> &amp; <code>consult-find</code>) start the search in the <code>default-directory</code>. I however do like to select the starting directory first. This is possible with the universal argument. Hence the following to functions.</p>
<p><strong>Searching file contents:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-consult-rg</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Function for </span><span class="ss">`consult-ripgrep&#39;</span><span class="s"> with the </span><span class="ss">`universal-argument&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">consult-ripgrep</span> <span class="p">(</span><span class="nf">list</span> <span class="mi">4</span><span class="p">)))</span>
</span></span></code></pre></div><p><strong>Searching file names:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-consult-fd</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Function for </span><span class="ss">`consult-find&#39;</span><span class="s"> with the </span><span class="ss">`universal-argument&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">consult-find</span> <span class="p">(</span><span class="nf">list</span> <span class="mi">4</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="where-is-my-project">Where is my project?</h3>
<p>Whenever I want to go to a project I always – I mean always – want to open a file. The default command <code>project-switch-project</code> However gives me some options/actions (including Eshell, VC-Dir and more). This is the reason for the following simple function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-project-switch-project</span> <span class="p">(</span><span class="nv">dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\&#34;Switch\&#34; to another project by running an Emacs command.
</span></span></span><span class="line"><span class="cl"><span class="s">Directly use </span><span class="ss">`project-find-file&#39;</span><span class="s"> instead of getting prompted.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">When called in a program, it will use the project corresponding
</span></span></span><span class="line"><span class="cl"><span class="s">to directory DIR.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nv">project-prompt-project-dir</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">project-current-directory-override</span> <span class="nv">dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">project-find-file</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="bring-emacs-to-the-system">Bring emacs to the system</h3>
<p>With the help of the package <a href="https://github.com/tecosaur/emacs-everywhere">emacs-everywhere</a> I can edit the content of most text areas/boxes in macOS within an Emacs pop-up window.</p>
<p>In case I already started typing text this functions helps with the populating of the Emacs pop-up with that text.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-nav-emacs-everywhere-copy</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Copy the contents of the text area to be edited.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">do-applescript</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;set frontmostApplication to path to frontmost application\n&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;tell application \&#34;System Events\&#34;\n&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;	keystroke \&#34;c\&#34; using {command down}\n&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;end tell\n&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><h2 id="the-end">The end</h2>
<p>Granted some functions here can be simply <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Lambda-Expressions.html">lambdas</a> in the definition of keybindings. However I like the order creaaating custom functions – however small (and maybe superfluous) they are – provides me. Sue me! ;)</p>
