<h2 id="file-management">File Management</h2>
<p>There should now be a trend in this series for custom functions (see the last posts for <a href="https://macowners.club/posts/custom-functions-1-baseline/">baseline</a> &amp; <a href="https://macowners.club/posts/custom-functions-2-modules/">modules</a> functions). I like things to work my way.</p>
<p>This is of course a reasonably easy thing to do using Emacs. With it being extensible and stuff&hellip;</p>
<p>It is no different with file management using Dired.</p>
<h2 id="dired-custom-functions">Dired custom functions</h2>
<h3 id="timu-dired-up-directory">timu-dired-up-directory</h3>
<p>Dired by defaults keeps the old Dired buffer when navigating on the file systems. This causes Emacs to &ldquo;collect&rdquo; a bunch of opened Dired buffers. I and my mild OCD do not like this one bit.</p>
<p>This functions navigates up a directory in dire by using <code>find-alternate-file</code> which kills the &ldquo;previous buffer&rdquo;.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-dired-up-directory</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Go up a directory in </span><span class="ss">`dired&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">find-alternate-file</span> <span class="s">&#34;..&#34;</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="timu-dired-open-all-in-emacs">timu-dired-open-all-in-emacs</h3>
<p>This functions forces the marked files or the file at point to be opened inside of Emacs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-dired-open-all-in-emacs</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open the current FILE or Dired marked files in Emacs.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">doIt</span> <span class="p">(</span><span class="nv">myFileList</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;dired-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">dired-get-marked-files</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nv">not</span> <span class="nv">file</span><span class="p">)</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">file</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">doIt</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&lt;=</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">myFileList</span><span class="p">)</span> <span class="mi">30</span><span class="p">)</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">y-or-n-p</span> <span class="s">&#34;Open more than 30 files? &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">mapc</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">fPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">process-connection-type</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">start-process</span> <span class="s">&#34;&#34;</span> <span class="no">nil</span> <span class="s">&#34;emacsclient&#34;</span> <span class="nv">fPath</span><span class="p">)))</span> <span class="nv">myFileList</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="timu-dired-open-in-external-app">timu-dired-open-in-external-app</h3>
<p>Simple function to open a marked files or the file at point in the default macOS App for the file type.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-dired-open-in-external-app</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open the current FILE or Dired marked files in external app.
</span></span></span><span class="line"><span class="cl"><span class="s">The app is chosen from your OS&#39;s preference.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: http://xahlee.info/emacs/emacs/emacs_dired_open_file_in_ext_apps.html.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">doIt</span> <span class="p">(</span><span class="nv">myFileList</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;dired-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">dired-get-marked-files</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nv">not</span> <span class="nv">file</span><span class="p">)</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">file</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">doIt</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&lt;=</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">myFileList</span><span class="p">)</span> <span class="mi">30</span><span class="p">)</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">y-or-n-p</span> <span class="s">&#34;Open more than 30 files? &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="nv">doIt</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">       <span class="p">((</span><span class="nf">string-equal</span> <span class="nv">system-type</span> <span class="s">&#34;windows-nt&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">mapc</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">fPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">w32-shell-execute</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;open&#34;</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">&#34;/&#34;</span> <span class="s">&#34;\\&#34;</span> <span class="nv">fPath</span> <span class="no">t</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">              <span class="nv">myFileList</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">((</span><span class="nf">string-equal</span> <span class="nv">system-type</span> <span class="s">&#34;darwin&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">mapc</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">fPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">shell-command</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;open \&#34;%s\&#34;&#34;</span> <span class="nv">fPath</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">              <span class="nv">myFileList</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">((</span><span class="nf">string-equal</span> <span class="nv">system-type</span> <span class="s">&#34;gnu/linux&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">mapc</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">fPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">process-connection-type</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="nf">start-process</span> <span class="s">&#34;&#34;</span> <span class="no">nil</span> <span class="s">&#34;xdg-open&#34;</span> <span class="nv">fPath</span><span class="p">)))</span> <span class="nv">myFileList</span><span class="p">))))))</span>
</span></span></code></pre></div><h3 id="timu-dired-shell-open-dir">timu-dired-shell-open-dir</h3>
<p>This one opens the current directory in the Finder.app on macOS.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-dired-shell-open-dir</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open current directory at point with shell command \&#34;open\&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s">This will open \&#34;Finder.app\&#34; at current location.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">timu-baseline-async-shell-command-no-window</span> <span class="s">&#34;open ./&#34;</span> <span class="p">))</span>
</span></span></code></pre></div><h3 id="timu-dired-shell-quicklook">timu-dired-shell-quicklook</h3>
<p>The function uses macOS <a href="https://support.apple.com/en-gb/guide/mac-help/mh14119/mac">Quick Look</a> feature to preview the file at point. I use this one all the time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-dired-shell-quicklook</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open the files at point with shell command \&#34;qlmanage\&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s">This will display a Quicklook of the file at point in macOS.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">file</span> <span class="p">(</span><span class="nv">dired-get-file-for-visit</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">timu-baseline-async-shell-command-no-window</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;qlmanage -p &#34;</span> <span class="p">(</span><span class="nv">shell-quote-argument</span> <span class="nv">file</span><span class="p">)</span> <span class="s">&#34; &gt; /dev/null 2&gt;&amp;1&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="timu-dired-copy-path-at-point">timu-dired-copy-path-at-point</h3>
<p>Honestly do not use this one a lot. However it is quite useful to have in those cases. It is simple. It copies the full path of the file at point.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-dired-copy-path-at-point</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Copy the full path of the at </span><span class="ss">`point&#39;</span><span class="s"> to the </span><span class="ss">`kill-ring&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://emacs.stackexchange.com/a/36851/30874&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">dired-copy-filename-as-kill</span> <span class="mi">0</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="timu-dired-search-and-enter">timu-dired-search-and-enter</h3>
<p><code>consult-line</code> is a wonderful command to search the current buffer. I use it to search for a directory in the Dired buffer and enter it with <code>dired-find-alternate-file</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-dired-search-and-enter</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Search file or directory with </span><span class="ss">`consult-line&#39;</span><span class="s"> and then visit it.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">consult-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">dired-find-alternate-file</span><span class="p">))</span>
</span></span></code></pre></div>