<p>Retook running recently. Took the dust off my aria scale and used the opportunity to check out fitbit's API.</p>
<p>First register your app at <a href="https://dev.fitbit.com/apps/new">dev.fitbit.com/apps/new</a> and get a client_id=AABBCC.</p>
<p><img src="https://xenodium.github.io/images/fitbit-api-org-babel-and-gnuplot/fitbitapp.png" alt=""></p>
<p>You'll also need your USER_ID, from your Fitbitx user profile.</p>
<p><img src="https://xenodium.github.io/images/fitbit-api-org-babel-and-gnuplot/fitbituser.png" alt=""></p>
<p>We'll also need a token. I used the <a href="https://dev.fitbit.com/build/reference/web-api/oauth2/">implicit grant flow</a> URL in my browser and extracted access_token=TOKEN.</p>
<p>Now let's wire up two org source blocks to fetch the data and subsequently plot using gnuplot.</p>
<p>It's pretty neat. You can take the output from one source block and use it as input to another.</p>
<p>We use curl to fetch data from fitbit's API and pipe through <a href="https://stedolan.github.io/jq/">jq</a> and sed to massage the output format into two columns.</p>
<p><strong>Note:</strong> Before using gnuplot in org babel, you'll need to install the gnuplot package and add to babel languages.</p>
<pre><code class="language-{.commonlisp">(use-package gnuplot :ensure t)

(use-package ob
  :config
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((gnuplot . t))))
</code></pre>
<pre><code class="language-{#weight-data">curl -s -H &quot;Authorization: Bearer TOKEN&quot; https://api.fitbit.com/1/user/USER_ID/body/weight/date/2018-06-09/2018-07-11.json | jq '.[][] | &quot;\(.dateTime) \(.value)&quot;' | sed 's/&quot;//g'
</code></pre>
<hr>
<p>2018-06-09   65.753
2018-06-10   65.762
2018-06-11   65.771
2018-06-12   65.78
2018-06-13   65.789
2018-06-14   65.798
2018-06-15   65.807
2018-06-16   65.816
2018-06-17   65.825
2018-06-18   65.85
2018-06-19   65.96
2018-06-20   64.1
2018-06-21   65.64
2018-06-22   65.47
2018-06-23   65.515
2018-06-24   65.56
2018-06-25   65.605
2018-06-26   65.65
2018-06-27   65.18
2018-06-28   64.49
2018-06-29   64.49
2018-06-30   64.41
2018-07-01   64.33
2018-07-02   64.25
2018-07-03   64.17
2018-07-04   64.55
2018-07-05   64.39
2018-07-06   64.33
2018-07-07   65.06
2018-07-08   63.28
2018-07-09   63.4
2018-07-10   64.22
2018-07-11   63.95</p>
<hr>
<p>Now feed the two column data to gnuplot.</p>
<pre><code class="language-{.gnuplot">reset
set title &quot;My recent weight&quot;
set xdata time
set timefmt '%Y-%m-%d'
set format x &quot;%d/%m/%y&quot;
set term png
set xrange ['2018-06-09':'2018-07-11']
plot data u 1:2 with linespoints title 'Weight in Kg'
</code></pre>
<p><img src="https://xenodium.github.io/images/fitbit-api-org-babel-and-gnuplot/weight.png" alt=""></p>
<p>Fetching data and plotting through org babel and gnuplot is pretty sweet. I've barely scratched the surface. There's more at <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-gnuplot.html">Org-babel-gnuplot</a> and <a href="https://orgmode.org/worg/org-tutorials/org-plot.html">Plotting tables in Org-Mode using org-plot</a>. Either way, this is another Emacs super power to keep in the toolbox.</p>
