M-x helm shows duplicates after upgrading to Emacs 27. Turns out the changed behavior is easily fixed by configuring history-delete-duplicates. Answer courtesy official issue .