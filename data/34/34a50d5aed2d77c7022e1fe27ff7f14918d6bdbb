<p>Narrowing utilities are a wonderful way of increasing productivity. I have a few workflows using Emacs's <a href="https://github.com/emacs-helm/helm">Helm</a> framework.</p>
<p>There are great productivity boosters like <a href="https://www.alfredapp.com/">Alfred</a> and <a href="https://qsapp.com/">Quicksilver</a> for macOS, with batteries included.</p>
<p>If you're a tinkerer, you'd enjoy the powerful <a href="http://hammerspoon.org/">Hammerspoon</a>. Like elisp gluing all things Emacs, Hammerspoon uses Lua to glue all things macOS. You can build your own narrowing utilities using <a href="http://www.hammerspoon.org/docs/hs.chooser.html">chooser</a> and a little Lua.</p>
<pre><code>local chooser = hs.chooser.new(function(choice)
      hs.alert.show(choice['text'])
end)

chooser:choices({
      {
         [&quot;text&quot;] = &quot;Alfred\n&quot;,
         [&quot;subText&quot;] = &quot;macOS only\n&quot;,
      },
      {
         [&quot;text&quot;] = &quot;Quicksilver\n&quot;,
         [&quot;subText&quot;] = &quot;macOS only\n&quot;,
      },
      {
         [&quot;text&quot;] = &quot;Hammerspoon\n&quot;,
         [&quot;subText&quot;] = &quot;macOS only\n&quot;,
      },
      {
         [&quot;text&quot;] = &quot;Emacs\n&quot;,
         [&quot;subText&quot;] = &quot;is everywhere :)\n&quot;,
      },
})
chooser:show()
</code></pre>
<p><img src="https://xenodium.github.io/images/emacs-utilities-for-your-os/chooser.png" alt=""></p>
<p>Howard Abrams's post on <a href="http://howardism.org/Technical/Emacs/capturing-content.html">Capturing Content for Emacs</a> inspired me to look at gluing Emacs and macOS to launch my own cross-platform narrowing utilities.</p>
<p>I've also taken this opportunity to look at Oleh Krehel's wonderful completion package: <a href="https://github.com/abo-abo/swiper">Ivy</a>. We can use it to build a macOS narrowing utility.</p>
<p>Ivy is remarkably easy to use. Turns out, <a href="http://oremacs.com/swiper/#api">ivy-read</a> is all you need. A simple Emacs completion can be accomplished with little elisp.</p>
<pre><code class="language-{.commonlisp">(ivy-read &quot;Hello ivy: &quot;
          '(&quot;One &quot;
            &quot;Two &quot;
            &quot;Three &quot;
            &quot;Four &quot;))
</code></pre>
<p><img src="https://xenodium.github.io/images/emacs-utilities-for-your-os/simple_ivy.png" alt=""></p>
<p>Pretty nifty. Let's make this completion more accessible from the rest of the OS. To do so, we create a separate Emacs frame and make it pretty. We also want it to interact with the OS. We'll use <em>ivy-read</em>'s <em>:action</em> to invoke a tiny bit of AppleScript.</p>
<p>Oh and we'll also use some funny quotes to tease ourselves about our beloved editor.</p>
<pre><code class="language-{.commonlisp">(with-current-buffer (get-buffer-create &quot;*modal-ivy*&quot;)
  (let ((frame (make-frame '((auto-raise . t)
                             (background-color . &quot;DeepSkyBlue3&quot;)
                             (cursor-color . &quot;MediumPurple1&quot;)
                             (font . &quot;Menlo 15&quot;)
                             (foreground-color . &quot;#eeeeec&quot;)
                             (height . 20)
                             (internal-border-width . 20)
                             (left . 0.33)
                             (left-fringe . 0)
                             (line-spacing . 3)
                             (menu-bar-lines . 0)
                             (minibuffer . only)
                             (right-fringe . 0)
                             (tool-bar-lines . 0)
                             (top . 48)
                             (undecorated . t)
                             (unsplittable . t)
                             (vertical-scroll-bars . nil)
                             (width . 110)))))
    (set-face-attribute 'ivy-minibuffer-match-face-1 frame
                        :background nil
                        :foreground nil)
    (set-face-attribute 'ivy-minibuffer-match-face-2 frame
                        :background nil
                        :foreground &quot;orange1&quot;)
    (set-face-attribute 'ivy-minibuffer-match-face-3 frame
                        :background nil
                        :foreground &quot;orange1&quot;)
    (set-face-attribute 'ivy-minibuffer-match-face-4 frame
                        :background nil
                        :foreground &quot;orange1&quot;)
    (set-face-attribute 'ivy-current-match frame
                        :background &quot;#ffc911&quot;
                        :foreground &quot;red&quot;)
    (set-face-attribute 'minibuffer-prompt frame
                        :foreground &quot;grey&quot;)
    (let ((ivy-height 20)
          (ivy-count-format &quot;&quot;))
      (ivy-read &quot;Emacs acronyms: &quot;
                '(&quot; Emacs: Escape-Meta-Alt-Control-Shift &quot;
                  &quot; Emacs: Eight Megabytes And Constantly Swapping &quot;
                  &quot; Emacs: Even a Master of Arts Comes Simpler &quot;
                  &quot; Emacs: Each Manual's Audience is Completely Stupified &quot;
                  &quot; Emacs: Eventually Munches All Computer Storage &quot;
                  &quot; Emacs: Eradication of Memory Accomplished with Complete Simplicity &quot;
                  &quot; Emacs: Easily Maintained with the Assistance of Chemical Solutions &quot;
                  &quot; Emacs: Extended Macros Are Considered Superfluous &quot;
                  &quot; Emacs: Every Mode Accelerates Creation of Software &quot;
                  &quot; Emacs: Elsewhere Maybe All Commands are Simple &quot;
                  &quot; Emacs: Emacs Makes All Computing Simple &quot;
                  &quot; Emacs: Emacs Masquerades As Comfortable Shell &quot;
                  &quot; Emacs: Emacs My Alternative Computer Story &quot;
                  &quot; Emacs: Emacs Made Almost Completely Screwed &quot;
                  &quot; Emacs: Each Mail A Continued Surprise &quot;
                  &quot; Emacs: Eating Memory And Cycle-Sucking &quot;
                  &quot; Emacs: Elvis Masterminds All Computer Software &quot;
                  &quot; Emacs: Emacs Makes A Computer Slow&quot; )
                :action (lambda (funny-quote)
                          (async-shell-command (format &quot;osascript -e 'tell app \&quot;System Events\&quot; to display dialog \&quot;%s\&quot; buttons {\&quot;OK\&quot;}'&quot; funny-quote)))
                :unwind (lambda ()
                          (shell-command &quot;/Applications/Hammerspoon.app/Contents/Resources/extensions/hs/ipc/bin/hs -c 'backFromEmacs()'&quot;)
                          (delete-frame)
                          (other-window 1))))))
</code></pre>
<p><img src="https://xenodium.github.io/images/emacs-utilities-for-your-os/ivy_frame.gif" alt=""></p>
<p>So where's all this going? I wrote a utility to extract all links from <a href="https://raw.githubusercontent.com/xenodium/xenodium.github.io/master/index.org">this page's org file</a> and make them easily searchable from anywhere on macOS by invoking <strong>‚å•-W</strong>.</p>
<p>The keys are bound using Lua, Hammerspoon, and emacsclient. This works well on macOS, but there are alternatives for other operating systems.</p>
<pre><code>hs.execute(&quot;emacsclient -ne \&quot;&quot;..elisp..&quot;\&quot; -s /tmp/emacs*/server&quot;)
</code></pre>
<p>Here's the resulting utility in action:</p>
<p><img src="https://xenodium.github.io/images/emacs-utilities-for-your-os/ivy_links.gif" alt=""></p>
<p>These integrations look promising. They enable me to bring cross-platform Emacs utilities into areas I hadn't considered.</p>
