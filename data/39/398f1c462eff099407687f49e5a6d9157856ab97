<p>Since my <a href="https://www.rousette.org.uk/archives/exploring-desktop-linux-p4/">last update on my desktop Linux adventures</a>, some fairly fundamental changes have happened. I had been getting very comfortable with Gnome, but had also gone back to Hyprland to fix and update some things, and was enjoying (all over again) the snappiness and keyboard navigability (if that is a word) of a tiling window manager. As an aside, one of the things I love about Linux is that you can essentially have two completely different front ends for all your applications and files, and switch between them at will. Mostly I like the tiling interface, but every now and again I&rsquo;m in a &lsquo;point and click&rsquo; kind of mood, and I can log out and log in to Gnome with very little effort.</p>
<p><a href="https://archlinux.org/">Arch Linux</a> is great, but &mdash; like many Linux distros &mdash; it offers you plenty of opportunities to shoot yourself in the foot. A couple of weeks ago, even though I knew better, I managed to take up that opportunity.</p>
<p>Long story short, it turns out that accidentally uninstalling your login shell is a Bad Thing. In my defence, I was tired and in a hurry, but that is really no excuse, and it is certainly not a problem with Arch. I had btrfs boot snapshots enabled, so I was able to roll back to a snapshot before my fateful <code>sudo pacman -R fish-git</code> incident, but in trying to figure out how to make that snapshot permanent and current, I messed things up even more.</p>
<p>I had a backup of all my user files, so it was time to format the drive and start again.</p>
<p>One thing that has always made me a little uncomfortable about Arch Linux is that there seems to be no good way (that I have found, anyway) to easily keep a record of what you have installed and then automatically reinstall it all. You may remember my previous adventures with both <a href="https://www.rousette.org.uk/archives/nixos-and-the-art-of-os-configuration/" title="NixOS and the art of OS configuration">NixOS</a> and <a href="https://www.rousette.org.uk/archives/setting-up-a-development-environment-with-nix-and-home-manager/" title="Setting up a development environment with Nix and Home Manager">using Nix with Home Manager</a>. I found using Nix incredibly satisfying and frustrating in equal measures. It&rsquo;s a huge ecosystem, and both the error messages and the documentation can be hard to follow for a newbie. Despite all that, having a declarative system would solve the problems I have just mentioned, and if I was having to start again from scratch, I wanted a maintainable system, even if it took me longer to get things set up.</p>
<p>Nix has increased enormously in popularity, even since my last serious interaction with it starting in 2022, and so it is much easier to find resources and help than it used to be. Even though they are <em>still</em> not marked as a stable feature, everyone now seems to have converged on using Flakes, so most recent tutorials and guides are written on that basis, making it easier to follow. In the meantime, I have also started learning another programming language for fun (that&rsquo;s a story for another time), so I have found it a bit easier to understand the functional programming aspects of Nix as a language.</p>
<p>I used the graphical ISO as it is a very easy on-ramp, and I knew that I would want Gnome installed anyway. From there, I started gradually building on the <code>configuration.nix</code> file that was generated to get the feel for installing and configuring things. Once I started to feel that I needed to modularise things, I used the core of <a href="https://github.com/rvveber/nixos-config" title="Robin Weber's NixOS config">Robin Weber&rsquo;s excellent configuration</a> to work out how to do this. It took a little while, and I got better at understanding Nix error messages along the way. I now have quite a lot of my system set up, neatly and declaratively configured. I still have to install and configure Hyprland (I&rsquo;m taking one step at a time), and decide how to handle Neovim and Emacs (there are many options), but it is a really nice and workable system already.</p>
<p>One of the fun parts has been using <a href="https://stylix.danth.me/index.html" title="Stylix Nix themeing framework">Stylix</a> to simultaneously theme most of my applications, desktop and tools. You can declare a theme in your configuration, and add a few lines to automatically apply that theme to a huge range of elements. If the application you are working with is not set up to be auto-themed, you can still use an abstract reference to the colours from the stylix base16 themes in your configuration. The colours are defined as their base numbers in a consistent way, so &mdash; whichever theme you use &mdash; one base colour will represent the red-ish colour, one the darkest background, and so on. What this means is that you can change the actual theme in one place, and all the applications will change consistently. It&rsquo;s pretty cool.</p>
<p>I found out about this tool from a Youtuber called <a href="https://www.youtube.com/@vimjoyer/videos" title="Vimjoyer's Youtube channel">Vimjoyer</a>: everyone&rsquo;s favourite helmeted Neovim and Nix expert. Vimjoyer&rsquo;s guides are very easy to follow, and manage to break down the complexity into digestible chunks. I think I must have watched almost all the videos in the channel by now, and they have helped a lot. I even managed to write a simple package to package up and install the Berkeley Mono font I bought and love to bits so that I can use it in Nix.</p>
<p>I&rsquo;m really enjoying NixOS the second (third?) time around, and am feeling more confident that I have a better handle on how it works. The declarative thing is really addictive though. It makes using non-declarative operating systems feel very old-fashioned. I still have to set up Hyprland again, and I am also hoping to move my <code>/home</code> directory to the other internal drive I have in this computer. I&rsquo;ve seen a guide on how to do that on NixOS which made it seem very simple, but I&rsquo;m still a bit scared to do it! At least now I know that I can just reboot my computer, choose the next snapshot back and un-do my mistakes. In the absolute worst case scenario, I could format the drive again, install NixOS from the ISO, then pull my configuration from GitHub and rebuild it all. All I would need to do then would be to restore my user files from a backup. One of the reasons that I&rsquo;m keen to move my <code>/home</code> to another drive is that I wouldn&rsquo;t even have to do that last step: I could just format the boot drive and rebuild my system, and my user files would be safe.</p>