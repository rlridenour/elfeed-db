<p>While playing around with Swift package manager, I had a quick look into code coverage options. Luckily, coverage reporting and exporting are supported out of the box (via <a href="https://llvm.org/docs/CommandGuide/llvm-cov.html">llvm-cov</a>).</p>
<p>Ensure tests are invoked as follows:</p>
<pre><code class="language-{.bash">swift test --enable-code-coverage
</code></pre>
<p>A high level report can be generated with:</p>
<pre><code class="language-{.bash">xcrun llvm-cov report .build/x86_64-apple-macosx/debug/FooPackageTests.xctest/Contents/MacOS/FooPackageTests \
      -instr-profile=.build/x86_64-apple-macosx/debug/codecov/default.profdata -ignore-filename-regex=&quot;.build|Tests&quot;
</code></pre>
<p>llvm-cov can export as lcov format:</p>
<pre><code class="language-{.bash">xcrun llvm-cov export -format=&quot;lcov&quot; .build/x86_64-apple-macosx/debug/FooPackageTests.xctest/Contents/MacOS/FooPackageTests -instr-profile=.build/x86_64-apple-macosx/debug/codecov/default.profdata -ignore-filename-regex=&quot;.build|Tests&quot; &gt; coverage.lcov
</code></pre>
<p>With the report in lcov format, we can look for an Emacs package to visualize coverage in source files. Found <a href="https://github.com/twada/coverlay.el">coverlay.el</a> to require minimal setup. I was interested in highlighting only untested areas, so I set <em>tested-line-background-color</em> to nil:</p>
<pre><code class="language-{.commonlisp">(use-package coverlay
  :ensure t
  :config
  (setq coverlay:tested-line-background-color nil))
</code></pre>
<p>After installing coverlay, I enabled the minor mode via <em>M-x coverlay-minor-mode</em>, invoked <em>M-x coverlay-watch-file</em> to watch <em>coverage.lcov</em> for changes, and voil√†!</p>
<p><img src="https://xenodium.github.io/images/swift-package-code-coverage/coverage.png" alt=""></p>
