<div>  <figure>    <blockquote>      <p>"Winning takes talent, to repeat takes character."</p>      <figcaption>&ndash; John Wooden</figcaption>    </blockquote>  </figure>  <p>Remember Emacs's transient maps?</p>  <p>I posted about them all the way <a href="emacs-repeat-emacs-repeat">back in 2016</a>. Transient maps temporarily add a keymap that is active only for a single keypress. It enables things like repeating commands, or making a set of similar commands easier to call one after another.</p>  <p>Well, times have changed.</p>  <p>In 2022, Emacs 28.1 was released. This release added repeat mode, a piece of functionality that's similar to transient maps. Like transient maps, repeat mode allows for different actions to be triggered by keypresses after a function is called. Unlike transient maps, repeat mode works without modifying the source of the function being acted on.</p>  <p>But repeat mode is confusing.</p>  <p>Like "repeat mode" suggests, it lets the user repeat commands. If that were all it does, repeat mode would be useful, but it would duplicate <code>C-x z</code> (<code>#'repeat</code>). Luckily, repeat mode has more functionality than just repeating.</p>  <p>Maybe even the <em>name</em> is confusing.</p></div><div>  <h2>Using repeat mode</h2>  <div>    <p>Enable it with <code>(repeat-mode 1)</code>.</p>    <p>Now, every time a command is called, Emacs will look at the <code>'repeat-map</code> property on that specific command. If it finds a keymap there, Emacs will bind it as a transient map after running the command.</p>    <p>To use it, add a keymap to the function with <code>(put #'original-function-name 'repeat-map 'keymap-for-the-function)</code></p>    <p>If you look carefully, you'll notice that I lied before.</p>    <p>There isn't a <em>keymap</em> as the property; there's a <em>symbol</em>. That is, the keymap name is quoted. It can't directly be a function, like a <code>make-keymap</code> call. Instead, make a variable and set its value to the desired keymap, like <code>(defvar my-example-repeat-map (define-keymap "h" #'function-to-repeat))</code>.</p>    <p>Once we do all that, after calling <code>#'original-function-name</code>, the user can call <code>#'function-to-repeat</code> by pressing <code>h</code>.</p>    <p>I suspect repeat mode doesn't look directly for a keymap to encourage variable use. That way, users can add and remove bindings from the keymap after it's added to the function. But that's just a guess.</p>  </div></div><div>  <h2>Not just for repeating</h2>  <div>    <p>Remember how I said repeat mode was confusing? Well, it sure is. Unintuitively, repeat mode is not just for repeating. It can be used to call a whole menu of commands after the original function.</p>    <p>If you're writing your own functions, I'm not sure whether to use repeat maps vs transient maps. As far as I can tell, the result is basically the same, except for two things:</p>    <ol>      <li><p>Repeat-maps can be listed by <code>#'describe-repeat-maps</code>. I don't think this is especially useful.</p></li>      <li><p>Repeat-maps automatically message the user the keys that are bound in that map, although they do not tell the user what the keys do. Transient maps don't provide any guidance to the user.</p></li>    </ol>    <p>On the other hand, repeat mode means you can change any given function, not just ones you're coding yourself.</p>  </div></div><div>  <h2>An example!</h2>  <div>    <p>Let's say you want to capitalize, lowercase, and upcase words easily. We want to choose between pressing <code>c</code> to call <code>#'capitalize-dwim</code>, <code>d</code> to call <code>#'downcase-dwim</code>, and <code>u</code> for <code>#'upcase-dwim</code>. First, let's create a keymap that binds those three keys.</p>    <pre><code class="code-emacs-lisp">(defvar change-of-case-keymap  (define-keymap    "c" #'capitalize-dwim    "d" #'downcase-dwim    "u" #'upcase-dwim))</code></pre>    <p>Now, we set that map as the <code>'repeat-map'</code> property on the three functions.</p>    <pre><code class="code-emacs-lisp">(put #'capitalize-dwim 'repeat-map 'change-of-case-keymap)(put #'downcase-dwim 'repeat-map 'change-of-case-keymap)(put #'upcase-dwim 'repeat-map 'change-of-case-keymap)</code></pre>    <p>Now, after running any of those three functions, the keymap is activated, and it's possible to run any of the three functions again with a keypress.</p>  </div></div><div>  <h2>Go and repeat!</h2>  <div>    <p>That's all I have to say. Go and repeat.</p>    <p>Go and repeat.</p>  </div></div>