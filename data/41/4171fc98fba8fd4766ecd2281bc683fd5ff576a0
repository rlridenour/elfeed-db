
	
<p>
Computing has come a long way in the past 75 years. I learned how to write code in the 1980s on my tiny 1 kilobyte ZX81 home computer. With only 1 kilobyte of memory, capabilities were limited, but this machine set me off on an adventure writing code in the BASIC language. An active subculture of computer enthusiasts still develops new code and keeps these old machines alive. I recently stumbled across the fantastic <a href="https://spectrumcomputing.co.uk/index.php?cat=96&amp;id=30392">Tenliner Cave Adventure</a> (2016) by Einar Saukas from Brazil. This tiny ZX81 program provides a fully functional classical text adventure using some cunning techniques. This article contains a port of this game to the R language to explore its inner workings.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Interactive Fiction
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Text adventures, or interactive fiction, were trendy in the 1980s. The basic premise is that the computer shows a text and the player responds with a text command. The computer parses the command, calculates the new state of play and progresses the game with a new bit of prose. Last year I wrote an article about writing interactive fiction using the R language with a translation of <a href="https://lucidmanager.org/data-science/text-adventure/">Secret of Landusia</a>. The <em>Tenliner Cave Adventure</em>  provides a minimalist approach by squashing the basic principles of a text adventure into 1024 bytes of memory. The backstory of this Saukas&#39; mini-adventure is a typical fantasy setting:</p>
<blockquote>
<p>As a young warrior apprentice, you have been chosen by the village elders to seek out the evil menace that lurks in some nearby caves. Once found, use any means at your disposal to defeat itâ€¦ Good luck on your quest!</p>
</blockquote>
<figure>
<img src="https://lucidmanager.org/images/rgames/zx81.png" alt="ZX81 Screenshot of the Tenliner Cave Adventure" title="ZX81 Screenshot of the Tenliner Cave Adventure"/>
<figcaption>
ZX81 Screenshot of the Tenliner Cave Adventure.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Tenliner Cave Adventure in R
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>The Tenliner Cave Adventure is a jewel of efficient programming. The game is simple, but it has all typical elements of a text adventure.  As I no longer own a ZX81, I could not resist translating this code to R to be able to play and reverse-engineer the game. </p>
<p>
The game recognises the following commands:</p>
<ul>
<li>north, south, east, west (move)</li>
<li>inventory</li>
<li>look</li>
<li>look &lt;object&gt;</li>
<li>get &lt;object&gt;</li>
<li>open &lt;object&gt;</li>
<li>kill &lt;object&gt;</li>
</ul>
<p>Most advanced games understand abbreviations and synonyms, but in this simple version, you have to provide precise commands. Can you rid the village of the evil menace?</p>
<p>
<a href = "https://github.com/pprevos/RGames/" target="_blank"
   title="Download RGames from GitHub"
   alt="Download RGames from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">RGames</span>
  </button>
</a>

</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Tenliner Cace Adventure by Einar Saukas</span>
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Ported from ZX81 BASIC to R by Peter Prevos</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Helper functions to keep syntax close to ZX81</span>
</span></span><span style="display:flex;"><span>  val <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(p) <span style="color:#06b;font-weight:bold">as.numeric</span>(p)
</span></span><span style="display:flex;"><span>  x <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(p, q <span style="color:#333">=</span> p) <span style="color:#06b;font-weight:bold">substr</span>(X, p, q)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Ported ZX81 code</span>
</span></span><span style="display:flex;"><span>  X <span style="color:#333">&lt;-</span> <span style="background-color:#fff0f0">&#34;100cannot doyou walk opened   closed   a sword  a key    nothing  a chest  a dragon a corpse taken    you died you won. &#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-weight:bold">repeat</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">cat</span>(<span style="color:#06b;font-weight:bold">paste</span>(<span style="background-color:#fff0f0">&#34;You are in a&#34;</span>, <span style="color:#06b;font-weight:bold">substr</span>(<span style="background-color:#fff0f0">&#34;cavepit halllake&#34;</span>, <span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>)) <span style="color:#333">*</span> <span style="color:#60e;font-weight:bold">4</span> <span style="color:#333">-</span> <span style="color:#60e;font-weight:bold">3</span>, <span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>)) <span style="color:#333">*</span> <span style="color:#60e;font-weight:bold">4</span>), <span style="background-color:#fff0f0">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>      u <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">tolower</span>(<span style="color:#06b;font-weight:bold">readline</span>(prompt <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;What would you like to do? &#34;</span>))
</span></span><span style="display:flex;"><span>      m <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">2</span> <span style="color:#333">*</span> (u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;north&#34;</span>) <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">&lt;</span> <span style="background-color:#fff0f0">&#34;3&#34;</span>) <span style="color:#333">-</span>
</span></span><span style="display:flex;"><span>        <span style="color:#60e;font-weight:bold">2</span> <span style="color:#333">*</span> (u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;south&#34;</span>) <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">&gt;</span> <span style="background-color:#fff0f0">&#34;2&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;2&#34;</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;west&#34;</span>) <span style="color:#333">-</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;3&#34;</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;east&#34;</span>)
</span></span><span style="display:flex;"><span>      a <span style="color:#333">&lt;-</span> (<span style="color:#60e;font-weight:bold">3</span> <span style="color:#333">*</span> <span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">2</span>)) <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">2</span> <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">3</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;2&#34;</span>)) <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">2</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;look chest&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#60e;font-weight:bold">11</span> <span style="color:#333">+</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">3</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;2&#34;</span>)) <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;3&#34;</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;kill dragon&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        (m <span style="color:#333">!=</span> <span style="color:#60e;font-weight:bold">0</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#60e;font-weight:bold">5</span> <span style="color:#333">+</span> <span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>))) <span style="color:#333">*</span> (u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;look&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#60e;font-weight:bold">6</span> <span style="color:#333">-</span> <span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">3</span>))) <span style="color:#333">*</span> (u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;inventory&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#60e;font-weight:bold">6</span> <span style="color:#333">-</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">3</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;0&#34;</span>)) <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">4</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;look corpse&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#60e;font-weight:bold">10</span> <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>, <span style="color:#60e;font-weight:bold">3</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;400&#34;</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;get key&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#60e;font-weight:bold">2</span> <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>, <span style="color:#60e;font-weight:bold">3</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;201&#34;</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;open chest&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#60e;font-weight:bold">10</span> <span style="color:#333">*</span> (<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>, <span style="color:#60e;font-weight:bold">3</span>) <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;211&#34;</span> <span style="color:#333">&amp;</span> u <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;get sword&#34;</span>)
</span></span><span style="display:flex;"><span>      X <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">paste0</span>(<span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">1</span>)) <span style="color:#333">+</span> m, <span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">2</span>)) <span style="color:#333">+</span> (a <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">2</span>), <span style="color:#06b;font-weight:bold">val</span>(<span style="color:#06b;font-weight:bold">x</span>(<span style="color:#60e;font-weight:bold">3</span>)) <span style="color:#333">+</span> (a <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">10</span>), <span style="color:#06b;font-weight:bold">substring</span>(X, <span style="color:#60e;font-weight:bold">4</span>))
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">cat</span>(<span style="color:#06b;font-weight:bold">paste</span>(<span style="color:#06b;font-weight:bold">substr</span>(X, a <span style="color:#333">*</span> <span style="color:#60e;font-weight:bold">9</span> <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">4</span>, a <span style="color:#333">*</span> <span style="color:#60e;font-weight:bold">9</span> <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">12</span>), <span style="background-color:#fff0f0">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>      <span style="color:#080;font-weight:bold">if</span> (a <span style="color:#333">&gt;=</span> <span style="color:#60e;font-weight:bold">11</span>) <span style="color:#080;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>  }</span></span></code></pre></div>
</div>
<p>
This port of the <em>Ten-liner Text Adventure</em> stay as close as possible to the original code by creating two helper functions, <code class="verbatim">val()</code> and <code class="verbatim">x()</code>. In ZX81 basic, you can subset a string with parenthesis, which is mimicked in this code with the <code class="verbatim">x()</code> function. The <code class="verbatim">val()</code> function in ZX81 BASIC converts a string to a value. The rest of the code is almost literally the same as the ZX81 version.</p>
<p>
The workings of the game are ingenious and minimise memory usage on the ZX81 to a minimum. All numeric values are stored in the <code class="verbatim">X</code> string to save memory, which also contains all game responses. The first number is the room number the player is in, the second number records whether the chest is closed or open and the third number records the objects held by the player (the inventory). The responses in the <code class="verbatim">X</code> variable are all nine characters long. </p>
<p>
In ZX81 BASIC, all lines have numbers to control sequencing. This version uses a <code class="verbatim">repeat{}</code> loop that keeps running until the game ends.</p>
<p>
The game opens with displaying the room the player is in. Next, the player is asked to provide a response.</p>
<p>
The variable <code class="verbatim">m</code> determines the movement of the player depending on their direction. The result is a number between -2 and 2, which indicates the difference between the current and new room. The code uses a complex boolean expression to work this out.</p>
<p>
The variable <code class="verbatim">a</code> determines the outcome after the command if it is not a change in direction. This is the most sophisticated line in the game. In the original listing, it took three lines to determine the new game state due to line-length restrictions. In this code, I concatenated it into one line in line with the games minimalism philosophy. This line combines the input of the player with the current game state to determine the new situation.</p>
<p>
In the next step, the code changes the state of the game by updating the three numbers in <code class="verbatim">X</code>. The game displays a response, depending on the content of <code class="verbatim">a</code>.</p>
<p>
It takes much more space to describe how this game works than the size of the code itself.</p>
<p>
Have fun!</p>
<p>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
</div>
</div>

      