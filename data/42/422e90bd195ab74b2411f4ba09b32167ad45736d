<p><a href="http://www.dyerdwelling.family/">James Dyer</a> has a nice <a href="https://www.emacs.dyerdwelling.family/emacs/20230606213531-emacs--dired-duplicate-here-revisited/">post</a> sharing his frequent <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Dired.html">dired</a> need to duplicate files. He offers a solution using a custom interactive command. His use-case resonated with me.</p>
<p>Similarly, James' recommendation to bind his file-duplicating command to <code>C-c d</code> [^1] sent a signal to my brain triggering <a href="https://twitter.com/bbatsov">Bozhidar Batsov</a>'s <code>crux-duplicate-current-line-or-region</code>.</p>
<p><code>crux-duplicate-current-line-or-region</code> is part of a &quot;collection of Ridiculously useful extensions for Emacs&quot; (yeah that's <a href="https://github.com/bbatsov/crux">crux</a>). The command itself does what it says on the tin.</p>
<p>Let's duplicate the current line.</p>
<p><img src="https://xenodium.github.io/images/duplicate-this/duplicate-line.gif" alt=""></p>
<p>Now let's duplicate the current region.</p>
<p><img src="https://xenodium.github.io/images/duplicate-this/duplicate-region.gif" alt=""></p>
<p>Since I already have a well-internalized key-binding duplicating lines/regions in text buffers, I could extend a similar behaviour to dired files with almost zero adoption effort.</p>
<p>In case you haven't noticed, I've made it a <a href="https://youtu.be/urcL86UpqZc?t=177">part-time job</a> to make command line utilities easily accessible from Emacs (<a href="https://xenodium.com/joining-images-from-the-comfort-of-dired/">1</a> <a href="https://xenodium.com/emacs-dwim-shell-command/">2</a> <a href="https://xenodium.com/emacs-password-protect-current-pdf-revisited/">3</a> <a href="https://xenodium.com/dwim-shell-command-now-on-windows/">4</a> <a href="https://xenodium.com/recordscreenshot-windows-the-lazy-way/">5</a> <a href="https://xenodium.com/emacs-ffmpeg-and-macos-alias-commands/">6</a> <a href="https://xenodium.com/emacs-quick-kill-process/">7</a> <a href="https://xenodium.com/hey-emacs-change-the-default-macos-app-for/">8</a> <a href="https://xenodium.com/hey-emacs-where-did-i-take-that-photo/">9</a> <a href="https://xenodium.com/emacs-open-with-macos-app/">10</a> <a href="https://xenodium.com/emacs-macos-sharing-dwim-style-improved/">11</a> <a href="https://xenodium.com/emacs-macos-share-from-dired-dwim-style/">12</a> <a href="https://xenodium.com/emacs-reveal-in-finder-dwim-style/">13</a> <a href="https://xenodium.com/dwim-shell-command-usages-pdftotext-and-scp/">14</a> <a href="https://xenodium.com/dwim-shell-command-with-template-prompts/">15</a> <a href="https://xenodium.com/seamless-command-line-utils/">16</a> <a href="https://xenodium.com/dwim-shell-command-video-streams/">17</a> <a href="https://xenodium.com/dwim-shell-command-improvements/">18</a> <a href="https://xenodium.com/dwim-shell-command-on-melpa/">19</a> <a href="https://xenodium.com/emacs-dwim-shell-command-multi-language/">20</a> <a href="https://xenodium.com/png-to-icns-emacs-dwim-style/">21</a>) via <a href="https://github.com/xenodium/dwim-shell-command">dwim-shell-command</a>. Partly because it's fairly quick and partly 'cause it's fun.</p>
<p>Jame's post gave me yet another opportunity to exercise my errrm part-time job. This time, duplicating files. All I need is the <a href="https://www.man7.org/linux/man-pages/man1/cp.1.html">cp</a> utility and a template:</p>
<pre><code class="language-{.bash">cp -R '&lt;&lt;f&gt;&gt;' '&lt;&lt;f(u)&gt;&gt;'
</code></pre>
<p>I seldom type these template's myself when I want to execute a command (via <code>M-x dwim-shell-command</code>). I typically wrap these templates in interactive commands, making them easily accessible via <code>M-x</code> and your favorite completion framework. I happen to use <a href="https://github.com/abo-abo/swiper">ivy</a>.</p>
<pre><code class="language-{.commonlisp">(require 'dwim-shell-command)

(defun dwim-shell-commands-duplicate ()
  &quot;Duplicate file(s).&quot;
  (interactive)
  (dwim-shell-command-on-marked-files
   &quot;Duplicate file(s).&quot;
   &quot;cp -R '&lt;&lt;f&gt;&gt;' '&lt;&lt;f(u)&gt;&gt;'&quot;
   :utils &quot;cp&quot;))
</code></pre>
<p>There's nothing much to the command. Most logic is handled by the template, replacing <code>&lt;&lt;f&gt;&gt;</code> with the current file and <code>&lt;&lt;f(u)&gt;&gt;</code> with a uniquified version of it. Having said this, there's a bunch of free <a href="https://xenodium.com/emacs-dwim-do-what-i-mean/">DWIM</a> love that kicks in, courtesy of the <code>dwim-shell-command</code> package by yours truly. Let's give our new <code>dwim-shell-commands-duplicate</code> command a spin.</p>
<p>Like <code>crux-duplicate-current-line-or-region</code> duplicates the current line, our new command duplicates the current dired file.</p>
<p><img src="https://xenodium.github.io/images/duplicate-this/duplicate-file.gif" alt=""></p>
<p>Got multiple files to duplicate? Like <code>crux-duplicate-current-line-or-region</code>, we can use the region for a similar purpose.</p>
<p><img src="https://xenodium.github.io/images/duplicate-this/duplicate-files.gif" alt=""></p>
<p>While we have been using the region to duplicate adjacent files, we can also mark specific files.</p>
<p><img src="https://xenodium.github.io/images/duplicate-this/duplicate-marked.gif" alt=""></p>
<p>Our <code>cp -R '&lt;&lt;f&gt;&gt;' '&lt;&lt;f(u)&gt;&gt;'</code> template uses the <code>-R</code> (recursive) flag, so we get another freebie. In addition to files, we can also duplicate directories.</p>
<p><img src="https://xenodium.github.io/images/duplicate-this/duplicate-dirs.gif" alt=""></p>
<p>Lastly, because we're on a DWIM train, if your current buffer happens to be visiting a file, you can <code>M-x dwim-shell-commands-duplicate</code> the current file to duplicate it. You're automatically dropped to a dired buffer, with point on the new file (à la <a href="https://emacsredux.com/blog/2013/09/24/dired-jump/">dired-jump</a>).</p>
<p><img src="https://xenodium.github.io/images/duplicate-this/duplicate-buffer.gif" alt=""></p>
<p>While duplicating files using a template was a mere <code>cp -R '&lt;&lt;f&gt;&gt;' '&lt;&lt;f(u)&gt;&gt;'</code> away, we get a bunch of free DWIM magic applied to a handful of use-cases and contexts. What made the file-duplicating use-case extra special is that it maps almost exactly to an equivalent text command. Keep the same key bindings and we almost get a &quot;<a href="https://endlessparentheses.com/hungry-delete-mode.html">free feature</a>&quot;.</p>
<pre><code class="language-{.commonlisp">(use-package crux
  :ensure t
  :commands crux-open-with
  :bind
  ((&quot;C-c d&quot; . crux-duplicate-current-line-or-region)))

(use-package dwim-shell-command
  :ensure t
  :bind (:map dired-mode-map
              (&quot;C-c d&quot; . dwim-shell-commands-duplicate))
  :config
  ;; Loads all my own dwim shell commands
  ;; (including `dwim-shell-commands-duplicate')
  (require 'dwim-shell-commands))
</code></pre>
<p>You can find my ever-growing list of similar commands over at <a href="https://github.com/xenodium/dwim-shell-command/blob/main/dwim-shell-commands.el">dwim-shell-commands.el</a> (the optional part of the package). Got some nifty usages? Would love to check 'em out. <a href="https://indieweb.social/@xenodium">Get in touch</a>.</p>
<p>Like this or <a href="https://xenodium.com/">other content</a>? <a href="https://github.com/sponsors/xenodium">✨Sponsor✨ via GitHub Sponsors</a>.</p>
<h2>Update</h2>
<p>If you're keen on a regex-based approach, <a href="https://www.reddit.com/user/arthurno1/">u/arthurno1</a> <a href="https://www.reddit.com/r/emacs/comments/14rmvkx/comment/jqtkel8/?utm_source=share&amp;utm_medium=web2x&amp;context=3">offers a great built-in alternative</a>: dired-do-copy-regexp (bound to <code>% C</code>).</p>
