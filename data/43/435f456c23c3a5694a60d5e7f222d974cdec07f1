 
          <p>Once you start digging beyond the surface, you discover that an ancient piece of text editing software called Emacs was light years ahead of its time. It already contained a clipboard history (<code>kill-ring</code>) and automatic saves/backups decades before contemporary editors took a half-baked stab at mimicking these features. Granted, I don&rsquo;t make use of the kill ring because Alfred manages that for me across different applications, but it&rsquo;s still pretty damn impressive.</p>
<p>If you manage to stumble past the initial setup, that is. Many default settings in Emacs are&hellip; weird? The first thing to configure to transition to a bit of a sane default system is moving all those <code>.*~</code> and <code>.#*#</code> backup and auto-save files to a central location to stop the editor from littering all over the place. That&rsquo;s pretty easy to do but begs the question why they don&rsquo;t change these defaults? Nobody wants random backup files popping up in their Git change set!</p>
<p>Do you even need those files? The system feels archaic at first, but the more you think about the possibilities, the more brilliant the idea becomes. Let&rsquo;s ignore the auto-save system for now&mdash;that doesn&rsquo;t auto-save but auto-saves an auto-save backup that&rsquo;s not a backup. Got all that?</p>
<p>On every <em>manual</em> <code>save-buffer</code>, a backup file <code>.*~</code> is created or replaced, depending on your configuration. These files can act as your local file history in case you&rsquo;re not rocking a version control system. If you do, Emacs notices this and stops producing backups. I do recommend setting <code>vc-make-backup-files</code> to <code>t</code> as you might lose interesting historical data <em>before</em> doing a commit. That is one of the more useful features of IntelliJ-based IDEs: to go back in time a few minutes to half an hour.</p>
<p>Why would you need that? Emacs has a built-in undo history system! Very true, and perhaps better, as that doesn&rsquo;t require a save, but isn&rsquo;t persistent. I can hear you say it. You&rsquo;re right: <em>there&rsquo;s a package for that</em>. It&rsquo;s called <a href="https://github.com/emacsmirror/undo-fu-session">undo-fu-session</a> and it serialises the undo information without changing any inner logic. This is even more brilliant if coupled with <code>vundo</code> that helps you step through this. If you increase the three related <code>undo-limit</code> settings, you will have a powerful way to go back in time.</p>
<p>Perhaps a bit too powerful? What is a good limit? Contrary to IntelliJ, Emacs does not persist timestamps: it only works with bytes and limits those, so you&rsquo;ll have to write a function that periodically cleans up those persisted backups. But are you going to remove the entire tree or just prune a bit? Because if you don&rsquo;t, this is how your <code>vundo</code> session will look like:</p>
<p>
<figure><a href="https://brainbaking.com/post/2026/02/a-note-on-file-history-in-emacs/vundo.png" class="lbox">
		<img src="https://brainbaking.com/post/2026/02/a-note-on-file-history-in-emacs/vundo.png" loading="lazy" title="The vundo tree: a visualised undo tree with a lot of nodes to diff..." data-pagefind-index-attrs="title">
	</a>
	
		<figcaption>The vundo tree: a visualised undo tree with a lot of nodes to diff...</figcaption></figure>
</p>
<p>And that&rsquo;s just a clean tree with no branching reapplied undo paths. Good luck trying to hop between different nodes, selecting the right ones to diff and revert to. Without timestamp info, a big undo tree is useless.</p>
<p>So I removed <code>undo-fu-session</code>: too much power, too much responsibility. Let&rsquo;s keep that history local and non-persistent (even with a daemon you&rsquo;ll end up with more than enough). I started fine-tuning the built-in backup settings:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1">setq</span> version-control <span style="color:#8fbcbb">t</span>
</span></span><span style="display:flex;"><span>      backup-by-copying <span style="color:#8fbcbb">t</span>
</span></span><span style="display:flex;"><span>      delete-old-versions <span style="color:#8fbcbb">t</span>
</span></span><span style="display:flex;"><span>      vc-make-backup-files <span style="color:#8fbcbb">t</span>
</span></span><span style="display:flex;"><span>      kept-new-versions <span style="color:#b48ead">10</span>
</span></span><span style="display:flex;"><span>      kept-old-versions <span style="color:#b48ead">2</span><span style="color:#eceff4">)</span>
</span></span></code></pre></div><p>Which translates to:</p>
<ul>
<li>Keep <em>multiple backup files</em>: <code>file.md.~1~</code>, <code>file.md.~2~</code>, &hellip;</li>
<li>Also backup even if it&rsquo;s under version control</li>
<li>Clean up older files: keep the oldest 2 and the last 10.</li>
<li>Copy the file, don&rsquo;t turn the existing one into a backup and save the buffer as the new file.</li>
</ul>
<p>There&rsquo;s a bit of a catch here: Emacs only saves a backup once per editing session and then assumes you&rsquo;re safe. To force it to create a backup every time you save you&rsquo;ll have to add <code>(setq buffer-backed-up nil)</code> to the <code>before-save-hook</code>. Or, as <a href="https://abochannek.github.io/emacs/2022/11/30/emacs-backup.html">I learned from Alex</a>, save with <code>C-u C-u C-x C-s</code>. Ridiculous. GNU Emacs already featured this snapshot backup system in 1985, when I was born!</p>
<p>Fine, we now have a bunch of backup files. Then what? This is where things can get interesting. Since they&rsquo;re just files, you can obviously run a diff tool against them. But which backup file to choose, and how to easily select the right file from the UI and go from there? Consult to the rescue.</p>
<p><a href="https://github.com/minad/consult">Consult</a> is a completing-read on steroids that plugs seamlessly into Vertico, my minibuffer completion framework. It&rsquo;s basically a fuzzy search tool you can throw anything at&mdash;including a list of backup files to choose from. Which is exactly what I did. You can change the label (parse the timestamps), choose a lovely icon if you&rsquo;re using nerd-icons et al., and tell Consult what to do when (1) you preview the candidate and (2) when you select it.</p>
<p>So the plan is this:</p>
<ol>
<li>For the current buffer, find all backup files. Easy: <code>buffer-file-name</code>, substitute a few weird chars into !, read them from <code>backup-directory-alist</code>, done. (This very file has a backup called <code> !brainbaking!content!post!2026!02!a-note-on-file-history-in-emacs.md.~1~</code>)</li>
<li>Sort and properly format a timestamp to show in the Consult minibuffer using <code>file-attribute-modification-time</code>.</li>
<li>When previewed, <code>diff-no-select</code> with the current buffer into a new window on the right.</li>
<li>When selected, make that diff window permanent. When cancelled with <code>C-g</code>, cleanup the mess.</li>
</ol>
<p>The result looks like this:</p>
<p>
<figure><a href="https://brainbaking.com/post/2026/02/a-note-on-file-history-in-emacs/consult-result.gif" class="lbox">
		<img src="https://brainbaking.com/post/2026/02/a-note-on-file-history-in-emacs/consult-result.gif" loading="lazy" title="Selecting different backups automatically changes the opened diff on the right." data-pagefind-index-attrs="title">
	</a>
	
		<figcaption>Selecting different backups automatically changes the opened diff on the right.</figcaption></figure>
</p>
<p>I have no idea if I butchered <code>consult--read</code>, I tried a few things until it sort-of worked and had some help with the rest. You can find the source somewhere in the <a href="https://codeberg.org/wouterg/bakemacs/src/branch/main/config/autocomplete-minibuffer.el">Bakemacs config files</a>, look for <code>bb/consult-local-history</code>. It could very well be that something like that already exists, but I haven&rsquo;t found it so far. <code>consult-history</code> does something else. <code>diff-backup</code> sounds good but requires you to navigate to the backup file yourself.</p>
<p>The added advantage of <code>diff</code> mode is that you can revert the diff and re-apply specific hunks. The idea that I&rsquo;ll never lose anything stupid I wrote will make me sleep better later tonight. Sublime Text&rsquo;s persistent but unsaved changed file system and IntelliJ&rsquo;s local history saved my ass more than once. The fact that I cobbled together a working thing using Consult makes this even more satisfying.</p>
<p>Isn&rsquo;t fooling around in Emacs the best thing ever? I hope these nerdy posts are not alienating too many faithful <em>Brain Baking</em> readers&hellip; Because, you know, the Lisp Alien mascot? No? Took it too far?</p>


          
          <p>
            Related topics: /
                  <a href="https://brainbaking.com/tags/emacs">emacs</a> /</span>
          </p>
          
          <p>
            By <a href="/about">Wouter Groeneveld</a> on 10 February 2026.&nbsp;
            <a href="mailto:hifromrss@brainbaking.com?subject=Re: A%20Note%20on%20File%20History%20in%20Emacs">Reply via email</a>.
          </p>
          
      