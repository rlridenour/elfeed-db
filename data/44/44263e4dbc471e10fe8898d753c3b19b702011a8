<h2>Update: Doh! I was wrong. There's a better way.</h2>
<p>So, I totally missed the macOS native emoji picker is actually supported out of the box üò≠. Thanks to redditor <a href="https://www.reddit.com/user/hrabannixlisp/">u/hrabannixlisp</a> who <a href="https://www.reddit.com/r/emacs/comments/1ec5t4j/comment/ley1j59">pointed me in the right direction</a>.</p>
<p><code>ns-do-show-character-palette</code> is bound to <code>C-s-SPC</code> by default, which didn't work for me as I use <code>(setq mac-command-modifier 'meta)</code>, that is, ‚åò as meta modifier.</p>
<p>While I won't be giving up <code>(setq mac-command-modifier 'meta)</code>, I can certainly use <code>ns-do-show-character-palette</code> via <code>M-x</code> or a different binding. Thank you <code>u/hrabannixlisp</code>!</p>
<h2>Read on for how I went about it the long convoluted way ü§∑‚Äç‚ôÇÔ∏è</h2>
<p>A couple of years ago, I was delighted to discover <a href="https://lmno.lol/alvaro/emacs-freebie-macos-emoji-picker">a macOS freebie for us Emacs users</a>. Newer Macbook models started shipping with a globe/üåê key, which summons the macOS native emoji picker. Pressing this key in Emacs works as you'd expect (no config required üéâ).</p>
<p>While I seldom use emojis, the globe key worked great for me until I started using an external keyboard, which didn't have this magical key. The potential solutions I came across suggest either reprogramming the keyboard or using the likes of <a href="https://karabiner-elements.pqrs.org/">Karabiner-Elements</a> to map other keys to an alternate shortcut: <code>Ctrl-‚åò-SPC</code>. As far as I can tell, this is the only other available shortcut (please reach out if otherwise). Not a great option (it conflicts with Emacs's <code>mark-sexp</code>). Not that I'd be super keen to lose this mark command, but even unbinding doesn't seem of much help.</p>
<p>While we have Emacs packages available for different emoji-picking experiences, I was keen on maintaining that native experience I enjoyed before. I nearly gave up on the matter until I remembered we have at least one more tool in the Emacs toolbox: <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Dynamic-Modules.html">dynamic modules</a>. Thanks to Valeriy Savchenko's <a href="https://github.com/SavchenkoValeriy/emacs-swift-module">emacs-swift-module</a>, we can leverage Swift to integrate native macOS experiences.</p>
<p>With that in mind, I set out to find the relevant macOS API, which turned out to be a lovely one-liner:</p>
<pre><code class="language-swift">NSApp.orderFrontCharacterPalette(nil)
</code></pre>
<p>Let's bring it into Emacs via <code>emacs-swift-module</code>'s infrastructure:</p>
<pre><code class="language-swift">try env.defun(
  &quot;macos-module--show-emoji-picker&quot;,
  with: &quot;Show emoji picker (macOS module implementation).&quot;
) { (env: Environment) in
  NSApp.orderFrontCharacterPalette(nil)
}
</code></pre>
<p>In theory, this is all we need. We can <code>M-x eval-expression</code> <code>(macos-module--show-emoji-picker)</code> and the picker simply pops up. I haven't worked out how define an interactive command from <code>emacs-swift-module</code> just yet, so for now I'll just wrap with a little elisp:</p>
<pre><code class="language-{.commonlisp">(defun macos-show-emoji-picker ()
  &quot;Show macOS emoji picker.&quot;
  (interactive)
  (macos-module--show-emoji-picker))
</code></pre>
<p>And with that, we got our native macoOS emoji picker back at our fingertips:</p>
<p><img src="https://xenodium.github.io/images/emacs-macos-native-emoji-picker-revisited/hearts3.webp" alt=""></p>
<p>While the dedicated globe key <em>just worked</em> without configuration, it required newer hardware. This new approach works on older Macbooks too. Since it's an interactive command, you can optionally bind to your preferred keys.</p>
<p>Having said all that, you may have noticed a brief lag during insertion. I haven't worked out the source, but since I rarely use emojis, this will have to do for now. If you have a better macOS alternative working on external keyboards, <a href="https://indieweb.social/@xenodium">I'd love to hear about it</a>!</p>
<p>I've added <code>macos-show-emoji-picker</code> to <code>EmacsMacOSModule</code>, a tiny repo I've used to experiment with <a href="https://github.com/SavchenkoValeriy/emacs-swift-module">emacs-swift-module</a>. You can find <code>EmacsMacOSModule</code> on <a href="https://github.com/xenodium/EmacsMacOSModule">GitHub</a>.</p>
<h2>Unrelated - Want your own blog?</h2>
<p>Like this blog? Want to start a blog? Run your blog off a single file. Write from the comfort of your favourite text editor and <a href="https://indieweb.social/@xenodium/112265481282475542">drag and drop to the web</a>. I'm launching a blogging service at <a href="https://lmno.lol">lmno.lol</a>. Looking for early adopters. <a href="https://indieweb.social/@xenodium">Get in touch</a>.</p>
