 
          <p>Since the Belgian government mandated the use of digitized smart energy meters we&rsquo;ve been <a href="/post/2025/06/are-solar-panels-really-worth-it/">more carefully monitoring</a> our daily energy demand. Before, we&rsquo;d simply chuck all the dishes in the machine and program it to run at night: no more noise when we&rsquo;re around. But now, consuming energy at night is costing us much more. The trick is to take as little as possible from the grid, but also put as little as possible back. In short, consume (or store) energy when our solar panels produce it. That dishwasher will have to run at noon instead.</p>
<p>The same principle applies to running demanding software: CPU or GPU-intensive tasks consume an awful amount of energy, so why run them when there&rsquo;s less energy available locally, thus paying more? Traditionally, these kinds of background jobs are always scheduled at night using a simple cron expression like <code>0 3 * * *</code> that says &ldquo;At 03:00 AM, kick things in gear&rdquo;. But we can do better.</p>
<p>At 03:00 AM, our solar panels are asleep too. Why not run the job when the sun is shining? Probably because you don&rsquo;t want to interfere with the heavy load of your software system during the day thanks to your end users. It&rsquo;s usually not a good idea to start generating PDF files <em>en masse</em>, clogging up all available threads, severely slowing down the handling of incoming HTTP requests. But there&rsquo;s still a big margin to improve the planning of the job: instead of saying &ldquo;At 03:00 AM <em>exactly</em>&rdquo;, why can&rsquo;t we say &ldquo;Between 01:00 AM and 07:00 AM&rdquo;? That&rsquo;s still before the big HTTP rush, and in the early morning, chances are there&rsquo;s more cheap energy available to you.</p>
<p>Cooking up a simple version of this for home use is easy with the help of Home Assistant. The following historical graph shows our typical energy demand during the last week (dreadful Belgian weather included):</p>
<p>
<figure><a href="https://brainbaking.com/post/2025/11/using-energy-prediction-to-better-plan-cron-jobs/homeassistant-history.jpg" class="lbox">
		<img src="https://brainbaking.com/post/2025/11/using-energy-prediction-to-better-plan-cron-jobs/homeassistant-history.jpg" loading="lazy" title="Home Assistant history of P1 Energy Meter Demand from 24 Nov to 28 Nov." data-pagefind-index-attrs="title">
	</a>
	
		<figcaption>Home Assistant history of P1 Energy Meter Demand from 24 Nov to 28 Nov.</figcaption></figure>
</p>
<p>Care to guess what these spikes represent? Evenings. Turning on the stove, the oven, the lights, the TV obviously creates a big spike in energy consumption, and at the same time, the moon replacing the sun results in us taking instead of giving from the energy grid. This is the reason the government charges more then: if everybody creates spikes at the same time, there&rsquo;s much more pressure on the general grid. But I can&rsquo;t bake my fries at noon when I&rsquo;m work and we aren&rsquo;t supposed to watch TV when we&rsquo;re working from home&hellip;</p>
<p>That data is available through the Home Assistant API: <code>http://myserver/api/history/period/2025-11-21T00:00:00Z?filter_entity_id=sensor.p1_meter_average_demand&amp;end_time=2025-11-28T00:00:00Z</code>. Use an authorization header with a Bearer token created in your Home Assistant profile. If you collect this for a few weeks and average the results you can make an estimated guess when demand will be going up or down.</p>
<p>If you want things to get a bit more fancy, you can use the <a href="https://emhass.readthedocs.io/en/latest/forecasts.html#pv-power-production-forecast0">EMHASS Home Assistant plug-in</a> that includes a power production forecast module. This thing uses machine learning and other APIs such as <a href="https://solcast.com/">https://solcast.com/</a> that predicts solar power&mdash;or weather in general: the better the weather, the more power available to burn through (given you&rsquo;ve got solar panels installed). EMHASS also internalizes your power consumption habits. Combined, its prediction model can help to better plan your jobs when energy demand is low and availability is high.</p>
<p>You don&rsquo;t need Home Assistant to do this, but the software does help smooth things over with centralized access to data using a streamlined API. Our energy consumption and generation is measured using <a href="https://www.homewizard.com/nl/p1-meter/">HomeWizard&rsquo;s P1 Meter</a> that plugs into <a href="https://www.fluvius.be/nl/meters-en-meterstanden/digitale-meter">our provider&rsquo;s digital meter</a> and sends the data over to Home Assistant. That&rsquo;s cool if you are running software in your own basement, but will hardly do on a bigger scale.</p>
<p>Instead of monitoring your own energy usage, you can rely on grid data from the providers. In Europe, the <a href="https://www.entsoe.eu/data/power-stats/">European Network of Transmission System Operators for Electricity</a> (ENTSO-E) provides APIs to access power statistics based on your region&mdash;including a day-ahead forecast! In USA, there&rsquo;s the <a href="https://www.eia.gov/">U.S. Energy Information Administration</a> (EIA) providing the equivalent, also including a forecast, depending on the state. ENTSO-E returns a day-ahead pricing model while EIA returns consumption in megawatthours, but both statistics can be used for the same thing: to better plan that cron job.</p>
<p>And that&rsquo;s exactly what we at <a href="https://www.jobrunr.io/en/">JobRunr</a> managed to do. JobRunr is an open-source <a href="/tags/java">Java</a> library for easy asynchronous background job scheduling that I&rsquo;ve had the pleasure to work on the last year. Using JobRunr, planning a job with a cron expression is trivial:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#d08770">@Recurring</span><span style="color:#eceff4">(</span>id <span style="color:#81a1c1">=</span> <span style="color:#a3be8c">&#34;generate-pay-slip-pdfs&#34;</span><span style="color:#eceff4">,</span> cron <span style="color:#81a1c1">=</span> <span style="color:#a3be8c">&#34;0 3 * * *&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#d08770">@Job</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">public</span> <span style="color:#81a1c1">void</span> <span style="color:#88c0d0">generatePaySlipPDFs</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">// your logic here</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>But we don&rsquo;t want that thing to trigger at 3 AM, remember? Instead, we want it to trigger between an interval, when the energy prices are at their lowest, meaning when <em>the CPU-intensive job will produce the least amount of CO2</em>. In JobRunr v8, we introduced the concept of <a href="https://www.jobrunr.io/en/documentation/configuration/carbon-aware/">Carbon Aware Job Processing</a> that uses energy prediction of the aforementioned APIs to better plan your cron jobs.</p>
<p>The configuration for this is ridiculously easy: (1) tell JobRunr which region you&rsquo;re in, (2) adjust that cron. Done. Instead of <code>0 3 * * *</code>, use <code>0 3 * * * [PT1H/PT4H]</code>: this means &ldquo;plan at somewhere between an hour before 3 AM to four hours later than 3 AM, when the lowest amount of CO2 will be generated&rdquo;. That string is not a valid cron expression but a custom extension on it we invented to minimize configuration.</p>
<p>Behind the scene, JobRunr will look up the energy forecasts for your region and plan the job according to your specified time range. There are other ways to plan jobs (e.g. fire-and-forget, providing <code>Duration</code>s instaed of a cron, &hellip;), but you get the gist. JobRunr&rsquo;s dashboard can be consulted to inspect when the job is due for processing. Since the scheduled picks can sometimes be confusing&mdash;why did it plan this at 6 AM and not at 7?&mdash;the dashboard also visualizes the predictions. In the following screenshot, you can see <code>TestService.doWork()</code> being planned at 15:00 PM, with an initial interval between 09:39 and 17:39 (GMT+2):</p>
<p>
<figure><a href="https://brainbaking.com/post/2025/11/using-energy-prediction-to-better-plan-cron-jobs/carbon-aware-job-scheduled-to-minimize-carbon-impact.jpg" class="lbox">
		<img src="https://brainbaking.com/post/2025/11/using-energy-prediction-to-better-plan-cron-jobs/carbon-aware-job-scheduled-to-minimize-carbon-impact.jpg" loading="lazy" title="The JobRunr dashboard: a pending job, to be processed on Mon Jul 07 2025 at 15:00 PM." data-pagefind-index-attrs="title">
	</a>
	
		<figcaption>The JobRunr dashboard: a pending job, to be processed on Mon Jul 07 2025 at 15:00 PM.</figcaption></figure>
</p>
<p>There&rsquo;s also <a href="https://www.jobrunr.io/en/guides/intro/how-to-reduce-carbon-impact-with-carbon-aware-jobs/">a practical guide</a> that helps you get started if you&rsquo;re interested in fooling around with the system.</p>
<p>The idea here is simple: postpone firing up that CPU to the moments with more sunshine, when energy is more readily available, and when less CO2 will be generated<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. If you&rsquo;re living in Europe/Belgium, you&rsquo;re probably already trying to optimize the energy consumption in your household the exact same way because of the digital meters. Why not applying this principle on a grander scale?</p>
<p>Amazon offers <a href="https://aws.amazon.com/ec2/spot/instance-advisor/">EC2 Spot Instances</a> to &ldquo;optimize compute usage&rdquo; which is also marketed as more sustainable, but this is not the same thing. Shifting your cloud workout to a Spot Instance will use &ldquo;spare energy&rdquo; that was already being generated. JobRunr, and hopefully soon other software that optimized jobs based on energy availability, plans using marginal changes. In theory, the decision can determine the fuel resource as high spikes force high-emission plants to burn more fuel. In always-on infrastructure, spare compute capacity is sold as the Spot product&mdash;there&rsquo;s no marginal change.</p>
<p>The environmental impact of planning your job to align with low grid carbon intensity is much higher&mdash;in a good way&mdash;compared to shifting cloud instance types from on-demand/reserved to Spot. Still, it&rsquo;s better than nothing, I guess. If the recent outages of these big cloud providers have taught us anything, it&rsquo;s that on-premise self-hosting is not dead yet.</p>
<p>If you happen to be rocking Java, give JobRunr a try. And if you&rsquo;re not, we challenge you to implement something similar and make the world a better place!</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>You probably already noticed that in this article I&rsquo;ve interchanged carbon intensity with energy availability. It&rsquo;s a lot more complicated than that, but for the purpose of Carbon Aware Job Processing, we assume a strong relationship between the electricity price and CO2 emissions.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


          
          <p>
            Related topics: /
                  <a href="https://brainbaking.com/tags/java">java</a> /</span>
          </p>
          
          <p>
            By <a href="/about">Wouter Groeneveld</a> on 28 November 2025.&nbsp;
            <a href="mailto:hifromrss@brainbaking.com?subject=Re: Using%20Energy%20Prediction%20To%20Better%20Plan%20Cron%20Jobs">Reply via email</a>.
          </p>
          
      