<p>Using regular expressions to perform text replacements can be tricky.
Without robust undo support or version control, 
a preview of the changes, 
or checking every replacement before it’s being made,
you can end up with false-positive matches and mess things up.</p>

<p>Now Emacs 30.1 released and ships with yet another way to perform mass text replacements more safely:
Use run-of-the-mill diffs to show the changes that <em>would</em> be made <em>if</em> you applied a regular expression-based replacement. 
I love the ingenuity of this idea, because it is so obvious.</p>

<figure><a href="https://christiantietze.de/posts/2025/02/preview-mass-text-replacements-with-emacs-30-1-replace-regexp-as-diff/2025-02-25_diff.png"><img alt="" src="https://christiantietze.de/posts/2025/02/preview-mass-text-replacements-with-emacs-30-1-replace-regexp-as-diff/2025-02-25_diff.png" /></a><figcaption>Diff of replacing “BUG” with “FEATURE”. Note how “DEBUG” turns into “DEFEATURE”, a false-positive I could catch this way.</figcaption></figure>

<p>It’s usually rather cumbersome to use the output of <code>diff</code> for anything but sharing patches.
You probably don’t interact with the difference of 2 files directly in your day-to-day life.
Tooling for the job, consequently, is ‘meh’.</p>

<p>Unless you live in Emacs, where viewing a diff is just a step removed from applying changes hunk-by-hunk.</p>

<p>Emacs 30.1 comes with 3 new interactive functions:
<code>replace-regexp-as-diff</code> for replacements in a single buffer,
<code>multi-replace-regexp-as-diff</code> for multiple buffers, 
and <code>dired-do-replace-regexp-as-diff</code> to perform <code>replace-regexp-as-diff</code> on marked files in the directory editor.</p>

<p>While we have <code>project-query-replace-regexp</code>, 
the interactive cousin that asks for each and every replacement whether you want to perform the change,
note that there’s no <code>project-replace-regexp-as-diff</code>. 
So you can’t run a search on all files in a project just yet.</p>

<p>Most of the time, I’ll still be reaching for <code>grep</code> (or rather <code>rg</code>) and <a href="https://github.com/mhayashi1120/Emacs-wgrep"><code>wgrep</code> to edit search result buffers</a> because I like the user interface so much.
You can search via regular expressions in multiple files in a project and then <em>interactively</em> edit the search results.
That’s an interactive live preview of the changes that you want to make.
Similar to the diff preview, it’s like a sandbox:
you don’t actually change anything before you apply the changes.</p>

<hr><p><small><a href="https://christiantietze.de/hire-me/">Hire me</a> for freelance macOS/iOS work and consulting.</small></p><p><small><a href="https://christiantietze.de/apps/">Buy</a> my apps.</small></p><p><small><a href="https://christiantietze.de/newsletter/">Receive</a> new posts via email.</small></p>