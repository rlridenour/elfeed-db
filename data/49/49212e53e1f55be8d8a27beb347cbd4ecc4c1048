<p>My significant other and I had two plastic Tesco Clubcards. I lost mine, so I took a picture of hers. I was fairly certain a barcode photo would scan just as well at self-checkout, and it did.</p>
<p>This got me thinking about Apple's Wallet <a href="https://en.wikipedia.org/wiki/PKPASS">pkpasses</a>. I don't really know much about them. Could I potentially create my own <code>.pkpass</code>? If I could just include the same barcode as in the photo, it should do the job just fine.</p>
<p>Now I should mention, <a href="https://apps.apple.com/gb/app/tesco-grocery-clubcard/id389581236">Tesco does have an app on the App Store</a>. If you just want the official Wallet pass on your iPhone, use that. But I was curious about whether or not I could create my own pass.</p>
<p>Turns out I <em>can</em>. I followed Apple's <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/YourFirst.html">building your first pass</a> which runs you through <a href="https://developer.apple.com/help/account/configure-app-capabilities/create-wallet-identifiers-and-certificates">creating Wallet identifiers/certificates</a>, editing <code>pass.json</code>, and downloading/building <a href="https://developer.apple.com/services-account/download?path=/iOS/Wallet_Support_Materials/WalletCompanionFiles.zip">signpass</a> (the utility used to sign <code>.pass</code> bundles).</p>
<p>The <code>signpass</code> utility is included in WalletCompanionFiles.zip, which comes with a handful of sample passes.</p>
<pre><code class="language-{.commonlisp">WalletCompanionFiles
│
├── SamplePasses
│   │
│   ├── BoardingPass.pass
│   ├── Coupon.pass
│   ├── Event.pass
│   ├── Event.pkpass
│   ├── Generic.pass
│   └── StoreCard.pass
│       │
│       ├── pass.json
│       └── ...
└── signpass
</code></pre>
<p>Being a rewards card, I opted to look into <code>StoreCard.pass</code>, but like all other passes, the <code>barcode</code> itself is what makes each pass scannable. The barcode details are specified in the bundles's <code>pass.json</code> file. I needed to figure out the relevant values describing the Tesco barcode.</p>
<pre><code class="language-json">&quot;barcode&quot;: {
  &quot;format&quot;: &quot;???&quot;,
  &quot;message&quot;: &quot;???&quot;,
  &quot;messageEncoding&quot;: &quot;???&quot;
}
</code></pre>
<p>I had no clue what values I should use for a Tesco Clubcard. I did, however, have a photo of the barcode I needed. This is in fact what prompted looking into <a href="https://xenodium.com/emacs-scan-this-qrcode">scanning barcodes from Emacs</a>, which worked just great. It gave me all the crucial bits for the Clubcard.</p>
<pre><code class="language-json">&quot;barcode&quot;: {
  &quot;format&quot;: &quot;PKBarcodeFormatCode128&quot;,
  &quot;message&quot;: &quot;1234567890123456&quot;,  // not my actual Clubcard number of course.
  &quot;messageEncoding&quot;: &quot;iso-8859-1&quot;
}
</code></pre>
<p>That's all that's needed for the barcode section, the most useful part of the pass. We're not done though. We also need our registered Wallet identifiers, so the <code>signpass</code> utility can sign.</p>
<pre><code class="language-json">&quot;passTypeIdentifier&quot;: &quot;my.com.identifier.passmaker&quot;, // also not my actual one.
&quot;teamIdentifier&quot;: &quot;AAABBBCCCD&quot;, // nor this one.
</code></pre>
<p>We should be able to sign the pass with the following:</p>
<pre><code class="language-{.bash">signpass -p StoreCard.pass
</code></pre>
<p>We're technically done. We now have a working card, but it looks just like the sample store card included in WalletCompanionFiles.</p>
<p><img src="https://xenodium.github.io/images/my-custom-tesco-clubcard-pkpass/lemons.png" alt=""></p>
<p>What's the fun in that? Now that I can make my own Clubcard, let's customize it!</p>
<p>For imagery, I replaced a couple of images in the .pass bundle:</p>
<pre><code class="language-c">StoreCard.pass
│
├── pass.json
├── icon.png
├── logo.png // replaced
└── strip.png // replaced
</code></pre>
<p>I replaced <code>logo.png</code> using a <a href="https://en.wikipedia.org/wiki/File:Tesco_Logo.svg">Tesco logo I found on Wikipedia</a>. I had initially removed <code>strip.png</code>, but that made the card feel a little empty. I was thinking of using a Tesco carrier bag to bulk the space up. While I didn't find a suitable bag image, I did land on &quot;<a href="https://banksyexplained.com/very-little-helps-2008/">Very Little Helps, 2008</a>&quot;. Using my limited <a href="https://www.gimp.org/">GIMP</a> skills, I cropped one of the images and also replaced <code>strip.png</code>.</p>
<p>The remaining customizations took place in <code>pass.json</code> and should be fairly self-explanatory. There's the text shown in all labels as well as three customizable colours (background, label, and foreground).</p>
<pre><code class="language-json">{
  &quot;formatVersion&quot;: 1,
  &quot;passTypeIdentifier&quot;: &quot;my.com.identifier.passmaker&quot;, // also not my actual one.
  &quot;teamIdentifier&quot;: &quot;AAABBBCCCD&quot;, // nor this one.
  &quot;serialNumber&quot;: &quot;AnySerialNumberYouWant&quot;,
  &quot;barcode&quot;: {
    &quot;format&quot;: &quot;PKBarcodeFormatCode128&quot;,
    &quot;message&quot;: &quot;1234567890123456&quot;,
    &quot;messageEncoding&quot;: &quot;iso-8859-1&quot;
  },
  &quot;organizationName&quot;: &quot;Not Tesco of course&quot;,
  &quot;description&quot;: &quot;Not a Tesco reqards card&quot;,
  &quot;logoText&quot;: &quot;Clubcard&quot;,
  &quot;foregroundColor&quot;: &quot;rgb(255, 255, 255)&quot;,
  &quot;labelColor&quot;: &quot;rgb(255, 255, 255)&quot;,
  &quot;backgroundColor&quot;: &quot;rgb(2, 81, 158)&quot;, // Blue for that Tesco look
  &quot;storeCard&quot;: {
    &quot;auxiliaryFields&quot;: [
      {
        &quot;key&quot;: &quot;membership&quot;,
        &quot;label&quot;: &quot;Member since 2023&quot;,
        &quot;value&quot;: &quot;&quot;
      },
      {
        &quot;key&quot;: &quot;membership2&quot;,
        &quot;label&quot;: &quot;Expires sometime&quot;,
        &quot;value&quot;: &quot;&quot;
      }
    ]
  }
}
</code></pre>
<p>…and with all that, here's what my very own custom Tesco Clubcard pkpass looks like. As you can appreciate, my image-editing skills aren't all that great, but hey this will do for now.</p>
<p><img src="https://xenodium.github.io/images/my-custom-tesco-clubcard-pkpass/bsy.png" alt=""></p>
<h2>Update</h2>
<p>Redditor u/stupergenius <a href="https://www.reddit.com/r/programming/comments/15y4c65/comment/jxa1obg/?utm_source=share&amp;utm_medium=web2x&amp;context=3">suggested using the image's original background color</a>. Nice suggestion. Tweaked via pass.json:</p>
<pre><code class="language-json">&quot;foregroundColor&quot;: &quot;rgb(2, 81, 158)&quot;,
&quot;labelColor&quot;: &quot;rgb(15, 58, 105)&quot;,
&quot;backgroundColor&quot;: &quot;rgb(166, 202, 214)&quot;,
</code></pre>
<p><img src="https://xenodium.github.io/images/my-custom-tesco-clubcard-pkpass/bsy-light.png" alt=""></p>
