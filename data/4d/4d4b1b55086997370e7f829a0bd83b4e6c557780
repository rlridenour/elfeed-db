<h2 id="what-for">What for?</h2>
<blockquote>
<p>An extensible, customizable, free/libre text editor [&hellip;]</p>
</blockquote>
<p>What that means for most users – me included – is that you can make Emacs yours. And part of this is adding custom functions.</p>
<p>This might be because there is a functionality missing or just because the builtin way of doing stuff doesn&rsquo;t compute the same way my head does.</p>
<p>You will be hard pressed to find an Emacs <code>init.el</code> without custom functions. And this is no different with mine.</p>
<img style="display:inline;float:center;" src="https://imgs.xkcd.com/comics/workflow.png" width="40%"/>
<p style="text-align:center;"><a href="https://xkcd.com/1172/">XKCD - Workflow</a></p>
<p>In this and a few following posts I will be showcasing my functions and what they do. Some are written by me and some are lifted from other more versed people.</p>
<p>I will also be providing my sources for the code – mostly in the documentation strings of the functions.</p>
<h2 id="commands-and-functions">Commands and functions</h2>
<p>In this post I will be talking about the functions in my module <a href="https://gitlab.com/aimebertrand/dotemacs/-/blob/main/libraries/timu-base.el">timu-base.el</a>. This contains defaults for my configuration.</p>
<h3 id="timu-base-setv">timu-base-setv</h3>
<p>This macro implements a way to easily customize variables using <code>customize-set-variable</code> – similar to <code>setq</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">timu-base-setv</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Handle ARGS like </span><span class="ss">`setq&#39;</span><span class="s"> using </span><span class="ss">`customize-set-variable&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://www.reddit.com/r/emacs/comments/qg8tga/comment/hi4xp8d.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">while</span> <span class="nv">args</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">var</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">args</span><span class="p">))</span> <span class="p">(</span><span class="nv">val</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">args</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">push</span> <span class="o">`</span><span class="p">(</span><span class="nv">customize-set-variable</span> <span class="ss">&#39;,var</span> <span class="o">,</span><span class="nv">val</span><span class="p">)</span> <span class="nv">body</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">macroexp-progn</span> <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">body</span><span class="p">))))</span>
</span></span></code></pre></div><p>With this the following Emacs Lisp &hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">timu-base-setv</span> <span class="nv">global-auto-revert-non-file-buffers</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">load-prefer-newer</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></div><p>&hellip; would expand to</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">customize-set-variable</span> <span class="ss">&#39;global-auto-revert-non-file-buffers</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">customize-set-variable</span> <span class="ss">&#39;load-prefer-newer</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></div><p>Granted I don not use the macro. However I keep it handy for such a time that I might need it.</p>
<h3 id="timu-base-disable-yes-or-no-p">timu-base-disable-yes-or-no-p</h3>
<p>On occasions the &ldquo;yes or no&rdquo; prompt that one gets to confirm an action can get pretty annoying. This functions facilitates getting rid of the prompt.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-base-disable-yes-or-no-p</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Advice how to answer yes or no automatically in Emacs.
</span></span></span><span class="line"><span class="cl"><span class="s">Use around any ORIG-FUN to \&#34;skip\&#34; </span><span class="ss">`yes-or-no-p&#39;</span><span class="s"> and </span><span class="ss">`y-or-n-p&#39;</span><span class="s"> with t.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://stackoverflow.com/a/35263420.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;yes-or-no-p</span> <span class="nb">:around</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;y-or-n-p</span> <span class="nb">:around</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unwind-protect</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">advice-remove</span> <span class="ss">&#39;yes-or-no-p</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">advice-remove</span> <span class="ss">&#39;y-or-n-p</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="no">t</span><span class="p">))))</span>
</span></span></code></pre></div><p>I use it mostly as an advice around other functions and commands</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;dired-do-flagged-delete</span> <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">timu-base-disable-yes-or-no-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;dired-do-delete</span> <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">timu-base-disable-yes-or-no-p</span><span class="p">)</span>
</span></span></code></pre></div><p>With this I can delete files without being prompted to confirm.</p>
<h3 id="timu-base-async-shell-command-no-window">timu-base-async-shell-command-no-window</h3>
<p>Running <code>async-shell-command</code> results in a new window with the output of the shell command. This is not always desired. This function omits the windows.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-base-async-shell-command-no-window</span> <span class="p">(</span><span class="nv">command</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Do not display the </span><span class="ss">`async-shell-command&#39;</span><span class="s"> COMMAND output buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://stackoverflow.com/a/60333836
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://stackoverflow.com/a/47910509.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">display-buffer-alist</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">cons</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;\\*Async Shell Command\\*.*&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">cons</span> <span class="nf">#&#39;</span><span class="nv">display-buffer-no-window</span> <span class="no">nil</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">async-shell-command</span> <span class="nv">command</span><span class="p">)))</span>
</span></span></code></pre></div><p>Say you want to open a Finder.app window at the current location.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">shell-open-dir</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open current directory at point with shell command \&#34;open\&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s">This will open \&#34;Finder.app\&#34; at current location.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">timu-base-async-shell-command-no-window</span> <span class="s">&#34;open ./&#34;</span> <span class="p">))</span>
</span></span></code></pre></div><h3 id="timu-base-visit-emacs-init-and-timu-base-visit-emacs-early-init">timu-base-visit-emacs-init &amp; timu-base-visit-emacs-early-init</h3>
<p>These two functions are quite straight forward. There are here just for completeness sake. I bind these to keys to get to <code>init.el</code> &amp; <code>early-init.el</code> as fast a possible.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-base-visit-emacs-init</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Load </span><span class="ss">`init.el&#39;</span><span class="s"> file into a buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">find-file</span> <span class="nv">user-init-file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-base-visit-emacs-early-init</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Load </span><span class="ss">`early-init.el&#39;</span><span class="s"> file into a buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">find-file</span> <span class="nv">early-init-file</span><span class="p">))</span>
</span></span></code></pre></div><p>Quite honestly, I think these might be fine as <code>lambdas</code> in the Lisp for the keybindings.</p>
<h3 id="timu-base-make-key-string">timu-base-make-key-string</h3>
<p>This one needs a bit of explaining.</p>
<p>You see I mostly use macOS and my muscle memory is quite used to the keybindings on a Mac. I have stated this before in <a href="https://macowners.club/posts/emacs-and-macos-like-keybindings/">this post</a>.</p>
<p>However I do use Linux and windows as well. But I still want to keep the keybindings that I know. Or at least close enough to those.</p>
<p>I swap the control key and the alt key system wide on Linux or Windows machines. This way the control key is next to the space bar, which is the macOS command key&rsquo;s position on the keyboard.</p>
<p>However I want the alt (now control key) key in Emacs to be still be alt (Meta). I comes this function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-base-make-key-string</span> <span class="p">(</span><span class="nv">modsymbol</span> <span class="nv">basic-event</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Convert the combination of MODSYMBOL and BASIC-EVENT.
</span></span></span><span class="line"><span class="cl"><span class="s">BASIC-EVENT can be a character or a function-key symbol.  The
</span></span></span><span class="line"><span class="cl"><span class="s">return value can be used with </span><span class="ss">`define-key&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://gist.github.com/mmarshall540/8db9b5bac8dc5670cb9323e387de1317&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">vector</span> <span class="p">(</span><span class="nf">event-convert-list</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">modsymbol</span> <span class="o">,</span><span class="nv">basic-event</span><span class="p">))))</span>
</span></span></code></pre></div><p>Which gets used on Linux and Windows like so</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">pcase</span> <span class="nv">system-type</span>
</span></span><span class="line"><span class="cl">  <span class="p">((</span><span class="nb">or</span><span class="ss">&#39;windows-nt</span> <span class="ss">&#39;gnu/linux</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="c1">;; Escaped chars are:</span>
</span></span><span class="line"><span class="cl">   <span class="c1">;; tab return space del backspace (typically translated to del)</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">dolist</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">char</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">append</span>
</span></span><span class="line"><span class="cl">         <span class="o">&#39;</span><span class="p">(</span><span class="nv">up</span> <span class="nv">down</span> <span class="nv">left</span> <span class="nv">right</span> <span class="nv">menu</span> <span class="nf">print</span> <span class="nv">scroll</span> <span class="nv">pause</span>
</span></span><span class="line"><span class="cl">              <span class="nf">insert</span> <span class="nf">delete</span> <span class="nv">home</span> <span class="nv">end</span> <span class="nv">prior</span> <span class="nv">next</span>
</span></span><span class="line"><span class="cl">              <span class="nv">tab</span> <span class="nb">return</span> <span class="nv">space</span> <span class="nv">backspace</span> <span class="nv">escape</span>
</span></span><span class="line"><span class="cl">              <span class="nv">f1</span> <span class="nv">f2</span> <span class="nv">f3</span> <span class="nv">f4</span> <span class="nv">f5</span> <span class="nv">f6</span> <span class="nv">f7</span> <span class="nv">f8</span> <span class="nv">f9</span> <span class="nv">f10</span> <span class="nv">f11</span> <span class="nv">f12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="c1">;; Escape gets translated to `C-\[&#39; in `local-function-key-map&#39;</span>
</span></span><span class="line"><span class="cl">         <span class="c1">;; We want that to keep working, so we don&#39;t swap `C-\[&#39; with `M-\[&#39;.</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">remq</span> <span class="sc">?\[</span> <span class="p">(</span><span class="nv">number-sequence</span> <span class="mi">33</span> <span class="mi">126</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; Changing this to use `input-decode-map&#39;, as it works for more keys.</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">define-key</span> <span class="nv">input-decode-map</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">timu-base-make-key-string</span> <span class="ss">&#39;control</span> <span class="nv">char</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">timu-base-make-key-string</span> <span class="ss">&#39;meta</span> <span class="nv">char</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">define-key</span> <span class="nv">input-decode-map</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">timu-base-make-key-string</span> <span class="ss">&#39;meta</span> <span class="nv">char</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">timu-base-make-key-string</span> <span class="ss">&#39;control</span> <span class="nv">char</span><span class="p">)))))</span>
</span></span></code></pre></div><p>Quite a unique problem to solve I think. But this is one of the functions I always need to stay sane.</p>
<h2 id="conclusion">Conclusion</h2>
<p>As a rule of thumb we Emacs users spend a considerable amount of time tweaking it. Is it worth it the time? You tell me!</p>
<h2 id="update-27-dot-may-2023">UPDATE - 27. May 2023</h2>
<p><a href="https://gitlab.com/aimebertrand/dotemacs/-/commit/5d6083e0c2fe9b42755ebb3805da7721776e2905">Renamed a few modules</a> (now &lsquo;bits&rsquo;). Hence the few changes in this post.</p>
