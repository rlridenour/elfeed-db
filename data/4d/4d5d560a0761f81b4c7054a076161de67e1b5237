<h2 id="motivation">Motivation</h2>
<p>I like <a href="https://melpa.org/#/ivy">Ivy</a>. I like it a lot. Together with <a href="https://melpa.org/#/counsel">Counsel</a> it makes a fantastic completion framework for Emacs.</p>
<p>However there is something driving me up the wall. Searching the active buffer with <a href="https://melpa.org/#/swiper">Swiper</a> is quite slow. Meaning that the <code>Minibuffer</code> sometimes needs more than a second to appear. Which actually feels like 3 seconds.</p>
<p>Now this could have been solved by doing some research to fix it. But it would have not be fun, would it? To be completely honest there are two more reasons for switching.</p>
<ul>
<li>I want to try the new and – according to the community fashionable – way of doing stuff.</li>
<li>Tweaking the Emacs configuration is a wonderful way of getting work done without getting work done.</li>
</ul>
<blockquote>
<p>Vertico provides a performant and minimalistic vertical completion UI, which is based on the default completion system.</p>
</blockquote>
<p>This being the description of the author of <a href="https://github.com/minad/vertico">vertico.el - VERTical Interactive COmpletion</a> himself sounds fairly promising – maybe even convincing.</p>
<p>Thus my decision to try it out together with <a href="https://github.com/minad/consult">consult.el - Consulting completing-read</a> as my completion framework.</p>
<h2 id="deal-breaker">Deal Breaker</h2>
<p>To got about switching I needed to think about my use of Ivy and the accompanying packages and figure out if there will be proper substitutions for them after the move.</p>
<p>To be frank here I was reasonably sure that I would find equivalents for the following functions. Even if there were no corresponding functions to Vertico or Consult, my experience suggests that the community surely would have been at it.</p>
<dl>
<dt>ivy-switch-buffer:</dt>
<dd>the equivalent function for switching buffers: <code>consult-buffer</code></dd>
<dt>counsel-find-file:</dt>
<dd>the equivalent function for opening files with completion: <code>find-file</code></dd>
<dt>counsel-M-x:</dt>
<dd>the equivalent for calling interactive functions: <code>execute-extended-command</code></dd>
<dt>swiper:</dt>
<dd>the equivalent for searching the current buffer: <code>consult-line</code></dd>
<dt>counsel-projectile-switch-project:</dt>
<dd>the equivalent for switching projects: <code>projectile-switch-project</code></dd>
<dt>counsel-bookmark:</dt>
<dd>the equivalent for finding saved bookmarks: <code>consult-bookmark</code></dd>
<dt>Ivy actions:</dt>
<dd><a href="https://github.com/oantolin/embark">Embark</a> for actions on completion candidates: <code>embark-act</code>.</dd>
</dl>
<p>The changes for the first working code with Vertico &amp; Consult are reflected in <a href="https://gitlab.com/aimebertrand/dotfiles/-/commit/ba8db69a00947033164cb0148a51d12394fa5f3d">this commit</a>.</p>
<h2 id="custom-configuration">Custom configuration</h2>
<p>After using Emacs for a fairly significant time – around 2 years in my case – one of course customizes the workflows. Custom functions, keybindings and other adjustments become a frequent occurrence. I am no exception here.</p>
<p>Following are a few of changes that I had to make to adjust for the new completions system. These will be formatted as diffs to reflect the changes.</p>
<h3 id="function-to-open-miscellaneous-config-files">Function to open miscellaneous config files:</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gu">@@ -477,10 +477,10 @@ This will display a Quicklook of the file at point in macOS.&#34;
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>
</span></span><span class="line"><span class="cl"> (defun timu/find-config-file ()
</span></span><span class="line"><span class="cl"><span class="gd">-  &#34;Open a config file with `ivy-completing-read&#39;.&#34;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  &#34;Open a config file with `completing-read&#39;.&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>   (interactive)
</span></span><span class="line"><span class="cl">   (let ((config-file
</span></span><span class="line"><span class="cl"><span class="gd">-         (ivy-completing-read
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+         (completing-read
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>           &#34;Select account: &#34;
</span></span><span class="line"><span class="cl">           timu-config-files)))
</span></span><span class="line"><span class="cl">     (find-file config-file)))
</span></span></code></pre></div><h3 id="search-my-frequently-used-directories">Search my frequently used directories</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gu">@@ -426,12 +416,12 @@ This will display a Quicklook of the file at point in macOS.&#34;
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>
</span></span><span class="line"><span class="cl"> (defun timu/search-org-files ()
</span></span><span class="line"><span class="cl">   &#34;Grep for a string in the `~/org&#39; using `rg&#39;.&#34;
</span></span><span class="line"><span class="cl">   (interactive)
</span></span><span class="line"><span class="cl"><span class="gd">-  (counsel-rg &#34;&#34; &#34;~/org&#34; nil &#34;Search in Org Files: &#34;))
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  (consult-ripgrep &#34;~/org&#34; &#34;&#34;))
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl"> (defun timu/search-project-files ()
</span></span><span class="line"><span class="cl">   &#34;Grep for a string in the `~/projects&#39; using `rg&#39;.&#34;
</span></span><span class="line"><span class="cl">   (interactive)
</span></span><span class="line"><span class="cl"><span class="gd">-  (counsel-rg &#34;&#34; &#34;~/projects&#34; nil &#34;Search in Project Files: &#34;))
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  (consult-ripgrep &#34;~/projects&#34; &#34;&#34;))
</span></span></span></code></pre></div><h3 id="custom-finding-of-headings-in-org-mode">Custom finding of headings in org-mode</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gu">@@ -144,15 +144,22 @@ This runs `org-babel-load-file&#39; on `config.org&#39;.&#34;
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>
</span></span><span class="line"><span class="cl"><span class="gd">-(defun timu/ivy-go-to-heading (&amp;optional arg)
</span></span></span><span class="line"><span class="cl"><span class="gd">-  &#34;Like `helm-org-in-buffer-headings&#39;, the preconfigured helm for org buffer headings.
</span></span></span><span class="line"><span class="cl"><span class="gd">-This function will use `counsel-outline&#39; and also move the heading to the top of the buffer
</span></span></span><span class="line"><span class="cl"><span class="gd">-with the evil funtion `evil-scroll-line-to-top&#39;&#34;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+(defun timu/org-go-to-heading (&amp;optional arg)
</span></span></span><span class="line"><span class="cl"><span class="gi">+  &#34;Go to an outline heading with `consult-org-heading&#39;.
</span></span></span><span class="line"><span class="cl"><span class="gi">+Also move the heading to the top of the buffer with `evil-scroll-line-to-top&#39;&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>   (interactive)
</span></span><span class="line"><span class="cl"><span class="gd">-  (counsel-outline)
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  (consult-org-heading)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>   (evil-scroll-line-to-top arg))
</span></span></code></pre></div><h3 id="filter-elfeed-articles-by-tags">Filter Elfeed articles by tags</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gu">@@ -103,23 +103,23 @@ the buffer.&#34;
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>
</span></span><span class="line"><span class="cl"><span class="gd">-;;; Add &#34;+&#34; tags to filter with ivy
</span></span></span><span class="line"><span class="cl"><span class="gd">-(defun timu/elfeed-ivy-filter-include-tag ()
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+;;; Add &#34;+&#34; tags to filter with completion
</span></span></span><span class="line"><span class="cl"><span class="gi">+(defun timu/elfeed-filter-include-tag ()
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>   &#34;Use Ivy to select tags to include `+&#39;.
</span></span><span class="line"><span class="cl"> The function reads the tags from the elfeed db.&#34;
</span></span><span class="line"><span class="cl">   (interactive)
</span></span><span class="line"><span class="cl"><span class="gd">-  (let ((filtered-tag (ivy-completing-read &#34;Select Tags: &#34; (elfeed-db-get-all-tags))))
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  (let ((filtered-tag (completing-read &#34;Select Tags: &#34; (elfeed-db-get-all-tags))))
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>     (progn
</span></span><span class="line"><span class="cl">       (setq elfeed-search-filter (concat elfeed-search-filter &#34; +&#34; filtered-tag))
</span></span><span class="line"><span class="cl">       (elfeed-search-update--force))))
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>The question is&hellip; Was the switch worth it? <strong>It definitely was. Let me explain!</strong></p>
<p>First things first. The switch indeed fixed the speed issue mentioned at the top. With <code>consult-line</code> the Minibuffer with candidates appears instantaneously. This already made the whole thing absolutely worth it for me.</p>
<p>Still there are more advantages to switching. One major one being that Vertico &amp; Consult automagically use the Emacs built-in system <code>completing-read</code>. I cannot explain the intricacies behind it, but I know one thing. This makes matters easier for me configuring the whole thing.</p>
<dl>
<dt>Example:</dt>
<dd>Instead of using a custom command <code>counsel-find-file</code> for finding files, I can just <code>find-file</code> and Vertico takes over. Other functions/commands using completion will automatically hand over to Vertico as well. No configuration needed on my part. This is munch much better for scaling and porting.</dd>
</dl>
