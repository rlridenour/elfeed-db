<p><img src="https://cdn3.brettterpstra.com/uploads/2025/12/apex-header-2-rb.7517.jpg" width="800" height="226" style="margin:0 auto;clear:both;" class="header" /></p>

<p>I&rsquo;ve added so much new stuff to my universal Markdown processor, <a href="https://brettterpstra.com//projects/apex/">Apex</a>, that it&rsquo;s hard to count. It&rsquo;s developing quickly!</p>

<p><img src="https://cdn3.brettterpstra.com/uploads/2025/12/apexicon.png"></p>
<p>In case you missed the announcement, Apex is my latest project &mdash; a command line tool and C library that combines the best of various Markdown tools, supporting syntax from <a href="https://commonmark.org/" title="CommonMark">CommonMark</a>, <a href="https://docs.github.com/github/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax" title="Basic writing and formatting syntax">GitHub Flavored Markdown</a>, <a href="https://fletcherpenney.net/multimarkdown/" title="MultiMarkdown">MultiMarkdown</a>, <a href="https://kramdown.gettalong.org/" title="Home-kramdown">Kramdown</a>, <a href="https://github.com/mmarkdown/mmark" title="a powerful markdown processor in Go geared towards the IETF">mmark</a>, <a href="https://pandoc.org/" title="Pandoc-index">Pandoc</a>, and even <a href="https://markedapp.com">Marked&rsquo;s</a> own <a href="https://markedapp.com/help/Special_Syntax.html">special syntax</a>.</p>

<p>The <strong>first and most important change</strong> is that I fixed multiple bugs that caused Apex to hang on some files. In all of my testing, it no longer chokes on any file, no matter how complex. And while the rendering speed is slower than plain <code class="language-plaintext highlighter-rouge">cmark</code>, it&rsquo;s far faster than it was previously, and slots into the <a href="https://github.com/ttscoff/apex/blob/main/BENCHMARK.md">middle of the pack</a> for efficiency, with about a 70ms render time on a complex document.</p>

<h3 id="the-big-stuff">The Big Stuff</h3>

<h4 id="bibliography-and-index-support">Bibliography and Index Support</h4>

<p>I&rsquo;ve added bibliography and index support. Citations work with multiple types of bibliography files, and Apex handles syntax from both Pandoc and MultiMarkdown. And you can create automatic indices for your documents using mmark or <a href="https://mattgemmell.scot/textindex/">TextIndex</a> format (a cool project by <a href="https://mattgemmell.scot/" title="Matt Gemmellâ€”Thriller, Horror, and Suspense author">Matt Gemmell</a> with a clever syntax that I like a lot).</p>

<p>Given that bibliography support is the #1 reason Marked users need to use Pandoc as an external processor, building citation support into Apex &mdash; as well as Pandoc metadata and other features &mdash; means a lot of users won&rsquo;t need an external processor at all. I&rsquo;m in no way trying to replace or replicate Pandoc entirely; it&rsquo;s a brilliant tool with a ton of capabilities that Apex does not aspire to to include. I just want to support the features that make the most sense for a universal Markdown tool.</p>

<h4 id="metadata-improvements">Metadata Improvements</h4>

<p>Almost all command line options can now also be controlled with metadata (YAML or MMD), allowing per-document control of options when operating on batches. It also means you can create a single configuration for Apex and then load it with something like <code class="language-plaintext highlighter-rouge">apex --meta-file ~/.config/apex/main_config.yml my_document.md</code>, and all of the options defined in <code class="language-plaintext highlighter-rouge">main_config.yml</code> will be applied to <code class="language-plaintext highlighter-rouge">my_document.md</code>.</p>

<p>MultiMarkdown allows you to include metadata in a document with <code class="language-plaintext highlighter-rouge">[%key]</code> syntax. Apex supports this, and adds on to it by allowing &ldquo;transforms&rdquo; &mdash; string transforms like <code class="language-plaintext highlighter-rouge">[%title:title]</code> or <code class="language-plaintext highlighter-rouge">[%source:urlencode]</code>, and array transforms like <code class="language-plaintext highlighter-rouge">[%tags:split:join(, )]</code>. Transforms also include date parsing and transformation with <code class="language-plaintext highlighter-rouge">strftime</code> formatting, e.g. <code class="language-plaintext highlighter-rouge">[%date:format(%B)]</code>. This feature allows you to use metadata in a document, or common metadata across multiple files, to control text generation.</p>

<h4 id="advanced-file-inclusiontransclusion">Advanced File Inclusion/Transclusion</h4>

<p>I&rsquo;ve added some cool features to file inclusion, including &ldquo;addressing&rdquo;, inspired by mmark&rsquo;s syntax. This allows you to include only parts of a file, based on line number ranges (<code class="language-plaintext highlighter-rouge">{{filename.sh[START,LEN]}}</code>) or regular expression searches (<code class="language-plaintext highlighter-rouge">{{filename.md[/^## Introduction/,/^## Conclusion/]}}</code>). You can also prefix every line of an included file (<code class="language-plaintext highlighter-rouge">{{quotes.md[139,15;prefix:&gt; ]}}</code>).</p>

<h3 id="the-future">The Future</h3>

<p>I don&rsquo;t have any specific next steps planned as far as feature additions &mdash; I want to see if I can get enough people to start using it that I get feature requests and feedback to guide development. Let me know what you want to see. It&rsquo;s one of those projects that I start dreaming about around 1am and then end up awake and adding new features to by 3am.</p>

<p>I plan to add Apex to <a href="https://markedapp.com">Marked</a>. It will start as an optional &ldquo;beta&rdquo; processor, in addition to the built-in MultiMarkdown, Kramdown, CommonMark, and Discount processors, but I&rsquo;d like to eventually replace all of the processor options with Apex and just allow it to run in different compatibility modes, with the &ldquo;unified&rdquo; mode being the default so users don&rsquo;t even have to think about which processor they need. Marked will just render all syntaxes as expected. And having Apex available as a command line tool that supports relevant parts of Marked&rsquo;s special syntax will mean users can get results similar to Marked from the command line and other automations.</p>

<p>If you have feature requests or questions about implementation, I&rsquo;d love to hear about it in <a href="https://github.com/ttscoff/apex/issues/">a GitHub Issue</a>, or if you&rsquo;re not a GitHub user, feel free to <a href="https://forum.brettterpstra.com">use the forum</a>. I&rsquo;m open to any and all feature suggestions, in the interest of making this as universal as possible.</p>

<h3 id="give-it-a-shot">Give It a Shot</h3>

<p>If you want to try Apex out, you can find installation instructions on the <a href="https://brettterpstra.com//projects/apex/">Apex project page</a>, and the full documentation <a href="https://github.com/ttscoff/apex/wiki/">in the wiki</a>. Apex can be run as a command line tool (which you can build from source, or just <a href="https://github.com/ttscoff/apex/releases/latest">download a pre-built binary</a> for macOS or Linux), and there&rsquo;s a full C API that can be used in your own projects, including an Xcode framework.</p>

<p>Apex is open source and code contributions are welcome. If you want to contribute money instead, donations are always appreciated.</p>

<p>Support Brett's work <a title="Make a donation" href="https://brettterpstra.com/donate/?ppid=A9KK2MTU7QSJU&submit=">with a donation</a>, or <a title="Sponsor ttscoff on GitHub" href="https://github.com/sponsors/ttscoff?o=esb">sponsor me on GitHub!</a>

<h3 id="highlights">Highlights</h3>

<p>You can view the full changelog <a href="https://github.com/ttscoff/apex/blob/main/CHANGELOG.md">on GitHub</a>.</p>

<h4 id="changed">Changed</h4>

<ul>
  <li>HTML comments now replaced with &ldquo;raw HTML omitted&rdquo; in CommonMark and GFM modes by default</li>
  <li>Tag filter (GFM security feature) now only applies in GFM mode, not Unified mode, allowing raw HTML and autolinks in Unified mode as intended.</li>
  <li>Wiki links are now disabled by default in all modes (previously enabled in unified mode). Use <code class="language-plaintext highlighter-rouge">--wikilinks</code> to enable.</li>
  <li>Change <code class="language-plaintext highlighter-rouge">--enable-includes</code> to <code class="language-plaintext highlighter-rouge">--[no-]includes</code>, allowing <code class="language-plaintext highlighter-rouge">--no-includes</code> to disable includes in unified mode and shortening the flag</li>
</ul>

<h4 id="new">New</h4>

<ul>
  <li>Comprehensive test suite (580+ tests passing)</li>
  <li>Control command line options with metadata
    <ul>
      <li>String options via metadata (bibliography, csl, title, style/css, id-format, base-dir, mode)</li>
      <li>Boolean metadata values accept true/false, yes/no, or 1/0 (case-insensitive, downcased)</li>
    </ul>
  </li>
  <li>MultiMarkdown-style superscript (<code class="language-plaintext highlighter-rouge">^text</code>) and subscript (<code class="language-plaintext highlighter-rouge">~text</code>) syntax support
    <ul>
      <li><code class="language-plaintext highlighter-rouge">--[no-]sup-sub</code> command-line option to enable/disable superscript/subscript</li>
      <li>Differentiates between subscript (tildes within a word, e.g., H~2~O) and underline (tildes at word boundaries, e.g., ~text~) by checking if tildes are within alphanumeric words or at word boundaries.</li>
      <li>Superscript/subscript enabled by default in unified and MultiMarkdown modes</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">--[no-]unsafe</code> command-line option to control raw HTML handling</li>
  <li>Added preprocessing for angle-bracket autolinks (<code class="language-plaintext highlighter-rouge">&lt;http://...&gt;</code>) to convert them to explicit markdown links, ensuring they work correctly with custom rendering paths.</li>
  <li><code class="language-plaintext highlighter-rouge">--[no-]autolink</code> CLI option to control automatic linking of URLs and email addresses. Autolinking is enabled by default in GFM, MultiMarkdown, Kramdown, and unified modes.</li>
  <li>Underline syntax support: <code class="language-plaintext highlighter-rouge">~text~</code> now renders as <code class="language-plaintext highlighter-rouge">&lt;u&gt;text&lt;/u&gt;</code> when there&rsquo;s a closing <code class="language-plaintext highlighter-rouge">~</code> with no space before it.</li>
  <li>Man page</li>
  <li><code class="language-plaintext highlighter-rouge">--obfuscate-emails</code> flag to hex-encode mailto links.</li>
  <li><code class="language-plaintext highlighter-rouge">--[no-]wikilinks</code> to enable/disable wiki link processing</li>
  <li>Definition lists now work inside block quotes (e.g., <code class="language-plaintext highlighter-rouge">&gt; Term\n&gt; : Definition</code>)</li>
  <li>Nested block quotes with definition lists (e.g., <code class="language-plaintext highlighter-rouge">&gt; &gt; Term\n&gt; &gt; : Definition</code>)</li>
  <li>File includes now support address syntax for line ranges, regex ranges, and prefixes
    <ul>
      <li>Line number ranges: <code class="language-plaintext highlighter-rouge">[3,5]</code> includes lines 3 to 5 (exclusive)</li>
      <li>Line range to end: <code class="language-plaintext highlighter-rouge">[3,] </code> includes from line 3 to end of file</li>
      <li>Regular expression ranges: <code class="language-plaintext highlighter-rouge">[/START/,/END/]</code> includes lines between regex matches</li>
      <li>Prefix option: <code class="language-plaintext highlighter-rouge">[3,5;prefix="C: "]</code> prefixes each included line</li>
      <li>Address syntax works with `` and <code class="language-plaintext highlighter-rouge">&lt;&lt;[file]</code> syntaxes (not iA Writer <code class="language-plaintext highlighter-rouge">/file</code>)</li>
      <li>POSIX regex support for pattern-based line extraction</li>
    </ul>
  </li>
  <li>Metadata variable transforms with <code class="language-plaintext highlighter-rouge">[%key:transform]</code> syntax
    <ul>
      <li><code class="language-plaintext highlighter-rouge">--[no-]transforms</code> to enable/disable transforms</li>
      <li>19 text transforms: upper, lower, title, capitalize, trim, slug, replace (with regex support), substring, truncate, default, html_escape, basename, urlencode, urldecode, prefix, suffix, remove, repeat, reverse, format, length, pad, contains</li>
      <li>Array transforms: split, join, first, last, slice</li>
      <li>Date/time transform: <code class="language-plaintext highlighter-rouge">strftime</code> with date parsing</li>
      <li>Transform chaining support (multiple transforms separated by colons)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">--meta-file</code> flag to load metadata from external files (YAML, MMD, or Pandoc format, auto-detected)</li>
  <li><code class="language-plaintext highlighter-rouge">--meta KEY=VALUE</code> flag to set metadata from command line (supports multiple flags and comma-separated pairs)</li>
  <li>Add metadata merging with proper precedence: <code class="language-plaintext highlighter-rouge">command-line &gt; document &gt; file</code></li>
  <li><code class="language-plaintext highlighter-rouge">--embed-images</code> flag to embed local images as base64 data URLs in HTML output</li>
  <li><code class="language-plaintext highlighter-rouge">--base-dir</code> flag to set base directory for resolving relative paths (images, includes, wiki links)</li>
  <li>Automatic base directory detection from input file directory when reading from file</li>
  <li>Add citation processing with support for Pandoc, MultiMarkdown, and mmark syntaxes
    <ul>
      <li>Add bibliography loading from BibTeX, CSL JSON, and CSL YAML formats</li>
      <li>Add &ndash;bibliography CLI option to specify bibliography files (can be used multiple times)</li>
      <li><code class="language-plaintext highlighter-rouge">--csl</code> CLI option to specify citation style file</li>
      <li><code class="language-plaintext highlighter-rouge">--no-bibliography</code> CLI option to suppress bibliography output</li>
      <li><code class="language-plaintext highlighter-rouge">--link-citations</code> CLI option to link citations to bibliography entries</li>
      <li><code class="language-plaintext highlighter-rouge">--show-tooltips</code> CLI option for citation tooltips</li>
      <li>Bibliography generation and insertion at <code class="language-plaintext highlighter-rouge">&lt;!-- REFERENCES --&gt;</code> marker</li>
      <li>Support for bibliography specified in document metadata</li>
    </ul>
  </li>
  <li>Index extension
    <ul>
      <li>mmark syntax (!item), (!item, subitem), and (!!item, subitem) for primary entries</li>
      <li>TextIndex syntax with {^}, [term]{^}, and {^params} patterns</li>
      <li>Automatic index generation at end of document or at <code class="language-plaintext highlighter-rouge">&lt;!--INDEX--&gt;</code> marker</li>
      <li>Alphabetical sorting and optional grouping by first letter for index entries</li>
      <li>Hierarchical sub-item support in generated index</li>
      <li><code class="language-plaintext highlighter-rouge">--indices</code> CLI flag to enable index processing</li>
      <li><code class="language-plaintext highlighter-rouge">--no-indices</code> CLI flag to disable index processing</li>
    </ul>
  </li>
  <li>Support for MultiMarkdown&rsquo;s standard metadata fields
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Base Header Level</code> and HTML Header Level metadata to adjust heading levels</li>
      <li><code class="language-plaintext highlighter-rouge">CSS</code> to link external stylesheets in standalone HTML documents</li>
      <li><code class="language-plaintext highlighter-rouge">HTML Header</code> and <code class="language-plaintext highlighter-rouge">HTML Footer</code> metadata to inject custom HTML</li>
      <li><code class="language-plaintext highlighter-rouge">Language</code> to set HTML lang attribute in standalone documents</li>
      <li><code class="language-plaintext highlighter-rouge">Quotes Language</code> metadata to control smart quote styles (French, German, Spanish, etc.) This falls back to <code class="language-plaintext highlighter-rouge">Language</code> setting.</li>
      <li>Metadata key normalization: case-insensitive matching with spaces removed (e.g., &ldquo;HTML Header Level&rdquo; matches &ldquo;htmlheaderlevel&rdquo;)</li>
    </ul>
  </li>
  <li>Add <code class="language-plaintext highlighter-rouge">--css</code> CLI flag as alias for <code class="language-plaintext highlighter-rouge">--style</code> with metadata override precedence</li>
</ul>

<h4 id="improved">Improved</h4>

<ul>
  <li>Processing speed improved by 15x
    <ul>
      <li>Only process citations when bibliography is actually provided for better performance</li>
      <li>Add comprehensive performance profiling system (<code class="language-plaintext highlighter-rouge">APEX_PROFILE=1</code>) to measure processing time for all extensions and CLI operations
        <ul>
          <li>Add profiling instrumentation for all preprocessing, parsing, rendering, and post-processing steps</li>
          <li>Add profiling instrumentation for CLI operations (file I/O, metadata processing)</li>
        </ul>
      </li>
      <li>Early exits
        <ul>
          <li>IAL processing when no <code class="language-plaintext highlighter-rouge">{:</code> markers are present</li>
          <li>Index processing when no index patterns are found</li>
          <li>Citation processing when no citation patterns are found</li>
          <li>Definition list processing when no <code class="language-plaintext highlighter-rouge">/^: /</code> patterns are found</li>
          <li>Wiki link AST traversal entirely when no wiki link markers are present in the document.</li>
          <li>Alpha lists post-processing when no markers are present</li>
        </ul>
      </li>
      <li>Optimize alpha lists post-processing with single-pass algorithm replacing O(n*m) strstr() loops</li>
      <li>Optimize file I/O by using fwrite() with known length instead of fputs()</li>
      <li>Add markdown syntax detection in definition lists to skip parser creation for plain text</li>
      <li>Optimize definition lists by selectively extracting only needed reference definitions instead of prepending all</li>
    </ul>
  </li>
</ul>

<h4 id="fixed">Fixed</h4>

<ul>
  <li>IAL markers appearing immediately after content without a blank line are now correctly parsed as separate attribute lists instead of being treated as part of the preceding paragraph. This ensures Kramdown-style IAL syntax works correctly with cmark-gfm parser.</li>
  <li>Relaxed tables are now disabled by default for CommonMark, GFM, and MultiMarkdown modes</li>
  <li>Header ID extraction no longer incorrectly parses metadata variables like <code class="language-plaintext highlighter-rouge">[%title]</code></li>
  <li>Relaxed tables now preserve input newline behavior in output</li>
  <li>Unified mode now correctly enables mixed list markers and alpha lists by default when no <code class="language-plaintext highlighter-rouge">--mode</code> is specified</li>
  <li><code class="language-plaintext highlighter-rouge">^</code> marker now properly separates lists by creating a paragraph break instead of just blank lines</li>
  <li>Empty paragraphs created by <code class="language-plaintext highlighter-rouge">^</code> marker are now removed from final HTML output</li>
  <li>Setext headers are no longer broken when followed by highlight syntax (<code class="language-plaintext highlighter-rouge">==text==</code>). Highlight processing now stops at line breaks to prevent interference with header parsing.</li>
  <li>Metadata parser no longer incorrectly treats URLs and angle-bracket autolinks as metadata. Lines containing <code class="language-plaintext highlighter-rouge">&lt;</code> or URLs are now skipped during metadata extraction.</li>
  <li>Metadata variable replacement now runs before autolinking so [%key] values containing URLs are turned into links when autolinking is enabled.</li>
  <li>MMD metadata parsing no longer incorrectly rejects entries with URL values; only URL-like keys or &lsquo;&lt;&rsquo; characters in keys are rejected, allowing &ldquo;URL: https://example.com&rdquo; as valid metadata.</li>
  <li>Math processor now validates that <code class="language-plaintext highlighter-rouge">\(...\)</code> sequences contain actual math content (letters, numbers, or operators) before processing them. This prevents false positives like <code class="language-plaintext highlighter-rouge">\(%\)</code> from being treated as math when they only contain special characters.</li>
  <li>Improved autolink functionality to only wrap valid URLs/emails and ensured email autolinks use mailto: hrefs.</li>
  <li>Reference-style markdown links now convert correctly in definition list terms (dt tags) and definitions (dd tags). Previously, reference-style links like [text][ref] were not being resolved when used in definition list terms or definitions, even when the reference definition was present elsewhere in the document.</li>
</ul>

<p>So <a href="https://brettterpstra.com//projects/apex/">give it a whirl</a> and keep me posted! Again, feel free to help guide development by <a href="https://github.com/ttscoff/apex/issues/">opening Issues</a> or joining in <a href="https://forum.brettterpstra.com">on the forum</a>!</p>

<p>Like or share this post <a title="This post on Mastodon" target="_blank" href="https://hachyderm.io/users/ttscoff/statuses/115718614805048533">on Mastodon</a>, <a title="Share on Bluesky" target="_blank" href="https://bsky.app/intent/compose?text=So+much+new+Apex+stuff%0A%0Ahttps%3A%2F%2Fbrettterpstra.com%2F2025%2F12%2F14%2Fso-much-new-apex-stuff%2F">Bluesky</a>, or <a class="twitter" target="_blank" rel="nofollow" href="https://twitter.com/intent/tweet?original_referer=https%3A%2F%2Fbrettterpstra.com%2F2025%2F12%2F14%2Fso-much-new-apex-stuff%2F&text=So+much+new+Apex+stuff&url=https%3A%2F%2Fbrettterpstra.com%2F2025%2F12%2F14%2Fso-much-new-apex-stuff%2F&via=ttscoff" title="Tweet this post">Twitter</a>.</p>
<hr style="margin:40px 0">

<p>BrettTerpstra.com is supported by readers like you. <a href="https://brettterpstra.com/support/">Click here if you'd
        like to help out.</a></p>
<p>Find Brett on <a rel="me" href="https://hachyderm.io/@ttscoff">Mastodon</a>, <a
        href="https://bsky.app/profile/ttscoff.bsky.social">Bluesky</a>, <a
        href="https://github.com/ttscoff">GitHub</a>, and <a href="https://brettterpstra.com/elsewhere">everywhere
        else</a>.</p><img src="https://brett.trpstra.net/link/535/17233513.gif" height="1" width="1"/>