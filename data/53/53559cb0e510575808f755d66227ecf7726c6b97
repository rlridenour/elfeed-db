<p>
Sometimes I want to copy a toot and include it in
my Org Mode notes, like when I post a thought and
then want to flesh it out into a blog post. This
code defines <code>my-mastodon-org-copy-toot-content</code>,
which converts the toot text to Org Mode format
using Pandoc and puts it in the kill ring so I can
yank it somewhere else.
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-mastodon-toot-at-url</span> (<span class="org-type">&amp;optional</span> url)
  <span class="org-doc">"Return JSON toot object at URL.</span>
<span class="org-doc">If URL is nil, return JSON toot object at point."</span>
  (<span class="org-keyword">if</span> url
      (<span class="org-keyword">let*</span> ((search (format <span class="org-string">"%s/api/v2/search"</span> mastodon-instance-url))
             (params <span class="org-highlight-quoted-quote">`</span>((<span class="org-string">"q"</span> . ,url)
                       (<span class="org-string">"resolve"</span> . <span class="org-string">"t"</span>))) <span class="org-comment-delimiter">; </span><span class="org-comment">webfinger</span>
             (response (mastodon-http&#45;&#45;get-json search params <span class="org-builtin">:silent</span>)))
        (car (alist-get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">statuses</span> response)))
    (mastodon-toot&#45;&#45;base-toot-or-item-json)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my-mastodon-org-copy-toot-content</span> (<span class="org-type">&amp;optional</span> url)
  <span class="org-doc">"Copy the current toot's content as Org Mode.</span>
<span class="org-doc">Use pandoc to convert.</span>

<span class="org-doc">When called with \\[</span><span class="org-doc"><span class="org-constant">universal-argument</span></span><span class="org-doc">], prompt for a URL."</span>
  (<span class="org-keyword">interactive</span> (list
                (<span class="org-keyword">when</span> current-prefix-arg
                  (read-string <span class="org-string">"URL: "</span>))))

  (<span class="org-keyword">let</span> ((toot (my-mastodon-toot-at-url url)))
    (<span class="org-keyword">with-temp-buffer</span>
      (insert (alist-get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">content</span> toot))
      (call-process-region nil nil <span class="org-string">"pandoc"</span> t t nil <span class="org-string">"-f"</span> <span class="org-string">"html"</span> <span class="org-string">"-t"</span> <span class="org-string">"org"</span>)
      (kill-new
       (concat
        (org-link-make-string
         (alist-get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">url</span> toot)
         (concat <span class="org-string">"@"</span> (alist-get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">acct</span> (alist-get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">account</span> toot))))
        <span class="org-string">":\n\n#+begin_quote\n"</span>
        (string-trim (buffer-string)) <span class="org-string">"\n#+end_quote\n"</span>))
      (message <span class="org-string">"Copied."</span>))))
</pre>
</div>


<div class="note">This is part of my <a href="https://sachachua.com/dotemacs#mastodon-mastodon-el-copy-toot-content-as-org-mode">Emacs configuration.</a></div><div><a href="https://sachachua.com/blog/2025/03/mastodon-el-copy-toot-content-as-org-mode/index.org">View org source for this post</a></div>
<p>You can <a href="https://social.sachachua.com/@sacha/statuses/01JQ9NF4K6V8MY8S6KCWRYCZS3" target="_blank" rel="noopener noreferrer">comment on Mastodon</a> or <a href="mailto:sacha@sachachua.com?subject=Comment%20on%20https%3A%2F%2Fsachachua.com%2Fblog%2F2025%2F03%2Fmastodon-el-copy-toot-content-as-org-mode%2F&body=Name%20you%20want%20to%20be%20credited%20by%20(if%20any)%3A%20%0AMessage%3A%20%0ACan%20I%20share%20your%20comment%20so%20other%20people%20can%20learn%20from%20it%3F%20Yes%2FNo%0A">e-mail me at sacha@sachachua.com</a>.</p>