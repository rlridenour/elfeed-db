<h2 id="problem-to-solve">Problem to solve</h2>
<p>As described by the developer. Emacs-slack is setup with a <a href="https://github.com/yuya373/emacs-slack#configuration">slack Auth token</a>. There are of course a few ways of <a href="https://github.com/yuya373/emacs-slack#how-to-secure-your-token">securing the token</a> for it not to be accidentally either pushed to a public git repo or getting in the hands of somebody else in another way.</p>
<p>Well I use macOS and so far I have been very happy doing it. Same with the builtin keychains system that it uses. With all the iCloud syncing and other convenience solutions, I use it to store most of my passwords and credentials and forget about them.</p>
<p>So why not use it to store my slack token for emacs-slack as well!?</p>
<h2 id="solution">Solution</h2>
<p>The macOS keychains system – beside the <em>Keychain Access.app</em> – has a CLI that I can leverage for this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ man security <span class="p">|</span> head -n <span class="m">5</span>
</span></span><span class="line"><span class="cl">security<span class="o">(</span>1<span class="o">)</span>               BSD General Commands Manual              security<span class="o">(</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME
</span></span><span class="line"><span class="cl">     security -- Command line interface to keychains and Security framework
</span></span></code></pre></div><h3 id="store-the-token-in-the-keychain">Store the token in the Keychain</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">security add-generic-password -s keychain_item_name -a keychain_item_account_name -w
</span></span></code></pre></div><p>How to obtain the token is out of scope for this post, but it is described by the emacs-slack <a href="https://github.com/yuya373/emacs-slack#how-to-get-token">README.md</a> file.
Once you have the token, you need to save it into a keychain:</p>
<p>You ll get a secure prompt (twice) to fill in the token.</p>
<p><code>keychain_item_name</code> &amp; <code>keychain_item_account_name</code> are really arbitrary and can be chosen by you. The item can be accessed with the <em>Keychain Access.app</em> of course.</p>
<h3 id="retrieving-the-token">Retrieving the token</h3>
<p>Getting back the stored token is as simple as:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">security find-generic-password -s keychain_item_name -a keychain_item_account_name -w
</span></span></code></pre></div><p>One is then prompted for the macOS user password to be granted access. There is an option to always allow access for convenience too. The security suffers of course.</p>
<h3 id="putting-it-all-together-for-the-emacs-slack-package">Putting it all together for the emacs-slack package</h3>
<p>This code is almost 1 to 1 to the example given in the package README.md file except for the token settings.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">slack</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">slack-start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">slack-buffer-emojify</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; if you want to enable emoji, default nil</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">slack-prefer-current-team</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">slack-register-team</span>
</span></span><span class="line"><span class="cl">   <span class="nb">:name</span> <span class="s">&#34;emacs-slack&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="nb">:default</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nb">:token</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nf">substring</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="s">&#34;security find-generic-password -s keychain_item_name -a keychain_item_account_name -w&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">0</span> <span class="mi">-1</span><span class="p">)))</span>
</span></span></code></pre></div>