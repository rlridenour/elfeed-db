
	
<p>
A fractal is a geometric figure in which the same pattern repeats infinitely at an ever-smaller scale. One of the most simple examples is the H-Fractal. You construct a H-Fractal by starting with the line segments that resemble the capital letter H. You then iteratively place smaller H’s centred at the top and bottom of each free line segment. This article shows how to generate H-Fractals with the R language.</p>
<p>
The H-Fractal or H-Tree is a self-similar fractal with ever-smaller line segments. This fractal is a Paeno Curve, which means that it eventually will fill a whole area and becomes a 2-dimensional object. The H-Fractal is a canopy fractal, a type of graph where a line segment is split into smaller lines at the end. Fractal canopies are very useful in creating models of plants. </p>
<p>
The H-Fractal principle has practical applications in electronics. For example, microstrip antennae are printed on circuit boards and resemble the tree structure in this fractal. In addition, the splitting of fractal canopies is similar to the structure of bronchial tubes in the human body. A <a href="https://patents.google.com/patent/US20070236406">US Patent from 2006</a> lists a H-Fractal as the geometry for a microwave antenna.</p>
<figure>
<img src="https://lucidmanager.org/images/fractals/h-fractal-5.png" alt="H-Fractal with five iterations" title="H-Fractal with five iterations."/>
<figcaption>
H-Fractal with five iterations.
</figcaption>
</figure>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Method
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The algorithm starts with a horizontal line on the interval $[-1,1]$. Each iteration adds new shortened lines to the ends of the existing lines. The first iteration results in a shape that resembles the letter H. After that, the direction of the lines switches at each iteration from horizontal to vertical.</p>
<p>
If the number of iterations of the fractal is $p$, then each iteration adds $2^p$ lines to the tree, and the total number of lines in the fractal is $2^{p+1} + 1$.  </p>
<p>
The new lines are shortened by a factor, which is set at $\frac{1}{\sqrt{2}}$. If you set it any higher, the lines will overlap—a lower value results in a more sparse design.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Generate H-Fractals with ggplot
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>The code below starts with setting the initial variables and defines the first line in a data frame. The data frame holds the start and end coordinates and the iteration number.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>  <span style="color:#888">## H-Fractal Parameters</span>
</span></span><span style="display:flex;"><span>  p <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">8</span> <span style="color:#888">## Number of iterations</span>
</span></span><span style="display:flex;"><span>  a <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">1</span> <span style="color:#333">/</span> <span style="color:#06b;font-weight:bold">sqrt</span>(<span style="color:#60e;font-weight:bold">2</span>) <span style="color:#888">## Shortening parameter</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Define horizontal starting line</span>
</span></span><span style="display:flex;"><span>  h_fractal <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">data.frame</span>(x1 <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">-1</span>,
</span></span><span style="display:flex;"><span>                          y1 <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>                          x2 <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>                          y2 <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>                          m <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">0</span>)</span></span></code></pre></div>
</div>
<p>
The loop defines the iterations and adds a new row to the data frame for each line. First, the direction flips by setting the <code class="verbatim">dx</code> and <code class="verbatim">dy</code> values to either 0 or 1. The second part defines the row numbers for the previously defined lines and the new lines. The code then calculates the coordinates for the new line segments.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888"># Generate coordinates (each line on a row)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-weight:bold">for</span> (m <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">1</span><span style="color:#333">:</span>p) {
</span></span><span style="display:flex;"><span>    <span style="color:#888">## Flip direction</span>
</span></span><span style="display:flex;"><span>    dx <span style="color:#333">&lt;-</span> (m <span style="color:#333">-</span> <span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">%%</span> <span style="color:#60e;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    dy <span style="color:#333">&lt;-</span> m <span style="color:#333">%%</span> <span style="color:#60e;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#888"># Previous and current line numbers</span>
</span></span><span style="display:flex;"><span>    i <span style="color:#333">&lt;-</span> (<span style="color:#60e;font-weight:bold">2</span><span style="color:#06b;font-weight:bold">^</span>(m <span style="color:#333">-</span> <span style="color:#60e;font-weight:bold">1</span>))<span style="color:#333">:</span>(<span style="color:#60e;font-weight:bold">2</span>^m <span style="color:#333">-</span> <span style="color:#60e;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>    j <span style="color:#333">&lt;-</span> (<span style="color:#60e;font-weight:bold">2</span>^m)<span style="color:#333">:</span>(<span style="color:#60e;font-weight:bold">2</span><span style="color:#06b;font-weight:bold">^</span>(m <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>) <span style="color:#333">-</span> <span style="color:#60e;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#888">## Calculate coordinates</span>
</span></span><span style="display:flex;"><span>    h_fractal[j, <span style="background-color:#fff0f0">&#34;x1&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(h_fractal[i, <span style="background-color:#fff0f0">&#34;x1&#34;</span>] <span style="color:#333">-</span> dx <span style="color:#333">*</span> a^m, h_fractal[i, <span style="background-color:#fff0f0">&#34;x2&#34;</span>] <span style="color:#333">-</span> dx <span style="color:#333">*</span> a^m)
</span></span><span style="display:flex;"><span>    h_fractal[j, <span style="background-color:#fff0f0">&#34;x2&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(h_fractal[i, <span style="background-color:#fff0f0">&#34;x1&#34;</span>] <span style="color:#333">+</span> dx <span style="color:#333">*</span> a^m, h_fractal[i, <span style="background-color:#fff0f0">&#34;x2&#34;</span>] <span style="color:#333">+</span> dx <span style="color:#333">*</span> a^m)
</span></span><span style="display:flex;"><span>    h_fractal[j, <span style="background-color:#fff0f0">&#34;y1&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(h_fractal[i, <span style="background-color:#fff0f0">&#34;y1&#34;</span>] <span style="color:#333">-</span> dy <span style="color:#333">*</span> a^m, h_fractal[i, <span style="background-color:#fff0f0">&#34;y2&#34;</span>] <span style="color:#333">-</span> dy <span style="color:#333">*</span> a^m)
</span></span><span style="display:flex;"><span>    h_fractal[j, <span style="background-color:#fff0f0">&#34;y2&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(h_fractal[i, <span style="background-color:#fff0f0">&#34;y1&#34;</span>] <span style="color:#333">+</span> dy <span style="color:#333">*</span> a^m, h_fractal[i, <span style="background-color:#fff0f0">&#34;y2&#34;</span>] <span style="color:#333">+</span> dy <span style="color:#333">*</span> a^m)
</span></span><span style="display:flex;"><span>    <span style="color:#888">## Set line property</span>
</span></span><span style="display:flex;"><span>    h_fractal[j, <span style="background-color:#fff0f0">&#34;m&#34;</span>] <span style="color:#333">&lt;-</span> m
</span></span><span style="display:flex;"><span>  }</span></span></code></pre></div>
</div>
<p>
Lastly, The fractal is visualised with ggplot and the line segment geometry. The colour of the line slowly fades by setting it to the iteration number.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>    <span style="color:#888">## Visualise</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">ggplot</span>(h_fractal) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">aes</span>(x <span style="color:#333">=</span> x1, y <span style="color:#333">=</span> y1, xend <span style="color:#333">=</span> x2, yend <span style="color:#333">=</span> y2,
</span></span><span style="display:flex;"><span>        col <span style="color:#333">=</span> m) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">geom_segment</span>(size <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">.5</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">scale_size</span>(guide <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NULL</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">scale_colour_gradientn</span>(colours <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">gray.colors</span>(p), guide <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NULL</span>) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">theme_void</span>()</span></span></code></pre></div>
</div>
<figure>
<img src="https://lucidmanager.org/images/fractals/h-fractal.png" alt="H-Fractal example with twelve iterations" title="H-Fractal example with twelve iterations"/>
<figcaption>
H-Fractal with twelve iterations.
</figcaption>
</figure>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Variations on the Theme
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>Besides changing the number of iterations and the shortening factor, you can also play with line thickness, colours, and the lines’ direction. This <a href="https://prevos.shinyapps.io/rfractals/">Shiny application</a> lets you play with all variables in this algorithm to generate</p>
<p>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
</div>
</div>

      