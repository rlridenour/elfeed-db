<p>&quot;Do-what-I-mean&quot; (DWIM) functions enable us to introduce new Emacs powers to existing workflows without incurring the typical cost of remembering multiple related functions or introducing yet another key binding. DWIM functions invoke other functions, based on current context.</p>
<p>I wanted a small tweak in Ivy's <em>`minibuffer-keyboard-quit'</em> invocation, commonly invoked via <em>C-g</em> key binding:</p>
<ol>
<li>If we have text selected in minibuffer, deselect it.</li>
<li>If we have any text in minibuffer, clear it.</li>
<li>If no text in minibuffer, quit.</li>
</ol>
<p>Added <em>`ar/ivy-keyboard-quit-dwim'</em> for this purpose. Binding it to C-g in <em>ivy-minibuffer-map</em>:</p>
<pre><code class="language-{.commonlisp">(use-package ivy
  :ensure t
  :bind (:map ivy-minibuffer-map
              (&quot;C-g&quot; . ar/ivy-keyboard-quit-dwim))
  :config
  (defun ar/ivy-keyboard-quit-dwim ()
    &quot;If region active, deactivate. If there's content, clear the minibuffer. Otherwise quit.&quot;
    (interactive)
    (cond ((and delete-selection-mode (region-active-p))
           (setq deactivate-mark t))
          ((&gt; (length ivy-text) 0)
           (delete-minibuffer-contents))
          (t
           (minibuffer-keyboard-quit)))))
</code></pre>
<p><img src="https://xenodium.github.io/images/dwim-ivy-quit/ivy-keybqoard-quit-dwim.gif" alt=""></p>
