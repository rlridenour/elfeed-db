
<p>By default, the <code>git diff</code> algorithm compares changes in Elisp files line by line without understanding the structural semantics of Emacs Lisp files. This means that when modifications are made within functions, the diff output does not convey how those changes relate to higher-level code constructs such as functions or macros.</p>



<p>As a result, reviewers are presented with fragmented and often verbose diffs where the context of a change, such as which function it belongs to, is not always readily apparent. This lack of structural awareness can make it difficult to assess the purpose and impact of changes efficiently.</p>



<p>Git can be configured to recognize function or macro definitions explicitly, ensuring that diffs are presented at the function or macro level rather than as arbitrary line changes. Here are the steps:</p>



<h2 class="wp-block-heading">Step 1 &#8211; The Git configuration for Emacs Lisp diffs</h2>



<p>Add the following elisp Git driver to your <code>~/.gitconfig</code> file:</p>


<pre class="wp-block-code"><span><code class="hljs language-plaintext">&#91;diff "elisp"]
xfuncname = ^\\(&#91;^&#91;:space:]]*def&#91;^&#91;:space:]]+&#91;&#91;:space:]]+(&#91;^()&#91;:space:]]+)
</code></span></pre>


<p>The regular expression above matches lines that begin with typical Emacs Lisp definition forms, such as defun, defmacro, and other def* constructs. It detects the symbol being defined, allowing Git to handle changes at the function or definition level intelligently. This configuration can also be found in the autogen.sh file, which is part of the Emacs source code.</p>



<h2 class="wp-block-heading">Step 2 &#8211; Associating the Git Diff Driver with *.el files</h2>



<p>Once the custom diff driver is defined, it needs to be associated with Elisp files. This is accomplished by adding the following line to the <code>~/.gitattributes</code> file:</p>


<pre class="wp-block-code"><span><code class="hljs language-plaintext">*.el diff=elisp
</code></span></pre>


<p>With this setup, Git will apply the <code>elisp</code> diff driver to all files with the .el extension, using the custom pattern to identify function boundaries.</p>



<h2 class="wp-block-heading">Conclusion</h2>



<p>This configuration generates diffs that focus on changes within the scope of individual function and macro definitions, rather than arbitrary lines. As a result, reviews of Emacs Lisp code become more precise and contextually relevant. Reviewers can easily identify which functions were modified, without being distracted by unrelated or excessive diffs.</p>



<h2 class="wp-block-heading">Related links</h2>



<ul class="wp-block-list">
<li>The configuration in this article is part of the authorâ€™s <code>~/.gitconfig</code> file is available in the <a href="https://github.com/jamescherti/jc-dotfiles">jc-dotfiles</a> repository.</li>



<li><a href="https://www.jamescherti.com/optimized-git-configuration-for-performance-and-usability/">Enhancing Git configuration ~/.gitconfig for performance, efficiency, data integrity, and workflow automation</a></li>



<li><a href="https://git-scm.com/docs/git-diff">git-diff documentation</a></li>
</ul>
