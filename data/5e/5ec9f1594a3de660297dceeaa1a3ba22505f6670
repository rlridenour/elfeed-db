
	
<p>
In the old days, obtaining latitude and longitude required a physical survey and lots of mathematics. Google Maps has made this task much easier. This article describes how to use the Google Maps API with the <a href="https://cran.r-project.org/web/packages/ggmap/index.html">ggmap library</a>. Geocoding with ggmap is a convenient way to create meaningful spatial visualisations.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
The ggmap package
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Several R libraries exist to visualise spatial information. ggmap by David Kahle which aligns with the ggplot philosophy of layered visualisations.</p>
<p>
The geocode function from the ggmap package extracts longitude and latitude from Google maps, based on a location query. The example below shows the result of a simple geocoding call for the White House and Uluru. The geocode function essentially constructs a URL to obtain the data. However, when you run this code you see an error:</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(ggmap)
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">geocode</span>(<span style="color:#06b;font-weight:bold">c</span>(<span style="background-color:#fff0f0">&#34;White House&#34;</span>, <span style="background-color:#fff0f0">&#34;Uluru&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Error<span style="color:#333">:</span> Google now requires an API key.
</span></span><span style="display:flex;"><span>         See <span style="color:#333">?</span>register_google <span style="color:#080;font-weight:bold">for</span> details.</span></span></code></pre></div>
</div>
<p>
In the middle of 2018, Google tightened access to the database, which means you need to register an API for it to work. This article explains how to use the latest version of ggmap and a Google account to continue using this function.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
The Google API
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>Before we can start geocoding, we need to obtain an <a href="https://developers.google.com/maps/documentation/geocoding/get-api-key">API key from Google</a>. Go to the <a href="https://cloud.google.com/maps-platform/#get-started">registration page</a>, and follow the instructions (select all mapping options). The geocoding API is a free service, but you nevertheless need to associate a credit card with the account. Please note that the Google Maps API is <a href="https://developers.google.com/maps/documentation/geocoding/usage-and-billing">not a free service</a>. There is a free allowance of 40,000 calls to the geocoding API per month, and beyond that calls are $0.005 each.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Geocoding with ggmap
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>You will need to ensure that you have the latest version of ggmap installed on your system. The current version on CRAN is 3.0.</p>
<p>
The code snippet below shows a minimum-working-example of how you can map coordinates using ggplot. The <code class="verbatim">register_google</code> function stores the API key. I have stored the key itself in a private text file. The <code class="verbatim">getOption(&#34;ggmap&#34;)</code> function summarises the Google credentials to check how you are connected.</p>
<p>
The geocode function converts the request into a URL and captures the output into a data frame. The plot shows the places I have lived, projected orthogonally on the globe. The mapproj library provides the orthogonal projection.</p>
<p>
<a href = "https://github.com/pprevos/geography/" target="_blank"
   title="Download geography from GitHub"
   alt="Download geography from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">geography</span>
  </button>
</a>

</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>api <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">readLines</span>(<span style="background-color:#fff0f0">&#34;google.api&#34;</span>) <span style="color:#888"># Text file with the API key</span>
</span></span><span style="display:flex;"><span><span style="color:#06b;font-weight:bold">register_google</span>(key <span style="color:#333">=</span> api)
</span></span><span style="display:flex;"><span><span style="color:#06b;font-weight:bold">getOption</span>(<span style="background-color:#fff0f0">&#34;ggmap&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>locations <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(<span style="background-color:#fff0f0">&#34;Hoensbroek&#34;</span>, <span style="background-color:#fff0f0">&#34;Johannesburg&#34;</span>, <span style="background-color:#fff0f0">&#34;Barrow-in-Furness&#34;</span>,                
</span></span><span style="display:flex;"><span>               <span style="background-color:#fff0f0">&#34;Hong Kong&#34;</span>, <span style="background-color:#fff0f0">&#34;Singapore&#34;</span>, <span style="background-color:#fff0f0">&#34;Tangail&#34;</span>, <span style="background-color:#fff0f0">&#34;Maastricht&#34;</span>, <span style="background-color:#fff0f0">&#34;Bendigo&#34;</span>) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>     <span style="color:#06b;font-weight:bold">geocode</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06b;font-weight:bold">library</span>(ggplot2)
</span></span><span style="display:flex;"><span><span style="color:#06b;font-weight:bold">library</span>(mapproj)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>world <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">map_data</span>(<span style="background-color:#fff0f0">&#34;world&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#06b;font-weight:bold">ggplot</span>() <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>     <span style="color:#06b;font-weight:bold">geom_polygon</span>(data <span style="color:#333">=</span> world,  <span style="color:#06b;font-weight:bold">aes</span>(long, lat, group <span style="color:#333">=</span> group),
</span></span><span style="display:flex;"><span>                  fill <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;grey&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>     <span style="color:#06b;font-weight:bold">geom_point</span>(data <span style="color:#333">=</span> locations, <span style="color:#06b;font-weight:bold">aes</span>(lon, lat),
</span></span><span style="display:flex;"><span>                colour <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;red&#34;</span>, size <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">5</span>) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>     <span style="color:#06b;font-weight:bold">coord_map</span>(<span style="background-color:#fff0f0">&#34;ortho&#34;</span>, orientation <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">c</span>(<span style="color:#60e;font-weight:bold">30</span>, <span style="color:#60e;font-weight:bold">80</span>, <span style="color:#60e;font-weight:bold">0</span>)) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>     <span style="color:#06b;font-weight:bold">theme_void</span>()</span></span></code></pre></div>
</div>
<figure>
<p alt="Places where I have worked and lived" title="Places where I have worked and lived."><img src="https://lucidmanager.org/images/geography/worldhomes.png" alt="/images/geography/worldhomes.png" title="/images/geography/worldhomes.png"/>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
<figcaption>
Places where I have worked and lived.
</figcaption>
</figure>
</div>
</div>

      