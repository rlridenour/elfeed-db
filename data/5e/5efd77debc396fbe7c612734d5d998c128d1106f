<p>I asked <a href="http://yummymelon.com/devnull" target="_blank">Charles Choi</a> about <a href="https://social.sdf.org/@prjorgensen/114636642074808121" target="_blank" class="broken_link">adding corelocationcli similar to what <a href="https://raw.githubusercontent.com/xenodium/dotsies/refs/heads/main/emacs/ar/journelly.el" target="_blank">journelly.el</a> uses</a>. We discussed it a bit. I went away and this is what the robot overlord helped me put together.</p>
<pre>
(defun my/update-calendar-location-from-corelocationcli ()
  "Update `calendar-latitude`, `calendar-longitude`, and `calendar-location-name`
from the output of the `CoreLocationCLI` command line utility. Made with ChatGPT."
  (interactive)
  (unless (executable-find "CoreLocationCLI")
    (error "CoreLocationCLI is not installed (try `brew install corelocationcli`)"))
  (with-temp-buffer
    (let ((exit-code (call-process "CoreLocationCLI" nil t nil
                                   "--format" "%latitude\t%longitude\t%thoroughfare")))
      (if (not (eq exit-code 0))
          (error "CoreLocationCLI failed to get location")
        (let* ((parts (split-string (buffer-string) "\t"))
               (lat (string-to-number (nth 0 parts)))
               (lon (string-to-number (nth 1 parts)))
               (desc (string-trim (nth 2 parts))))
          (setq calendar-latitude lat
                calendar-longitude lon
                calendar-location-name desc)
          (message "Updated calendar location: %s (%.4f, %.4f)"
                   calendar-location-name calendar-latitude calendar-longitude))))))
</pre>
<p>I think this works, so could call it when the calendar is invoked:</p>
<pre>
(add-hook 'calendar-mode-hook #'my/update-calendar-location-from-corelocationcli)
</pre>
<p>â€¦ or some such. Thoughts?</p>
