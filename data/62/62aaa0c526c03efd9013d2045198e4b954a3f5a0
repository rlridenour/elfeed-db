<p>After reading a quite interesting post by Irreal on <a href="https://irreal.org/blog/?p=11416">Org mode clock tables</a>,
I decided to share my — a bit specific —  experience with the subject.</p>
<h2 id="the-task">The Task</h2>
<p>Like many of us these days, I&rsquo;m working remotely. My employer requires
a periodic report and I should track my time I spend on various task —
exactly as Irreal describes in his post. Of course, I&rsquo;m using Org mode
clock tables for that purpose.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span><span style="color:#75715e">#+TITLE</span><span style="color:#75715e">: Worktime Tracker for July 2023</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#+OPTIONS</span><span style="color:#75715e">: num:nil toc:nil</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#+BEGIN</span><span style="color:#75715e">: clocktable :maxlevel 3 :scope file</span>
</span></span><span style="display:flex;"><span>#+END
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>*<span style="font-weight:bold"> 2023-07   </span><span style="font-style:italic"> :2023:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">**</span> 2023-07-03
</span></span><span style="display:flex;"><span><span style="color:#75715e">***</span> Impl. a test gRPC server                           <span style="font-style:italic"> :TEST:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">:LOGBOOK:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">CLOCK: [2023-07-03 Mon 15:05]--[2023-07-03 Mon 15:50] =&gt;  0:45
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">CLOCK: [2023-07-03 Mon 09:45]--[2023-07-03 Mon 14:10] =&gt;  4:25
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">:END:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">**</span> 2023-07-04
</span></span><span style="display:flex;"><span><span style="color:#75715e">***</span> Fix client timeout                                  <span style="font-style:italic"> :FIX:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">:LOGBOOK:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">CLOCK: [2023-07-04 Tue 12:45]--[2023-07-04 Tue 13:10] =&gt;  0:25
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">:END:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">***</span> Add AddOrder handler                               <span style="font-style:italic"> :FEAT:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">:LOGBOOK:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">CLOCK: [2023-07-04 Tue 14:05]--[2023-07-04 Tue 15:10] =&gt;  1:05
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">:END:</span>
</span></span></code></pre></div><p>Then if I put the cursor at the line with the word <code>#+BEGIN</code> (line #4
in my org file) and press <code>C-c C-c</code> (in the Org mode, this chord runs
the multipurpose command <code>org-ctrl-c-ctrl-c</code>), the dynamic clock table
block is getting updated immediately and I get a standard clock table
report as shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span><span style="color:#75715e">#+BEGIN</span><span style="color:#75715e">: clocktable :maxlevel 3 :scope file</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#+CAPTION</span><span style="color:#75715e">: Clock summary at [2023-07-30 Sun 15:32]</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| Headline                       | Time |      |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">|--------------------------------+------+------+------|</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| *Total time*                   |*6:40*|      |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">|--------------------------------+------+------+------|</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| 2023-07                        | 6:40 |      |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_  2023-07-03                 |      | 5:10 |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_    Impl. a test gRPC server |      |      | 5:10 |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_  2023-07-04                 |      | 1:30 |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_    Fix client timeout       |      |      | 0:25 |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_    Add AddOrder handler     |      |      | 1:05 |</span>
</span></span><span style="display:flex;"><span>#+END
</span></span></code></pre></div><p>So far, everything looks fine.</p>
<h2 id="the-problem">The Problem</h2>
<p>The problem is that my employer wants the report to be in a specific
format.</p>
<figure><img src="http://localhost:1313/img/clock-report.png"/><figcaption>
            <h4>The required MS Word (sic!) file with the work time report.</h4>
        </figcaption>
</figure>

<p>Please note the column #1 should contain <em>a tag</em> of the task, all dates
should be in the <em>DD.MM.YYYY</em> format, a time spent for the task should
be in the <em>hh:mm</em> format, left-padded with 0s if required, and the
total time should be in the <em>hhh:mm</em> format, left-padded with 0s as
well.</p>
<p>Here the adventure begins.</p>
<h2 id="the-adventure">The Adventure</h2>
<p>I decided to implement my <em>exporter</em> as the Elisp code block inside my
time tracking org file. Therefore, if I press <code>C-c C-c</code> when the
cursor is over the <em>exporter</em> code block, Emacs evaluates this block
and prints the result just below the block. This would allow us to
make some experiments.</p>
<p>First of all, I need an access to my clock table entries. After some
research I found what I need — <code>org-clock-get-table-data</code>, a built-in
function defined in the <code>org-clock.el[.gz]</code> file (as of Emacs 28.2).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun org-clock-get-table-data (file params)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Get the clocktable data for file FILE, with parameters PARAMS.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">FILE is only for identification - this function assumes that
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">the correct buffer is current, and that the wanted restriction is
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">in place.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">The return value will be a list with the file name and the total
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file time (in minutes) as 1st and 2nd elements.  The third element
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">of this list will be a list of headline entries.  Each entry has the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">following structure:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  (LEVEL HEADLINE TAGS TIMESTAMP TIME PROPERTIES)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LEVEL:      The level of the headline, as an integer.  This will be
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            the reduced level, so 1,2,3,... even if only odd levels
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            are being used.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">HEADLINE:   The text of the headline.  Depending on PARAMS, this may
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            already be formatted like a link.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TAGS:       The list of tags of the headline.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TIMESTAMP:  If PARAMS require it, this will be a time stamp found in the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            entry, any of SCHEDULED, DEADLINE, NORMAL, or first inactive,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            in this sequence.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TIME:       The sum of all time spend in this tree, in minutes.  This time
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            will of cause be restricted to the time block and tags match
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            specified in PARAMS.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PROPERTIES: The list properties specified in the `:properties&#39; parameter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            along with their value, as an alist following the pattern
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            (NAME . VALUE).&#34;</span>
</span></span></code></pre></div><p>Let&rsquo;s make an experiment.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>(org-clock-get-table-data <span style="color:#a6e22e">buffer-file-name</span> <span style="color:#f92672">&#39;</span>(:tags <span style="color:#66d9ef">t</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span>| /home/magnolia/Desktop/demo.org | <span style="color:#ae81ff">400</span> | ((<span style="color:#ae81ff">1</span> 2023-07 (<span style="color:#ae81ff">2023</span>) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">400</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">2</span> 2023-07-03 (<span style="color:#ae81ff">2023</span>) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">310</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">3</span> Impl. a test gRPC server (<span style="color:#ae81ff">2023</span> TEST) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">310</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">2</span> 2023-07-04 (<span style="color:#ae81ff">2023</span>) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">90</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">3</span> Fix client timeout (<span style="color:#ae81ff">2023</span> FIX) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">3</span> Add AddOrder handler (<span style="color:#ae81ff">2023</span> FEAT) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">65</span> <span style="color:#66d9ef">nil</span>)) |
</span></span></code></pre></div><p>Please note the output is an Org table because the result is a list.
Please also note the <code>'(:tags t)</code> parameter — it is required because
we want all tags to be included in the output.</p>
<p>Obviously, we actually want the 3rd element of the output list.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> (org-clock-get-table-data <span style="color:#a6e22e">buffer-file-name</span> <span style="color:#f92672">&#39;</span>(:tags <span style="color:#66d9ef">t</span>)))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">1</span> |                  2023-07 | (<span style="color:#ae81ff">2023</span>)      | <span style="color:#66d9ef">nil</span> | <span style="color:#ae81ff">400</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">2</span> |               2023-07-03 | (<span style="color:#ae81ff">2023</span>)      | <span style="color:#66d9ef">nil</span> | <span style="color:#ae81ff">310</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">3</span> | Impl. a test gRPC server | (<span style="color:#ae81ff">2023</span> TEST) | <span style="color:#66d9ef">nil</span> | <span style="color:#ae81ff">310</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">2</span> |               2023-07-04 | (<span style="color:#ae81ff">2023</span>)      | <span style="color:#66d9ef">nil</span> |  <span style="color:#ae81ff">90</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">3</span> |       Fix client timeout | (<span style="color:#ae81ff">2023</span> FIX)  | <span style="color:#66d9ef">nil</span> |  <span style="color:#ae81ff">25</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">3</span> |     Add AddOrder handler | (<span style="color:#ae81ff">2023</span> FEAT) | <span style="color:#66d9ef">nil</span> |  <span style="color:#ae81ff">65</span> | <span style="color:#66d9ef">nil</span> |
</span></span></code></pre></div><p>It seems we are on the right way. The column #1 contains the level of
the headline, as an integer; #2 — the text of the headline; #3 — the
list of tags of the headline; #5 — the sum of all time spend in this
tree, in minutes, as an integer.</p>
<h3 id="the-magic">The Magic</h3>
<p>Before implementing the clock table parser, we need some <em>utilities</em>.</p>
<p>First of all we should convert a date from the ISO 8601 format
(YYYY-MM-DD) to the European DD.MM.YYYY format.
According to the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Time-Parsing.html">GNU Emacs Lisp Reference Manual</a>,
we can use two built-in functions for this purpose:</p>
<blockquote>
<p>Function: <code>format-time-string</code> <em>format-string &amp;optional time zone</em></p>
<p>This function converts <em>time</em> (which should be a Lisp <strong>timestamp</strong>,
and defaults to the current time if time is omitted or nil) to a
string according to format-string.</p>
</blockquote>
<p>and</p>
<blockquote>
<p>Function: <code>date-to-time</code> <em>string</em></p>
<p>This function parses the time-string <em>string</em> and returns the
corresponding Lisp <strong>timestamp</strong>.
This function assumes Universal Time if <em>string</em> lacks explicit time zone information,
and <em>assumes earliest values if string lacks month, day, or time</em>.</p>
</blockquote>
<p>As we&rsquo;ll see below, the last sentence (in italic) is wrong — at least as of Emacs
28.2. Maybe it has something to do with
<a href="https://debbugs.gnu.org/cgi/bugreport.cgi?bug=52209">this bug in Emacs 28</a>,
I don&rsquo;t know.</p>
<p>Okay, let&rsquo;s test it out.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span> (date-to-time <span style="color:#e6db74">&#34;2023-07&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Error: date-to-time: Invalid date: 2023-07
</span></span></code></pre></div><p>This doesn&rsquo;t work.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span> (date-to-time <span style="color:#e6db74">&#34;2023-07-04&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Error: date-to-time: Invalid date: 2023-07-04
</span></span></code></pre></div><p>This doesn&rsquo;t work as well.</p>
<p>This is where the magic begins. Let&rsquo;s add <em>a fake time component</em>
<code>T01</code> to the ISO date string.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span> (date-to-time <span style="color:#e6db74">&#34;2023-07-04T01&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span><span style="color:#f92672">:</span> 04.07.2023
</span></span></code></pre></div><p>It worked, I&rsquo;m so happy.</p>
<p>Now let&rsquo;s implement a utility function that converts a time, in
minutes, as an integer, to the properly padded  string.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (defun my/clock--format-time (time-in-minutes <span style="color:#66d9ef">&amp;optional</span> padding)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Convert TIME-IN-MINUTES, as an integer, to a string,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   with hours left-padded with zeroes. Default PADDING is 2.&#34;</span>
</span></span><span style="display:flex;"><span>    (let* ((hours (<span style="color:#a6e22e">/</span> time-in-minutes <span style="color:#ae81ff">60</span>))
</span></span><span style="display:flex;"><span>           (minutes (<span style="color:#a6e22e">-</span> time-in-minutes (<span style="color:#a6e22e">*</span> hours <span style="color:#ae81ff">60</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">format</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;%0&#34;</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%d&#34;</span> (or padding <span style="color:#ae81ff">2</span>)) <span style="color:#e6db74">&#34;d:%02d&#34;</span>)
</span></span><span style="display:flex;"><span>               hours minutes)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; TEST</span>
</span></span><span style="display:flex;"><span>(my/clock--format-time <span style="color:#ae81ff">310</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span><span style="color:#f92672">:</span> 05:10
</span></span></code></pre></div><p>Okay, it works.</p>
<h2 id="the-result">The Result</h2>
<p>Now let&rsquo;s combine everything together and then evaluate the code
block.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (require <span style="color:#e6db74">&#39;org-clock</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (defvar my/cur-date <span style="color:#66d9ef">nil</span> <span style="color:#e6db74">&#34;Holds the current entry date.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (defun my/clock--format-time (time-in-minutes <span style="color:#66d9ef">&amp;optional</span> padding)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Convert TIME-IN-MINUTES, as an integer, to a string,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   with hours left-padded with zeroes. Default PADDING is 2.&#34;</span>
</span></span><span style="display:flex;"><span>    (let* ((hours (<span style="color:#a6e22e">/</span> time-in-minutes <span style="color:#ae81ff">60</span>))
</span></span><span style="display:flex;"><span>           (minutes (<span style="color:#a6e22e">-</span> time-in-minutes (<span style="color:#a6e22e">*</span> hours <span style="color:#ae81ff">60</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">format</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;%0&#34;</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%d&#34;</span> (or padding <span style="color:#ae81ff">2</span>)) <span style="color:#e6db74">&#34;d:%02d&#34;</span>)
</span></span><span style="display:flex;"><span>               hours minutes)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (defun my/clock--parse-entry (entry)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Parse the clock table ENTRY, returning a list of row items,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   depending on the level of the headline.&#34;</span>
</span></span><span style="display:flex;"><span>    (let* ((level (<span style="color:#a6e22e">car</span> entry))
</span></span><span style="display:flex;"><span>           (headline (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">1</span> entry))
</span></span><span style="display:flex;"><span>           (tag (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> entry)))
</span></span><span style="display:flex;"><span>           (minutes (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">4</span> entry))
</span></span><span style="display:flex;"><span>           (date (if (<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>                     (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span>
</span></span><span style="display:flex;"><span>                         (date-to-time (<span style="color:#a6e22e">concat</span> headline <span style="color:#e6db74">&#34;T01&#34;</span>))))))
</span></span><span style="display:flex;"><span>      (cond
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">1</span>) (<span style="color:#a6e22e">list</span> headline <span style="color:#e6db74">&#34;TOTAL&#34;</span> <span style="color:#e6db74">&#34;&#34;</span> (my/clock--format-time minutes <span style="color:#ae81ff">3</span>)))
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">2</span>) (progn (setq my/cur-date date) <span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">3</span>) (<span style="color:#a6e22e">list</span> tag headline my/cur-date (my/clock--format-time minutes)))
</span></span><span style="display:flex;"><span>      )))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; Apply the parser to every entry in the clock table.</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">mapcar</span> <span style="color:#a6e22e">#&#39;</span>my/clock--parse-entry
</span></span><span style="display:flex;"><span>     (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> (org-clock-get-table-data <span style="color:#a6e22e">buffer-file-name</span> <span style="color:#f92672">&#39;</span>(:tags <span style="color:#66d9ef">t</span>))))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span>| 2023-07 | TOTAL                    |            | 006:40 |
</span></span><span style="display:flex;"><span>| TEST    | Impl. a test gRPC server | 03.07.2023 |  05:10 |
</span></span><span style="display:flex;"><span>| FIX     | Fix client timeout       | 04.07.2023 |  00:25 |
</span></span><span style="display:flex;"><span>| FEAT    | Add AddOrder handler     | 04.07.2023 |  01:05 |
</span></span></code></pre></div><p>Bingo! We&rsquo;ve got what we exactly want — the Org mode table filled with
properly formatted data. Now I can just copy this table from my work
time org file to another org file and export it to the ODT file (and
then save it as the MS Word file).</p>
<figure><img src="http://localhost:1313/img/clock-report.png"/><figcaption>
            <h4>The MS Word file with the work time report.</h4>
        </figcaption>
</figure>

<p>Tested on Ubuntu Linux (Pop!_OS 20.10) and MS Windows 10 using Emacs 28.2.</p>
<h2 id="conclusions">Conclusions</h2>
<ol>
<li>We can have access to all the data collected in a clock table.</li>
<li>Org mode code blocks provide an ideal way to make experiments,
testing your code, and getting the result <em>inplace</em>.</li>
<li>In Emacs, you can do everything.</li>
</ol>
<p>Happy emacsing!</p>