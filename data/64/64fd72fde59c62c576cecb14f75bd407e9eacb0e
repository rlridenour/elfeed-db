<pre><code class="language-example">o______________o
| Hello world! |
o--------------o
        \   ^__^
         \  (oo)_______
            (__)\       )\/\
                ||----w |
                ||     ||

</code></pre>
<p>Keen to get started with your <em>Hello World</em> Cloudflare Worker? Skip to the <a href="id:cloudflare-worker-hello-world-setup">setup</a> section.</p>
<h2>A little background</h2>
<p>The vast majority of my software development experience has been centered around client-side software. The few times I've needed a server-side component for a hobby project, I've historically provisioned a linux <a href="https://en.wikipedia.org/wiki/Virtual_machine">virtual machine</a> somewhere and ran whatever services I needed. I have to admit though, I don't enjoy the provisioning process, configuration, maintenance, upgrades, database admin, etc. which take time away from the part I enjoy more: building and experimenting with features.</p>
<p>While <a href="https://en.wikipedia.org/wiki/Containerization_(computing)">containers</a> have made things somewhat simpler, much of the maintenance tradeoffs remain.</p>
<p>These days, the server-managing overhead has been greatly reduced by &quot;<a href="https://en.wikipedia.org/wiki/Serverless_computing">serverless</a>&quot; solutions. Odd terminology for a server offering, but I digress. It more or less refers to removing most of that additional responsibility that comes with managing your own servers and enabling you to focus on building your business logic. Having said that, I've typically shied away from these services, with the possibly irrational fear of vendor lock-in.</p>
<p>The thing is, if most of my potential server-side needs merely require an entry point (where I could route/handle incoming requests) and possibly some persistence (maybe a database), I should be able to abstract these things away and build server-side logic against portable abstractions. With that in place, maybe there's little vendor lock-in to worry about? Who knows, the devil's in the detail. If I keep shying away from these services, I'll never know, so maybe I should try some and see.</p>
<h2>Let's try Cloudflare Workers</h2>
<p>There are no shortages of serverless options offering <a href="https://en.wikipedia.org/wiki/Function_as_a_service">functions as a service</a>. Google Cloud, AWS Lambda, Azure Functions, Vercel Functions, Netlify Functions, Fastly, Cloudflare workers, I could go on…</p>
<p>While I haven't researched the different offerings, I had made a mental note to check out Cloudflare Workers as they had <a href="https://blog.cloudflare.com/introducing-d1">announced D1</a>, their database backed by SQLite …and who doesn't love SQLite? ;) OK, I'm no expert here, but I have had a pleasant experience whenever I've used it. These days, even <a href="https://xenodium.com/emacs-29s-sqlite-mode/">Emacs 29 got some SQLite love</a>, which prompted me to add <a href="https://xenodium.com/sqlite-mode-goodies/">cell navigation/navigation</a> and <a href="https://xenodium.com/further-sqlite-mode-extensions/">try other experiments</a>.</p>
<h2>D1 / SQLite in beta</h2>
<p>Keep in mind that D1 is in public beta and not yet recommended for large production workloads. From the <a href="https://developers.cloudflare.com/d1/">Cloudflare site</a>:</p>
<blockquote>
<p>&quot;While the D1 team expects breaking changes and issues to be minimal, they may still occur. The D1 team generally does not recommend running large production workloads on beta products.&quot;</p>
</blockquote>
<h2>Workers cost</h2>
<p>In terms of pricing (as of 2024-01-13), the <a href="https://developers.cloudflare.com/workers/platform/pricing">free tier</a> enables workers to handle up 100,000 requests per day. Plenty for trying things out.</p>
<p>In any case, we're only checking out Cloudflare's offering, so let's move on…</p>
<h2>Settings up a new Cloudflare Worker (via web dash) {#settings-up-a-new-cloudflare-worker-via-web-dash id=&quot;cloudflare-worker-hello-world-setup&quot;}</h2>
<p>Cloudflare has a tiny snippet on their <a href="https://workers.cloudflare.com/">Workers landing page</a> that sets things up rather quickly, but [I won't be using it]{.underline}.</p>
<pre><code class="language-{.bash">~/ $ npm create cloudflare -- my-app
~/ $ cd my-app
~/ $ npx wrangler deploy
Published https://my-app.world.workers.dev
</code></pre>
<p>⚠️ <em>Note: before you get copying and pasting, read on.</em></p>
<p>Cloudflare's snippet is helpful, but it does quite a bit under the hood. I'm somewhat of a node and serverless noob, so I wanted to understand things a little more and figure out the bare minimum needed to start a minimal Cloudflare Worker project.</p>
<p>Instead, we'll first click here and there over at <a href="https://dash.cloudflare.com">https://dash.cloudflare.com</a> to spin off our new worker from the web and later continue from the command line.</p>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/cf-new-0.png" alt=""></p>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/cf-new-1.png" alt=""></p>
<p>Give the worker a name. We'll call it &quot;todos&quot; to give ya a little sneak peek at what the next post is possibly about… But you can call it whatever you'd like. Keep in mind you'll need to use this name to refer to your new worker.</p>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/cf-new-2.png" alt=""></p>
<p>Congrats, you've now deployed a new worker. You can access it via the URL that looks something like <a href="https://todos.somewhere.workers.dev">https://todos.somewhere.workers.dev</a></p>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/hello-dark.png" alt=""></p>
<p>This is great and all, but we want to build something with this new worker, so let's set up our local development environment…</p>
<h2>Prerequisites</h2>
<p>You'll need <a href="https://nodejs.org/">node.js</a> installed on your machine.</p>
<p>I happen to be on macOS, so I installed node via <a href="https://brew.sh/">Homebrew</a>.</p>
<pre><code class="language-{.bash">brew install node
</code></pre>
<h2>Create a new node project</h2>
<p>We want to start with a bare bones node project, so let's do just that.</p>
<pre><code class="language-{.bash">mkdir HelloCloudflareWorker
cd HelloCloudflareWorker
npm init -y
</code></pre>
<h2>Install TypeScript (compiler)</h2>
<p>I like some guardrails when targetting Javascript, so I'll use the <a href="https://www.typescriptlang.org">TypeScript</a> compiler in this project. Let's install it.</p>
<pre><code class="language-{.bash">npm install --save-dev typescript
npx tsc --init
</code></pre>
<h2>Install Cloudflare Typescript types</h2>
<p>To have Cloudflare types information accessible to the TypeScript compiler, we'll need to install that too.</p>
<pre><code class="language-{.bash">npm install --save-dev @cloudflare/workers-types
</code></pre>
<h2>Install Wrangler (Cloudflare tooling)</h2>
<p>To manage your worker from the command-line, you'll need Cloudflare's <a href="https://developers.cloudflare.com/workers/wrangler/">wrangler</a> tool. Let's install it.</p>
<pre><code class="language-{.bash">npm install --save-dev wrangler
</code></pre>
<h2>Point Wrangler to our worker</h2>
<p>We're done installing things now. Let's point wrangler to our new worker by creating its config file.</p>
<p><code>wrangler.toml</code></p>
<pre><code class="language-{.bash">name = &quot;todos&quot;
main = &quot;worker/worker.ts&quot;
</code></pre>
<h2>Worker entry point</h2>
<p>By default, the worker we created using Cloudflare's dash has the following entry point:</p>
<pre><code class="language-{.javascript">export default {
  async fetch(request, env, ctx) {
    return new Response( 'Hello World!'):
  }
}
</code></pre>
<p>However, this isn't yet included in our development environment. We need to write our first bit of code. You may have noticed our <code>wrangler.toml</code> is pointing to the main entry point (<code>worker/worker.ts</code>) and this file doesn't exist yet. Let's create it, though be sure to also create its owning directory:</p>
<pre><code class="language-{.bash">mkdir worker
</code></pre>
<p>Now we can create our very own <code>worker/worker.ts</code>. Let's make the first change that shapes worker to our liking. Rather than just printing &quot;Hello World&quot;, let's style things up using our <a href="https://en.wikipedia.org/wiki/Cowsay">cow friend</a>. We'll create <code>worker/worker.ts</code> and include the spiffed up message.</p>
<p><code>worker/worker.ts</code></p>
<pre><code class="language-{.javascript">import { Env, ExecutionContext } from '@cloudflare/workers-types';

export default {
  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise&lt;Response&gt; {
    let defaultResponse = `
   o______________o
   | Hello World! |
   o--------------o
           \\   ^__^
            \\  (oo)\_______
               (__)\\       )\\/\\
                   ||----w |
                   ||     ||`
    return new Response(defaultResponse);
  }
};
</code></pre>
<p>It's worth mentioning the import statement, since it brings Cloudflare's type information for both <code>Env</code> and <code>ExecutionContext</code>.</p>
<h2>Running worker locally</h2>
<p>Okay, we now have our <code>worker/worker.ts</code> code ready to go. Let's run it locally. For that we use the wrangler utility.</p>
<pre><code class="language-{.bash">npx wrangler dev
</code></pre>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/dev.png" alt=""></p>
<p>With that, you'll notice the worker is now running locally and waiting to be visited at <a href="http://localhost:8787">http://localhost:8787</a>.</p>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/moo.png" alt=""></p>
<h2>Deploying worker</h2>
<p>When we first created the worker via <a href="https://dash.cloudflare.com">https://dash.cloudflare.com</a>, it automatically deployed to <a href="https://todos.somewhere.workers.dev">https://todos.somewhere.workers.dev</a>. But our mods only ran locally. Let's deploy, again with the wrangler utility.</p>
<pre><code class="language-{.bash">npx wrangler deploy
</code></pre>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/deploying.png" alt=""></p>
<p>We're good to go. Let's point our browser to the worker's public location.</p>
<p><img src="https://xenodium.github.io/images/a-cloudflare-workers-primer-hello-world/deployed.png" alt=""></p>
<p>…and with that, we have a functional Cloudflare Worker and a local development environment to shape things up however we'd like. What would you use the Worker for?</p>
<p>Gave this primer a try? I'd love to hear from ya (<a href="https://indieweb.social/@xenodium">Mastodon</a> / <a href="https://twitter.com/xenodium">Twitter</a> / <a href="https://www.reddit.com/user/xenodium">Reddit</a> / <a href="mailto:me__AT__xenodium.com">Email</a>).</p>
<p><em>Enjoying this content? Find it useful?</em></p>
<p><em>Consider ✨<a href="https://github.com/sponsors/xenodium">sponsoring me</a>✨ or buy ✨<a href="https://apps.apple.com/us/developer/xenodium-ltd/id304568690">my iOS apps</a>✨.</em></p>
