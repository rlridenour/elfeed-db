<p>While it's only been a few weeks since <a href="https://xenodium.com/introducing-agent-shell">introducing Emacs agent-shell</a>, we've landed <a href="https://github.com/xenodium/agent-shell/commits/main/">nearly 100 commits</a> and enough improvements to warrant a new blog post.</p>
<h2>More agents</h2>
<p><a href="https://github.com/xenodium/agent-shell">agent-shell</a> now includes support for two additional ACP-capable agents:</p>
<ul>
<li>Claude Code</li>
<li>Codex via <a href="https://github.com/cola-io/codex-acp">codex-acp</a> (new)</li>
<li>Gemini CLI</li>
<li>Goose (new)</li>
</ul>
<h2>Unified entry point</h2>
<p>In addition to starting new shells via agent-specific commands, we now have a unified <code>M-x agent-shell</code> entry point, enabling selection from a list of supported agents.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-0-5-improvements/picker.png" alt=""></p>
<p>The agent-specific commands remain available as usual:</p>
<ul>
<li><code>M-x agent-shell-anthropic-start-claude-code</code></li>
<li><code>M-x agent-shell-openai-start-codex</code></li>
<li><code>M-x agent-shell-google-start-gemini</code></li>
<li><code>M-x agent-shell-goose-start-agent</code></li>
</ul>
<h2>Toggling display</h2>
<p><code>agent-shell</code> now provides basic control to toggle display of shell buffers:</p>
<ul>
<li><code>M-x agent-shell-toggle</code>: Toggles display of the most recently accessed agent (per project).</li>
<li><code>agent-shell-display-action</code>: Controls how agent shells are displayed when activated.</li>
</ul>
<h2>agent-shell-sidebar (new package)</h2>
<p>While <code>agent-shell</code> provides basic display toggling, <a href="https://github.com/cmacrae">Calum MacRae</a> offers a comprehensive sidebar package. Check out <a href="https://github.com/cmacrae/agent-shell-sidebar">agent-shell-sidebar</a>.</p>
<h2>Experimental dev container support (thanks to Fritz Grabo)</h2>
<p><code>agent-shell</code> now has experimental support for running agents inside dev containers. See <a href="https://github.com/xenodium/agent-shell?tab=readme-ov-file#running-agents-in-devcontainers--docker-containers-experimental">docs</a>.</p>
<h2>quick-diff improvements</h2>
<p><code>quick-diff</code> buffers, proposing changes, get a more polished experience. More notably, diffs get context (thanks to David J. Rosenbaum), single-key patch navigation/acceptance, and file names now displayed in header line.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-0-5-improvements/quick-diff.png" alt=""></p>
<h2>Environment variables</h2>
<p>Environment variables can now be loaded from either the Emacs environment, .env files, and/or overridden inline:</p>
<pre><code class="language-{.commonlisp">(setq agent-shell-anthropic-claude-environment
      (agent-shell-make-environment-variables
       :inherit-env t
       :load-env &quot;~/.env&quot;
       &quot;CUSTOM_VAR&quot; &quot;custom_value&quot;))
</code></pre>
<h2>Authentication methods</h2>
<p>Different authentication methods are now supported. For example:</p>
<pre><code class="language-{.commonlisp">;; Login-based auth
(setq agent-shell-anthropic-authentication
      (agent-shell-anthropic-make-authentication :login t))

;; API key auth
(setq agent-shell-anthropic-authentication
      (agent-shell-anthropic-make-authentication
       :api-key (lambda () (auth-source-pass-get &quot;secret&quot; &quot;anthropic-api-key&quot;))))
</code></pre>
<p>Check <code>agent-shell-*-authentication</code> per provider, as available options may differ.</p>
<h2>UX polish</h2>
<p>On the smaller side, but also contributing to overall polish:</p>
<ul>
<li>Single-key permission bindings (y/n/!).</li>
<li>Improved error messages.</li>
<li>Improved task status rendering.</li>
<li>Improved TAB navigation.</li>
</ul>
<h2>Traffic inspection and debugging</h2>
<p>While not technically part of <code>agent-shell</code>, <a href="https://github.com/xenodium/acp.el">acp.el</a>'s traffic inspection has been getting some love to help users diagnose issues.</p>
<h2>Contributions</h2>
<p>Thank you for your contributions!</p>
<ul>
<li>David J. Rosenbaum: Context support in diffs (<a href="https://github.com/xenodium/agent-shell/pull/48">PR</a>).</li>
<li>Fritz Grabo: Dev container support (<a href="https://github.com/xenodium/agent-shell/pull/19">PR</a>).</li>
<li>Grant Surlyn: Doom Emacs installation instructions (<a href="https://github.com/xenodium/agent-shell/pull/37">PR</a>).</li>
<li>Mark A. Hershberger: Goose key improvement (<a href="https://github.com/xenodium/agent-shell/issues/46">PR</a>).</li>
<li>Ruslan Kamashev: Customization group fix (<a href="https://github.com/xenodium/agent-shell/pull/33">PR</a>).</li>
</ul>
<h2>Sponsors</h2>
<p>Thank you to all sponsors. While LLMs aren't everyone's cup of tea, we're seeing editors across the board evolving to accommodate these new LLM tools. In a somewhat similar vein, <a href="https://microsoft.github.io/language-server-protocol/">LSP</a> integration wasn't for everyone, but for those who did want it, Emacs luckily catered to them. Thank you for helping make this project sustainable while also enabling Emacs to cater to all.</p>
<h2>Support this work</h2>
<p>If <a href="https://github.com/xenodium/agent-shell">agent-shell</a> or <a href="https://github.com/xenodium/acp.el">acp.el</a> are useful to you, consider <a href="https://github.com/sponsors/xenodium">sponsoring</a> its development. LLM tokens aren't free, and neither is the time dedicated to building this stuff ;-)</p>
