<p>Working with satellite data I often have to convert a coordinate value or an
angle value from the DMS notation (<em>degree@minute&rsquo;second&quot;</em>) to a decimal
degree in the floating point number format and vice versa.</p>
<h2 id="dms-to-decimal-degree">DMS to Decimal Degree</h2>
<p>Of course, I want to do this directly in an Emacs buffer, so I wrote a
simple function that uses <code>deg</code> and <code>hms</code> functions provided by the
built-in superb <strong>calc</strong> package.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun dms2deg (p1 p2)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Converts a region from the DMS (dd@mm&#39;ss\&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  to a decimal degree.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  P1,P2 are the beginning and the end of the region
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  (selection) respectively.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive <span style="color:#e6db74">&#34;r&#34;</span>)
</span></span><span style="display:flex;"><span>  (let (s)
</span></span><span style="display:flex;"><span>    (if (region-active-p)
</span></span><span style="display:flex;"><span>        (progn
</span></span><span style="display:flex;"><span>          (setq s (calc-eval
</span></span><span style="display:flex;"><span>              (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;deg(&#34;</span> (<span style="color:#a6e22e">buffer-substring-no-properties</span> p1 p2) <span style="color:#e6db74">&#34;)&#34;</span>)))
</span></span><span style="display:flex;"><span>          (delete-active-region)
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">insert</span> s))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;No active region!&#34;</span>))
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p>I&rsquo;ve bound this function to the <code>Ctrl+F6</code> key chord (<code>C-f6</code> in the Emacs
notation) globally. Of course, you can use your own key combination.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(global-set-key [(control f6)] <span style="color:#a6e22e">#&#39;</span>dms2deg)
</span></span></code></pre></div><p>Now I can select a region in a buffer, press <code>C-f6</code> and <em>replace</em> the
selection with its decimal value, so <code>30@15'54&quot;</code> becomes <code>30.265</code>.</p>
<h2 id="decimal-degree-to-dms">Decimal Degree to DMS</h2>
<p>The inverse function (bound to <code>S-f6</code> or <code>Shift+F6</code>) <em>replaces</em> a floating
point with the corresponding DMS string.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun deg2dms (p1 p2)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Converts a region from a decimal degree
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  to the DMS format (dd@ mm&#39; ss\&#34;).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  P1,P2 - beginning and end of the region
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  (selection) respectively.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive <span style="color:#e6db74">&#34;r&#34;</span>)
</span></span><span style="display:flex;"><span>  (let (s)
</span></span><span style="display:flex;"><span>    (if (region-active-p)
</span></span><span style="display:flex;"><span>        (progn
</span></span><span style="display:flex;"><span>          (setq s (calc-eval
</span></span><span style="display:flex;"><span>              (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;hms(&#34;</span> (<span style="color:#a6e22e">buffer-substring-no-properties</span> p1 p2) <span style="color:#e6db74">&#34;)&#34;</span>)))
</span></span><span style="display:flex;"><span>          (delete-active-region)
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">insert</span> s))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;No active region!&#34;</span>))
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(global-set-key [(shift f6)] <span style="color:#a6e22e">#&#39;</span>deg2dms)
</span></span></code></pre></div><p>Now if you select a region in a buffer and then press <code>S-f6</code>, your <code>30.265</code>
becomes <code>30@ 15' 54.&quot;</code></p>
<h2 id="enhanced-version">Enhanced Version</h2>
<p>After a while, I decided to enhance the first conversion function by
adding an <em>&lsquo;inline calculator&rsquo;</em> feature. It works quite simple: if a
selected region contains the &lsquo;@&rsquo; character, the region is considered
as a coordinate (angle) value in the DMS notation, and it should be <em>replaced</em>
with its decimal value. Otherwise, the region is considered as an
arithmetic expression (in terms of the Emacs&rsquo; calc) and its calculated
value will be <em>inserted</em> just after the region.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun avs/calc-region (p1 p2)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Calculates a region or converts DMS to decimal.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   P1,P2 - beginning and end of the region
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   respectively.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive <span style="color:#e6db74">&#34;r&#34;</span>)
</span></span><span style="display:flex;"><span>  (if (region-active-p)
</span></span><span style="display:flex;"><span>      (let ((b (<span style="color:#a6e22e">buffer-substring-no-properties</span> p1 p2)))
</span></span><span style="display:flex;"><span>        (cond ((string-match-p <span style="color:#e6db74">&#34;@&#34;</span> b) <span style="color:#75715e">; convert DMS to decimal ...</span>
</span></span><span style="display:flex;"><span>               (delete-active-region)
</span></span><span style="display:flex;"><span>               (<span style="color:#a6e22e">insert</span> (calc-eval (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;deg(&#34;</span> b <span style="color:#e6db74">&#34;)&#34;</span>))))
</span></span><span style="display:flex;"><span>              (<span style="color:#66d9ef">t</span> <span style="color:#75715e">; ... otherwise calculate a region</span>
</span></span><span style="display:flex;"><span>               (<span style="color:#a6e22e">goto-char</span> (<span style="color:#a6e22e">region-end</span>))
</span></span><span style="display:flex;"><span>               (pop-mark)
</span></span><span style="display:flex;"><span>               (<span style="color:#a6e22e">insert</span> <span style="color:#e6db74">&#34; = &#34;</span> (calc-eval b))))
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;No active region!&#34;</span>))
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(global-set-key [(f6)] <span style="color:#e6db74">&#39;avs/calc-region</span>)
</span></span></code></pre></div><p>The enhanced function is bound to <code>f6</code>. So now if you press <code>F6</code>,
<code>15@45'20&quot;</code> becomes <code>15.7555555556</code>, and <code>((350.0 / 7) + 48.314)</code>
becomes <code>((350.0 / 7) + 48.314) = 98.314</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Emacs&rsquo; <strong>calc</strong> is great.</p>
<h2 id="next">Next</h2>
<p>As a next step, I want to implement DMS and Decimal degree
conversions to the DD:MM:SS format used by the excellent <a href="https://www.generic-mapping-tools.org/">Generic
Mapping Tools</a> (GMT) toolbox.</p>