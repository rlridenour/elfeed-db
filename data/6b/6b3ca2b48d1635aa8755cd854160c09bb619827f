<p><strong>EDIT - 2024-11-09:</strong> See the <a href="#edits">Edits section</a> further down.</p>
<h2 id="intro">Intro</h2>
<p>In the name of bringing the kitchen sink inside of Emacs, I manage my mails here as well. Mu4e is my choice of a mail client.</p>
<p>As a quite opinionated fellow when it comes to my tools, I tend to change stuff a lot. This includes extending functions and commands that are delivered with Mu4e by default. Or even creating new ones.</p>
<p>Barring changes in Mu4e or related updates, these functions should remain relevant. However some where created a good while ago. Which in turn might result in &ldquo;obsolete&rdquo; code or easier solutions.</p>
<h2 id="commands-and-functions">Commands and Functions</h2>
<h3 id="timu-mu4e-in-new-tab">timu-mu4e-in-new-tab</h3>
<p>I always, I mean ALWAYS open Mu4e in a new tab. This one does it for me with a custom keybinding.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-in-new-tab</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Open </span><span class="ss">`mu4e&#39;</span><span class="s"> in a new tab with </span><span class="ss">`tab-bar-new-tab&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">tab-bar-new-tab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="timu-mu4e-quit">timu-mu4e-quit</h3>
<p>Since I always open Mu4e in a new tab, this function allows me to close the &ldquo;mail-tab&rdquo; upon quitting Mu4e.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-quit</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Quit </span><span class="ss">`mu4e&#39;</span><span class="s"> and close the tab with </span><span class="ss">`tab-bar-close-tab&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e-quit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">tab-bar-close-tab</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="timu-mu4e-execute-no-confirm">timu-mu4e-execute-no-confirm</h3>
<p>Executing marks – moving, deleting, archiving mails and more – in Mu4e (mostly in headers view) happens many many times a day. Having to confirm all of those action would result in me throwing my Mac out of the window after a while. The following function helps execute marks without confirmation.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-execute-no-confirm</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Execute all without confirmation.
</span></span></span><span class="line"><span class="cl"><span class="s">Use the argument NO-COMFIRM in the command </span><span class="ss">`mu4e-mark-execute-all&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">mu4e-mark-execute-all</span> <span class="ss">&#39;no-confirm</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="timu-mu4e-jump-to-maildir">timu-mu4e-jump-to-maildir</h3>
<p>To simplify mailbox navigation, I use <code>completing-read</code> with the command below, bound to <code>J</code>..</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-jump-to-maildir</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Use </span><span class="ss">`completing-read&#39;</span><span class="s"> to jump to a maildir.
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://emacs.stackexchange.com/a/47580/30874
</span></span></span><span class="line"><span class="cl"><span class="s">Credit: https://arupajhana.wordpress.com/2014/09/26/mu4e-with-helm.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">maildir</span> <span class="p">(</span><span class="nf">completing-read</span> <span class="s">&#34;Maildir: &#34;</span> <span class="p">(</span><span class="nv">mu4e-get-maildirs</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e-headers-search</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;maildir:\&#34;%s\&#34;&#34;</span> <span class="nv">maildir</span><span class="p">))))</span>
</span></span></code></pre></div><h3 id="timu-mu4e-attach-file">timu-mu4e-attach-file</h3>
<p>This one helps add attachments to a compose buffer with completion in the minibuffer (<code>read-file-name</code>).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-attach-file</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Attach a file to an email.
</span></span></span><span class="line"><span class="cl"><span class="s">Use the built-in function </span><span class="ss">`mml-attach-file&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">default-directory</span> <span class="s">&#34;~/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">file</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&#34;Select a file to attach: &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">mml-attach-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">file</span><span class="p">)))))</span>
</span></span></code></pre></div><h3 id="timu-mu4e-view-save-attachments">timu-mu4e-view-save-attachments</h3>
<p>The default command for saving attachments, <code>mu4e-view-save-attachments</code> automatically chooses a – in the variable <code>mu4e-attachment-dir</code> – predefined directory. This is fine and dandy, but I mostly want to select the directory my self – on a case-by-case basis.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-view-save-attachments</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Save all attachements in a selected directory.
</span></span></span><span class="line"><span class="cl"><span class="s">This is </span><span class="ss">`mu4e-view-save-attachments&#39;</span><span class="s"> with prefix Argument.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">current-prefix-arg</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">embark-confirm-act-all</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">call-interactively</span> <span class="nf">#&#39;</span><span class="nv">mu4e-view-save-attachments</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="timu-mu4e-get-mail">timu-mu4e-get-mail</h3>
<p>The variable <code>mu4e-get-mail-command</code> defines which CLI command to use to fetch emails with Mu4e. In my case – using the isync program (mbsync) – I want sometimes to only fetch mails per account or all accounts.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-get-mail</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Select the Account before syncing.
</span></span></span><span class="line"><span class="cl"><span class="s">This makes the syncing of mails more flexible.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">mu4e-get-mail-command</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">          <span class="s">&#34;/opt/homebrew/bin/mbsync &#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">completing-read</span>
</span></span><span class="line"><span class="cl">           <span class="s">&#34;Which Account: &#34;</span>
</span></span><span class="line"><span class="cl">           <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;icloud&#34;</span> <span class="s">&#34;aimebertrand&#34;</span> <span class="s">&#34;moclub&#34;</span> <span class="s">&#34;--all&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e-update-mail-and-index</span> <span class="no">t</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="commands-and-functions-to-deal-with-signatures">Commands and functions to deal with signatures</h3>
<p>The following two commands are extensively covered in the previous post &ldquo;<a href="https://macowners.club/posts/signature-above-cited-text-mu4e/">Signature above the cited text in mu4e</a>&rdquo;.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-message-insert-signature</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">force</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Insert a signature at the end of the buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Original command is </span><span class="ss">`message-insert-signature&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">See https://macowners.club/posts/signature-above-cited-text-mu4e/ for reasons.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">See the documentation for the </span><span class="ss">`message-signature&#39;</span><span class="s"> variable for
</span></span></span><span class="line"><span class="cl"><span class="s">more information.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">If FORCE is 0 (or when called interactively), the global values
</span></span></span><span class="line"><span class="cl"><span class="s">of the signature variables will be consulted if the local ones
</span></span></span><span class="line"><span class="cl"><span class="s">are null.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="p">(</span><span class="nf">list</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">message-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">timu-message-signature</span> <span class="nv">timu-message-signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">message-signature-file</span> <span class="nv">message-signature-file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; If called interactively and there&#39;s no signature to insert,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; consult the global values to see whether there&#39;s anything they</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; have to say for themselves.  This can happen when using</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; `gnus-posting-styles&#39;, for instance.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">null</span> <span class="nv">timu-message-signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">null</span> <span class="nv">message-signature-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">eq</span> <span class="nv">force</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">timu-message-signature</span> <span class="p">(</span><span class="nf">default-value</span> <span class="ss">&#39;timu-message-signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nv">message-signature-file</span> <span class="p">(</span><span class="nf">default-value</span> <span class="ss">&#39;message-signature-file</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">signature</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">             <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nf">null</span> <span class="nv">timu-message-signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nf">eq</span> <span class="nv">force</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">re-search-backward</span> <span class="nv">message-signature-separator</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">             <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nf">null</span> <span class="nv">timu-message-signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="nv">force</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">((</span><span class="nf">functionp</span> <span class="nv">timu-message-signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">funcall</span> <span class="nv">timu-message-signature</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">             <span class="p">((</span><span class="nf">listp</span> <span class="nv">timu-message-signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">eval</span> <span class="nv">timu-message-signature</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="no">t</span> <span class="nv">timu-message-signature</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">           <span class="nv">signature-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">signature</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nf">stringp</span> <span class="nv">signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="nv">signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="no">t</span> <span class="nv">signature</span><span class="p">)</span> <span class="nv">message-signature-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nb">setq</span> <span class="nv">signature-file</span>
</span></span><span class="line"><span class="cl">                         <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">message-signature-directory</span>
</span></span><span class="line"><span class="cl">                                  <span class="c1">;; don&#39;t actually use the signature directory</span>
</span></span><span class="line"><span class="cl">                                  <span class="c1">;; if message-signature-file contains a path.</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">file-name-directory</span>
</span></span><span class="line"><span class="cl">                                        <span class="nv">message-signature-file</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">message-signature-file</span>
</span></span><span class="line"><span class="cl">                                               <span class="nv">message-signature-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="nv">message-signature-file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">signature-file</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">when</span> <span class="nv">signature</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; Insert the signature.</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">newline</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="nv">message-signature-insert-empty-line</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">newline</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;...... &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">signature</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">insert-file-contents</span> <span class="nv">signature-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">insert</span> <span class="nv">signature</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)</span> <span class="p">(</span><span class="nv">newline</span><span class="p">))))))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-message-insert-signature-at-point</span> <span class="p">(</span><span class="nv">pmode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Function to insert signature at right point according to PMODE.
</span></span></span><span class="line"><span class="cl"><span class="s">Uses </span><span class="ss">`timu-mu4e-message-insert-signature&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">This is a modified version of </span><span class="ss">`message-insert-signature&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="nv">pmode</span> <span class="p">(</span><span class="nv">message-goto-body</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">message-goto-body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">message-goto-body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">save-restriction</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">narrow-to-region</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">timu-mu4e-message-insert-signature</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">message-goto-body</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="automatically-switching-the-context">Automatically switching the context</h3>
<p>Whenever switching to specific mailbox, I want to be in the right <a href="https://www.djcbsoftware.nl/code/mu/mu4e/Contexts.html">mu4e-context</a>. This is in short a setting set. In my case to mostly identify the correct account.</p>
<p>Based on my current research, there is no built-in solution to automatically switch contexts. I use the following function as a <code>mu4e-headers-found-hook</code> to achieve this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-switch-context</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Switch context of the current maildir.
</span></span></span><span class="line"><span class="cl"><span class="s">Uses </span><span class="ss">`mu4e--search-last-query&#39;</span><span class="s"> and regex to get the context.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">new-context</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">timu-get-mu4e-context</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">new-context</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">mu4e-context-switch</span> <span class="no">t</span> <span class="nv">new-context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">mu4e-context-switch</span> <span class="no">t</span> <span class="s">&#34;icloud&#34;</span><span class="p">))))</span>
</span></span></code></pre></div><p>&hellip; Which in turn uses the following function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-get-mu4e-context</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Extract context from </span><span class="ss">`mu4e--search-last-query&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;/\\(.+?\\)/.*&#34;</span> <span class="nv">mu4e--search-last-query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">match-string</span> <span class="mi">1</span> <span class="nv">mu4e--search-last-query</span><span class="p">)</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>You can find more details in the older post &ldquo;<a href="https://macowners.club/posts/autoswitch-mu4e-context-mailbox/">AutoSwitch Mu4e context depending on mailbox</a>&rdquo;.</p>
<h3 id="timu-mu4e-msmtp-select-account">timu-mu4e-msmtp-select-account</h3>
<p>When sending emails, which use the CLI program <code>msmtp</code> in my configuration, the ‘from’ address should be pre-populated with the correct sender address.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-msmtp-select-account</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Select the right account/context according to the from line.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">message-mail-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let*</span>
</span></span><span class="line"><span class="cl">            <span class="p">((</span><span class="nv">from</span> <span class="p">(</span><span class="nb">save-restriction</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nv">message-narrow-to-headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nv">message-fetch-field</span> <span class="s">&#34;from&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">account</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nf">string-match</span> <span class="nv">timu-personal-icloud-email</span> <span class="nv">from</span><span class="p">)</span> <span class="s">&#34;icloud&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nf">string-match</span> <span class="nv">timu-personal-aimebertrand-email</span> <span class="nv">from</span><span class="p">)</span> <span class="s">&#34;aimebertrand&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nf">string-match</span> <span class="nv">timu-personal-moclub-email</span> <span class="nv">from</span><span class="p">)</span> <span class="s">&#34;moclub&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">message-sendmail-extra-arguments</span> <span class="p">(</span><span class="nf">list</span> <span class="o">&#39;</span><span class="s">&#34;-a&#34;</span> <span class="nv">account</span><span class="p">))))))</span>
</span></span></code></pre></div><h2 id="edits">Edits</h2>
<h3 id="2024-11-09-adding-fixing-a-function-to-save-all-attachments">2024-11-09 - Adding/Fixing a function to save all attachments</h3>
<p>You can find this in the new post <a href="https://macowners.club/posts/update-mu4e-save-attachments-faster/">Mu4e - Update - save attachments faster</a>.</p>
