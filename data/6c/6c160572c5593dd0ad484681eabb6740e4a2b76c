<p>C++ is my primary programming language since &ndash; I can&rsquo;t believe it
myself &ndash; 1991 (yes, it was Turbo C++). As I&rsquo;m going to do almost
everything within Emacs 29.4 now &ndash; no doubt I want to have the C++ IDE in
Emacs, in the same way I&rsquo;m using Emacs as the
<a href="https://olddeuteronomy.github.io/post/python-programming-in-emacs/">Python IDE</a>.</p>
<p>Thankfully, <a href="https://github.com/joaotavora/eglot">eglot</a>, the Emacs <em>client</em> for
the Language Server Protocol (LSP), is now &ndash; since version 29 &ndash; the
part of Emacs. It remains to choose the appropriate LSP.</p>
<h2 id="choosing-a-language-server">Choosing a Language Server</h2>
<p>I&rsquo;ve settled on <a href="https://clangd.llvm.org/">clangd</a>, a powerful LSP for
C++ based on the <a href="https://clang.llvm.org/">Clang</a> C++ compiler. It
provides an impressive set of
<a href="https://clangd.llvm.org/features">features</a> including error checking,
code completion, cross-references, navigation, and others.</p>
<p><code>clangd</code> is the part of the <a href="https://llvm.org/">LLVM</a> project and it can be
downloaded from <a href="https://releases.llvm.org/download.html">LLVM Download Page</a>.
Which version to download?
It depends on OS/version you are using. I&rsquo;m using
Pop!_OS 22.04 (Ubuntu 22.04 fork); after researching, I came upon
<em>clang+llvm-17.0.6-x86_64-linux-gnu-ubuntu-22.04.tar.xz</em>
from <a href="https://github.com/llvm/llvm-project/releases/tag/llvmorg-17.0.6">this repository</a>
that contains pre-build binaries for my OS. It supports C++17 standard
&ndash; that&rsquo;s good enough for me.</p>
<p>I&rsquo;ve unpacked the archive to <code>~/bin/LLVM-17.0.6/</code> then added
<code>$HOME/bin/LLVM-17.0.6/bin</code> to the <code>$PATH</code> envvar.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ clangd --version
</span></span><span style="display:flex;"><span>clangd version 17.0.6 <span style="color:#f92672">(</span>https://github.com/llvm/llvm-project 6009708b4367171ccdbf4b5905cb6a803753fe18<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Features: linux
</span></span><span style="display:flex;"><span>Platform: x86_64-unknown-linux-gnu
</span></span></code></pre></div><h3 id="configuring-clangd">Configuring clangd</h3>
<p>Clangd stores its configuration in YAML files. I&rsquo;m using <em>per-project</em>
configuration file <code>.clangd</code> &ndash; clangd searches for it in all parent
directories of the active file.</p>
<p>Below is my simple and straightforward <code>.clangd</code> for some of my projects.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Enable all warnings, use C++17 standard, specify include directories.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">CompileFlags</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Add</span>: [-<span style="color:#ae81ff">xc++,</span>
</span></span><span style="display:flex;"><span>       -<span style="color:#ae81ff">Wall,</span>
</span></span><span style="display:flex;"><span>       -<span style="color:#ae81ff">std=c++17,</span>
</span></span><span style="display:flex;"><span>       -<span style="color:#ae81ff">I/home/magnolia/workspace/devel,</span>
</span></span><span style="display:flex;"><span>       -<span style="color:#ae81ff">I/home/magnolia/lib/grpc/include,</span>
</span></span><span style="display:flex;"><span>       -<span style="color:#ae81ff">I/home/magnolia/lib/spdlog/include]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Compiler</span>: <span style="color:#ae81ff">clang++ </span> <span style="color:#75715e"># Always use `clang++&#39;</span>
</span></span></code></pre></div><p>It is placed in the <em>top level directory</em> of my project.
You can find more about <code>clangd</code> configuration <a href="https://clangd.llvm.org/config">here</a>.</p>
<p>Now we can return back to the Emacs configuration.</p>
<h2 id="emacs-configuration-for-c">Emacs Configuration for C++</h2>
<h3 id="using-eglot">Using Eglot</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(require <span style="color:#e6db74">&#39;eglot</span>)
</span></span><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;c-mode-hook</span> <span style="color:#e6db74">&#39;eglot-ensure</span>)
</span></span><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;c++-mode-hook</span> <span style="color:#e6db74">&#39;eglot-ensure</span>)
</span></span><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;c-or-c++-mode-hook</span> <span style="color:#e6db74">&#39;eglot-ensure</span>)
</span></span></code></pre></div><p>The Eglot session will start automatically every time you open the C/C++ file in a buffer.
If the Eglot session for the current C/C++ buffer has started successfully
it displays the following message in the Emacs minibuffer:</p>
<pre tabindex="0"><code>[eglot] Connected! Server `clangd&#39; now managing `(c++-mode c-mode)&#39; buffers in project ...
</code></pre><h3 id="visual-improvements">Visual Improvements</h3>
<p>Highlighting symbols and numbers in the source code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; Highlights the word/symbol at point and any other occurrences in</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; view. Also allows to jump to the next or previous occurrence.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; https://github.com/nschum/highlight-symbol.el</span>
</span></span><span style="display:flex;"><span>(use-package highlight-symbol
</span></span><span style="display:flex;"><span>  :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  (setq highlight-symbol-on-navigation-p <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>  (add-hook <span style="color:#e6db74">&#39;prog-mode-hook</span> <span style="color:#e6db74">&#39;highlight-symbol-mode</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; Emacs minor mode that highlights numeric literals in source code.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; https://github.com/Fanael/highlight-numbers</span>
</span></span><span style="display:flex;"><span>(use-package highlight-numbers
</span></span><span style="display:flex;"><span>  :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  (add-hook <span style="color:#e6db74">&#39;prog-mode-hook</span> <span style="color:#e6db74">&#39;highlight-numbers-mode</span>))
</span></span></code></pre></div><h3 id="c-headers">C++ Headers</h3>
<p>Please, treat C headers as C++ ones.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; .h files to open in c++-mode rather than c-mode.</span>
</span></span><span style="display:flex;"><span>(add-to-list <span style="color:#e6db74">&#39;auto-mode-alist</span> <span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;\\.h$&#34;</span> <span style="color:#f92672">.</span> c++-mode))
</span></span></code></pre></div><h3 id="code-styles">Code Styles</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(setq c-default-style <span style="color:#e6db74">&#34;stroustrup&#34;</span>)
</span></span><span style="display:flex;"><span>(setq c-basic-indent <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>(setq c-basic-offset <span style="color:#ae81ff">4</span>)
</span></span></code></pre></div><p>I&rsquo;m using the Stroustrup C++ <a href="https://www.emacswiki.org/emacs/IndentingC">code style</a>
that is very similar to the K&amp;R (Kernighan &amp; Ritchie) code style.</p>
<p>The <code>c-style-alist</code> Elisp variable contains a list of all predefined code
styles. Pick a <a href="https://www.emacswiki.org/emacs/IndentingC">style</a> that suits you.</p>
<h3 id="indentation-inside-of-namespaces">Indentation Inside of Namespaces</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; emacs-fu: donâ€™t indent inside of C++ namespaces</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; http://brrian.tumblr.com/post/9018043954/emacs-fu-dont-indent-inside-of-c-namespaces</span>
</span></span><span style="display:flex;"><span>(c-set-offset <span style="color:#e6db74">&#39;innamespace</span> <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>I prefer to have the code <em>unindented</em> inside of a namespace as shown below,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> tec {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Client</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Client() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get_id</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// ::Client
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// ::tec
</span></span></span></code></pre></div><p>rather than</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> tec {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Client</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        Client() {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get_id</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }; <span style="color:#75715e">// ::Client
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// ::tec
</span></span></span></code></pre></div><h3 id="spaces-vs-tabs">Spaces vs Tabs</h3>
<p>Yes, I&rsquo;m using spaces instead of tabs for indentation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; Spaces instead of tabs when indenting.</span>
</span></span><span style="display:flex;"><span>(setq-default indent-tabs-mode <span style="color:#66d9ef">nil</span>)
</span></span></code></pre></div><h3 id="trailing-tabs-and-spaces">Trailing Tabs and Spaces</h3>
<p>A builtin <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Useless-Whitespace.html">package</a>
that shows/deletes useless trailing tabs and spaces.
You can also use <code>M-x delete-trailing-whitespace</code> to remove all
trailing white-spaces in a buffer interactively.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; http://www.reddit.com/r/emacs/comments/2keh6u/show_tabs_and_trailing_whitespaces_only/</span>
</span></span><span style="display:flex;"><span>(use-package whitespace
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; Commented since there are too many &#39;valid&#39; whitespaces in some modes.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; (setq-default show-trailing-whitespace t)</span>
</span></span><span style="display:flex;"><span>  (setq whitespace-style <span style="color:#f92672">&#39;</span>(face tabs trailing))
</span></span><span style="display:flex;"><span>  (set-face-attribute <span style="color:#e6db74">&#39;whitespace-tab</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>      :background <span style="color:#e6db74">&#34;red&#34;</span>
</span></span><span style="display:flex;"><span>      :foreground <span style="color:#e6db74">&#34;yellow&#34;</span>
</span></span><span style="display:flex;"><span>      :weight <span style="color:#e6db74">&#39;bold</span>)
</span></span><span style="display:flex;"><span>  (add-hook <span style="color:#e6db74">&#39;prog-mode-hook</span> <span style="color:#e6db74">&#39;whitespace-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; Delete trailing tabs and spaces on save of a file.</span>
</span></span><span style="display:flex;"><span>  (add-hook <span style="color:#e6db74">&#39;before-save-hook</span> <span style="color:#e6db74">&#39;whitespace-cleanup</span>)
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="clangd-with-flymake">Clangd with Flymake</h3>
<style type="text/css">
     
    .notice {
        --title-color: #fff;
        --title-background-color: #6be;
        --content-color: #444;
        --content-background-color: #e7f2fa;
    }

    .notice.info {
        --title-background-color: #fb7;
        --content-background-color: #fec;
    }

    .notice.tip {
        --title-background-color: #5a5;
        --content-background-color: #efe;
    }

    .notice.warning {
        --title-background-color: #c33;
        --content-background-color: #fee;
    }

     
    @media (prefers-color-scheme:dark) {
        .notice {
            --title-color: #fff;
            --title-background-color: #069;
            --content-color: #ddd;
            --content-background-color: #023;
        }

        .notice.info {
            --title-background-color: #a50;
            --content-background-color: #420;
        }

        .notice.tip {
            --title-background-color: #363;
            --content-background-color: #121;
        }

        .notice.warning {
            --title-background-color: #800;
            --content-background-color: #400;
        }
    }

    body.dark .notice {
        --title-color: #fff;
        --title-background-color: #069;
        --content-color: #ddd;
        --content-background-color: #023;
    }

    body.dark .notice.info {
        --title-background-color: #a50;
        --content-background-color: #420;
    }

    body.dark .notice.tip {
        --title-background-color: #363;
        --content-background-color: #121;
    }

    body.dark .notice.warning {
        --title-background-color: #800;
        --content-background-color: #400;
    }

     
    .notice {
        padding: 18px;
        line-height: 24px;
        margin-bottom: 24px;
        border-radius: 4px;
        color: var(--content-color);
        background: var(--content-background-color);
    }

    .notice p:last-child {
        margin-bottom: 0
    }

     
    .notice-title {
        margin: -18px -18px 12px;
        padding: 4px 18px;
        border-radius: 4px 4px 0 0;
        font-weight: 700;
        color: var(--title-color);
        background: var(--title-background-color);
    }

     
    .icon-notice {
        display: inline-flex;
        align-self: center;
        margin-right: 8px;
    }

    .icon-notice img,
    .icon-notice svg {
        height: 1em;
        width: 1em;
        fill: currentColor;
    }

    .icon-notice img,
    .icon-notice.baseline svg {
        top: .125em;
        position: relative;
    }
</style><div class="notice info" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="92 59.5 300 300">
  <path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-100c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516 0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516 0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516 0 6.25-2.734 6.25-6.25Zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516 0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516 0 6.25-2.734 6.25-6.25Zm125 81.25c0 82.813-67.188 150-150 150-82.813 0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813 0 150 67.188 150 150Z"/>
</svg>

        </span></p><p>This chapter is identical to the corresponding chapter in my previous post
<a href="https://olddeuteronomy.github.io/post/python-programming-in-emacs/">Python Programming in Emacs</a>.
I put it here for clarity.</p></div>

<p>Flymake is a minor Emacs mode performing on-the-fly syntax checks. I&rsquo;m
using the <code>flymake</code> built-in Emacs package as an Eglot front-end for
syntax checks.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(require <span style="color:#e6db74">&#39;flymake</span>)
</span></span></code></pre></div><p>My custom <code>my/flymake-toggle-diagnostics-buffer</code> function toggles the
<em>Flymake diagnostics</em> buffer window.</p>
<p>If there is the Flymake diagnostics buffer associated with a file in
the current buffer, it shows the diagnostics buffer in the new window
and switches to it. If the current buffer <em>is</em> the Flymake diagnostics
buffer, it closes it. Otherwise it just shows the error message.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun my/flymake-toggle-diagnostics-buffer ()
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; Check if we are in the diagnostics buffer.</span>
</span></span><span style="display:flex;"><span>  (if (string-search <span style="color:#e6db74">&#34;*Flymake diagnostics&#34;</span> (<span style="color:#a6e22e">buffer-name</span>))
</span></span><span style="display:flex;"><span>      (delete-window)
</span></span><span style="display:flex;"><span>    (progn
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">;; Activate the Flymake diagnostics buffer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">;; and switch to it</span>
</span></span><span style="display:flex;"><span>      (flymake-show-buffer-diagnostics)
</span></span><span style="display:flex;"><span>      (let ((name (flymake--diagnostics-buffer-name)))
</span></span><span style="display:flex;"><span>        (if (<span style="color:#a6e22e">get-buffer</span> name)
</span></span><span style="display:flex;"><span>            (switch-to-buffer-other-window name)
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">error</span> <span style="color:#e6db74">&#34;No Flymake diagnostics buffer found&#34;</span>)
</span></span><span style="display:flex;"><span>          )))))
</span></span></code></pre></div><p>I&rsquo;ve bound this function to the <code>F7</code> key globally since I&rsquo;m using <code>F7</code>
in other programming modes as well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(global-set-key [(f7)] <span style="color:#a6e22e">#&#39;</span>my/flymake-toggle-diagnostics-buffer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; Additional bindings.</span>
</span></span><span style="display:flex;"><span>(global-set-key (kbd <span style="color:#e6db74">&#34;C-c f b&#34;</span>) <span style="color:#a6e22e">#&#39;</span>flymake-show-buffer-diagnostics)
</span></span><span style="display:flex;"><span>(global-set-key (kbd <span style="color:#e6db74">&#34;C-c f p&#34;</span>) <span style="color:#a6e22e">#&#39;</span>flymake-show-project-diagnostics)
</span></span></code></pre></div><p>The screenshot below shows what happens if you press <code>F7</code> while
editing a C++ file managed by Eglot + Flymake.</p>
<figure><a href="http://localhost:1313/img/cpp-eglot.png"><img src="http://localhost:1313/img/cpp-eglot.png"/></a><figcaption>
            <h4>Click or tap to view the full-size picture.</h4>
        </figcaption>
</figure>

<h2 id="treemacs">Treemacs</h2>
<p>From looking at the screenshot above, you can see using of
<a href="https://github.com/Alexander-Miller/treemacs">Treemacs</a>, a tree
layout file explorer for Emacs.</p>
<p>I can highly recommend to use it for any project you&rsquo;re working on in
conjunction with the excellent
<a href="https://github.com/bbatsov/projectile">Projectile</a>
and <a href="https://github.com/abo-abo/swiper">Ivy</a> packages.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(use-package ivy
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  (ivy-mode)
</span></span><span style="display:flex;"><span>  (setq ivy-use-virtual-buffers <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>  (add-hook <span style="color:#e6db74">&#39;after-init-hook</span> (lambda () (setq ivy-height (<span style="color:#a6e22e">/</span> (window-height) <span style="color:#ae81ff">2</span>))))
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(use-package projectile
</span></span><span style="display:flex;"><span>  :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  (projectile-global-mode)
</span></span><span style="display:flex;"><span>  (setq projectile-enable-caching <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>  (setq projectile-completion-system <span style="color:#e6db74">&#39;ivy</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(use-package treemacs :ensure <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>(use-package treemacs-projectile :ensure <span style="color:#66d9ef">t</span>)
</span></span></code></pre></div><p>I&rsquo;ve bound Treemacs to <code>F12</code> globally.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(global-set-key [(f12)] <span style="color:#a6e22e">#&#39;</span>treemacs-select-window)
</span></span></code></pre></div><p>Press <code>?</code> when in the Treemacs window to see all commands available.
Press <code>q</code> to close the Treemacs window.</p>
<h2 id="code-completion">Code Completion</h2>
<div class="notice info" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="92 59.5 300 300">
  <path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-100c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516 0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516 0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516 0 6.25-2.734 6.25-6.25Zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516 0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516 0 6.25-2.734 6.25-6.25Zm125 81.25c0 82.813-67.188 150-150 150-82.813 0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813 0 150 67.188 150 150Z"/>
</svg>

        </span></p><p>This chapter is identical to the corresponding chapter in my previous post
<a href="https://olddeuteronomy.github.io/post/python-programming-in-emacs/">Python Programming in Emacs</a>.
I put it here for clarity.</p></div>

<p>I&rsquo;m using the <a href="https://company-mode.github.io/"><code>company</code></a> package, a
modular in-buffer completion framework for Emacs, as an Eglot
front-end for code completion; it integrates with Eglot seamlessly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;;;; `COMPANY&#39;</span>
</span></span><span style="display:flex;"><span>(use-package company
</span></span><span style="display:flex;"><span>  :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  (setq company-idle-delay <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>  (setq company-minimum-prefix-length <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>  (setq company-show-numbers <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; To prevent default down-casing.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; https://emacs.stackexchange.com/questions/10837/how-to-make-company-mode-be-case-sensitive-on-plain-text</span>
</span></span><span style="display:flex;"><span>  (setq company-dabbrev-downcase <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; 2023-01-13 From a Reddit post on mixed case issue.</span>
</span></span><span style="display:flex;"><span>  (setq company-dabbrev-ignore-case <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>  (setq company-dabbrev-code-ignore-case <span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; Use `company&#39; everywhere.</span>
</span></span><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;after-init-hook</span> <span style="color:#e6db74">&#39;global-company-mode</span>)
</span></span></code></pre></div><figure><a href="http://localhost:1313/img/cpp-company2.png"><img src="http://localhost:1313/img/cpp-company2.png"/></a><figcaption>
            <h4>Click or tap to view the full-size picture.</h4>
        </figcaption>
</figure>

<h2 id="code-navigation">Code Navigation</h2>
<p>My favorite tool for code navigation <em>in the current buffer</em> is the
excellent <code>imenu-list</code> <a href="https://github.com/bmag/imenu-list">package</a>.
Powered by Eglot, it shows almost everything you want to see.</p>
<figure><a href="http://localhost:1313/img/cpp-imenu.png"><img src="http://localhost:1313/img/cpp-imenu.png"/></a><figcaption>
            <h4>Click or tap to view the full-size picture.</h4>
        </figcaption>
</figure>

<p>Now your Emacs looks like a full-featured C++ IDE &ndash; and it is, actually.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; Show the current buffer&#39;s imenu entries in a separate buffer</span>
</span></span><span style="display:flex;"><span>(use-package imenu-list
</span></span><span style="display:flex;"><span>  :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  (setq imenu-list-focus-after-activation <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>  (global-set-key (kbd <span style="color:#e6db74">&#34;C-.&#34;</span>) <span style="color:#a6e22e">#&#39;</span>imenu-list-minor-mode)
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>I&rsquo;ve bound <code>imenu-list-minor-mode</code> to <code>C-.</code>; this key chord will
toggle the Imenu buffer on/off.</p>
<p>Alternatively, you can use Treemacs to navigate through the code and files on a
<em>per-project</em> basis.</p>
<figure><a href="http://localhost:1313/img/cpp-treemacs.png"><img src="http://localhost:1313/img/cpp-treemacs.png"/></a><figcaption>
            <h4>Click or tap to view the full-size picture.</h4>
        </figcaption>
</figure>

<p>&ldquo;Classic&rdquo; default navigation keys will also work with all files in
your project.</p>
<dl>
<dt><code>xref-find-definitions</code></dt>
<dd><code>M-.</code> to find the definition of the identifier at point.</dd>
<dt><code>xref-go-back</code></dt>
<dd><code>M-,</code> to return back to where you invoked the <code>xref-find-definitions</code> command.</dd>
<dt><code>xref-find-references</code></dt>
<dd><code>M-?</code> to find references to the identifier at point.</dd>
</dl>
<p>These functions are now powered by Eglot.</p>
<h2 id="appendix-a">Appendix A</h2>
<h3 id="all-the-icons">All the Icons</h3>
<p>As you can see from the screenshots above, I like to see icons
wherever possible &ndash; in <code>treemacs</code>, <code>dired</code>, <code>ibuffer</code>, <code>company</code> and
other modes. To achieve that, all you need is to install the
corresponding packages.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; https://github.com/domtronn/all-the-icons.el</span>
</span></span><span style="display:flex;"><span>(use-package all-the-icons :ensure <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(use-package all-the-icons-dired :ensure <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;dired-mode-hook</span> <span style="color:#e6db74">&#39;all-the-icons-dired-mode</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(use-package all-the-icons-ibuffer :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :init (all-the-icons-ibuffer-mode <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  :hook (ibuffer-mode <span style="color:#f92672">.</span> all-the-icons-ibuffer-mode))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(use-package treemacs-all-the-icons :ensure <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(use-package all-the-icons-ivy :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :after all-the-icons
</span></span><span style="display:flex;"><span>  :config (all-the-icons-ivy-setup))
</span></span></code></pre></div><div class="notice tip" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="300.5 134 300 300">
  <path d="M551.281 252.36c0-3.32-1.172-6.641-3.515-8.985l-17.774-17.578c-2.344-2.344-5.469-3.711-8.789-3.711-3.32 0-6.445 1.367-8.789 3.71l-79.687 79.493-44.141-44.14c-2.344-2.344-5.469-3.712-8.79-3.712-3.32 0-6.444 1.368-8.788 3.711l-17.774 17.579c-2.343 2.343-3.515 5.664-3.515 8.984 0 3.32 1.172 6.445 3.515 8.789l70.704 70.703c2.343 2.344 5.664 3.711 8.789 3.711 3.32 0 6.64-1.367 8.984-3.71l106.055-106.056c2.343-2.343 3.515-5.468 3.515-8.789ZM600.5 284c0 82.813-67.188 150-150 150-82.813 0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813 0 150 67.188 150 150Z"/>
</svg>

        </span></p><p>To install icons font, please follow
these <a href="https://github.com/domtronn/all-the-icons.el#installing-fonts">instructions</a>.</p></div>

<h2 id="appendix-b">Appendix B</h2>
<h3 id="a-note-for-tree-sitter-users">A Note for Tree-Sitter Users</h3>
<div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 128 300 300">
  <path d="M150 128c82.813 0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812 0 278c0-82.813 67.188-150 150-150Zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515 0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32 0 6.055-2.93 6.055-6.445Zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758 0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515 0 6.445-2.148 6.64-4.883Z"/>
</svg>

        </span></p><p><strong>I do not use Tree-Sitter for coding in C++</strong>. It seems it has
its own rules for indentation that break down the code style I prefer.</p></div>

<p>Happy emacsing!</p>
<p>&ndash; The Emacs Cat.</p>
<p><em>P.S.</em> Emacs 30.1 has been released on February 23. Thanks for everyone
involved with this great project!</p>
<p><em>P.P.S.</em> Mickey Petersen has published his excellent
<a href="https://www.masteringemacs.org/article/whats-new-in-emacs-301">review</a>
on what&rsquo;s new in this release.</p>