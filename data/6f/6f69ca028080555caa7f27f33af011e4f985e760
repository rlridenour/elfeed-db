<p>
I have been using the <a href="https://www.gsmarena.com/motorola_defy_(2021)-10969.php">Motorola Defy (2021)</a> smartphone for almost 3
years. There is one of the rugged phones that has an <a href="https://en.wikipedia.org/wiki/IP_code#Code_breakdown">IP68</a> and a decent
thicknessÂ â€” it fits perfectly in my pocket. It looks like a normal phone in
the case, but there is no caseÂ â€” there is a phone body.
</p>

<p>
I've "tested" this rugged phone a lot:
</p>
<ul class="org-ul">
<li>I dropped it on its side on the tiled floor and on the asphalt pavement.</li>
<li>I used the phone in the rain and in high humidity environment.</li>
<li>Dropped it display side down on the tiled floor.</li>
<li>Dropped it display side down onto a pond on the asphalt road.</li>
</ul>

<p>
Nevertheless, the only injury of the phoneÂ â€” a small dent on the corner where
I dropped it when I got out of the car.
</p>

<p>
Unfortunately, I can't say the same for the phone's software. There are the
unnecessary for me (and undeletable) weather forecast application from
Motorola and a full set of undeletable applications from Google. These
applications are unsuitable for me, or I can't even use themÂ â€” because the
corresponding services aren't available in Russia (for example, Google Pay
app).
</p>

<p>
Also, after I signed in to my Google account, Google Play went crazy and
started installing a lot of Russian applications that are unnecessary for me:
Gosuslugi, VK, Odnoklassniki, almost all Yandex apps, MirPay and something
from the Sberbank. Fortunately, these applications were installed as usual
applications and I was able to delete them.
</p>

<p>
Most of the time I used FOSS applications from F-Droid and never felt a
grief. But, as it usually happens, after another update from Google, I got
problems. Sometimes, when I'm was installing or updating the application from
F-Droid, the OS shows me the next "warning" window for me (it comes from
Google "Safety" Net):
</p>


<div class="figure">
<p><img src="/assets/static/google_play_protect.png" alt="Google safety warning than installing applications from F-Droid" align="center" width="25%" />
</p>
</div>

<p>
As a result, I get rid of such "caring" behavior from Google. In addition, I
want to remove some pre-installed applications and take the ability to install
applications from F-Droid with one button and no dialog: "Do you really want
to install this application from unknown source?"
</p>

<p>
I knew, what I can get all I want from the some opensource Android
distribution. The most important thing for meÂ â€” this distribution should
support the phones hardware and allow root access. Since my phone is not so
popular among the hackersÂ â€” there is no support from <a href="https://grapheneos.org/">GrapheneOS</a>, <a href="https://postmarketos.org/">postmarketOS</a>
or the same operating systems.
</p>

<p>
Fortunately, I found some posts on the XDA Developers forum, <a href="https://xdaforums.com/f/motorola-defy-2021.12369/">in the topic</a>
about Motorola Defy (2021).
</p>
<div class="outline-2">
<h2>TOC&#xa0;&#xa0;&#xa0;<span class="tag"></span></h2>
<div class="outline-text-2">
<ul class="org-ul">
<li><a href="#preparations">Preparations before flashing the phone's memory</a></li>
<li><a href="#bootloader-unlock">Bootloader unlock</a></li>
<li><a href="#system-software-reflash">Rewriting the system software</a></li>
<li><a href="#lineage-os-install">Lineage OS install</a></li>
<li><a href="#android-root">Root user access</a></li>
<li><a href="#4g-calls-sms">4G calls and SMS</a></li>
<li><a href="#disable-floating-shit-on-copy">Disabling nonsensical popup when copying text</a></li>
<li><a href="#turn-off-usb-debugging">Turn off USB debugging</a></li>
<li><a href="#root-apps">Applications with root access</a>
<ul class="org-ul">
<li><a href="#appstores">Application stores</a></li>
<li><a href="#firewall">Firewall (AFWall+)</a></li>
<li><a href="#adblocker">System-wide ad blocker (AdAway)</a></li>
<li><a href="#acca">AccAÂ â€” to control accumulator (dis)charging</a></li>
<li><a href="#colorblendr">System theme color change (ColorBlendr)</a></li>
<li><a href="#sdmaid2se">System cleaner (SD Maid 2/SE)</a></li>
</ul></li>
<li><a href="#backups">Backups</a>
<ul class="org-ul">
<li><a href="#neobackup">Neo Backup</a></li>
<li><a href="#flash-memory-backup">Flash memory backup</a></li>
</ul></li>
<li><a href="#bugs">BUGS</a></li>
<li><a href="#notes">Notes</a></li>
</ul>
</div>
</div>
<div id="outline-container-preparations" class="outline-2">
<h2 id="preparations">Preparations before flashing the phone's memory</h2>
<div class="outline-text-2" id="text-preparations">
<p>
First, I made a list of all the necessary applications, installed on my
phone. Then I made a backup of all the valuable dataÂ â€” fortunately, almost all
FOSS applications allow me to backup user data and settings.
</p>

<p>
Also, just in case, I wrote down my IMEIÂ â€” I didn't need it afterwards, but
this note saved me a lot of nerve cells.
</p>

<p>
To flash the phone's flash memory I only needed two utilities:
</p>
<ol class="org-ol">
<li><a href="https://developer.android.com/tools/adb">adb</a> (<code>dev-util/android-tools</code> for Gentoo)Â â€” it is needed to access the
settings, hidden from users. And to reboot the phone not in Android, but in
various service programs that are also stored in the phone's flash memory.</li>
<li><a href="https://en.wikipedia.org/wiki/Fastboot">fastboot</a> (in the Gentoo it is installed with the same package)Â â€” it is
necessary to write binary files to the phone's flash memory.</li>
</ol>

<p>
To successfully complete the next steps, I've double-checked the phone model
code and the localization code in the phone settings. <b>NB!</b> All actions were
performed for the phone with model code XT2083-9 and with localization code
RETEU!
</p>
</div>
</div>
<div id="outline-container-bootloader-unlock" class="outline-2">
<h2 id="bootloader-unlock">Bootloader unlock</h2>
<div class="outline-text-2" id="text-bootloader-unlock">
<p>
Factory new Android smartphones shipped with a locked bootloaderÂ â€” it
prohibits to write to some areas of the flash memory (usually there are areas
with OS and the bootloader itself). From the one side, this is a useful thing,
because anyone with a physical access to your phone simply can't write
anything into the corresponding flash regions. From another side, this thing
forbids me to do whatever I want with the phone, as its full owner.
</p>

<p>
To install Lineage OS I had to unlock the bootloader to be able to write the
necessary files to the flash memory. The main steps are described here:
<a href="https://source.android.com/docs/core/architecture/bootloader/locking_unlocking">https://source.android.com/docs/core/architecture/bootloader/locking_unlocking</a>.
</p>

<p>
First, I need to get access to "Developer Options" in the Settings. Here the
everything as usualÂ â€” I just opened "Systemâ‡’About Phone" and after a few taps
on the Android version menu itemÂ â€” I've got the necessary access. After, I
enabled "USB debugging" via "Systemâ‡’Advancedâ‡’Developer options" submenu. Then
I rebooted the phone to the bootloader UI with the next steps:
</p>

<ol class="org-ol">
<li>I connected the phone to the PC using USB cable with data lanes in it.</li>
<li>I pressed "USB Preferences" in the notification bar and selected "Use USB
for: PTP".</li>
<li>Then, in the window that popped up, I allowed "debug connection to the PC".</li>
<li><p>
Then, I checked that <code>adb</code> can see the connected phone:
</p>
<pre class="example">
% adb devices
List of devices attached
ZY32DG32K2      device
</pre></li>
<li>Finally, I reboot the phone with the command: <code>adb reboot bootloader</code>.</li>
</ol>

<p>
As a result, the phone screen shows the next interface:
</p>


<div class="figure">
<p><img src="/assets/static/bootloader.jpg" alt="Motorola Defy (2021) in the bootloader mode" align="center" />
</p>
<p class="fignum"><i>Motorola Defy (2021), booted in the bootloader</i></p>
</div>

<p>
Then, it's time for the <code>fastboot</code>. In my case this utility didn't see the
connected phone, but after I changed the permissions for <code>/dev/bus/usb/001/018</code>,
the <code>fastboot</code> started to see the phone:
</p>

<pre class="example">
% fastboot devices -l
% lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 003: ID 046d:c24e Logitech, Inc. G500s Laser Gaming Mouse
Bus 001 Device 018: ID 22b8:2e80 Motorola PCS Fastboot bathena S
% ls -l /dev/bus/usb/001/
total 0
crw-rw-r-- 1 root usb     189,  0 Dec 31 00:09 001
crw-rw-r-- 1 root usb     189,  1 Dec 31 00:09 002
crw-rw-r-- 1 root usb     189,  2 Dec 31 00:09 003
crw-rw---- 1 root android 189, 17 Dec 31 17:28 018
% sudo chown -R drag0n:drag0n /dev/bus/usb/001/018
% fastboot devices
ZY32DG32K2       fastboot
</pre>

<p>
To prevent inexperienced users from unlocking the bootloader out of ignorance
and get a less secure phone. And to prevent experienced users from doing
anything what they want with their phonesÂ â€” different phone manufacturers
require extra steps to unlock the bootloader. In my case, the <code>fastboot</code> asked
me for an "unlock code":
</p>

<pre class="example">
% fastboot flashing unlock
(bootloader) usage: fastboot oem unlock &lt; unlock code &gt;
FAILED (remote: '')
fastboot: error: Command failed
% fastboot flashing get_unlock_ability
(bootloader) use "oem get_unlock_data" and web portal
(bootloader)     http://motorola.com/unlockbootloader
OKAY [  0.001s]
Finished. Total time: 0.001s
% fastboot oem get_unlock_data
(bootloader) Unlock data:
(bootloader) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
(bootloader) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
(bootloader) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
(bootloader) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
(bootloader) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
OKAY [  0.017s]
Finished. Total time: 0.017s
</pre>

<p>
Fortunately, the Motorola has not invented some kind of Torment Nexus in this
case and just use a special form on their site. This form accepts some kind of
"unlock data" and sends an "unlock code" to the email. This unlock code is
unique for each phone.
</p>

<p>
Unfortunately, the link from <code>get_unlock_ability</code> returns 404 (as
usual). However after some searching on the Internet, I managed to find the
necessary form on the American version of the Motorola site:
<a href="https://en-us.support.motorola.com/app/standalone/bootloader/unlock-your-device-a">https://en-us.support.motorola.com/app/standalone/bootloader/unlock-your-device-a</a>. And
through this form I was able to receive an email with the unlock code.
</p>

<p>
After that I simply unlocked the bootloader with command:
</p>

<pre class="example">
% fastboot oem unlock â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
(bootloader) Bootloader is unlocked!
OKAY [ 22.503s]
Finished. Total time: 22.503s
</pre>
</div>
</div>
<div id="outline-container-system-software-reflash" class="outline-2">
<h2 id="system-software-reflash">Rewriting the system software</h2>
<div class="outline-text-2" id="text-system-software-reflash">
<p>
First, I need to download an archive containing "factory" dumps of some flash
memory regions for the phoneÂ â€” according to instruction on installing Lineage
OS from the XDA forum. And then install them.
</p>

<p>
As I think, this is necessary to have the same <code>boot.img</code> both on the hard disk
and in the phone. This file is needed to get the root access on the phone.
</p>

<p>
Based <a href="https://xdaforums.com/t/flash-stock-rom-via-fastboot.4524845/">on this post</a>, I found <a href="https://www.getdroidtips.com/motorola-defy-2021-stock-firmware/">a link</a> to the mirror, suitable for my phone model
(XT2083-9, build number RZD31.31). Inside this server is the archive
<code>XT2083-9_BATHENA_RETEU_11_RZD31.31_subsidy-DEFAULT_regulatory-XT2083-9-EUROPE-SAR_CFC.xml.zip</code>
from the path <code>/firmware/lenomola/2021/bathena/official/RETEU/</code>:
</p>

<pre class="example">
% unzip XT2083-9_BATHENA_RETEU_11_RZD31.31_subsidy-DEFAULT_regulatory-XT2083-9-EUROPE-SAR_CFC.xml.zip
Archive:  XT2083-9_BATHENA_RETEU_11_RZD31.31_subsidy-DEFAULT_regulatory-XT2083-9-EUROPE-SAR_CFC.xml.zip
inflating: recovery.img
inflating: gpt.bin
inflating: boot.img
inflating: dspso.bin
inflating: BTFM.bin
inflating: vbmeta.img
inflating: radio.img
inflating: dtbo.img
inflating: logo.bin
inflating: bootloader.img
inflating: super.img_sparsechunk.0
inflating: super.img_sparsechunk.1
inflating: super.img_sparsechunk.2
inflating: super.img_sparsechunk.3
inflating: super.img_sparsechunk.4
inflating: super.img_sparsechunk.5
inflating: super.img_sparsechunk.6
inflating: super.img_sparsechunk.7
inflating: super.img_sparsechunk.8
inflating: flashfile.xml
inflating: servicefile.xml
extracting: slcf_rev_d_default_v1.0.nvm
inflating: regulatory_info_xt2083_9_europe_sar.png
inflating: signing-info.txt
inflating: BATHENA_RETAIL_RZD31.31_subsidy-DEFAULT_regulatory-XT2083-9-EUROPE-SAR_CFC.info.txt
</pre>

<p>
Phone's flash memory is divided into mutliple regions and some of them are
unique for different phone models. At least on my Motorola Defy (2021) I can
see the complete list of regions by rebooting the phone to the bootloader and
running the command <code>fastboot oem partition</code>:
</p>

<pre class="example">
~ % fastboot oem partition
(bootloader) xbl_a: offset=65536KB, size=5120KB
(bootloader) xbl_b: offset=70656KB, size=5120KB
(bootloader) xbl_config_a: offset=75776KB, size=128KB
(bootloader) xbl_config_b: offset=75904KB, size=128KB
(bootloader) tz_a: offset=76032KB, size=4096KB
(bootloader) tz_b: offset=80128KB, size=4096KB
(bootloader) rpm_a: offset=84224KB, size=512KB
(bootloader) rpm_b: offset=131072KB, size=512KB
(bootloader) hyp_a: offset=196608KB, size=512KB
(bootloader) hyp_b: offset=197120KB, size=512KB
(bootloader) cmnlib_a: offset=197632KB, size=512KB
(bootloader) cmnlib_b: offset=198144KB, size=512KB
(bootloader) cmnlib64_a: offset=198656KB, size=512KB
(bootloader) cmnlib64_b: offset=199168KB, size=512KB
(bootloader) keymaster_a: offset=199680KB, size=512KB
(bootloader) keymaster_b: offset=200192KB, size=512KB
(bootloader) prov_a: offset=200704KB, size=256KB
(bootloader) prov_b: offset=200960KB, size=256KB
(bootloader) abl_a: offset=201216KB, size=1024KB
(bootloader) abl_b: offset=202240KB, size=1024KB
(bootloader) uefisecapp_a: offset=203264KB, size=2048KB
(bootloader) uefisecapp_b: offset=205312KB, size=2048KB
(bootloader) devcfg_a: offset=207360KB, size=128KB
(bootloader) devcfg_b: offset=207488KB, size=128KB
(bootloader) qupfw_a: offset=207616KB, size=80KB
(bootloader) qupfw_b: offset=207696KB, size=80KB
(bootloader) storsec_a: offset=207776KB, size=128KB
(bootloader) storsec_b: offset=207904KB, size=128KB
(bootloader) ddr: offset=208032KB, size=1024KB
(bootloader) modem_a: offset=209056KB, size=184320KB
(bootloader) modem_b: offset=393376KB, size=184320KB
(bootloader) bluetooth_a: offset=577696KB, size=1024KB
(bootloader) bluetooth_b: offset=578720KB, size=1024KB
(bootloader) dsp_a: offset=579744KB, size=65536KB
(bootloader) dsp_b: offset=645280KB, size=65536KB
(bootloader) boot_a: offset=710816KB, size=98304KB
(bootloader) boot_b: offset=809120KB, size=98304KB
(bootloader) dtbo_a: offset=907424KB, size=24576KB
(bootloader) dtbo_b: offset=932000KB, size=24576KB
(bootloader) recovery_a: offset=983040KB, size=102400KB
(bootloader) recovery_b: offset=1085440KB, size=102400KB
(bootloader) ssd: offset=1245184KB, size=8KB
(bootloader) utags: offset=1310720KB, size=512KB
(bootloader) utagsBackup: offset=1311232KB, size=512KB
(bootloader) kpan: offset=1311744KB, size=8192KB
(bootloader) dhob: offset=1319936KB, size=32KB
(bootloader) msadp: offset=1376256KB, size=256KB
(bootloader) persist: offset=1441792KB, size=32768KB
(bootloader) prodpersist: offset=1474560KB, size=8192KB
(bootloader) metadata: offset=1482752KB, size=16384KB
(bootloader) misc: offset=1499136KB, size=1024KB
(bootloader) frp: offset=1500160KB, size=512KB
(bootloader) cid: offset=1507328KB, size=128KB
(bootloader) logo_a: offset=1507456KB, size=16384KB
(bootloader) logo_b: offset=1523840KB, size=16384KB
(bootloader) carrier: offset=1572864KB, size=16384KB
(bootloader) devinfo: offset=1638400KB, size=4KB
(bootloader) apdp: offset=1638404KB, size=256KB
(bootloader) spunvm: offset=1703936KB, size=8192KB
(bootloader) logfs: offset=1769472KB, size=8192KB
(bootloader) vbmeta_a: offset=1777664KB, size=64KB
(bootloader) vbmeta_b: offset=1777728KB, size=64KB
(bootloader) vbmeta_system_a: offset=1777792KB, size=64KB
(bootloader) vbmeta_system_b: offset=1777856KB, size=64KB
(bootloader) limits: offset=1777920KB, size=4KB
(bootloader) uefivarstore: offset=1777924KB, size=512KB
(bootloader) modemst1: offset=1835008KB, size=2560KB
(bootloader) modemst2: offset=1837568KB, size=2560KB
(bootloader) fsg_a: offset=1840128KB, size=65536KB
(bootloader) fsg_b: offset=1905664KB, size=65536KB
(bootloader) fsc: offset=1971200KB, size=128KB
(bootloader) hw: offset=2031616KB, size=8192KB
(bootloader) sp: offset=2097152KB, size=8192KB
(bootloader) padA: offset=2105344KB, size=640KB
(bootloader) super: offset=2105984KB, size=11631616KB
(bootloader) padB: offset=13737600KB, size=384KB
(bootloader) userdata: offset=13737984KB, size=47333359KB
(bootloader) system_a: offset=2105984KB, size=2376024KB
(bootloader) system_b: offset=2105984KB, size=165052KB
(bootloader) vendor_a: offset=2105984KB, size=585820KB
(bootloader) vendor_b: offset=2105984KB, size=0KB
(bootloader) product_b: offset=2105984KB, size=0KB
(bootloader) product_a: offset=2105984KB, size=4KB
OKAY [  0.015s]
Finished. Total time: 0.015s
</pre>

<p>
Fortunately, I don't need to rewrite all of these partitions. First, because
<a href="https://source.android.com/docs/core/ota/virtual_ab">A/B-partitions</a> is used on the device, there are a lot of partitions in the
output of the above command repeated two times: with <code>_a</code> suffix and with <code>_b</code>
suffix. To install Lineage OS, I only need to use partitions with the <code>_a</code>
suffix, according to the instructions.
</p>

<p>
Second, I only need to use the following partitions, according to the list of
files from the archive:
</p>

<table border="2" cellspacing="0" cellpadding="6" frame="void">
<caption class="t-above"><span class="table-number">Table 1:</span> Description of partitions, there to write dumps to</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Partition</th>
<th scope="col" class="org-left">Binary file from archive</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">gpt.bin</td>
<td class="org-left">General Partition Table (GPT).</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">bootloader.img</td>
<td class="org-left">Splitted to the few files, which is described below.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">radio.img</td>
<td class="org-left">The same.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">bluetooth_a</td>
<td class="org-left">BTFM.bin</td>
<td class="org-left">Binary blob with Bluetooth firmware.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">dsp_a</td>
<td class="org-left">dspso.bin</td>
<td class="org-left">Binary blob with graphical accelerator firmware.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">logo_a</td>
<td class="org-left">logo.bin</td>
<td class="org-left">Boot logo.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">boot_a</td>
<td class="org-left">boot.img</td>
<td class="org-left">The main Linux kernel, ramdisk and other files necessary to boot the system.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">recovery_a</td>
<td class="org-left">recovery.img</td>
<td class="org-left">The additional Linux kernel plus other necessary files. It is used in system updates, on factory resets, etc.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">dbto_a</td>
<td class="org-left">dtbo.img</td>
<td class="org-left">Device Tree Blobs OverlayÂ â€” device descriptions for Linux kernel<sup><a id="fnr.device_tree" class="footref" href="#fn.device_tree" role="doc-backlink">1</a></sup>.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">vbmeta_a</td>
<td class="org-left">vbmeta.img</td>
<td class="org-left">Information to check the authenticity of the some partitions, before they will be loaded to the memory.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.0</td>
<td class="org-left">This and the next 8 files will be written to the area with dynamic partitions. I don't found any information about contents of these partitions. Additional information is <a href="https://source.android.com/docs/core/ota/dynamic_partitions/implement">here</a>.</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.1</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.3</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.5</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.6</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.7</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">super</td>
<td class="org-left">super.img_sparsechunk.8</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">userdata</td>
<td class="org-left">/dev/null</td>
<td class="org-left">Partition with user data and applications. Should be cleared according to the instruction.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">ddr</td>
<td class="org-left">/dev/null</td>
<td class="org-left">Looks like the device RAM will be mapped here. Should be cleared according to the instruction.</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" frame="void">
<caption class="t-above"><span class="table-number">Table 2:</span> bootloader.img files and corresponding partitions description</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Partition</th>
<th scope="col" class="org-left">Binary file</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">keymaster</td>
<td class="org-left">keymaster.mbn</td>
<td class="org-left">Some data for Qualcomm Secure (Verified) Boot.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">hyp</td>
<td class="org-left">hyp.mbn</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Hypervisor">Hypervisor</a> from Qualcomm. The Linux is running under this hypervisor.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">tz</td>
<td class="org-left">tz.mbn</td>
<td class="org-left"><a href="https://research.checkpoint.com/2019/the-road-to-qualcomm-trustzone-apps-fuzzing/">TrustZone</a> firmware.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">devcfg</td>
<td class="org-left">devcfg.mbn</td>
<td class="org-left">Not found any information about this partition.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">storsec</td>
<td class="org-left">storsec.mbn</td>
<td class="org-left">Not found any information about this partition.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">prov</td>
<td class="org-left">prov64.mbn</td>
<td class="org-left">Not found any information about this partition.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">rpm</td>
<td class="org-left">rpm.mbn</td>
<td class="org-left">Resource Power ManagementÂ â€” blob with firmware to control modem's power.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">abl</td>
<td class="org-left">abl.elf</td>
<td class="org-left">Android BootLoaderÂ â€” second stage loader to verify and load Android or recovery.img contents.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">uefisecapp</td>
<td class="org-left">uefi_sec.mbn</td>
<td class="org-left">Not found any information about this partition.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">qupfw</td>
<td class="org-left">qupfw.elf</td>
<td class="org-left">Not found any information about this binary file.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">xbl_config</td>
<td class="org-left">xbl_config.elf</td>
<td class="org-left">Looks like there is something like HAL for the bootloader<sup><a id="fnr.xbl" class="footref" href="#fn.xbl" role="doc-backlink">2</a></sup>.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">xbl</td>
<td class="org-left">xbl.elf</td>
<td class="org-left">Described above.</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" frame="void">
<caption class="t-above"><span class="table-number">Table 3:</span> radio.img files and corresponding partitions description</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Partition</th>
<th scope="col" class="org-left">Biinary file</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">modem</td>
<td class="org-left">NON-HLOS.bin</td>
<td class="org-left">Blog with regional settings/frequences for the radio module.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">fsg</td>
<td class="org-left">fsg.mbn</td>
<td class="org-left">Modem File System Golden copy. Contains firmware blob for the modem, calibration data and IMEI. Rewrite necessity is unknown<sup><a id="fnr.fsg" class="footref" href="#fn.fsg" role="doc-backlink">3</a></sup>.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">modemst1</td>
<td class="org-left">/dev/null</td>
<td class="org-left">Will be cleared while writing radio.img. Here will be saved fsg contents after first launch of the system.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">modemst2</td>
<td class="org-left">/dev/null</td>
<td class="org-left">modemst1 backup. Also will be cleared during radio.img flashing.</td>
</tr>
</tbody>
</table>

<p>
The next steps were simple:
</p>
<ol class="org-ol">
<li>I rebooted the phone into bootloader again using <code>adb</code> as I described above.</li>
<li><p>
Then I wrote the unpacked binaries to the phone with the next commands:
</p>
<pre class="example">
fastboot flash partition gpt.bin
fastboot flash bootloader bootloader.img
fastboot reboot-bootloader
fastboot flash radio radio.img
fastboot reboot-bootloader
fastboot flash bluetooth BTFM.bin
fastboot flash dsp dspso.bin
fastboot flash logo logo.bin
fastboot flash boot boot.img
fastboot flash recovery recovery.img
fastboot flash dtbo dtbo.img
fastboot flash vbmeta vbmeta.img
fastboot flash super super.img_sparsechunk.0
fastboot flash super super.img_sparsechunk.1
fastboot flash super super.img_sparsechunk.2
fastboot flash super super.img_sparsechunk.3
fastboot flash super super.img_sparsechunk.4
fastboot flash super super.img_sparsechunk.5
fastboot flash super super.img_sparsechunk.6
fastboot flash super super.img_sparsechunk.7
fastboot flash super super.img_sparsechunk.8
fastboot erase userdata
fastboot erase ddr
fastboot oem fb_mode_clear
fastboot reboot
</pre></li>
</ol>

<p>
My log of this process <a href="/assets/static/bathena-flash.txt">is here</a>.
</p>

<p>
After this operation, I got a stock Android from Motorola, without any user
programs or settings.
</p>
</div>
</div>
<div id="outline-container-lineage-os-install" class="outline-2">
<h2 id="lineage-os-install">Lineage OS install</h2>
<div class="outline-text-2" id="text-lineage-os-install">
<p>
To install Lineage OS I used <a href="https://xdaforums.com/t/flash-gsi-rom-arm64-ab.4524895/#post-88309263">this comment</a> from the XDA forumÂ â€” here the user
HUN_Gyuszi wrote about the successful installation of LineageOS 20.0 with
Google apps and without root on the Motorola Defy phone.
</p>

<p>
I found the newer builds of LineageOS <a href="https://sourceforge.net/projects/andyyan-gsi/files/">in the repository</a> from that
comment. There were LineageOSÂ 21.0 builds that I obviously wanted to
install. But it wasn't that simple and I did some checking:
</p>
<ul class="org-ul">
<li>I don't want to use a build with Google apps installed
(<code>bgN</code><sup><a id="fnr.gsi_naming_conventions" class="footref" href="#fn.gsi_naming_conventions" role="doc-backlink">4</a></sup> code). But I installed it for testing and it
started and worked fine.</li>
<li><p>
Then I tried to use build without Google apps and with root access (<code>bvS</code>). I
have root access, but I've "lost" the IMEIÂ â€” the OS used the zero IMEI
instead of the valid one. As a result, the phone couldn't connect to the
cellular network.
</p>

<p>
Luckily, I saved my original IMEI. Unfortunately, it wasn't so easy to
forcibly set my IMEI in Android working on the Qualcomm Snapdragon
chipset. And I wasn't able to set my IMEI back. After that, I've checked the
"Barcodes" menu on the bootloader and found what my original IMEI still
stored somewhere in the phone.
</p>

<p>
Just to be sure, I reflashed the binaries from the <a href="#system-software-reflash">"Rewriting the system software"</a> section and found that in stock
Android my original IMEI is still visible.
</p>

<p>
Looks like there is a bug in the <code>bvS</code> build that prevents the IMEI from being
read from the right place.
</p></li>
<li>Finally, I've tested the build without Google apps and without root access
(<code>bvN</code> code). There were no problems and I'm using this build.</li>
</ul>

<p>
The installation process itself is simple:
</p>
<ol class="org-ol">
<li>As I wrote before, after reflashing all the system software my phone has
old stock Android. And I should get access the "Developer options", enable
USB debugging and reboot the phone with the command <code>adb reboot fastboot</code>
again.</li>
<li><p>
After rebooting the phone screen looks like this:
</p>

<div class="figure">
<p><img src="/assets/static/fastbootd.jpg" alt="Phone rebooted to fastbootd" align="center" />
</p>
</div></li>
<li><p>
And now I could to flash the downloaded LineageOS image:
</p>
<pre class="example">
motorola_defy/LineageOS % fastboot flash system lineage-21.0-20241118-UNOFFICIAL-arm64_bvN.img
</pre>

<p>
The successfull log of operation <a href="/assets/static/lineage-os-flash.txt">is here</a>.
</p></li>
<li><p>
<i>In my case</i> the flashing process failed with the next error:
</p>
<pre class="example">
motorola_defy/LineageOS % fastboot flash system lineage-21.0-20241118-UNOFFICIAL-arm64_bvN.img
Resizing 'system_a'                                FAILED (remote: 'Not enough space to resize partition')
fastboot: error: Command failed
</pre>

<p>
The <code>system_a</code> partition with 2.3Â Gb size is not enough for LineageOS. I
found the solution on the XDAÂ ForumÂ â€” I should delete the <code>product_a</code>
partition, resize the <code>system_a</code> partition up to 4.2Â Gb and create a new
<code>product_a</code> partition with 1Â byte size:
</p>
<pre class="example">
motorola_defy/LineageOS % fastboot set_active a
Setting current slot to 'a'                        OKAY [  0.139s]
Finished. Total time: 0.140s
motorola_defy/LineageOS % fastboot delete-logical-partition product_a
Deleting 'product_a'                               OKAY [  0.045s]
Finished. Total time: 0.045s
motorola_defy/LineageOS % fastboot resize-logical-partition system_a 4200000000
Resizing 'system_a'                                OKAY [  0.006s]
Finished. Total time: 0.049s
motorola_defy/LineageOS % fastboot create-logical-partition product_a 1
Creating 'product_a'                               OKAY [  0.045s]
Finished. Total time: 0.045s
</pre>

<p>
The <code>product_a</code> partition <a href="https://source.android.com/docs/core/architecture/partitions/product-partitions">is used by the stock Android OS</a> to store various
vendor specific things. The LineageOS doesn't use this partition, so I
resized it to one byte.
</p></li>
<li><p>
According to the forum instructions, I should to clear partitions
containing user data after the system installation:
</p>
<pre class="example">
motorola_defy/LineageOS % fastboot -w
Erasing 'userdata'                                 OKAY [  0.511s]
Erase successful, but not automatically formatting.
File system type raw not supported.
wipe task partition not found: cache
Erasing 'metadata'                                 OKAY [  0.007s]
Erase successful, but not automatically formatting.
File system type raw not supported.
Finished. Total time: 0.527s
</pre></li>
<li>Finally, I selected the menu item "Reboot system now", pressed the power
button and rebooted to my LineageOS.</li>
</ol>
</div>
</div>
<div id="outline-container-android-root" class="outline-2">
<h2 id="android-root">Root user access</h2>
<div class="outline-text-2" id="text-android-root">
<p>
This was easyÂ â€” I just use the well-known <a href="https://topjohnwu.github.io/Magisk/">Magisk project</a>, which replaces the
standard Linux <code>init</code> with it's own <code>magiskinit</code>. Users can get root-access on the
phone by communicating with this <code>magiskinit</code>.
</p>

<p>
Installing Magisk and getting the <code>root</code> access is extremely easy. I just follow
<a href="https://topjohnwu.github.io/Magisk/install.html">the instructions</a> and use the previously saved <code>boot_a</code> partition dump (the
<code>boot.img</code> file).
</p>

<p>
After installation, I hide Magisk from the other applications on the
system. Also, I forbid access to <code>root</code> privileges for <b>all applications</b> on the
phone. Except for some favorite apps, which I write about below.
</p>


<div class="figure">
<p><img src="/assets/static/magisk.png" alt="Magisk settings for hiding itself: Zygisk and DenyList" align="center" width="50%" />
</p>
<p class="fignum"><i>Magisk settings to hide itself from the other applications</i></p>
</div>
</div>
</div>
<div id="outline-container-4g-calls-sms" class="outline-2">
<h2 id="4g-calls-sms">4G calls and SMS</h2>
<div class="outline-text-2" id="text-4g-calls-sms">
<p>
After some time I noticed the strange behaviour of the phone. When I connect
to the mobile network via 4G instead of 3G, the phone stops receiving any SMS
and calls.
</p>

<p>
As I found out, the next things are happened. Before 4G, the calls were made
the "old-fashioned way"Â â€” the phone connects to the base station through the
radio and through the some telephone exchanges connects to the other caller's
phone. That is, with the same principle that were usual landline phones usedÂ â€”
when two callers were connected via <a href="https://en.wikipedia.org/wiki/Circuit_switching">circuit switch network</a>Â â€” when the
dedicated channel for phone call between two people was created<sup><a id="fnr.pstn" class="footref" href="#fn.pstn" role="doc-backlink">5</a></sup>.
</p>

<p>
But after 4G, things changed. The telephony became the <a href="https://en.wikipedia.org/wiki/Voice_over_IP">IP-telephony</a>Â â€” there
are no dedicated channels between different callers. The caller's voice is
encoded and broken into packets, and these packets are sent to the other phone
via the Internet. Like any other packets on the Internet.
</p>

<p>
The standardized access to the such <a href="https://en.wikipedia.org/wiki/Packet_switching">packet-switching network</a> for mobile phones
is through <a href="https://en.wikipedia.org/wiki/IP_Multimedia_Subsystem">IP Multimedia Subsystem</a> (IMS). There should be a special
application on the phone to use IMS. This application is installed by default
on the stock Android from Motorola (as in other manufacturers phones, I
think). But there is no such application in my version of LineageOS, possibly
because of licensing issues.
</p>

<p>
Fortunately, there is an option to download an IMS application from the vendor
(Qualcomm in my case): "Settingsâ‡’Phh Treble Settingsâ‡’IMS features".
</p>


<div class="figure">
<p><img src="/assets/static/ims.png" alt="IMS features in the LineageOS, &quot;Force IMS&quot; is enabled" align="center" width="50%" />
</p>
</div>

<p>
After installing the necessary app via the "Install IMS APK for Qualcomm
vendor" menu item and enabling the "Request IMS network" optionÂ â€” 4G calls and
SMS started working as usual.
</p>
</div>
</div>
<div id="outline-container-disable-floating-shit-on-copy" class="outline-2">
<h2 id="disable-floating-shit-on-copy">Disabling nonsensical popup when copying text</h2>
<div class="outline-text-2" id="text-disable-floating-shit-on-copy">
<p>
I found the <i>another "innovation"</i> from Google in AndroidÂ 14. When I copy text
to the clipboard, a nonsensical popup appears in the bottom left corner of the
screen. It shows everything I copied as <b>plain-text</b>! Of course, when I copy
password from <a href="https://www.passwordstore.org/">pass</a> â€” this password is shown as plain-text in this popup.
</p>


<div class="figure">
<p><img src="/assets/static/clipboard_bubble.png" alt="Clipboard bubble with &quot;Hello&quot; string inside" align="center" width="25%" />
</p>
</div>

<p>
This "feature" is sold under "user experience and convenience"Â â€” the user
should be sure that something has been copied. But in my opinion, this feature
was not created for "user comfort", but for the comfort of any perpetrator. It
becomes easy to see the user's password just by looking at the bottom left
corner of someone else's phone screen. Especially since this popup can't be
disabled in the settingsÂ â€” there's no such item in the "Settings" menu.
</p>

<p>
Luckily, I found that I can easily disable this popup on the phone with root
access:
</p>
<ol class="org-ol">
<li>Open the terminal.</li>
<li>Switch to the root with <code>su</code>.</li>
<li>Execute the command <code>appops set com.android.systemui READ_CLIPBOARD ignore</code>.</li>
</ol>

<p>
All done! This popup is now and <b>forever</b> disabled and won't re-enable itself
even after reboot.
</p>
</div>
</div>
<div id="outline-container-turn-off-usb-debugging" class="outline-2">
<h2 id="turn-off-usb-debugging">Turn off USB debugging</h2>
<div class="outline-text-2" id="text-turn-off-usb-debugging">
<p>
Pretty quickly, I found that USB debugging somehow ended up turned on after
every reboot. Obviously, I don't want to leave a hole like that in the system
for any trickster with an USB cable. In the case of an unlocked bootloader,
enabling USB debugging will allow anyone to write anything to the phone's
flash memory after rebooting into the bootloader.
</p>

<p>
I've found the fixes for this bug in the LineageOS bugtracker. But they were
for LineageOS <a href="https://review.lineageos.org/c/LineageOS/android_device_xiaomi_sdm845-common/+/253967">version 16.0</a> and <a href="https://review.lineageos.org/c/LineageOS/android_device_oneplus_sdm845-common/+/330486">version 19.1</a> and only for Xiaomi phones. The
"default solution" via <code>setprop persist.vendor.usb.config ""</code> command doesn't
work for meÂ â€” this option resets to <code>"adb"</code> after reboot. And USB debugging was
still on.
</p>

<p>
I looked for files, mentioned in the bugtracker records and found them in the
<code>/vendor/</code> catalog:
</p>
<pre class="example">
:/ # find / -type f -name init.qcom.usb.sh
/vendor/bin/init.qcom.usb.sh
:/ # find / -type f -name default.prop
/vendor/default.prop
</pre>

<p>
The <code>/vendor</code> catalog is the mountpoint for the <code>/dev/block/dm-5</code> device. Of
course, I first tried to remount it in RW mode (unsuccessfully):
</p>
<pre class="example">
:/ # mount | grep 'on /vendor'
/dev/block/dm-5 on /vendor type ext4 (ro,seclabel,relatime)
:/ # mount -o remount,rw /vendor
'/dev/block/dm-5' is read-only
</pre>

<p>
After that, I go to the <code>/etc/init</code> catalog to look at the system initialization
scripts. There I found something like <code>systemd</code> unit filesðŸ¤® and tried to add a
new file to disable USB debugging every time, when <code>persist.vendor.usb.config</code>
equals to <code>"adb"</code>:
</p>
<pre class="example">
on property:persist.vendor.usb.config="adb"
    settings put global adb_enabled 0
    setprop persist.vendor.usb.config ""
</pre>

<p>
Unfortunately, the root filesystem was mounted in read-only mode, and I
couldn't remount it with <code>mount -o remount,rw /</code>.
</p>

<p>
Fortunately, when I tried to run the above two commands<sup><a id="fnr.disable_usb" class="footref" href="#fn.disable_usb" role="doc-backlink">6</a></sup> in the
terminal, just in caseÂ â€” the problem was solved! USB debugging was disabled
and didn't turn on even after rebooting.
</p>
</div>
</div>
<div id="outline-container-root-apps" class="outline-2">
<h2 id="root-apps">Applications with root access</h2>
<div class="outline-text-2" id="text-root-apps">
<p>
In this section I write about special applications that definitely need the
root access on my phone.
</p>
</div>
<div id="outline-container-appstores" class="outline-3">
<h3 id="appstores">Application stores</h3>
<div class="outline-text-3" id="text-appstores">
<p>
First, it's naturally <a href="https://f-droid.org/">F-Droid</a>.
</p>


<div class="figure">
<p><img src="/assets/static/f-droid.png" alt="F-Droid main window" align="center" />
</p>
</div>

<p>
The application doesn't need the <code>root</code> itself. But it is needed for the
<a href="https://github.com/entr0pia/Fdroid-Priv">Fdroid-Priv</a> Magisk extension. This extension allows me to install and update
applications with a single tap, without the "Install this application?" popup.
</p>

<p>
Second, there is <a href="https://f-droid.org/en/packages/com.aurora.store/">Aurora Store</a>Â â€” the FOSS app to replace Google Play. Unlike
Google Play this application doesn't show ads on every screen and is not
overloaded with different screens and settings. There are only three tabs on
the main screen:
</p>
<ol class="org-ol">
<li>List of applications from Google Play.</li>
<li>List of games from Google Play.</li>
<li>List of installed apps to update.</li>
</ol>


<div class="figure">
<p><img src="/assets/static/aurora-store.png" alt="Aurora Store main window" align="center" width="50%" />
</p>
</div>

<p>
Installing and updating applications from the Aurora Store with a single tap
is easy:
</p>
<ul class="org-ul">
<li>Just add "<a href="https://apt.izzysoft.de/fdroid/">IzzyOnDroid F-Droid Repository</a>" to the F-Droid.</li>
<li>Install the <a href="https://shizuku.rikka.app/">Shizuku</a> application, which creates the standardized interface
for the <code>root</code> access.</li>
<li>Open the "Installationâ‡’Installation method" screen in the Aurora Store
settings and allow <code>root</code> access <b>once</b>.</li>
<li><p>
On the next screen select "Shizuku" as the application installation method.
</p>


<div class="figure">
<p><img src="/assets/static/aurora-store-shizuku.png" alt="Installation methods from Aurora Store. Shizuku method is selected" align="center" width="50%" />
</p>
</div></li>
</ul>

<p>
Third there is <a href="https://f-droid.org/en/packages/dev.imranr.obtainium.fdroid/">Obtainium</a>Â â€” it can download and install APKs from GitHub,
GitLab, etc.
</p>


<div class="figure">
<p><img src="/assets/static/obtainium.png" alt="Obtainium main window with ForkGram, LawnIcons and Shattered Pixel Dungeon" align="center" />
</p>
</div>

<p>
Some FOSS applications can only be installed through Google Play and don't
exist in the F-Droid<sup><a id="fnr.no-in-fdroid" class="footref" href="#fn.no-in-fdroid" role="doc-backlink">7</a></sup>. I prefer to install such applications via
Obtainium, because I prefer to use Aurora Store only for proprietary
applications.
</p>
</div>
</div>
<div id="outline-container-firewall" class="outline-3">
<h3 id="firewall">Firewall (AFWall+)</h3>
<div class="outline-text-3" id="text-firewall">
<p>
I am using <a href="https://f-droid.org/en/packages/dev.ukanth.ufirewall/">AFWall+</a> as my firewall. It uses <code>iptables</code> as a backend and doesn't
occupy the single VPN slot in the system, like the other Android firewalls
(which operate without <code>root</code> access).
</p>


<div class="figure">
<p><img src="/assets/static/afwall.png" alt="AFWall+ firewall main windows with two profiles: Default and special profile for some apps" align="center" />
</p>
</div>

<p>
AFWall+ provides a flexible set of Internet access rules for both system and
userland applications. I'm able to prohibit Internet access for some apps
completely, or prohibit only <i>some types</i> of connectionsÂ â€” WiFi, cellular,
cellular while roaming, VPN and so on. As you can see from the screenshot
above, there is profile support exists, so I created a separate profile with
Internet access allowed for <i>some apps</i> and enable it only when I need it.
</p>

<p>
Sadly, there are also one drawbackÂ â€” AFWall+ (version 3.6.0) allows to export
firewall rules to the file without any warning. But, when I want to import
rules from file (to check my backup), then I found out that I need to pay
money to the developer to unlock this feature. For now, I can't pay to the
people in the outside world because MasterCard/Visa/PayPal/etc <a href="https://en.wikipedia.org/wiki/Discrimination_based_on_nationality">discriminate me
based on my nationality and location</a>ðŸ˜’.
</p>

<p>
IMHO, the export screen lacks the notification text to warn the user of the
need to pay to re-import exported rules.
</p>

<p>
One nuance (I can't call it a drawback) you should know about: if you
configure the firewall properlyÂ â€” by denying Internet access to everything not
explicitly allowed by the rulesÂ â€” then checking for Internet access using the
"knocking on Google servers after connecting to the network" method will not
work. I didn't bother to find out which system process is responsible for this
and how to change the address <a href="http://clients3.google.com/">http://clients3.google.com/</a> to something more
decentÂ â€” and just disabled the captive portal check <a href="https://github.com/ukanth/afwall/wiki/FAQ#61-what-is-androids-captive-portal-check">according to the
instructions in the AFWall+ FAQ</a>. I can't say that this is an AFWall+
drawback for me, but for other peopleÂ â€” who knows?
</p>
</div>
</div>
<div id="outline-container-adblocker" class="outline-3">
<h3 id="adblocker">System-wide ad blocker (AdAway)</h3>
<div class="outline-text-3" id="text-adblocker">
<p>
Here I used the same principle as aboveÂ â€” the ad blocker shouldn't use my
single VPN slot. So I found an <a href="https://f-droid.org/en/packages/org.adaway/">AdAway</a> that uses <code>root</code> access to modify the
system <code>hosts</code> file with blacklists' data.
</p>


<div class="figure">
<p><img src="/assets/static/adaway.png" alt="AdAway main window" align="center" />
</p>
</div>

<p>
I import some of my favorite blacklists into the app, such as well known <a href="https://someonewhocares.org/hosts/hosts">Dan
Pollocks hosts file</a> or <a href="https://raw.githubusercontent.com/mtxadmin/ublock/master/hosts.txt">the hosts file</a> to block Russian-language ads.
</p>
</div>
</div>
<div id="outline-container-acca" class="outline-3">
<h3 id="acca">AccAÂ â€” to control accumulator (dis)charging</h3>
<div class="outline-text-3" id="text-acca">
<p>
I have always been bothered by the "turbo charging" supported by my
phone. This charging mode is activated every time I connect the phone to
something relatively new. This "feature" can't be disabled in stock
Android. And if it is enabled all the timeÂ â€” the battery is charged with
higher current and overheats. Of course it charges faster but at the same time
<a href="https://batteryuniversity.com/article/bu-808-how-to-prolong-lithium-based-batteries">the battery lifetime decreases</a>.
</p>

<p>
And then I found an <a href="https://github.com/MatteCarra/AccA">AccA application</a> with an <a href="https://github.com/VR-25/acc">acc daemon</a>. The daemon can do all
the necessary things:
</p>
<ul class="org-ul">
<li>it doesn't allow to charge the battery to 100%, it stops charging at 70%
(the default value)</li>
<li>it doesn't allow to use the battery in the last percent of the charge, the
phone will be switched off at 10% of the charge (the default value)</li>
<li>it can pause the charging process if the battery is heated up to 60Â°C, to
cool this thing down</li>
<li>it completely disables the "turbo charge" feature.</li>
</ul>

<p>
The AccA is just the daemon frontend, which simplifies the installation and
initial setup of the daemon.
</p>


<div class="figure">
<p><img src="/assets/static/acca.png" alt="AccA main window with battery realtime parameters" align="center" />
</p>
</div>

<p>
I'm comfortable using the phone all day and charging it at night as usual,
with the settings from the screenshot. If I need to quickly charge it to 100%
and fully use the batteryÂ â€” there is a button "Charge once to #% without
restrictions".
</p>
</div>
</div>
<div id="outline-container-colorblendr" class="outline-3">
<h3 id="colorblendr">System theme color change (ColorBlendr)</h3>
<div class="outline-text-3" id="text-colorblendr">
<p>
This simple application can change colors for the currently used theme. After
some setup I created something like my favorite Solarized Light theme:
</p>


<div class="figure">
<p><img src="/assets/static/colorblendr.png" alt="ColorBlendr main window" align="center" />
</p>
</div>

<p>
<a href="https://f-droid.org/en/packages/com.drdisagree.colorblendr/">Link to the ColorBlendr application</a>.
</p>
</div>
</div>
<div id="outline-container-sdmaid2se" class="outline-3">
<h3 id="sdmaid2se">System cleaner (SD Maid 2/SE)</h3>
<div class="outline-text-3" id="text-sdmaid2se">
<p>
I have used this app many times before. It helped me to clear the flash memory
and the SD card of some garbage that fills up over time: application logs,
empty catalogs, file duplicates, various caches, "remnants" of already deleted
applications, etc.
</p>


<div class="figure">
<p><img src="/assets/static/sdmaid2se.png" alt="SD Maid 2/SE main window" align="center" />
</p>
</div>

<p>
With the <code>root</code> access the SD Maid 2/SE capable to do the bigger things. It is
able to delete the cached APKs of already installed apps, clear the system
caches and logs, remove the old bug report files, etc.
</p>

<p>
The SD Maid 2/SE has deleted nearly 10Â Gb of garbage since the last few
months. Otherwise, these garbage files just took up space on the flash
memory.
</p>

<p>
<a href="https://f-droid.org/en/packages/eu.darken.sdmse/">Link to the SD Maid 2/SE</a>.
</p>
</div>
</div>
</div>
<div id="outline-container-backups" class="outline-2">
<h2 id="backups">Backups</h2>
<div class="outline-text-2" id="text-backups">
<blockquote>
<p>
There are two types of people: those who do backups and those who will do
backups.
</p>
</blockquote>
</div>
<div id="outline-container-neobackup" class="outline-3">
<h3 id="neobackup">Neo Backup</h3>
<div class="outline-text-3" id="text-neobackup">
<p>
I use the FOSS <a href="https://f-droid.org/packages/com.machiav3lli.backup/">Neo Backup</a> application to backup the phone.
</p>


<div class="figure">
<p><img src="/assets/static/neobackup.png" alt="Neo Backup application's backup tab with list of applications on it" align="center" />
</p>
</div>

<p>
This application, of course, needs <code>root</code> access. And it can:
</p>
<ol class="org-ol">
<li>Make backups of applications (APK files).</li>
<li>Create backups of user data and settings for these applications.</li>
<li>Compress the resulting files with zstd or gzip.</li>
<li>Encrypt the resulting backup.</li>
</ol>

<p>
In return, it puts a heavy IO load on the media used for the backup. This is
why it is recommended to backup to the SD cardÂ â€” it can be easily swapped to
the new one after end of life (instead of the internal flash memory).
</p>

<p>
Backup of the <a href="https://eugene-andrienko.com/uses">the mine</a> application takes nearly an hour with compression and
encrypion enabled. The size of the resulting backup was nearly 3.6Â Gb.
</p>
</div>
</div>
<div id="outline-container-flash-memory-backup" class="outline-3">
<h3 id="flash-memory-backup">Flash memory backup</h3>
<div class="outline-text-3" id="text-flash-memory-backup">
<p>
By the time, I thought about backup of the main partitions from
flash. Ideally, this could be done with the <code>fastboot fetch</code> command. But
suddenly I found out that this command is not supported on the phone side:
</p>

<pre class="example">
phone_backup/fastboot % fastboot fetch partition gpt.bin
(bootloader) max-fetch-size: not found
fastboot: error: Unable to get max-fetch-size. Device does not support fetch command.
</pre>

<p>
On the one hand, this prevents me from making a backup of the flash memory. On
the other hand, this disallows <i>anyone</i> to read the flash memory contents of my
phone without disassembling it.
</p>
</div>
</div>
</div>
<div id="outline-container-bugs" class="outline-2">
<h2 id="bugs">BUGS</h2>
<div class="outline-text-2" id="text-bugs">
<p>
Of course there are bugs!
</p>

<ul class="org-ul">
<li><p>
The "Phh Treble Settingsâ‡’Misc featuresâ‡’Set rounded corner diameter" and "Phh
Treble Settingsâ‡’Misc featuresâ‡’Set forced/faked rounded corners diameter"
settings don't work. After searching in the Internet, I found out that these
settings don't work for everyone.
</p>

<p>
Fortunately, this problem doesn't affect the usability of my phone. Only
were the next things that bothered me:
</p>
<ul class="org-ul">
<li>The left part of the mobile network name in the notification panel on the
lock screen is slightly cropped.</li>
<li>The small left part of the far left icon on the notification panel is also
cropped.</li>
<li>The buttons at the bottom of the game panel in Shattered Pixel Dungeon are
also cropped in the album orientation.</li>
</ul></li>
<li>The NFC doesn't work completely. There is no mention of NFC in the system
settings at all. I haven't researched this issue because I don't use the
NFC. I found the only one proper use of this technologyÂ â€” to pay with the
phone via Google/Apple Pay. But both companies participate in the
"discrimination based on nationality" party, so I can't use this technology
(the local substitute application: MirPay, works with different payment
terminals in 50% of casesÂ â€” i.e. unusable).</li>
</ul>
</div>
</div>
<div id="outline-container-notes" class="outline-2">
<h2 id="notes">Notes</h2>
<div class="outline-text-2" id="text-notes">
</div>
</div>
<div id="footnotes">

<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.device_tree" class="footnum" href="#fnr.device_tree" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://elinux.org/Device_Tree_Reference">https://elinux.org/Device_Tree_Reference</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.xbl" class="footnum" href="#fnr.xbl" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://xdaforums.com/t/location-and-function-of-xbl-elf-qupv3fw-elf-cmnlib-mbn-in-the-aosp-output-build.4351213/#post-88989497">https://xdaforums.com/t/location-and-function-of-xbl-elf-qupv3fw-elf-cmnlib-mbn-in-the-aosp-output-build.4351213/#post-88989497</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.fsg" class="footnum" href="#fnr.fsg" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
But netherless the <code>fastboot</code> clears this partition when flashing
<code>radio.img</code>.
</p></div></div>

<div class="footdef"><sup><a id="fn.gsi_naming_conventions" class="footnum" href="#fnr.gsi_naming_conventions" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://github.com/phhusson/treble_experimentations/wiki/Frequently-Asked-Questions-(FAQ)#naming-conventions-that-some-gsi-buildermaintainer-uses">Naming conventions that some GSI builder/maintainer
uses</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.pstn" class="footnum" href="#fnr.pstn" role="doc-backlink">5</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See the <a href="https://en.wikipedia.org/wiki/Public_switched_telephone_network">PSTN</a> (Public switched telephone network) article.
</p></div></div>

<div class="footdef"><sup><a id="fn.disable_usb" class="footnum" href="#fnr.disable_usb" role="doc-backlink">6</a></sup> <div class="footpara" role="doc-footnote"><pre class="example">
:/ # settings put global adb_enabled 0
:/ # setprop persist.vendor.usb.config ""
</pre></div></div>

<div class="footdef"><sup><a id="fn.no-in-fdroid" class="footnum" href="#fnr.no-in-fdroid" role="doc-backlink">7</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Probably because F-Droid requires reproducible builds or has
<a href="https://f-droid.org/en/docs/Inclusion_Policy/">clear requirements</a> for apps that can be published in it.
</p></div></div>


</div>
</div>