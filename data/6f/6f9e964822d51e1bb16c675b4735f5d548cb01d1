<p>Emacs users sooner or later disable all the GUI stuff, and usually also get rid of system alerts and file pickers.</p>

<p>But if you just once want to pick a file using your operating system’s file picker, these three temporary variable overrides will do:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">last-nonmenu-event</span> <span class="no">nil</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">use-dialog-box</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">use-file-dialog</span> <span class="no">t</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">call-interactively</span> <span class="nf">#'</span><span class="nv">find-file</span><span class="p">))</span>
</code></pre></div></div>

<p>If you’re in this situation, you likely already know <code>use-dialog-box</code> and <code>use-file-dialog</code> because you’ve set both to <code>nil</code> globally.</p>

<p>The interesting piece here is <code>last-nonmenu-event</code>: this tricks the interactive call of <code>find-file</code> into believing you used the mouse – which apparently is a prerequisite to make the system dialog appear, even though the docs seem to say that’s not always the case (emphasis mine):</p>

<blockquote>
  <p>use-file-dialog is a variable defined in ‘C source code’.</p>

  <p>Its value is nil</p>

  <p>Non-nil means mouse commands use a file dialog to ask for files. <strong>This applies to commands from menus and tool bar buttons even when they are initiated from the keyboard.</strong>  If ‘use-dialog-box’ is nil, that disables the use of a file dialog, regardless of the value of this variable.</p>
</blockquote>

<p>Now “Open File” in the main menu is bound to <code>find-file</code>, so the emphasized sentence doesn’t hold true.</p>

<p>But the <code>last-nonmenu-event</code> trick works. This variable’s docs say:</p>

<blockquote>
  <p>Last input event in a command, except for mouse menu events. Mouse menus give back keys that don’t look like mouse events; this variable holds the actual mouse event that led to the menu, so that you can determine whether the command was run by mouse or not.</p>
</blockquote>

<p>So there you go – put the above code snippet into a function and bind it to another key and you will have a quick way to open files with your system file picker.</p>
<hr><p><small><a href="https://christiantietze.de/hire-me/">Hire me</a> for freelance macOS/iOS work and consulting.</small></p><p><small><a href="https://christiantietze.de/apps/">Buy</a> my apps.</small></p><p><small><a href="https://christiantietze.de/newsletter/">Receive</a> new posts via email.</small></p>