<p>Today I figured out how to add a tab-bar to Emacs. I didn&rsquo;t like having it in the mode-line: it gets duplicated for every window and my mode-line space is precious. In contrast, the right side of the tab-bar was always blank. I&rsquo;ve just been using my OS&rsquo;s clock, but I started using non-native fullscreen with Emacs, so I wanted a view of the clock again.</p>
<p>Add this to your <code>early-init.el</code> or the like:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#eceff4">(</span>add-to-list <span style="color:#a3be8c">&#39;tab-bar-format</span> <span style="color:#a3be8c">&#39;tab-bar-format-align-right</span> <span style="color:#a3be8c">&#39;append</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span>add-to-list <span style="color:#a3be8c">&#39;tab-bar-format</span> <span style="color:#a3be8c">&#39;tab-bar-format-global</span> <span style="color:#a3be8c">&#39;append</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1">setq</span> display-time-format <span style="color:#a3be8c">&#34;%a %F %T&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1">setq</span> display-time-interval <span style="color:#b48ead">1</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span>display-time-mode<span style="color:#eceff4">)</span>
</span></span></code></pre></div><p>Adding that <code>tab-bar-format-global</code> to the <code>tab-bar-format</code> list means that whatever would to on the &ldquo;global&rdquo; section of the format line will now appear in the tab bar. The <code>tab-bar-format-align-right</code> puts the clock at the top-right hand corner, instead of right next to the tab. Here&rsquo;s what it looks like:</p>
<p><img src="https://lambdaland.org/img/emacs_tab_clock.jpg" alt="Screenshot of my Emacs buffer while I was composing this post; a custom clock is visible on the right side of the tab-bar" /></p>
<p>Note that this only works in Emacs 28.</p>
<p>I wrote an ugly hack that uses a posframe to display the time in the right place. I <em>do not</em> recommend this, but if you&rsquo;re still on Emacs 27 or earlier for whatever reason, this might work for you:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;;; Hack to display a clock in the tab-bar</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1">defun</span> posframe-poshandler-real-top-right <span style="color:#eceff4">(</span>info<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#88c0d0">cons</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">-</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">plist-get</span> info <span style="color:#81a1c1">:parent-frame-width</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>           <span style="color:#eceff4">(</span><span style="color:#88c0d0">+</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">plist-get</span> info <span style="color:#81a1c1">:posframe-width</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">*</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">plist-get</span> info <span style="color:#81a1c1">:font-width</span><span style="color:#eceff4">)</span> <span style="color:#b48ead">2</span><span style="color:#eceff4">)))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#b48ead">0</span><span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1">defun</span> update-posframe-clock <span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a3be8c">&#34;Update the clock displayed with posframe&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#81a1c1">let</span> <span style="color:#eceff4">((</span>the-time <span style="color:#eceff4">(</span><span style="color:#88c0d0">format-time-string</span> <span style="color:#a3be8c">&#34;%H:%M:%S&#34;</span><span style="color:#eceff4">)))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">(</span><span style="color:#81a1c1">if</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">&gt;</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">length</span> <span style="color:#eceff4">(</span>tab-bar-tabs<span style="color:#eceff4">))</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">(</span>posframe-show <span style="color:#a3be8c">&#34;*clock*&#34;</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#81a1c1">:string</span> the-time
</span></span><span style="display:flex;"><span>                       <span style="color:#81a1c1">:width</span> <span style="color:#b48ead">8</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#81a1c1">:poshandler</span> <span style="color:#a3be8c">&#39;posframe-poshandler-real-top-right</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#81a1c1">:background-color</span> <span style="color:#eceff4">(</span><span style="color:#88c0d0">plist-get</span> <span style="color:#eceff4">(</span>custom-face-attributes-get <span style="color:#a3be8c">&#39;tab-bar</span> <span style="color:#8fbcbb">nil</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">:background</span><span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>      <span style="color:#eceff4">(</span>posframe-delete <span style="color:#a3be8c">&#34;*clock*&#34;</span><span style="color:#eceff4">))))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1">when</span> <span style="color:#eceff4">(</span>display-graphic-p<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span>run-with-timer
</span></span><span style="display:flex;"><span>   <span style="color:#b48ead">1</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#88c0d0">#&#39;</span>update-posframe-clock<span style="color:#eceff4">))</span>
</span></span></code></pre></div><p>Again, I recommend you find something better than the above. It will almost certainly break. <em>Caveat emptor</em>.</p>
