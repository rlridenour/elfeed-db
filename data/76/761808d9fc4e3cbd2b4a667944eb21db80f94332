<p><a href="https://github.com/xenodium/chatgpt-shell">chatgpt-shell</a> includes a couple of mechanisms to operate on an Emacs buffer region. That is, select a region and ask the <a href="https://lmno.lol/alvaro/chatgpt-shell-goes-multi-model">LLM robots</a> to modify it for us. Until now, both of these mechanisms didn't quite close the loop. They could either modify current region or iterate on a separate solution, but never both.</p>
<h2>M-x chatgpt-shell-quick-insert</h2>
<p>While <code>chatgpt-shell</code>'s quick insert mechanism already enabled selecting a region and requesting changes, it was more of a &quot;I'm feeling lucky&quot; situation. If the changes didn't pan out, you'd have to discard the suggestion and start over.</p>
<p>With the latest changes, in addition to accepting or discarding (y/n bindings) suggestions, we can now iterate using the <code>i</code> binding.</p>
<p><img src="http://localhost:8787/alvaro/llm-iterate-and-insert/quick-insert-iterate.gif" alt="" title="1"></p>
<h2>M-x chatgpt-shell-prompt-compose</h2>
<p>While quick insertions rely on minibuffer input, <code>chatgpt-shell-prompt-compose</code> opens a dedicated buffer for a more thorough interactions. Select a region, invoke <code>chatgpt-shell-prompt-compose</code> (my preferred binding being <code>C-c C-e</code>), and a new compose buffer is created with the region text. Add your instructions and submit with <code>C-c C-c</code>. Post submission, the compose buffer becomes read-only and single-character key-bindings take over. For example: <code>r</code> replies (for further iteration) and <code>n/p</code> (or <code>TAB/shift-TAB</code>) navigation. There are <a href="https://github.com/xenodium/chatgpt-shell?tab=readme-ov-file#a-shell-hybrid">more bindings</a>.</p>
<p>Until now, we could easily craft more involved queries and continue iterating from the compose buffer, but integrating suggested changes was a manual process. That is, navigate to a code block, select, copy it and then paste it elsewhere.</p>
<p>With the latest changes, pressing <code>i</code> (insert) while on a code block will attempt to insert it wherever the initial interaction took place.</p>
<p><img src="http://localhost:8787/alvaro/llm-iterate-and-insert/compose-insert-iterate.gif" alt="" title="1"></p>
<p>Both of these changes show now be available on MELPA. While I demoed ChatGPT, the two mechanism should now work with any of the supported models (ChatGPT, Claude, Gemini, and Ollama).</p>
