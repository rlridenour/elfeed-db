<p>I'm a fan of Magnar Sveen's <a href="https://github.com/magnars/multiple-cursors.el">multiple cursors</a> Emacs implementation. It's just so fun to use and works very well with commands bound to my favorite keys.</p>
<p>Every now and then I'd like to execute extended commands on all cursors, but they have no keys bound to them. If you're an <a href="https://github.com/abo-abo/swiper">ivy/counsel</a> fan like me (and all packages by <a href="https://oremacs.com/about/">Abo Abo</a>), you use <em>counsel-M-x</em> to invoke commands. However, <em>counsel-M-x</em> doesn't support multiple cursors out of the box. Luckily, this is Emacs and we can fix that…</p>
<p>Back in December 2019, I made a note to revisit <a href="https://www.reddit.com/user/snippins1987/">u/snippins1987</a>'s weekly tip to pair <a href="https://www.reddit.com/r/emacs/comments/eeyhdz/weekly_tipstricketc_thread/fch1bkv?utm_source=share&amp;utm_medium=web2x">helm-M-x with multiple cursors</a>. Finally got back to it. With a few changes, we can also make the snippet work with <em>counsel-M-x</em> ø/.</p>
<pre><code class="language-{.commonlisp">(defun adviced:counsel-M-x-action (orig-fun &amp;rest r)
  &quot;Additional support for multiple cursors.&quot;
  (apply orig-fun r)
  (let ((cmd (intern (car r))))
    (when (and (boundp 'multiple-cursors-mode)
               multiple-cursors-mode
               cmd
               (not (memq cmd mc--default-cmds-to-run-once))
               (not (memq cmd mc/cmds-to-run-once))
               (or mc/always-run-for-all
                   (memq cmd mc--default-cmds-to-run-for-all)
                   (memq cmd mc/cmds-to-run-for-all)
                   (mc/prompt-for-inclusion-in-whitelist cmd)))
      (mc/execute-command-for-all-fake-cursors cmd))))

(advice-add #'counsel-M-x-action
            :around
            #'adviced:counsel-M-x-action)
</code></pre>
<p><img src="https://xenodium.github.io/images/emacss-counsel-m-x-meets-multiple-cursors/counsel-mx-mc.gif" alt=""></p>
