<h2 id="why">Why?</h2>
<p>Today was one of the days I decided to upgrade all my installed Emacs packages via <code>list-packages</code>.</p>
<p>The upgrade to Org-roam v2 should have not surprised me – it is and has been widely talked about in the community the developer – but it did <code>¯\_(ツ)_/¯</code>. This meant of course the adjustment of my configuration to meet the requirements of the new version.</p>
<p>Having followed the upfront chatter about the &ldquo;breaking upgrade&rdquo; I was afraid to have some work cut out for me. But in hind side I realize that this was not the case at all. Most time spent with the migration is this post really.</p>
<p>I will not discus the changes or the new feature of Org-roam v2. This is just a fairly fast How-To to get a working configuration before diving in deeper. There are some links to resources further down however.</p>
<p>So if I can manage then it should be a breeze for you. The tl;dr version of my changes can be found in this <a href="https://gitlab.com/aimebertrand/dotfiles/-/commit/9bfe4dd0d5303fdd7177c5655bd3dadd3b7a0b3f">commit</a>. Let us get into some details though.</p>
<h2 id="how">How?</h2>
<p>There are really just 3 steps in my humble opinion that you should take care of. &lt;span style=&ldquo;color:#f7821b;font-weight:bold;&quot;&gt;But – for the love of god – backup your Org-roam directory first!&lt;/span&gt;</p>
<h3 id="1-dot-adjust-your-configuration">1. Adjust your configuration</h3>
<p>Note that the <code>org-roam.db</code> can be separated from the <code>org-roam-directory</code>. I however choose to put the db in the same location.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-v2-ack</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; acknowledge upgrade and remove warning at startup</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-roam</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-directory</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">file-truename</span> <span class="s">&#34;/path/to/org-roam-directory&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-db-location</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">concat</span> <span class="nv">org-roam-directory</span> <span class="s">&#34;org-roam.db&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-roam-setup</span><span class="p">)))</span>
</span></span></code></pre></div><p><code>org-roam-setup</code> replaces <code>org-roam-mode</code>. This sets up Org-roam and initializes it at Emacs startup.</p>
<p>In case you are using <code>use-package</code> like me the following configuration should do the trick.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-roam</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-v2-ack</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; acknowledge upgrade and remove warning at startup</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-directory</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">file-truename</span> <span class="s">&#34;/path/to/org-roam-directory&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-db-location</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">concat</span> <span class="nv">org-roam-directory</span> <span class="s">&#34;org-roam.db&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-setup</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="2-dot-change-keybindings-to-the-new-functions">2. Change keybindings to the new functions</h3>
<p>I personally truly only use 3 Keybindings for Org-roam. You should of course change the bindings to your liking.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; insert a link to an org-roam file – `org-roam-insert&#39; in v1:</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-M-i&#34;</span><span class="p">)</span> <span class="ss">&#39;org-roam-node-insert</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; open a file in org-roam – `org-roam-find-file&#39; in v1:</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-M-o&#34;</span><span class="p">)</span> <span class="ss">&#39;org-roam-node-find</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; open backlinks buffer – `org-roam&#39; in v1:</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-M-r&#34;</span><span class="p">)</span> <span class="ss">&#39;org-roam-buffer-toggle</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="3-dot-migrate-your-org-roam">3. Migrate your Org-roam</h3>
<ul>
<li>Eval your new configuration. I just restart Emacs.</li>
<li>Run the provided migration wizard <code>M-x org-roam-migrate-wizard</code>.</li>
<li>For good measure sync changes to your DB – <code>M-x org-roam-db-sync</code>.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Admittedly I don&rsquo;t handle very big DBs with Org-roam (max 145 files). I choose to have multiple directories rather than a huge <code>org-roam-directory</code>. For that your results may vary, but I am fairly convinced that – as mentioned further up – it will not hurt a lot.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://github.com/org-roam/org-roam/wiki/Hitchhiker's-Rough-Guide-to-Org-roam-V2">Hitchhiker&rsquo;s Rough Guide to Org roam V2</a> - Guide by the developer.</li>
<li><a href="https://www.orgroam.com/manual.html#Migrating-from-Org_002droam-v1">Migrating from Org-roam v1</a> - Chapter in the manual.</li>
<li><a href="https://www.youtube.com/watch?v=FRTaXVcQLNc">Org-roam version 2 - Should one upgrade?</a> - Intro video by Emacs-Elements.</li>
<li><a href="https://org-roam.discourse.group/t/the-org-roam-v2-great-migration/1505">The Org-roam v2 Great Migration</a> - Discussion on the Org-roam homepage.</li>
</ul>
