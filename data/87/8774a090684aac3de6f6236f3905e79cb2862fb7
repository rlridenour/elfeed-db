<p>I have just started the process of reducing the number of org files I maintain for my web site.  I now have a greater understanding of how <strong>Hugo</strong> handles these files and I think can both simplify and make them more flexible.</p>
<p>Hugo is my static site generator of choice and although it supports org files directly I prefer to generate to a markdown file as an intermediate step using a file by file evaluation of <code>org-hugo-auto-export-mode</code>.  This means that each org subtree I modify automatically generates an <strong>md</strong> file to a defined folder dictated by <code>#+hugo_section</code> in the org header.</p>
<p>For example, I have a few org files that generate my art blog; one for videos, finished art, galleries and now AI.  Each org file has a single header <code>#+hugo_section</code> defining the destination export folder.  I think now I would like a bit more flexibility with the ability to push a subtree to a folder of my choosing so any extra sections can more easily be added.  Plus, if I merge I would only have to maintain a single org file (although a larger one!).</p>
<p>To achieve this I will have to add an extra property to the existing org drawer for each subtree using <code>:EXPORT_HUGO_SECTION:</code> and then to adapt my <code>org-capture</code> templates.</p>
<p>Now of course to add the subtree property emacs can certainly help me out.</p>
<p>I would like to insert typically a drawer property line for each subtree such as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>:EXPORT_HUGO_SECTION: art--all
</span></span></code></pre></div><p>However of course things are not quite so simple.  It seems that some subtrees already have such property lines even though the destination folder is ultimately the same as <code>#+hugo_section</code> in the header (another good reason to tidy up)</p>
<p>So rather than a simple <code>isearch</code> to an ever present subtree anchor point (for example <code>:EXPORT_FILE_NAME:</code>) and then the insertion of the new line I will need to take into account those subtrees that already have <code>:EXPORT_HUGO_SECTION:</code> and not insert a line.</p>
<p>I considered edit mode in <code>multi-occur</code> but as far as I can tell it doesn&rsquo;t work too well when new lines are inserted.</p>
<p><code>deadgrep</code> (ripgrep) also has similar functionality and will also show context around the search point which can be also edited in a similar manner to <code>multi-occur</code> but all this is starting to feel too fiddly and I am starting to spend too much time investigating this!</p>
<p>The grep/occur to edit buffer approach can work well in certain situations but this is a little more complex involving a small amount of logic.  At this stage the same thought always occurs to me and I really wish it would occur to me earlier.</p>
<blockquote>
<p>what about macros?</p>
</blockquote>
<p>The <code>isearch</code> technique won&rsquo;t quite work (as explained above), but what about <code>isearch-regexp</code>?</p>
<p>As the properties are always in the same order I could just insert the <code>:EXPORT_HUGO_SECTION:</code> line if I find the following regex:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>:EXPORT_FILE_NAME:.*
</span></span><span style="display:flex;"><span>:EXPORT_HUGO_LASTMOD:
</span></span></code></pre></div><p><em>Note that the carriage return is achieved by <code>C-q C-j</code></em></p>
<p>Incorporate this into a macro and the cursor will only move to a point that doesn&rsquo;t have a <code>:EXPORT_HUGO_SECTION:</code> line and hence I can then insert and then repeat until my org file is suitable amended!</p>
<figure class="emacs-img"><img src="https://emacs.dyerdwelling.family/ox-hugo/20230109113207-emacs--Tidying-Hugo-org-files-using-emacs.jpg">
</figure>