<p>I've written before, once you learn a little <a href="https://en.wikipedia.org/wiki/Emacs_Lisp">elisp</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> becomes this hyper malleable editor/platform. A live playground of sorts, where almost everything is up for grabs. You can inspect and tweak behaviour of just about anything to your liking.</p>
<p>While the compounding benefits of using your favourite Emacs utilities are evident over time, learning elisp takes the compounding effect to another level. It empowers you to have those aha moments like &quot;if I could just wire this awesome utility with that other one, it'd be perfect for me&quot; and enable you to act on it.</p>
<p>Take, for example, <a href="https://github.com/wolray/symbol-overlay">symbol-overlay</a> and <a href="https://github.com/magnars/multiple-cursors.el">multiple-cursors</a>. Two Emacs packages I've been using for years. The first one is a feature you've likely experienced on your favourite IDE or editor without thinking too much about it. Placing your editor cursor on a variable automatically highlights its usages. It's one of those lovely features with zero learning demands.</p>
<p><img src="https://xenodium.github.io/images/its-all-up-for-grabs-and-it-compounds/overlay-symbol.gif" alt=""></p>
<p>The second utility, <a href="https://github.com/magnars/multiple-cursors.el">multiple-cursors</a>, does demand some learning but can be so fun to use once you get the hang of it. Below is a little multiple cursor demo I used recently <a href="https://www.reddit.com/r/emacs/comments/1dyn3zy/comment/lcbi10o/?utm_source=share&amp;utm_medium=web3x&amp;utm_name=web3xcss&amp;utm_term=1&amp;utm_content=share_button">in a reddit comment</a>, but you really should check out <a href="https://emacsrocks.com/e13.html">Emacs Rocks! Episode 13: multiple-cursors</a> (stick around for the ending).</p>
<p><img src="https://xenodium.github.io/images/its-all-up-for-grabs-and-it-compounds/mc_x2.gif" alt=""></p>
<p>So where am I going with this? While <a href="https://github.com/wolray/symbol-overlay">symbol-overlay</a> offers a mechanism to rename symbols via <code>symbol-overlay-rename</code>, I prefer <a href="https://github.com/magnars/multiple-cursors.el">multiple-cursors</a> for this kind of thing… &quot;if I could just get <code>symbol-overlay</code> to tell <code>multiple-cursors</code> where to place my cursors, it'd be just perfect for me&quot;.</p>
<p>I've been wanting this tweak for some time. Today's the day I finally act on it. I had no idea how to go about it, but opening <code>symbol-overlay.el</code> (via <code>M-x find-library symbol-overlay</code>) and browsing through all functions (via imenu) yields the first piece I needed: <code>symbol-overlay-get-list</code>.</p>
<p><img src="https://xenodium.github.io/images/its-all-up-for-grabs-and-it-compounds/imenu.png" alt=""></p>
<pre><code class="language-{.commonlisp">(defun symbol-overlay-get-list (dir &amp;optional symbol exclude)
  &quot;Get all highlighted overlays in the buffer.
If SYMBOL is non-nil, get the overlays that belong to it.
DIR is an integer.
If EXCLUDE is non-nil, get all overlays excluding those belong to SYMBOL.&quot;
  ...)
</code></pre>
<p>Let's take <code>symbol-overlay-get-list</code> for a spin, courtesy of <code>M-x eval-expression</code>, and see what we get out of it:</p>
<p><img src="https://xenodium.github.io/images/its-all-up-for-grabs-and-it-compounds/eval.gif" alt=""></p>
<p>With a list of overlays, we now know where to tell <code>multiple-cursors</code> to do its thing. For the second piece, we needed to peek at any of the <code>multiple-cursors</code> commands I already use. I happen to pick <code>mc/mark-all-like-this</code> to examine what's under the hood.</p>
<pre><code class="language-{.commonlisp">(defun mc/mark-all-like-this ()
  &quot;Find and mark all the parts of the buffer matching the currently active region&quot;
  (interactive)
  (unless (region-active-p)
    (error &quot;Mark a region to match first.&quot;))
  (mc/remove-fake-cursors)
  (let ((master (point))
        (case-fold-search nil)
        (point-first (&lt; (point) (mark)))
        (re (regexp-opt (mc/region-strings) mc/enclose-search-term)))
    (mc/save-excursion
     (goto-char 0)
     (while (search-forward-regexp re nil t)
       (push-mark (match-beginning 0))
       (when point-first (exchange-point-and-mark))
       (unless (= master (point))
         (mc/create-fake-cursor-at-point))
       (when point-first (exchange-point-and-mark)))))
  (if (&gt; (mc/num-cursors) 1)
      (multiple-cursors-mode 1)
    (mc/disable-multiple-cursors-mode)))
</code></pre>
<p>The star of the <code>mc/mark-all-like-this</code> attraction is <code>mc/create-fake-cursor-at-point</code>, used to create each cursor. If we can just iterate over the overlays, we'd be able to create a fake cursor per overlay. There's some additional logic needed to ensure all fake cursors are placed in the same relative position within symbol (using an offset). Finally, we need to enable <code>multiple-cursors-mode</code>.</p>
<p>We put it all together in <code>ar/mc-mark-all-symbol-overlays</code>:</p>
<pre><code class="language-{.commonlisp">(defun ar/mc-mark-all-symbol-overlays ()
  &quot;Mark all symbol overlays using multiple cursors.&quot;
  (interactive)
  (mc/remove-fake-cursors)
  (when-let* ((overlays (symbol-overlay-get-list 0))
              (point (point))
              (point-overlay (seq-find
                              (lambda (overlay)
                                (and (&lt;= (overlay-start overlay) point)
                                     (&lt;= point (overlay-end overlay))))
                              overlays))
              (offset (- point (overlay-start point-overlay))))
    (setq deactivate-mark t)
    (mapc (lambda (overlay)
            (unless (eq overlay point-overlay)
              (mc/save-excursion
               (goto-char (+ (overlay-start overlay) offset))
               (mc/create-fake-cursor-at-point))))
          overlays)
    (mc/maybe-multiple-cursors-mode)))
</code></pre>
<p>and with that, you finally get to see it all in action…</p>
<p><img src="https://xenodium.github.io/images/its-all-up-for-grabs-and-it-compounds/symbol-overlay-meets-multiple-cursors.gif" alt=""></p>
<h2>Unrelated - Want your own blog?</h2>
<p>Like this blog? Want to start a blog? Run your blog off a single file. Write from the comfort of Emacs (or your favourite text editor) and <a href="https://indieweb.social/@xenodium/112265481282475542">drag and drop to the web</a>. I'm launching a blogging service at <a href="https://lmno.lol">lmno.lol</a>. Looking for early adopters. <a href="https://indieweb.social/@xenodium">Get in touch</a>.</p>
