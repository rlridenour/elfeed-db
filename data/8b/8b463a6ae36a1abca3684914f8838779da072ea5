
	
<p>
Estimating the cost of a complex project is not a trivial task. Traditional cost estimates are full of assumptions about the future state of the market and the final deliverable. Monte Carlo cost estimates are a tool for better understanding your project&#39;s risks and enabling better cost control. Monte Carlo simulations are a technique to control your “known unknowns”.</p>
<p>
Albert Einstein famously said that “God does not play dice”. While this might or might not be the case, engineers play dice and embrace the stochastic nature of reality to predict the future. Monte Carlo Simulations are a method for estimating the cost of your project across thousands of parallel universes to assess financial risk. </p>
<p>
While I have a pet hate against using <a href="https://lucidmanager.org/management/alternative-risk-matrix-template/">matrices to manage risk</a>, Monte Carlo simulations are an analytical method for dealing with uncertainty and risk. This article explains the principles of Monte Carlo cost estimates and how to implement them in the R language for statistical computing.</p>
<p>
You can download the code from GitHub in the <code class="verbatim">case-studies</code> folder.</p>
<p>
<a href = "https://github.com/pprevos/r4h2o/" target="_blank"
   title="Download r4h2o from GitHub"
   alt="Download r4h2o from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">r4h2o</span>
  </button>
</a>

</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
The principles of cost estimates
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The basic principle of cost estimation is deceptively simple. To estimate the cost for each item in a project, multiply the quantity of work $Q_i$ times the rate $R_i$ you will pay for each unit of work. Sum the cost of each item, and you have the total project cost $P$ for a project with $j$ items:</p>
<p>
$$P = \sum_{i=1}^j Q_i R_i$$</p>
<p>
The reality is, unfortunately, more inconsistent than this equation can express. Determining the correct quantity and rate for each item is a fine art requiring knowledge of engineering and economics.</p>
<p>
Cost estimates reflect the state of knowledge at the time of developing them. Many aspects of the project have yet to be discovered and might only surface once we start digging. As the late <a href="https://medium.com/the-philosophers-stone/rumsfelds-logic-of-known-knowns-known-unknowns-and-unknown-unknowns-f506db31ac74">Donald Rumsfeld philosophically said</a>:</p>
<blockquote>
<p>… there are known knowns; there are things we know we know. We also know there are known unknowns; that is, we know there are things we do not know. But there are also unknown unknowns — the ones we don’t know, we don’t know.</p>
</blockquote>
<figure>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/REWeBzGuzCc?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

<figcaption>
Donald Rumsfeld.
</figcaption>
</figure>
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
Deterministic
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<p>The basic method is helpful, but it assumes we know the amount of work or the unit rate accurately. Both parameters are subject to uncertainty and risk because the project has yet to be realised. Only at the end of the project do we know precisely how much it costs.</p>
<p>
In deterministic cost estimation, this uncertainty is accounted for by adding a contingency to the estimate. This contingency is simply a percentage of the total. The less information about the project (usually at the early stages of development), the higher the rate.</p>
<p>
In the planning phases, 20% or even higher might be suitable, while uncertainty can be much lower after tender award. This uncertainty covers any risk that quantities or rates are higher, as well as unforeseen activities that were not costed. The table below shows a typical deterministic cost estimate.</p>
<figure>
<table>
<thead>
<tr>
<th>Item</th>
<th class="align-right">Quantity</th>
<th>Unit</th>
<th class="align-right">Rate</th>
<th class="align-right">Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>Materials</td>
<td class="align-right">12,000</td>
<td>$m^1$</td>
<td class="align-right">75</td>
<td class="align-right">$900,000</td>
</tr>
<tr>
<td>Excavation</td>
<td class="align-right">2,200</td>
<td>$m^3$</td>
<td class="align-right">15</td>
<td class="align-right">$33,000</td>
</tr>
<tr>
<td>Pipe laying</td>
<td class="align-right">12,000</td>
<td>$m^1$</td>
<td class="align-right">13</td>
<td class="align-right">$156,000</td>
</tr>
<tr>
<td><em>SUBTOTAL</em></td>
<td class="align-right"></td>
<td></td>
<td class="align-right"></td>
<td class="align-right"><em>$1,089,000</em></td>
</tr>
<tr>
<td>Contingency</td>
<td class="align-right"></td>
<td></td>
<td class="align-right">20%</td>
<td class="align-right">$217,000</td>
</tr>
<tr>
<td><strong>TOTAL</strong></td>
<td class="align-right"></td>
<td></td>
<td class="align-right"></td>
<td class="align-right"><strong>$1,306,000</strong></td>
</tr>
</tbody>
</table>
<figcaption>
Example of a simple pipeline project estimate.
</figcaption>
</figure>
<p>
A deterministic method is a blunt tool. Uncertainties are not estimated; they are based on rules of thumb. In this example, we cannot know which part of the project contributes most to the uncertainty or the likelihood of staying within budget. Is the project manager simply inflating the budget to reduce the risk of spending more? What is the probability that the project will cost more than the estimated amount? We cannot answer these questions with the deterministic method.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
Probabilistic
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>A better understanding of the financial risk in a project leads to better decisions. Probabilistic cost estimation methods assess the uncertainty of each item rather than applying a percentage to the total. Breaking the uncertainty into smaller chunks allows project managers to better understand the financial risk in their projects and reduces the risk of significant estimating errors.</p>
<p>
The quantity of work and the rate we pay vary with local conditions, external factors, market rates, and other conditions. We thus need to introduce an error rate $\epsilon_i$ for each item to account for the uncertainty in the estimate. Uncertainty relates to the inaccuracy of each cost item due to a lack of information. Thus, our formula for a project with $j$ items and $k$ events cost now becomes:</p>
<p>
$$P = \sum_{i=1}^j (Q_i R_i)+ \epsilon_i$$</p>
<p>
The most basic way to implement this concept is to assign a contingency to each item in the estimate and nominate the risk events in something like this:</p>
<figure>
<table>
<thead>
<tr>
<th>Item</th>
<th class="align-right">Quantity</th>
<th>Unit</th>
<th class="align-right">Rate</th>
<th class="align-right">Cost</th>
<th class="align-right">Uncertainty</th>
</tr>
</thead>
<tbody>
<tr>
<td>Materials</td>
<td class="align-right">12,000</td>
<td>$m^1$</td>
<td class="align-right">75</td>
<td class="align-right">$900,000</td>
<td class="align-right">$9,000</td>
</tr>
<tr>
<td>Excavation</td>
<td class="align-right">2,200</td>
<td>$m^3$</td>
<td class="align-right">15</td>
<td class="align-right">$33,000</td>
<td class="align-right">$16,500</td>
</tr>
<tr>
<td>Pipe laying</td>
<td class="align-right">12,000</td>
<td>$m^1$</td>
<td class="align-right">13</td>
<td class="align-right">$156,000</td>
<td class="align-right">$30,000</td>
</tr>
<tr>
<td><em>SUBTOTAL</em></td>
<td class="align-right"></td>
<td></td>
<td class="align-right"></td>
<td class="align-right"><em>$1,089,000</em></td>
<td class="align-right"><em>$55,500</em></td>
</tr>
<tr>
<td><strong>TOTAL</strong></td>
<td class="align-right"></td>
<td></td>
<td class="align-right"></td>
<td class="align-right"><strong>$1,144,500</strong></td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<figcaption>
Example of a simple pipeline project estimate.
</figcaption>
</figure>
<p>
Note that we now call it &#39;uncertainty&#39; rather than &#39;contingency&#39;. This terminology is more than a semantic difference, as we have estimated our uncertainty at the item level in the Work-Breakdown-Structure.</p>
<p>
This approach provides additional intelligence about where the project&#39;s risks lie, which can help the team allocate efforts where they are most needed. The fact that the estimate is lower than before is less interesting than what we can gather from the details. If this were my project, I would gather more information about the events with the highest relative uncertainty to reduce risk.</p>
<p>
A probabilistic cost estimate produces higher accuracy because the error rate for some items will be more controllable than for others. In the traditional method, the amount of contingency is anyone&#39;s best guess. Estimates often hide contingencies in cost items to reduce the risk of requesting more budget. While this approach is pragmatic, looking at each item is more transparent.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Monte Carlo Cost Estimate
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>The probabilistic approach in the table above is an acceptable way to assign uncertainties and risks. Still, it does not give us insight into how likely this estimate will eventuate.</p>
<p>
Experience shows that the final project outcome rarely matches the estimate. It is, after all, an estimate, not a prediction. In other words, if you do the same project thousands of times in parallel universes, you will have thousands of different outcomes. This science-fiction concept is the basis for Monte Carlo simulations. With some statistics, we can recreate this hypothetical situation by repeating the same estimate thousands of times and analysing the distribution of possible outcomes.</p>
<p>
Monte Carlo simulations model reality using large volumes of randomised numbers drawn from known distributions. They can be used for any situation where deterministic methods are too complex, such as <a href="https://lucidmanager.org/data-science/call-centre-workforce-planning-erlang-c-in-r/">modelling contact centre call traffic</a>, or in this case, a cost estimate.</p>
<p>
To add more information to the estimate, we assign each item a low, likely and high cost. The low cost ($a$) is rarely achieved and is your ‘bargain-basement’ price. The likely cost ($c$) is what you would typically use in your estimate. Finally, the high cost ($b$) is what you will pay when everything you can think of goes wrong. Statistically, each cost item now has a <a href="https://en.wikipedia.org/wiki/Triangular_distribution">triangular probability distribution</a>, visualised below.</p>
<figure>
<img src="https://upload.wikimedia.org/wikipedia/commons/4/45/Triangular_distribution_PMF.png" alt="Triangular probability density distribution" title="Triangular probability density function" width="400"/>
<figcaption>
Triangular probability density function.
</figcaption>
</figure>
<p>
Our cost estimate would now look something like this:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th class="align-right">Low</th>
<th class="align-right">Medium</th>
<th class="align-right">High</th>
</tr>
</thead>
<tbody>
<tr>
<td>Materials</td>
<td class="align-right">900000</td>
<td class="align-right">909000</td>
<td class="align-right">950000</td>
</tr>
<tr>
<td>Excavation</td>
<td class="align-right">33000</td>
<td class="align-right">49500</td>
<td class="align-right">50000</td>
</tr>
<tr>
<td>Pipe laying</td>
<td class="align-right">156000</td>
<td class="align-right">186000</td>
<td class="align-right">200000</td>
</tr>
</tbody>
</table>
<p>
For each item, we can calculate the average or any other percentile. The average cost of an item is $\frac{a+b+c}{3}$. The expected cost $x$ with likelihood $p$ is defined by the <a href="https://lucidmanager.org/data-science/percentile-calculations/">quantiles</a> for each item, given by:</p>
<p>
$$x_p = \begin{cases}
a + \sqrt{(b-a)(c-a)p} &amp; 0 \leq p \leq p_c \\
b - \sqrt{(b-a)(b-c)(1-p)} &amp; p_c &lt; p \leq 1
\end{cases}$$</p>
<p>
Where $p_c$ is the probability of the likely estimate ($c$): $p_c=\frac{c-a}{b-a}$, and $a \leq c$ and $b \geq c$.</p>
<figure>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Triangular_distribution_CMF.png/800px-Triangular_distribution_CMF.png" alt="Triangular cumulative distribution function" title="cumulative distribution function" width="400"/>
<figcaption>
Triangular cumulative distribution function.
</figcaption>
</figure>
<p>
While the triangular distribution is the most common method for assessing uncertainty, other distributions are possible; the principles remain the same. Be mindful, however, that most probability distributions range from minus to plus infinity, which is not a realistic assumption for cost estimates.</p>
<p>
If your cost estimate contains only one item, you are done, as you can calculate the project cost by plugging in a percentile $p$ into the formulas. The final project cost will be lower than this number at probability $p$. The chosen percentile depends on your risk appetite. A percentile of .95 provides much more confidence that the actual cost will be lower than the budget.</p>
<p>
But when the estimate includes multiple items, doing so analytically will be too complex for mere mortals. This situation is where the Monte Carlo technique comes in. The Monte Carlo method simulates reality by calculating thousands of possible outcomes. The result is not a singular number but a distribution of $n$ possible outcomes.</p>
<p>
The outcome of a Monte Carlo simulation is a cost estimate for thousands of parallel universes. If you were to undertake the project $n$ times, the distribution of the final cost is expected to resemble the simulation outcome.</p>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
Monte Carlo Simulation in R
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>Several R libraries can calculate triangular distributions. The <code class="verbatim">triangle</code> package provides a set of functions to work with <a href="https://bertcarnell.github.io/triangle/">triangular distributions</a>. The <code class="verbatim">rtriangle()</code> function provides a vector of random quantiles for the chosen distribution, as shown below:</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888"># Monte Carlo Simulation in R</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(triangle)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888"># Triangular distribution</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">hist</span>(<span style="color:#06b;font-weight:bold">rtriangle</span>(n <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">10000</span>, a <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">12000</span>, b <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">15000</span>, c <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">14000</span>), 
</span></span><span style="display:flex;"><span>       breaks <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">100</span>, 
</span></span><span style="display:flex;"><span>       main <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;Triangular distribution simulation&#34;</span>)</span></span></code></pre></div>
</div>
<p>
When plotting the histogram of these results, the triangular shape becomes evident, albeit a bit rough around the edges. Notice that a Monte Carlo simulation is only ever an estimate. The higher the number of simulations (in this diagram, 10,000), the higher the resolution of the result. To test this proposition, change the <code class="verbatim">n</code> parameter in the <code class="verbatim">rtriangle()</code> function.</p>
<figure>
<img src="https://lucidmanager.org/images/hydroinformatics/triangular-distribution.png" alt="Simulated triangular distribution" title="Simulated triangular distribution"/>
<figcaption>
Simulated triangular distribution.
</figcaption>
</figure>
<p>
To add the probability distribution of all your cost items, store all simulations in a matrix with <code class="verbatim">n</code> columns (number of simulations) and <code class="verbatim">j</code> (number of cost items) rows. Then, in the next step, you add all the simulated values and create a histogram or calculate percentiles.</p>
<p>
The example below reads a CSV file with the same content as the table above. It then creates a results matrix, runs the simulations and calculates and visualises the results.</p>
<p>
The <code>set.seed(1234)</code> function fixes the pseudo-random number generator to always use the same &#39;random&#39; numbers. This way we always have the same result instead of introducing stochastic noise. If you need true randomness, then use a <a href="https://cran.r-project.org/web/packages/random/index.html">specialised random generator package</a> that obtains numbers form the <a href="https://random.org/">random.org</a> website.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Read Data</span>
</span></span><span style="display:flex;"><span>  estimate <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">read.csv</span>(<span style="background-color:#fff0f0">&#34;data/cost-estimate.csv&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Simulation settings</span>
</span></span><span style="display:flex;"><span>  n <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">10000</span> <span style="color:#888">## Simulations</span>
</span></span><span style="display:flex;"><span>  j <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">nrow</span>(estimate)
</span></span><span style="display:flex;"><span>  mc_sims <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">matrix</span>(ncol <span style="color:#333">=</span> n,
</span></span><span style="display:flex;"><span>                    nrow <span style="color:#333">=</span> j)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Simulation</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">set.seed</span>(<span style="color:#60e;font-weight:bold">1234</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-weight:bold">for</span> (i <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">1</span><span style="color:#333">:</span>j){
</span></span><span style="display:flex;"><span>    mc_sims[i,] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">rtriangle</span>(n <span style="color:#333">=</span> n,
</span></span><span style="display:flex;"><span>                             a <span style="color:#333">=</span> estimate<span style="color:#333">$</span>Low[i],
</span></span><span style="display:flex;"><span>                             b <span style="color:#333">=</span> estimate<span style="color:#333">$</span>High[i],
</span></span><span style="display:flex;"><span>                             c <span style="color:#333">=</span> estimate<span style="color:#333">$</span>Medium[i])}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Determine estimates and 95th percentile</span>
</span></span><span style="display:flex;"><span>  mc_results <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">colSums</span>(mc_sims)
</span></span><span style="display:flex;"><span>  p95 <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">quantile</span>(mc_results, <span style="color:#60e;font-weight:bold">0.95</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Visualise</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">hist</span>(mc_results, breaks <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">100</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">abline</span>(v <span style="color:#333">=</span> p95, col <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;red&#34;</span>, lwd <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">2</span>)</span></span></code></pre></div>
</div>
<p>
A Monte Carlo simulation outcome is thus never one number but a vector of numbers from which you can analyse. The example below uses the 95<sup>th</sup> percentile as the budget figure.</p>
<p>
Adding triangular distributions will create a new distribution specific to this project. The <code class="verbatim">mc_results</code> vector holds the estimated possible total cost.</p>
<p>
To set a budget figure, you need to nominate a percentile. The 50<sup>th</sup> percentile has an equal chance of being higher or lower than the actual. You should choose the 95<sup>th</sup> percentile or whatever percentile matches your risk appetite to have more certainty that a sufficient budget is available.</p>
<figure>
<img src="https://lucidmanager.org/images/hydroinformatics/monte-carlo-estimate.png" alt="Monte Carlo cost estimate" title="Monte Carlo cost estimate"/>
<figcaption>
Monte Carlo cost estimate and 95<sup>th</sup> percentile.
</figcaption>
</figure>
<p>
Monte Carlo cost estimates are not only for projects. You can also undertake these calculations at the program level and assess the level of financial risk you hold within the program. </p>
<p>
Monte Carlo cost estimates are a powerful tool for better understanding your project. They are, however, like any modelling, subject to the GiGo principle (Garbage-in-Garbage-out). Therefore, determining the low, likely and high costs will require domain knowledge. While these three estimates have their level of uncertainty, they will provide better insights than relying only on a monolithic amount for contingency.</p>
<p>
Probabilistic cost estimates do not guarantee that your project will remain under budget, but they help you achieve this elusive goal.</p>
<p>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
</div>
</div>
</div>
</div>

      