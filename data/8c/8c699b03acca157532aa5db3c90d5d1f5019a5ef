<p>I am of course using org mode for organizing my tasks, notes and other paraphernalia.</p>
<figure><img src="https://emacs.dyerdwelling.family/ox-hugo/20240918111443-emacs--Transforming-Dired-File-Paths-into-Org-Links-with-Emacs-Lisp.jpg" width="100%">
</figure>

<p>In addition, I generate static web pages from org using <strong><code>hugo</code></strong>, with each org heading representing a single post.</p>
<p>I often find myself needing to refer to files stored in a directory, especially image files that can be org embedded and then passed through to Hugo by the <code>ox-hugo</code> package.</p>
<p>Navigating to the file and manually generating the appropriate org link can be just a little cumbersome - to initially pick up the file name and then insert the relevant org attributes.</p>
<p><code>dired-copy-filename-as-kill</code> is a function I often use in <code>dired</code>, which copies the filename under point. I can then use something like <code>tempel</code> to insert the attributes. However, while the combination of copying the filename in <code>dired</code> and then remembering the <code>tempel</code> shortcode is quite efficient, I think this could be accomplished more cleanly with some Elisp and a <code>dired-mode</code> mapping.</p>
<p>Here is a typical embedded image form, which restricts the image within the org document to 300 pixels and to 100% width when exported through hugo to my web site.</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:emacs/20240918111443-emacs--Transforming-Dired-File-Paths-into-Org-Links-with-Emacs-Lisp.jpg]]
</code></pre><p>Lets walk through a custom function, <code>my/dired-file-to-org-link</code>, which transforms the <code>dired</code> file path under cursor/point into an org link and copies it to the kill ring for easy pasting.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun my/dired-file-to-org-link ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Transform the file path under the cursor in Dired to an Org mode
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">link and copy to kill ring.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (let ((file-path (dired-get-file-for-visit)))
</span></span><span style="display:flex;"><span>    (if file-path
</span></span><span style="display:flex;"><span>        (let* ((relative-path (file-relative-name file-path
</span></span><span style="display:flex;"><span>                                                  (project-root (project-current <span style="color:#66d9ef">t</span>))))
</span></span><span style="display:flex;"><span>               (org-link (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;#+attr_org: :width 300px\n&#34;</span>
</span></span><span style="display:flex;"><span>                                 <span style="color:#e6db74">&#34;#+attr_html: :width 100%\n&#34;</span>
</span></span><span style="display:flex;"><span>                                 <span style="color:#e6db74">&#34;file:&#34;</span> relative-path <span style="color:#e6db74">&#34;\n&#34;</span>)))
</span></span><span style="display:flex;"><span>          (kill-new org-link)
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;Copied to kill ring: %s&#34;</span> org-link))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;No file under the cursor&#34;</span>))))
</span></span></code></pre></div><p>When <code>my/dired-file-to-org-link</code> is called in a dired buffer, it gets the file path under the point, transforms it into an Org link with specific attributes, and copies the link to the kill ring. This enables you to quickly paste it into your Org file.</p>
<p>I map this to the letter <code>b</code> in the <code>dired-mode</code> mapping, which for me mnemonically refers to (b)log and the b key is not one I currently use in dired.</p>
<p>Note also the use of project.el with the project functions, as I have a project top level defined for my website content, allowing for an easily generated relative path name.</p>
<p>Therefore for example,  <code>20240918111443-emacs--Transforming-Dired-File-Paths-into-Org-Links-with-Emacs-Lisp.jpg</code> from dired in an <code>emacs</code> directory is transformed into :</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:emacs/20240918111443-emacs--Transforming-Dired-File-Paths-into-Org-Links-with-Emacs-Lisp.jpg]]
</code></pre>