<p>It is not uncommon for me to want the ability to quickly duplicate a file, especially if I am hacking around and just want a quick snapshot of a working file.</p>
<p>Previously I was using <code>dired</code> in a slightly convoluted manner, namely:</p>
<ul>
<li>open dired</li>
<li>cursor over the desired item to rename</li>
<li><code>w</code> (dired-copy-filename-as-kill)</li>
<li><code>C</code> (dired-do-copy)</li>
<li>paste from the kill ring (yank)</li>
<li>modify the filename as desired</li>
<li>return</li>
</ul>
<p>But I never actually used this functionality so I think its time for a different approach.</p>
<p>Since I have recently been delving into <strong>elisp</strong> I thought I would write an interactive function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun my/dired-duplicate-file (arg)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Duplicate the current file in Dired.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive <span style="color:#e6db74">&#34;p&#34;</span>)
</span></span><span style="display:flex;"><span>  (let ((filename (dired-get-filename)))
</span></span><span style="display:flex;"><span>    (setq target (<span style="color:#a6e22e">concat</span> (file-name-sans-extension filename)
</span></span><span style="display:flex;"><span>                   <span style="color:#e6db74">&#34;-old&#34;</span>
</span></span><span style="display:flex;"><span>                   (if (<span style="color:#a6e22e">&gt;</span> arg <span style="color:#ae81ff">1</span>) (<span style="color:#a6e22e">number-to-string</span> arg))
</span></span><span style="display:flex;"><span>                   (file-name-extension filename <span style="color:#66d9ef">t</span>)))
</span></span><span style="display:flex;"><span>    (if (<span style="color:#a6e22e">file-directory-p</span> filename)
</span></span><span style="display:flex;"><span>      (copy-directory filename target)
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">copy-file</span> filename target))
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">define-key</span> dired-mode-map (kbd <span style="color:#e6db74">&#34;C-c d&#34;</span>) <span style="color:#e6db74">&#39;my/dired-duplicate-file</span>)
</span></span></code></pre></div><p>The function first gets the name of the current file in the Dired buffer using `dired-get-filename`. It then creates a new filename for the duplicated file by appending &ldquo;-old&rdquo; to the base filename (i.e., without the extension), followed by the number specified by the `arg` prefix argument, and the original file extension.</p>
<p>For example, if the `arg` argument is 3, and the original filename is &ldquo;example.txt&rdquo;, the duplicated filename would become &ldquo;example-old3.txt&rdquo;.</p>
<p>The function then checks if the file is a directory using `file-directory-p`. If the file is a directory, it copies the entire directory to the new target directory. If the file is a regular file, it copies the file to the new target file.</p>
<p>The function is interactive, meaning it can be invoked with a key press or command invocation. The function does not return a value.</p>
<hr>
<p>Could you tell I used ChatGPT to describe this function?, well it was accurate, very precise, but very clinical, possibly useful for the quick documenting of written functions though.</p>
<p>I prefer the following more human approach:</p>
<blockquote>
<p>By default a quick flick of the fingers would duplicate rename a file or directory via emacs <code>dired</code> adding the keyword <code>old</code> and potentially a numeric value by means of the universal argument.</p>
</blockquote>
<p>Most of the time I just want a quick single backup but for more duplicates there is the option of a quick C-u (adds a 4) and a C-u C-u (a 16) e.t.c</p>
<figure><img src="https://emacs.dyerdwelling.family/ox-hugo/20230606213531-emacs--Dired-Duplicate-Here-Revisited.jpg" width="300px">
</figure>

<p>That should do me for now, lets see how I get on!</p>