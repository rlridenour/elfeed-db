<h2 id="the-intro">The intro</h2>
<p>Every Emacs user that I know changes the hell out of the look and feel of their UI. I am no different here.</p>
<p>The following is a list of the function, that use in my module <a href="https://gitlab.com/aimebertrand/dotemacs/-/blob/main/libraries/timu-ui.el">timu-ui.el</a>.</p>
<p>Of course feel free to browse my <a href="https://gitlab.com/aimebertrand/dotemacs">.emacs.d</a> for context ;).</p>
<p align="center"><img src="https://gitlab.com/aimebertrand/timu-caribbean-theme/-/raw/main/img/timu-caribbean.png" width="100%"/></p>
<h2 id="the-functions">The functions</h2>
<h3 id="timu-ui-with-face">timu-ui-with-face</h3>
<p>A very simple function to propertize a string with face property lists similar to <code>set-face-attribute</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-ui-with-face</span> <span class="p">(</span><span class="nv">str</span> <span class="kp">&amp;rest</span> <span class="nv">face-plist</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Propertize STR with FACE-PLIST.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">propertize</span> <span class="nv">str</span> <span class="ss">&#39;face</span> <span class="nv">face-plist</span><span class="p">))</span>
</span></span></code></pre></div><p>Example from my eshell prompt customization:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">timu-ui-with-face</span> <span class="s">&#34;$&#34;</span> <span class="nb">:inherit</span> <span class="nv">font-lock-preprocessor-face</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="timu-ui-load-theme">timu-ui-load-theme</h3>
<p>Emacs has an interactive function to load a theme, <code>load-theme</code>. However in my experience, some face attributes of the last active theme <code>custom-enabled-themes</code> remain visible, depending on the themes. I don&rsquo;t like it.</p>
<p>This function does remedy the issue by first disabling the last enabled theme.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-ui-load-theme</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;</span><span class="ss">`load-theme&#39;</span><span class="s"> without confirmation and with completion.
</span></span></span><span class="line"><span class="cl"><span class="s">Disables the </span><span class="ss">`custom-enabled-themes&#39;</span><span class="s"> first to start with a blank canvas.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">next-theme</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">completing-read</span> <span class="s">&#34;Load custom theme: &#34;</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">(</span><span class="nv">custom-available-themes</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">load-theme</span> <span class="p">(</span><span class="nf">intern</span> <span class="nv">next-theme</span><span class="p">)</span> <span class="no">t</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="timu-ui-flash-mode-line">timu-ui-flash-mode-line</h3>
<p>Remember the bell that goes of on when an &ldquo;exception&rdquo; occurs? Annoying right? You can of course set the variable <code>visible-bell</code> to <code>t</code> to flash the frame instead. However I find even that to be vexing.</p>
<p>This function makes just the modeline flash, &hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-ui-flash-mode-line</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Flash the modeline on error or warning instead of the bell.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">invert-face</span> <span class="ss">&#39;mode-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">run-with-timer</span> <span class="mf">0.1</span> <span class="no">nil</span> <span class="nf">#&#39;</span><span class="nv">invert-face</span> <span class="ss">&#39;mode-line</span><span class="p">))</span>
</span></span></code></pre></div><p>&hellip; when set as:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">(</span>customize-set-variable <span class="s1">&#39;ring-bell-function &#39;</span>timu-ui-flash-mode-line<span class="o">)</span>
</span></span></code></pre></div><h3 id="just-for-macos">Just for macOS</h3>
<p>I use the either <a href="https://github.com/railwaycat/homebrew-emacsmacport">emacs-mac</a> or the <a href="https://github.com/d12frosted/homebrew-emacs-plus">emacs-plus</a> port of Emacs. These are ports of Emacs, that are better adapted to macOS. These bring different facilities to automatically switch to dark or light mode with the OS. Hence the following functions.</p>
<p>Emacs uses the variable <code>ns-system-appearance-change-functions</code> (emacs-plus) or the hook <code>mac-effective-appearance-change-hook</code> (emacs-mac) respectively. These are keep track with the macOS state to run the hook/function.</p>
<p align="center"><img src="https://gitlab.com/aimebertrand/timu-macos-theme/-/raw/main/img/timu-macos-theme-darker-1.png" width="100%"/></p>
<h4 id="timu-ui-theme-hook">timu-ui-theme-hook</h4>
<p>The hook that gets automatically applied on the change to either dark or light mode in macOS.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-ui-theme-hook</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">appearance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;Hook to change the theme to light or dark.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Check the systems APPEARANCE in </span><span class="ss">`ns-system-appearance&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">Or get by getting the APPEARANCE value of (</span><span class="ss">`mac-application-state&#39;</span><span class="s">).
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Set the variable </span><span class="ss">`timu-macos-flavour&#39;</span><span class="s"> to \&#34;light\&#34; or \&#34;dark\&#34; accordingly.
</span></span></span><span class="line"><span class="cl"><span class="s">This is for the case the </span><span class="ss">`timu-macos-theme&#39;</span><span class="s"> is used.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Disable all </span><span class="ss">`custom-enabled-themes&#39;</span><span class="s"> and load the theme in:
</span></span></span><span class="line"><span class="cl"><span class="s">either </span><span class="ss">`timu-ui-custom-light-theme&#39;</span><span class="s"> or </span><span class="ss">`timu-ui-custom-dark-theme&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">boundp</span> <span class="ss">&#39;ns-system-appearance-change-functions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="c1">;; for emacs-plus:</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nb">pcase</span> <span class="nv">appearance</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="ss">&#39;light</span> <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nv">customize-set-variable</span> <span class="ss">&#39;timu-spacegrey-flavour</span> <span class="s">&#34;light&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nv">load-theme</span> <span class="nv">timu-ui-custom-light-theme</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="ss">&#39;dark</span> <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nv">customize-set-variable</span> <span class="ss">&#39;timu-spacegrey-flavour</span> <span class="s">&#34;dark&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nv">load-theme</span> <span class="nv">timu-ui-custom-dark-theme</span> <span class="no">t</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">       <span class="c1">;; for emacsmacport:</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">mac-mode</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nv">mac-application-state</span><span class="p">)</span> <span class="nb">:appearance</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nf">equal</span> <span class="nv">mac-mode</span> <span class="s">&#34;NSAppearanceNameAqua&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nv">customize-set-variable</span> <span class="ss">&#39;timu-spacegrey-flavour</span> <span class="s">&#34;light&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                       <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                       <span class="p">(</span><span class="nv">load-theme</span> <span class="nv">timu-ui-custom-light-theme</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">               <span class="p">((</span><span class="nf">equal</span> <span class="nv">mac-mode</span> <span class="s">&#34;NSAppearanceNameDarkAqua&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nv">customize-set-variable</span> <span class="ss">&#39;timu-spacegrey-flavour</span> <span class="s">&#34;dark&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                       <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                       <span class="p">(</span><span class="nv">load-theme</span> <span class="nv">timu-ui-custom-dark-theme</span> <span class="no">t</span><span class="p">)))))))</span>
</span></span></code></pre></div><h4 id="timu-ui-load-theme-hook">timu-ui-load-theme-hook</h4>
<p>Well this runs the aforementioned hook function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-ui-load-theme-hook</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;Function to add </span><span class="ss">`timu-ui-theme-hook&#39;</span><span class="s"> as a hook.
</span></span></span><span class="line"><span class="cl"><span class="s">Change theme with </span><span class="ss">`ns-system-appearance-change-functions&#39;</span><span class="s"> for emacs-plus.
</span></span></span><span class="line"><span class="cl"><span class="s">Or change theme with </span><span class="ss">`mac-effective-appearance-change-hook&#39;</span><span class="s"> for emacsmacport.&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">boundp</span> <span class="ss">&#39;ns-system-appearance-change-functions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ns-system-appearance-change-functions</span> <span class="ss">&#39;timu-ui-theme-hook</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;mac-effective-appearance-change-hook</span> <span class="nf">#&#39;</span><span class="nv">timu-ui-theme-hook</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="nf">#&#39;</span><span class="nv">timu-ui-theme-hook</span><span class="p">))))</span>
</span></span></code></pre></div><p><strong>ET VOILÃ€.</strong></p>
