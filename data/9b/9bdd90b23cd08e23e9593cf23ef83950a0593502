<p>For a long time I&rsquo;ve used a little macro to time chunks of code to avoid an endless succession of boilerplate functions to do this. I&rsquo;ve finally published the wretched thing.</p>
<!-- more-->

<p>If you&rsquo;re writing programs where you care about performance, you often want to be able to make programatic comparisons of performance. <code>time</code> doesn&rsquo;t do this, since it just reports things. Instead you want something that runs a bit of code a bunch of times and then returns the average time, with &lsquo;a bunch of times&rsquo; being controllable. <code>timing</code> is that macro. Here is a simple example:</p>

<pre class="brush: lisp"><code>(defun dotimes/in-naturals-ratio (&amp;key (iters 10000000) (tries 1000))
  (declare (type fixnum iters)
           (optimize speed))
  (/
   (timing (:n tries)
     (let ((s 0))                       ;avoid optimizing loop away
       (declare (type fixnum s))
       (dotimes (i iters s)
         (incf s))))
   (timing (:n tries)
     (let ((s 0))
       (declare (type fixnum s))
       (for ((_ (in-naturals iters t)))
         (incf s))))))</code></pre>

<p>and then, for instance</p>

<pre><code>&gt; (dotimes/in-naturals-ratio)
1.0073159</code></pre>

<p>All <code>timing</code> does is to wrap up its body into a function and then call a function which calls this function the number of times you specify and averages the time, returning that average as a float.</p>

<p>There are some options which let it print a progress note every given number of calls, wrap a call to <code>time</code> around things so you get, for instance, GC reporting, and subtract away the same number of calls to an empty function to try and account for overhead (in practice this is not very useful).</p>

<p>That&rsquo;s all it is. It&rsquo;s available in version 10 of my Lisp tools:</p>

<ul>
 <li>documentation <a href="https://tfeb.org/fragments/documentation/tfeb-lisp-tools.html">here</a>;</li>
 <li>git repo <a href="https://tfeb.org/computer/repos/tfeb-lisp-tools.git">here</a>;</li>
 <li>tarball <a href="https://tfeb.org/computer/tarballs/tfeb-lisp-tools.tar.gz">here</a>.</li></ul>