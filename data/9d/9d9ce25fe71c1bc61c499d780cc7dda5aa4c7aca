
	
<p>
Understanding who you are is strongly related to understanding your family history. Discovering ancestors is now a popular hobby, as many archives are available on the internet. The GEDCOM format provides a standardised way to store information about ancestors. This article shows how to develop a GEDCOM reader using the R language.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
The GEDCOM format
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The GEDCOM format is not an ideal way to store information, but it has become the de-facto standard for family history. This format includes metadata and two sets of data. The file contains a list of the individuals, and it lists the families to which they belong.</p>
<p>
The basic principle is that each line has a level, indicated by the first digit. At level zero, we find metadata and the individuals and their family. At level one, we see the various types of data, such as births, deaths and marriages. The deeper levels provide the data for these events.</p>
<p>
<a href="http://heiner-eichmann.de/gedcom/gedcom.htm">Heiner Eichmann</a> maintains a website that explains the format and provides some examples of files to help you understand the syntax.</p>
<p>
The GEDCOM format is not only old in the way it stores data, but it is also limited in the types of human relationships. These files only store genetic relationships between people and assume that these relationships are marriages between a wife and a husband. Human relationships are, however, a lot more complicated than the genetic relationships between children and their parents, grandparents and ancestors.</p>
<p>
These issues aside, all genealogical software can export a file to GEDCOM. The next section shows how to create a basic GEDCOM reader using the <a href="https://stringr.tidyverse.org/">stringr</a>, <a href="https://tibble.tidyverse.org/">tibble</a> and <a href="https://dplyr.tidyverse.org/">dplyr</a> packages from the <a href="https://www.tidyverse.org/">Tidyverse</a>.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
GEDCOM Reader
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>The <code class="verbatim">read.gedcom()</code> function takes a GEDCOM file as input and delivers a data frame (tibble) with basic information:</p>
<ul>
<li>ID</li>
<li>Full name</li>
<li>Gender</li>
<li>Birthdate and place</li>
<li>Father</li>
<li>Mother</li>
<li>Death date and place</li>
</ul>
<p>This code only can be easily expanded to include further fields by adding lines in the while-loops and including the fields in the data frame.</p>
<p>
The first lines read the file and setup the data frame. The <code class="verbatim">extract()</code> function extracts an individual&#39;s ID from a line in the file. The for loop runs through each line of the GEDCOM file. When the start of a new individual is detected, the GEDCOM reader collects the relevant information.</p>
<p>
Births and christenings are considered equal to simplify the data. In older data, we often only know one or the other. The function looks for the start of a family. It extracts the husband and wife and assigns these as parents to each of the children. The last section cleans the data and returns the result.</p>
<p>
<a href = "https://github.com/pprevos/digital-humanities/" target="_blank"
   title="Download digital-humanities from GitHub"
   alt="Download digital-humanities from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">digital-humanities</span>
  </button>
</a>

</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Read GEDCOM file for individuals</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(stringr)
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(lubridate)
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(dplyr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  read_gedcom_ind <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(gedcom_loc) {
</span></span><span style="display:flex;"><span>    gedcom <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">str_squish</span>(<span style="color:#06b;font-weight:bold">readLines</span>(gedcom_loc))
</span></span><span style="display:flex;"><span>    idv <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">sum</span>(<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;^0.*INDI$&#34;</span>, gedcom))
</span></span><span style="display:flex;"><span>    fam <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">sum</span>(<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;^0.*FAM$&#34;</span>, gedcom))
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">cat</span>(<span style="color:#06b;font-weight:bold">paste</span>(<span style="background-color:#fff0f0">&#34;Individuals: &#34;</span>, idv, <span style="background-color:#fff0f0">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">cat</span>(<span style="color:#06b;font-weight:bold">paste</span>(<span style="background-color:#fff0f0">&#34;Families: &#34;</span>, fam, <span style="background-color:#fff0f0">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>    family <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">data.frame</span>(id <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Full_Name <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Gender <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Birth_Date <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Birth_Place <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Father_id <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Mother_id <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Death_Date <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>,
</span></span><span style="display:flex;"><span>                         Death_Place <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#888">## Extract data</span>
</span></span><span style="display:flex;"><span>    extract <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(line, type) {
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">str_trim</span>(<span style="color:#06b;font-weight:bold">str_sub</span>(line, <span style="color:#06b;font-weight:bold">str_locate</span>(line, type)[2] <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    id <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-weight:bold">for</span> (l <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">1</span><span style="color:#333">:</span><span style="color:#06b;font-weight:bold">length</span>(gedcom)) {
</span></span><span style="display:flex;"><span>      <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;^0&#34;</span>) <span style="color:#333">&amp;</span> <span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;INDI$&#34;</span>)) {
</span></span><span style="display:flex;"><span>        id <span style="color:#333">&lt;-</span> id <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        family[id, <span style="background-color:#fff0f0">&#34;id&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">unlist</span>(<span style="color:#06b;font-weight:bold">str_split</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;@&#34;</span>))[2]
</span></span><span style="display:flex;"><span>        l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-weight:bold">while</span>(<span style="color:#333">!</span><span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;^0&#34;</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;NAME&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>            family[id, <span style="background-color:#fff0f0">&#34;Full_Name&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">extract</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;NAME&#34;</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;SEX&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>            family[id, <span style="background-color:#fff0f0">&#34;Gender&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">extract</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;SEX&#34;</span>)
</span></span><span style="display:flex;"><span>          l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;BIRT|CHR&#34;</span>, gedcom[l])) {
</span></span><span style="display:flex;"><span>            l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#080;font-weight:bold">while</span> (<span style="color:#333">!</span><span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;^1&#34;</span>)) {
</span></span><span style="display:flex;"><span>              <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;DATE&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>                family[id, <span style="background-color:#fff0f0">&#34;Birth_Date&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">extract</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;DATE&#34;</span>)
</span></span><span style="display:flex;"><span>              <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;PLAC&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>                family[id, <span style="background-color:#fff0f0">&#34;Birth_Place&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">extract</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;PLAC&#34;</span>)
</span></span><span style="display:flex;"><span>              l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;DEAT|BURI&#34;</span>, gedcom[l])) {
</span></span><span style="display:flex;"><span>            l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#080;font-weight:bold">while</span> (<span style="color:#333">!</span><span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;^1&#34;</span>)) {
</span></span><span style="display:flex;"><span>              <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;DATE&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>                family[id, <span style="background-color:#fff0f0">&#34;Death_Date&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">extract</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;DATE&#34;</span>)
</span></span><span style="display:flex;"><span>              <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;PLAC&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>                family[id, <span style="background-color:#fff0f0">&#34;Death_Place&#34;</span>] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">extract</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;PLAC&#34;</span>)
</span></span><span style="display:flex;"><span>              l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;^0&#34;</span>) <span style="color:#333">&amp;</span> <span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;FAM&#34;</span>)) {
</span></span><span style="display:flex;"><span>        l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-weight:bold">while</span>(<span style="color:#333">!</span><span style="color:#06b;font-weight:bold">str_detect</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;^0&#34;</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;HUSB&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>            husband <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">unlist</span>(<span style="color:#06b;font-weight:bold">str_split</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;@&#34;</span>))[2]
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;WIFE&#34;</span>, gedcom[l]))
</span></span><span style="display:flex;"><span>            wife <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">unlist</span>(<span style="color:#06b;font-weight:bold">str_split</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;@&#34;</span>))[2]
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">grepl</span>(<span style="background-color:#fff0f0">&#34;CHIL&#34;</span>, gedcom[l])) {
</span></span><span style="display:flex;"><span>            child <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">which</span>(family<span style="color:#333">$</span>id <span style="color:#333">==</span> <span style="color:#06b;font-weight:bold">unlist</span>(<span style="color:#06b;font-weight:bold">str_split</span>(gedcom[l], <span style="background-color:#fff0f0">&#34;@&#34;</span>))[2])
</span></span><span style="display:flex;"><span>            family[child, <span style="background-color:#fff0f0">&#34;Father_id&#34;</span>] <span style="color:#333">&lt;-</span> husband
</span></span><span style="display:flex;"><span>            family[child, <span style="background-color:#fff0f0">&#34;Mother_id&#34;</span>] <span style="color:#333">&lt;-</span> wife
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          l <span style="color:#333">&lt;-</span> l <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    family <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">mutate</span>(Full_Name <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">gsub</span>(<span style="background-color:#fff0f0">&#34;/&#34;</span>, <span style="background-color:#fff0f0">&#34;&#34;</span>, <span style="color:#06b;font-weight:bold">str_trim</span>(Full_Name)),
</span></span><span style="display:flex;"><span>             Birth_Date <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">as.Date</span>(family<span style="color:#333">$</span>Birth_Date, format <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;%d %b %Y&#34;</span>),
</span></span><span style="display:flex;"><span>             Death_Date <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">as.Date</span>(family<span style="color:#333">$</span>Death_Date, format <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;%d %b %Y&#34;</span>))
</span></span><span style="display:flex;"><span>  }</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Analysing the data
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>There are many websites with GEDCOM files of family histories of famous and not so famous people. The
<a href="https://webtreeprint.com/tp_famous_gedcoms.php">Famous GEDCOMs</a> website has a few useful examples to test the GEDCOM reader.</p>
<p>
Once the data is in a data frame, you can analyse it any way you please. The code below downloads a file with the presidents of the US, with their ancestors and descendants. The <code class="verbatim">alive()</code> function filters people who are alive at a certain date. For people without birth date, it sets a maximum age of 100 years.</p>
<p>
The histogram shows the distribution of ages at time of death of all the people in the presidents file.</p>
<p>
These are just some random examples of how to analyse family history data with this GEDCOM reader. The next article will explain how to plot a population pyramid using this data. A future article will discuss how to visualise the structure of family history.</p>
<figure>
<img src="https://lucidmanager.org/images/digital-humanities/us-presidents-birth-years.png" alt="Birth years of people of U SPresidents" title="Birth years of people of US Presidents"/>
<figcaption>
Birth years of people of in the Presidents file.
</figcaption>
</figure>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Basic family history statistics</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  presidents <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">read_gedcom_ind</span>(<span style="background-color:#fff0f0">&#34;https://webtreeprint.com/tp_downloader.php?path=famous_gedcoms/pres.ged&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">mutate</span>(presidents, Year <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">year</span>(Birth_Date)) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">ggplot</span>(<span style="color:#06b;font-weight:bold">aes</span>(Year)) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">geom_histogram</span>(binwidth <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">10</span>, fill <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;#6A6A9D&#34;</span>, col <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;white&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">labs</span>(title <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;Birth years in the presidents file&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">ggsave</span>(<span style="background-color:#fff0f0">&#34;us-presidents-birth-year.png&#34;</span>)</span></span></code></pre></div>
</div>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>

</div>
</div>

      