
	
<p>
Project Euler 33 takes us back to the world of fractions from our primary school days. This article provides a solution for the Euler problem and discusses how to solve this problem using Farey sequences and how to visualise Ford Circles with the <em>ggplot2</em> package.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Project Euler 33 Definition
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The fraction 49/98 is curious, as an inexperienced mathematician in attempting to simplify it may incorrectly believe that 49/98 = 4/8, which is correct, is obtained by cancelling the nines. We shall consider fractions like 30/50 = 3/5, to be trivial examples.</p>
<p>
There are precisely four nontrivial examples of this type of fraction, less than one in value, and containing two digits in the numerator and denominator. If the product of these four fractions is given in its lowest common terms, <a href="https://projecteuler.net/problem=33">find the value of the denominator</a>.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Proposed Solution in R
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>To solve this problem, we create a pseudo-Farey sequence by generating all different fractions with two decimals in the numerator and denominator. The loop generates all combinations of denominators and numerators, excluding the trivial ones (multiples of 10 and 11). This solution converts the numbers to strings, strips any common duplicates, and tests the condition. The code concatenates vectors, which is not good practice. However, the loop is so short it does not matter much.</p>
<p>
<a href = "https://github.com/pprevos/ProjectEuler/" target="_blank"
   title="Download ProjectEuler from GitHub"
   alt="Download ProjectEuler from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">ProjectEuler</span>
  </button>
</a>

</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Project Euler 33: Digit Cancelling Fractions</span>
</span></span><span style="display:flex;"><span>  num <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">vector</span>()
</span></span><span style="display:flex;"><span>  den <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">vector</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-weight:bold">for</span> (a <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">11</span><span style="color:#333">:</span><span style="color:#60e;font-weight:bold">99</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#080;font-weight:bold">for</span> (b <span style="color:#080;font-weight:bold">in</span> (a <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>)<span style="color:#333">:</span><span style="color:#60e;font-weight:bold">99</span>) {
</span></span><span style="display:flex;"><span>          trivial <span style="color:#333">&lt;-</span> (a <span style="color:#333">%%</span> <span style="color:#60e;font-weight:bold">10</span> <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">0</span> <span style="color:#333">|</span> b <span style="color:#333">&amp;&amp;</span> <span style="color:#60e;font-weight:bold">10</span> <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">0</span> <span style="color:#333">|</span> a <span style="color:#333">%%</span> <span style="color:#60e;font-weight:bold">11</span> <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">0</span> <span style="color:#333">|</span> b <span style="color:#333">%%</span> <span style="color:#60e;font-weight:bold">11</span> <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">0</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (<span style="color:#333">!</span>trivial) {
</span></span><span style="display:flex;"><span>              i <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">as.numeric</span>(<span style="color:#06b;font-weight:bold">unlist</span>(<span style="color:#06b;font-weight:bold">strsplit</span>(<span style="color:#06b;font-weight:bold">as.character</span>(a), <span style="background-color:#fff0f0">&#34;&#34;</span>)))
</span></span><span style="display:flex;"><span>              j <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">as.numeric</span>(<span style="color:#06b;font-weight:bold">unlist</span>(<span style="color:#06b;font-weight:bold">strsplit</span>(<span style="color:#06b;font-weight:bold">as.character</span>(b), <span style="background-color:#fff0f0">&#34;&#34;</span>)))
</span></span><span style="display:flex;"><span>              digs <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(i, j)
</span></span><span style="display:flex;"><span>              dup <span style="color:#333">&lt;-</span> digs<span style="color:#06b;font-weight:bold">[duplicated</span>(digs)]
</span></span><span style="display:flex;"><span>              digs <span style="color:#333">&lt;-</span> digs<span style="color:#06b;font-weight:bold">[which</span>(digs <span style="color:#333">!=</span> dup)]
</span></span><span style="display:flex;"><span>              <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">length</span>(digs) <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">2</span> <span style="color:#333">&amp;</span> a<span style="color:#333">/</span>b <span style="color:#333">==</span> digs[1]<span style="color:#333">/</span>digs[2]) {
</span></span><span style="display:flex;"><span>                  num <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(num, a)
</span></span><span style="display:flex;"><span>                  den <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(den, b)
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">paste</span>(num, den, sep <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span>  answer <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">prod</span>(den) <span style="color:#333">/</span> <span style="color:#06b;font-weight:bold">prod</span>(num)
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">print</span>(answer)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Farey Sequences and Ford Circles
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>Next step is to generalise Euler problem 33 and write a function to generate Farey Sequences and visualise them using Ford Circles. This Numberphile video below explains fractions and Farey sequences. A Farey sequence contains all fractions between 0 and 1 with a maximum denominator. More formally, a Farey sequence of order n is the sequence of completely reduced fractions between 0 and 1. These fractions have denominators less than or equal to n, arranged in order of increasing size. For example, the Farey Sequence with order 3 is:</p>
<p>
$$F_3 = \Big\{ \frac{0}{1},\frac{1}{3},\frac{1}{2},\frac{2}{3},\frac{1}{1}\Big\}$$</p>
<p>
Ford Circles are a fractal-esque way to visualise Farey sequences, but before we get to this, first solve Euler problem 33.</p>
<figure>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/0hlvhQZIOQw?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

<figcaption>
Funny Fractions and Ford Circles by Numberphile.
</figcaption>
</figure>
<p>
The farey function generates a data table with the numerators (p) and denominators (q) of a Farey sequence. The function builds a list of all possible fractions for the solution space, excluding those with one as a Greatest Common Denominator, as defined by the <code class="verbatim">gcd()</code> function.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Farey sequence function</span>
</span></span><span style="display:flex;"><span>  farey <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(n) {
</span></span><span style="display:flex;"><span>      fseq <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>      fseq[[1]] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(<span style="color:#60e;font-weight:bold">0</span>, <span style="color:#60e;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>      i <span style="color:#333">&lt;-</span> <span style="color:#60e;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>      gcd <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(a, b) { <span style="color:#888"># Euclid&#39;s method</span>
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (a <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">0</span>) <span style="color:#080;font-weight:bold">return</span>(b)
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">if</span> (b <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">0</span>) <span style="color:#080;font-weight:bold">return</span>(a)
</span></span><span style="display:flex;"><span>          <span style="color:#06b;font-weight:bold">gcd</span>(b, a <span style="color:#333">%%</span> b)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#080;font-weight:bold">for</span> (q <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">2</span><span style="color:#333">:</span>n) {
</span></span><span style="display:flex;"><span>          <span style="color:#080;font-weight:bold">for</span> (p <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">1</span><span style="color:#333">:</span>(q <span style="color:#333">-</span> <span style="color:#60e;font-weight:bold">1</span>)){
</span></span><span style="display:flex;"><span>              <span style="color:#080;font-weight:bold">if</span> (<span style="color:#06b;font-weight:bold">gcd</span>(p, q) <span style="color:#333">==</span> <span style="color:#60e;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>                  fseq[[i]] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(p, q)
</span></span><span style="display:flex;"><span>                  i <span style="color:#333">&lt;-</span> i <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      fseq[[i]] <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(<span style="color:#60e;font-weight:bold">1</span>, <span style="color:#60e;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>      fseq <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">as.data.frame</span>(<span style="color:#06b;font-weight:bold">do.call</span>(rbind, fseq))
</span></span><span style="display:flex;"><span>      <span style="color:#06b;font-weight:bold">names</span>(fseq) <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(<span style="background-color:#fff0f0">&#34;p&#34;</span>, <span style="background-color:#fff0f0">&#34;q&#34;</span>)
</span></span><span style="display:flex;"><span>      fseq <span style="color:#333">&lt;-</span> fseq<span style="color:#06b;font-weight:bold">[order</span>(fseq<span style="color:#333">$</span>p <span style="color:#333">/</span> fseq<span style="color:#333">$</span>q), ]
</span></span><span style="display:flex;"><span>      <span style="color:#080;font-weight:bold">return</span>(fseq)
</span></span><span style="display:flex;"><span>  }</span></span></code></pre></div>
</div>
<p>
Standard ggplot2 cannot draw circles where the radius of the circles is related to the coordinate system. I used a circle function sourced from <a href="https://stackoverflow.com/questions/6862742/draw-a-circle-with-ggplot2">StackOverflow</a>. This function is called in a for-loop to build the circles on top of the empty canvas.</p>
<figure>
<img src="https://lucidmanager.org/images/project-euler/problem-033.png" alt="/images/project-euler/problem-033.png" title="Farey Sequence and Ford Circles (n = 20)."/>
<figcaption>
Farey Sequence and Ford Circles (n = 20).
</figcaption>
</figure>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>  lm_palette <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">c</span>(<span style="background-color:#fff0f0">&#34;#008da1&#34;</span>, <span style="background-color:#fff0f0">&#34;#005395&#34;</span>, <span style="background-color:#fff0f0">&#34;#262e43&#34;</span>, <span style="background-color:#fff0f0">&#34;#3b2758&#34;</span>, <span style="background-color:#fff0f0">&#34;#865596&#34;</span>, <span style="background-color:#fff0f0">&#34;#f26230&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ford_circles <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">farey</span>(<span style="color:#60e;font-weight:bold">20</span>) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">mutate</span>(x <span style="color:#333">=</span> p <span style="color:#333">/</span> q,
</span></span><span style="display:flex;"><span>           y <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">1</span> <span style="color:#333">/</span> (<span style="color:#60e;font-weight:bold">2</span><span style="color:#333">*</span> q^2),
</span></span><span style="display:flex;"><span>           r <span style="color:#333">=</span> y,
</span></span><span style="display:flex;"><span>           c <span style="color:#333">=</span> lm_palette<span style="color:#06b;font-weight:bold">[</span>(q <span style="color:#333">-</span> <span style="color:#60e;font-weight:bold">1</span>)<span style="color:#333">%%</span><span style="color:#60e;font-weight:bold">6</span> <span style="color:#333">+</span> <span style="color:#60e;font-weight:bold">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  g_circle <span style="color:#333">&lt;-</span> <span style="color:#080;font-weight:bold">function</span>(r, x, y, color <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NA</span>, fill <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;black&#34;</span>, <span style="color:#080;font-weight:bold">...</span>) {
</span></span><span style="display:flex;"><span>    x <span style="color:#333">&lt;-</span> x <span style="color:#333">+</span> r <span style="color:#333">*</span> <span style="color:#06b;font-weight:bold">cos</span>(<span style="color:#06b;font-weight:bold">seq</span>(<span style="color:#60e;font-weight:bold">0</span>, <span style="color:#080;font-weight:bold">pi</span>, length.out <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">100</span>))
</span></span><span style="display:flex;"><span>    ymax <span style="color:#333">&lt;-</span> y <span style="color:#333">+</span> r <span style="color:#333">*</span> <span style="color:#06b;font-weight:bold">sin</span>(<span style="color:#06b;font-weight:bold">seq</span>(<span style="color:#60e;font-weight:bold">0</span>, <span style="color:#080;font-weight:bold">pi</span>, length.out <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">100</span>))
</span></span><span style="display:flex;"><span>    ymin <span style="color:#333">&lt;-</span> y <span style="color:#333">+</span> r <span style="color:#333">*</span> <span style="color:#06b;font-weight:bold">sin</span>(<span style="color:#06b;font-weight:bold">seq</span>(<span style="color:#60e;font-weight:bold">0</span>, <span style="color:#333">-</span><span style="color:#080;font-weight:bold">pi</span>, length.out <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">100</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">annotate</span>(<span style="background-color:#fff0f0">&#34;ribbon&#34;</span>, x <span style="color:#333">=</span> x, ymin <span style="color:#333">=</span> ymin, ymax <span style="color:#333">=</span> ymax,
</span></span><span style="display:flex;"><span>             color <span style="color:#333">=</span> color, fill <span style="color:#333">=</span> fill, <span style="color:#080;font-weight:bold">...</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">ggplot</span>(ford_circles, <span style="color:#06b;font-weight:bold">aes</span>(x, y))
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-weight:bold">for</span> (i <span style="color:#080;font-weight:bold">in</span> <span style="color:#60e;font-weight:bold">1</span><span style="color:#333">:</span><span style="color:#06b;font-weight:bold">nrow</span>(ford_circles)) {
</span></span><span style="display:flex;"><span>    p <span style="color:#333">&lt;-</span> p <span style="color:#333">+</span> <span style="color:#06b;font-weight:bold">g_circle</span>(ford_circles<span style="color:#333">$</span>r[i], ford_circles<span style="color:#333">$</span>x[i], ford_circles<span style="color:#333">$</span>y[i],
</span></span><span style="display:flex;"><span>                      fill <span style="color:#333">=</span> ford_circles<span style="color:#333">$</span>c[i])
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">xlim</span>(<span style="color:#06b;font-weight:bold">c</span>(<span style="color:#60e;font-weight:bold">0</span>, <span style="color:#60e;font-weight:bold">1</span>)) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">coord_fixed</span>() <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">theme_void</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">ggsave</span>(<span style="background-color:#fff0f0">&#34;images/problem-033.png&#34;</span>, width <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">6</span>, height <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">4</span>)</span></span></code></pre></div>
</div>
<p>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
</div>
</div>

      