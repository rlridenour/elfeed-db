<p>For a little while now, I have been developing C# applications at work and on Windows!, possibly the perfect storm for Emacs, but actually, it copes pretty well, especially with eglot and the LSP server OmniSharp.</p>
<p>But recently my work setup has become even more air-gapped, and unfortunately, I reached a point where I couldn&rsquo;t get eglot and OmniSharp working together. I gave it a really good try, but I think the mishmash and dependency installation madness finally took a toll.</p>
<p>It has something to do with trying to find MSBuild.exe, but due to my potentially wonky installation, I couldn&rsquo;t figure out how to detect it. If Visual Studio is installed on the system, there are no problems; however, offline installation, even of the Community edition, is not an easy task.</p>
<p>So, the solution? Well, I thought I would try another C# LSP in the form of csharp-ls. Its deliverable form is a NuGet package, which can be extracted, placed in the relevant location, and then you&rsquo;re pretty much off and running!</p>
<figure><img src="https://emacs.dyerdwelling.family/ox-hugo/20250627222703-emacs--Setting-up-CSharp-Language-Server-csharp-ls-on-Air-Gapped-Windows-System.jpg" width="100%">
</figure>

<p>So here is how I did it:</p>
<h2 id="step-1-download-csharp-ls-nuget-components">Step 1: Download csharp-ls nuget Components</h2>
<p>On a machine with internet access (which fortunately I do have access to):</p>
<h3 id="download-csharp-ls">Download csharp-ls</h3>
<ul>
<li>Go to the <a href="https://www.nuget.org/packages/csharp-ls/">csharp-ls NuGet page</a></li>
<li>Click &ldquo;Download package&rdquo; to get the <code>.nupkg</code> file</li>
<li>Rename the file from <code>.nupkg</code> to <code>.zip</code></li>
<li>Extract the contents</li>
</ul>
<h2 id="step-2-install-csharp-ls--airgapped-machine">Step 2: Install csharp-ls (Airgapped Machine)</h2>
<ol>
<li>
<p>Create a directory in your Emacs installation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>      <span style="color:#66d9ef">mkdir</span> <span style="color:#e6db74">&#34;c:\path\to\emacs\bin\csharp-ls&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Copy the extracted csharp-ls contents to this directory. The key file you need is:</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">      tools\net9.0\any\CSharpLanguageServer.dll
</code></pre></li>
</ol>
<h2 id="step-3-configure-emacs">Step 3: Configure Emacs</h2>
<p>Add this configuration to your Emacs init file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; Configure csharp-ls as the language server for C#</span>
</span></span><span style="display:flex;"><span>(setq eglot-server-programs
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#39;</span>((csharp-mode <span style="color:#f92672">.</span> (<span style="color:#e6db74">&#34;dotnet&#34;</span> <span style="color:#e6db74">&#34;c:/path/to/emacs/bin/csharp-ls/tools/net9.0/any/CSharpLanguageServer.dll&#34;</span>))))
</span></span></code></pre></div><h2 id="step-4-set-up-your-c-project-structure">Step 4: Set Up Your C# Project Structure</h2>
<p>Basically defining a source code collection as a project in Emacs. This can be a solution file, a source code control directory or as I generally have set up, an empty .project file</p>
<h2 id="step-5-set-up-paths">Step 5: Set up paths</h2>
<p>This may not be needed, but for my own sanity and just in case, absorb the new directory in to the PATH and exec-path variables.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(when (<span style="color:#a6e22e">eq</span> system-type <span style="color:#e6db74">&#39;windows-nt</span>)
</span></span><span style="display:flex;"><span>  (let ((xPaths
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">`</span>(
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">,</span>(<span style="color:#a6e22e">expand-file-name</span> <span style="color:#e6db74">&#34;~/bin/csharp-ls/tools/net9.0/any&#34;</span>)
</span></span><span style="display:flex;"><span>           )))
</span></span><span style="display:flex;"><span>    (setenv <span style="color:#e6db74">&#34;PATH&#34;</span> (<span style="color:#a6e22e">concat</span>
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">mapconcat</span> <span style="color:#e6db74">&#39;identity</span> xPaths <span style="color:#e6db74">&#34;;&#34;</span>)))
</span></span><span style="display:flex;"><span>    (setq exec-path (<span style="color:#a6e22e">append</span> (split-string winPaths <span style="color:#e6db74">&#34;;&#34;</span>) xPaths (<span style="color:#a6e22e">list</span> <span style="color:#e6db74">&#34;.&#34;</span> exec-directory)))))
</span></span></code></pre></div><p>So it works as I had it with <code>OmniSharp</code> and that really is all I can ask for, lets see how I get on!</p>