
         
         <p>This is a simple package to automatically preview in a side window the
file at point in Dired buffers. Preview windows are closed when they
are no longer relevant, while preview buffers are killed if they have
not been used for other purposes beside previewing. The package
provides several customisation options to control its behaviour.</p>

<ul>
  <li>Package name (GNU ELPA): <code class="language-plaintext highlighter-rouge">dired-preview</code></li>
  <li>Official manual: <a href="https://protesilaos.com/emacs/dired-preview">https://protesilaos.com/emacs/dired-preview</a></li>
  <li>Git repositories:
    <ul>
      <li>GitHub: <a href="https://github.com/protesilaos/dired-preview">https://github.com/protesilaos/dired-preview</a></li>
      <li>GitLab: <a href="https://gitlab.com/protesilaos/dired-preview">https://gitlab.com/protesilaos/dired-preview</a></li>
    </ul>
  </li>
  <li>Backronym: Directories Invariably Render Everything Decently …
preview; dired … PDFs Require Extra Viewing Instructions for Emacs
to Work.</li>
</ul>

<p>Below are the release notes</p>

<hr />

<h2>Version 0.3.0 on 2024-09-16</h2>

<p>This version brings some nice new features and makes small refinements
to the code base.</p>

<h3>Run commands in the preview window</h3>

<p>The <code class="language-plaintext highlighter-rouge">dired-preview-mode-map</code> is active when <code class="language-plaintext highlighter-rouge">dired-preview-mode</code> is
enabled. Here are all the keys and corresponding commands it provides
right now:</p>

<table>
  <thead>
    <tr>
      <th>Key binding</th>
      <th>Command</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>C-c C-c</td>
      <td>dired-preview-hexl-toggle</td>
    </tr>
    <tr>
      <td>C-c C-d</td>
      <td>dired-preview-page-down</td>
    </tr>
    <tr>
      <td>C-c C-f</td>
      <td>dired-preview-find-file</td>
    </tr>
    <tr>
      <td>C-c C-o</td>
      <td>dired-preview-open-dwim</td>
    </tr>
    <tr>
      <td>C-c C-u</td>
      <td>dired-preview-page-up</td>
    </tr>
  </tbody>
</table>

<p>With the exception of <code class="language-plaintext highlighter-rouge">dired-preview-hexl-toggle</code>, these are all new
commands.</p>

<p>My most used command among those is <code class="language-plaintext highlighter-rouge">dired-preview-open-dwim</code>, which
has a Do-What-I-Mean behaviour: If the file name matches
<code class="language-plaintext highlighter-rouge">dired-preview-media-extensions-regexp</code>,
<code class="language-plaintext highlighter-rouge">dired-preview-ignored-extensions-regexp</code>, or
<code class="language-plaintext highlighter-rouge">dired-preview-image-extensions-regexp</code>, then it opens it externally.
Otherwise, it visits the file in an Emacs buffer. Note that here we
include the <code class="language-plaintext highlighter-rouge">dired-preview-image-extensions-regexp</code> because while
Emacs can visit those in a buffer, it does not offer as much
functionality as other apps that specialise in handling image files.</p>

<p>[ Emacs uses the system default for those files when opening them externally. ]</p>

<h3>Advanced users can rely on the <code class="language-plaintext highlighter-rouge">dired-preview-with-window</code> macro</h3>

<p>Use this in your custom functions to run some code with the preview
window as the selected window. For example, here is a simple one from
our code base:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">dired-preview-page-down</span> <span class="p">()</span>
  <span class="s">"Move a page down in the preview window.
This technically runs `scroll-up-command'."</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">dired-preview-with-window</span>
    <span class="p">(</span><span class="nv">call-interactively</span> <span class="ss">'scroll-up-command</span><span class="p">)))</span>
</code></pre></div></div>

<p>Remember to add them to the <code class="language-plaintext highlighter-rouge">dired-preview-mode-map</code>.</p>

<h3>Placeholder window prevents preview jumpiness</h3>

<p>Wtih <code class="language-plaintext highlighter-rouge">dired-preview-ignored-extensions-regexp</code> we can exclude certain
files from being previewed. This is useful because, for example, Emacs
cannot display those files or do something useful with their contents,
or we just want to hide them (e.g. to omit GPG-encrypted files from
the preview).</p>

<p>In the past, <code class="language-plaintext highlighter-rouge">dired-preview-mode</code> would pop up a preview window for a
file that could be previewed and would then hide that window for
anything matching <code class="language-plaintext highlighter-rouge">dired-preview-ignored-extensions-regexp</code>. As a
result, windows would jump in and out of the frame layout. This could
be disorienting.</p>

<p>We now provide the user option <code class="language-plaintext highlighter-rouge">dired-preview-ignored-show-ignored-placeholders</code>
which shows a placeholder window when trying to preview an ignored
file. So as we move up and down the Dired buffer, the preview window
stays in place regardless if we are on an ignored file or not.</p>

<p>The default value of <code class="language-plaintext highlighter-rouge">dired-preview-ignored-show-ignored-placeholders</code>
is <code class="language-plaintext highlighter-rouge">t</code> because I think this is the better behaviour. Though users can
set it to <code class="language-plaintext highlighter-rouge">nil</code> to retain the old functionality.</p>

<p>Thanks to Álvaro Ramírez (xenodium) for the contribution. This was
done in pull request 15: <a href="https://github.com/protesilaos/dired-preview/pull/15">https://github.com/protesilaos/dired-preview/pull/15</a>.</p>

<p>The change is within the permissible limit of ~15 lines, meaning that
Álvaro does not need to assign copyright to the Free Software
Foundation.</p>

<h3>The <code class="language-plaintext highlighter-rouge">dired-preview-display-action-alist</code> replaces <code class="language-plaintext highlighter-rouge">dired-preview-display-action-alist-function</code></h3>

<p>The old symbol is an alias for the new one and users will be notified
accordingly while updating.</p>

<p>This user option is for advanced users who want to customise where and
how <code class="language-plaintext highlighter-rouge">display-buffer</code> places the preview window. Before, we were
accepting only the symbol of a function that would return an
appropriate action alist. Now we accept either a function’s symbol or
an action alist directly.</p>

<p>Examples of both:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; Use a function that returns an action alist:</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">dired-preview-display-action-alist</span> <span class="nf">#'</span><span class="nv">dired-preview-display-action-alist-dwim</span><span class="p">)</span>

<span class="c1">;; Use an action alist directly:</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">dired-preview-display-action-alist</span>
      <span class="o">'</span><span class="p">((</span><span class="nv">display-buffer-in-side-window</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">side</span> <span class="o">.</span> <span class="nv">bottom</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">window-height</span> <span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">preserve-size</span> <span class="o">.</span> <span class="p">(</span><span class="no">t</span> <span class="o">.</span> <span class="no">t</span><span class="p">))))</span>
</code></pre></div></div>

<p>Check our <code class="language-plaintext highlighter-rouge">dired-preview-display-action-alist-dwim</code> for inspiration if
you want to have a function that returns an action alist based on,
say, the width of the frame.</p>

<h3>Preview of the next file works when marking for deletion</h3>

<p>When we mark a file for deletion, Dired moves the point to the next
line. Before, this would not trigger a preview of the updated
file-at-point. Now it should work as expected.</p>

<p>Technically, we check if the last command is among those stored in the
variable <code class="language-plaintext highlighter-rouge">dired-preview-trigger-commands</code>. If you think there are
more commands we need to include there, just let me know.</p>

<h3>The <code class="language-plaintext highlighter-rouge">dired-preview-ignored-extensions-regexp</code> can be <code class="language-plaintext highlighter-rouge">nil</code></h3>

<p>This was always the intention, but the relevant code was not
accounting for that scenario. It should work now as intended.</p>
        
      