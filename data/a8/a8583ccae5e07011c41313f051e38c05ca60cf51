<p>In his comment on <a href="https://irreal.org/blog/">Irreal</a>&rsquo;s post
<a href="https://irreal.org/blog/?p=12595">Some Configuration To Solve Common Problems</a>,
<a href="https://disqus.com/by/gregbognar/">gregbognar</a> noted that some of my
configuration <em>is seriously outdated</em>. In some sense, he is absolutely
correct &ndash; I&rsquo;ve been collecting Emacs settings/tweaks since 2012, and
keeping them unmodified for 12+ years.</p>
<p>But on the other hand, it demonstrates how stable and powerful Emacs
is &ndash; everything is still working! <em>If something works, don&rsquo;t fix it</em>
&ndash; I&rsquo;ve since tried to apply this rule wherever possible.</p>
<p>Here are a few functions/enhancements I found helpful.</p>
<h2 id="dired-mode-enhancements"><code>dired-mode</code> enhancements</h2>
<h3 id="function-calculate-the-total-size-of-all-marked-files">Function: Calculate the total size of all marked files</h3>
<p>The custom <code>dired-get-size</code> function calculates the total size of all
marked files in the dired buffer and displays it in the echo area.
Files in the dired buffer can be marked with <code>m</code> key and unmarked with
<code>u</code> key.</p>
<p>The current version only works on systems with the <code>/usr/bin/du</code>
system utility, which actually comprise 100% of the (non-Windows)
systems &ndash; borrowed from <a href="https://oremacs.com/2015/01/12/dired-file-size/">oremacs.com</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun dired-get-size ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Display file size in dired.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (let ((files (dired-get-marked-files)))
</span></span><span style="display:flex;"><span>    (with-temp-buffer
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">apply</span> <span style="color:#e6db74">&#39;call-process</span> <span style="color:#e6db74">&#34;/usr/bin/du&#34;</span> <span style="color:#66d9ef">nil</span> <span style="color:#66d9ef">t</span> <span style="color:#66d9ef">nil</span> <span style="color:#e6db74">&#34;-sch&#34;</span> files)
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">message</span>
</span></span><span style="display:flex;"><span>       <span style="color:#e6db74">&#34;Size of all marked files: %s&#34;</span>
</span></span><span style="display:flex;"><span>       (progn
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">re-search-backward</span> <span style="color:#e6db74">&#34;\\(^[ 0-9.,]+[A-Za-z]+\\).*total$&#34;</span>)
</span></span><span style="display:flex;"><span>         (match-string <span style="color:#ae81ff">1</span>))))))
</span></span></code></pre></div><p>In my config, <code>dired-get-size</code> is bound to <code>z</code> key in the <code>dired-mode</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; https://oremacs.com/2015/01/12/dired-file-size/</span>
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">define-key</span> dired-mode-map <span style="color:#e6db74">&#34;z&#34;</span> <span style="color:#a6e22e">#&#39;</span>dired-get-size)
</span></span></code></pre></div><figure><img src="http://localhost:1313/img/dired-z.png"/><figcaption>
            <h4>The result of pressing the `z` key in dired.</h4>
        </figcaption>
</figure>

<h3 id="some-other-dired-mode-enhancements">Some other <code>dired-mode</code> enhancements</h3>
<h4 id="move-to-the-parent-directory">Move to the parent directory</h4>
<p>It reuses the current <code>dired</code> buffer for opening the parent
directory (<a href="https://oremacs.com/2015/01/21/dired-shortcuts/">oremacs.com</a>)
instead of creating a new buffer.
Bounded to the <code>a</code> key in <code>dired-mode</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; Move to the parent directory.</span>
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">define-key</span> dired-mode-map <span style="color:#e6db74">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>  (lambda ()
</span></span><span style="display:flex;"><span>    (interactive)
</span></span><span style="display:flex;"><span>    (find-alternate-file <span style="color:#e6db74">&#34;..&#34;</span>)))
</span></span></code></pre></div><h4 id="run-eshell-in-the-current-dired-directory">Run <code>eshell</code> in the current <code>dired</code> directory</h4>
<p>Bounded to the ` back-tick key in <code>dired-mode</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#75715e">;; Run eshell.</span>
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">define-key</span> dired-mode-map <span style="color:#e6db74">&#34;`&#34;</span>
</span></span><span style="display:flex;"><span>  (lambda ()
</span></span><span style="display:flex;"><span>    (interactive)
</span></span><span style="display:flex;"><span>    (eshell)))
</span></span></code></pre></div><h2 id="date-and-time-stamps">Date and time stamps</h2>
<p>Inserting the date and/or time stamps at the current cursor position.
You can bind these functions to any key chords you prefer or call the
corresponding function with <code>M-x</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun my/time-stamp ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Insert full date/time stamp as 2024-11-29 10:41 +0100 CET&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">insert</span> (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%Y-%m-%d %R %z %Z&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun my/time-stamp-short ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Insert short date/time stamp as 2024-11-29 10:41&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">insert</span> (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%Y-%m-%d %R&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun my/date-stamp ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Insert date stamp as 2024-11-29&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">insert</span> (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%Y-%m-%d&#34;</span>)))
</span></span></code></pre></div><h2 id="some-editing-tweaks">Some editing tweaks</h2>
<h3 id="inserting-a-new-line">Inserting a new line</h3>
<p>Insert a new line, indent it, and move the cursor there. This behavior
is different then the typical function bound to <code>Enter</code> which may be
<code>open-line</code> or <code>newline-and-indent</code>. When you call them with the cursor
between ^ (beginning of line) and $ (end of line), the contents of the
line to the right of it will be moved to the newly inserted line. <em>This
function will not do that</em>. Instead, the current line is <em>left alone</em>, a new line
is inserted, indented, and the cursor is moved there. Borrowed from
<a href="http://emacsredux.com/blog/2013/03/26/smarter-open-line/">emacsredux</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun smart-open-line ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Insert a new line, indent it, and move the cursor there.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (move-end-of-line <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>  (newline-and-indent))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(global-set-key (kbd <span style="color:#e6db74">&#34;&lt;C-return&gt;&#34;</span>) <span style="color:#a6e22e">#&#39;</span>smart-open-line)
</span></span></code></pre></div><p>I have bound it globally to <code>Ctrl-Enter</code> &ndash; <code>C-return</code> in the Emacs
notation &ndash; so it should work in any mode.</p>
<h3 id="smart-beginning-of-line">Smart beginning of line</h3>
<p>Move point to first non-whitespace character or <code>beginning-of-line</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun smart-beginning-of-line ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Move point to first non-whitespace character or `beginning-of-line`.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (let ((oldpos (<span style="color:#a6e22e">point</span>)))
</span></span><span style="display:flex;"><span>    (back-to-indentation)
</span></span><span style="display:flex;"><span>    (and (<span style="color:#a6e22e">=</span> oldpos (<span style="color:#a6e22e">point</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">beginning-of-line</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(global-set-key (kbd <span style="color:#e6db74">&#34;C-a&#34;</span>) <span style="color:#a6e22e">#&#39;</span>smart-beginning-of-line)
</span></span></code></pre></div><p>I&rsquo;ve rebound the <em>default</em> <code>Ctrl-A</code> &ndash; <code>C-a</code> in the Emacs notation &ndash; to
move to first non-whitespace character of a line instead of first
column.</p>
<h3 id="killing-a-word-at-point">Killing a word at point</h3>
<p>Deleting the whole word at the cursor position.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun kill-whole-word ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Kill the current word at point.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (backward-word)
</span></span><span style="display:flex;"><span>  (kill-word <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">define-key</span> global-map (kbd <span style="color:#e6db74">&#34;&lt;M-DEL&gt;&#34;</span>) <span style="color:#a6e22e">#&#39;</span>kill-whole-word)
</span></span></code></pre></div><p>I&rsquo;ve rebound it to <code>Alt-delete</code> &ndash; <code>M-DEL</code> in the Emacs notation.</p>
<h2 id="nuke-all-buffers">Nuke all buffers</h2>
<p>Kill all buffers, leaving <em>*scratch*</em> only.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun nuke-all-buffers ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Kill all buffers, leaving *scratch* only.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">mapc</span>
</span></span><span style="display:flex;"><span>   (lambda (buffer)
</span></span><span style="display:flex;"><span>     (<span style="color:#a6e22e">kill-buffer</span> buffer))
</span></span><span style="display:flex;"><span>   (<span style="color:#a6e22e">buffer-list</span>))
</span></span><span style="display:flex;"><span>  (delete-other-windows))
</span></span></code></pre></div><p>To be continued. Happy emacsing!</p>