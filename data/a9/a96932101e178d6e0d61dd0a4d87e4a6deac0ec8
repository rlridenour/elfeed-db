
         
         <p><strong>UPDATE 2024-12-14 08:06 +0200:</strong> I was told that this functionality
has already been avaialble for more than a decade. I simply did not
see it in the source code of <code class="language-plaintext highlighter-rouge">save-some-buffers-action-alist</code>. Sorry!</p>

<hr />

<p>The command <code class="language-plaintext highlighter-rouge">save-some-buffers</code>, which is bound to <code class="language-plaintext highlighter-rouge">C-x s</code> by default
is helpful when you need to save lots of buffers efficiently. Instead
of figuring out which ones are modified and visiting each of them to
decide what to do, you invoke <code class="language-plaintext highlighter-rouge">save-some-buffers</code>. It prompts for an
action, one buffer at a time. Actions include to save or not as well
as a “yes to all” directive. Each action is bound to a key and all of
them can be customised by modifying the variable <code class="language-plaintext highlighter-rouge">save-some-buffers-action-alist</code>.
When there are no more modified buffers to act on, the command
concludes its operation. Nice and simple.</p>

<p>While the default experience is fine, there are times when I
completely forgot what kind of changes I made to a file. This is
especially true when files have similar names. Do I really need to
save it, or there is more work to be done? As such, I need access to a
diff command, which I access via the <code class="language-plaintext highlighter-rouge">d</code> key binding.</p>

<p>Emacs has built-in the ability to calculate the difference between the
buffer’s contents and that of its underlying file. This is done by the
function <code class="language-plaintext highlighter-rouge">diff-buffer-with-file</code>.</p>

<p>We may then leverage this function to add a new association between a
key, a function, and a brief explanatory statement. The latter is
available upon typing <code class="language-plaintext highlighter-rouge">C-h</code> at the <code class="language-plaintext highlighter-rouge">save-some-buffers</code> prompt.</p>

<p>Here is the idea:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'save-some-buffers-action-alist</span>
             <span class="p">(</span><span class="nb">list</span> <span class="s">"d"</span>
                   <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">buffer</span><span class="p">)</span> <span class="p">(</span><span class="nv">diff-buffer-with-file</span> <span class="p">(</span><span class="nv">buffer-file-name</span> <span class="nv">buffer</span><span class="p">)))</span>
                   <span class="s">"show diff between the buffer and its file"</span><span class="p">))</span>
</code></pre></div></div>

<p>Now I can type <code class="language-plaintext highlighter-rouge">d</code> at the prompt whenever I am not sure about what I
need to do with a given buffer and its file. When I am done reviewing
the diff buffer, I type <code class="language-plaintext highlighter-rouge">q</code> to dismiss it and get back to the prompt. It works!</p>
        
      