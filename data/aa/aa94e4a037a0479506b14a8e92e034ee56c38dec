<blockquote>
<p>Do you use #Emacs to run shells or terminal emulators?
Well, you should. With vterm you have a fast alternative to the
builtin ansi-term. And if you prefer shells, you&rsquo;ve got EShell and
Shell Mode.
And don&rsquo;t forget serial-term for embedded programming.
— Mickey Petersen (@mickeynp) on Twitter, July 18, 2022.</p>
</blockquote>
<h2 id="eshell-aliases">Eshell Aliases</h2>
<p>An excellent
<a href="https://www.masteringemacs.org/article/running-shells-in-emacs-overview">post</a>
from Mickey Petersen, a famous Emacs guru and the author of
<a href="https://www.masteringemacs.org/"><em>Mastering Emacs</em></a> reminded me to
share my eshell configuration.</p>
<p>There are 2 ways to configure eshell aliases. <a href="http://www.gonsie.com/blorg/eshell.html">Elsa
Gonsiorowski</a> uses a
special configuration file <code>~/.emacs.d/eshell/alias</code> while <a href="https://github.com/howardabrams/dot-files/blob/master/emacs-eshell.org#aliases">Howard
Abrams</a>
prefers to put his eshell alias settings to <code>.emacs</code> or <code>init.el</code>.
Personally, I prefer the former approach.</p>
<p>Here is my <code>~/.emacs.d/eshell/alias</code>.</p>
<pre tabindex="0"><code>alias ll ls -AFGhl --color=always $1
alias ff find-file $1
alias e find-file-other-window $1
alias d dired $1
alias gd magit-diff-unstaged
alias gds magit-diff-staged
alias gg git log --color --graph --oneline --abbrev-commit --decorate --all --date=short --pretty=format:&#34;%C(cyan)%h %C(yellow)%ad %C(bold green)%d %C(reset)%s&#34;
</code></pre><p>Most of these aliases are obvious, e.g. <code>ll</code> prints extended directory
listing, <code>ff somefile</code> opens <em>somefile</em> for editing in the same
window, <code>e somefile</code> uses other window to edit <em>somefile</em>, <code>d</code> opens
the dired buffer in the same window, etc. The last one prints
the colorized one-line git log as shown below.</p>
<figure><img src="http://localhost:1313/img/gg2.png"/>
</figure>

<h2 id="eshell-prompt">Eshell Prompt</h2>
<p>The prompt you can see on the screenshot above is borrowed from the
Reddit
<a href="https://www.reddit.com/r/emacs/comments/6f0rkz/my_fancy_eshell_prompt/">post</a>
with some colors optimized for the Solarized Dark theme.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(setq eshell-prompt-function
</span></span><span style="display:flex;"><span>      (lambda ()
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">concat</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> <span style="color:#e6db74">&#34;┌─[&#34;</span> <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#2aa198&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> (<span style="color:#a6e22e">user-login-name</span>) <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#dc322f&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> <span style="color:#e6db74">&#34;@&#34;</span> <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#2aa198&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> (<span style="color:#a6e22e">system-name</span>) <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#268bd2&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> <span style="color:#e6db74">&#34;]──[&#34;</span> <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#2aa198&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%H:%M&#34;</span> (<span style="color:#a6e22e">current-time</span>)) <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#b58900&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> <span style="color:#e6db74">&#34;]──[&#34;</span> <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#2aa198&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> (<span style="color:#a6e22e">concat</span> (eshell/pwd)) <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#93a1a1&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> <span style="color:#e6db74">&#34;]\n&#34;</span> <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#2aa198&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> <span style="color:#e6db74">&#34;└─&gt;&#34;</span> <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#2aa198&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> (if venv-current-name (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34; (&#34;</span> venv-current-name <span style="color:#e6db74">&#34;)&#34;</span>)  <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#00dc00&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">propertize</span> (if (<span style="color:#a6e22e">=</span> (<span style="color:#a6e22e">user-uid</span>) <span style="color:#ae81ff">0</span>) <span style="color:#e6db74">&#34; # &#34;</span> <span style="color:#e6db74">&#34; $ &#34;</span>) <span style="color:#e6db74">&#39;face</span> <span style="color:#f92672">`</span>(:foreground <span style="color:#e6db74">&#34;#2aa198&#34;</span>))
</span></span><span style="display:flex;"><span>         )))
</span></span></code></pre></div><p>In addition to the username, the current time, and the current
directory it also shows the current Python virtual environment name
(in green).</p>
<h2 id="eshell-colors">Eshell Colors</h2>
<p>The often cited issue with eshell is the lack of color output even if
it is explicitly specified in a command (e.g. <code>ls --color=always</code>).</p>
<p>Adding this to your <code>~/.emacs</code> (or <code>init.el</code>)  DOES NOT solve the problem:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(setenv <span style="color:#e6db74">&#34;TERM&#34;</span> <span style="color:#e6db74">&#34;xterm-256color&#34;</span>)
</span></span></code></pre></div><p>THIS DOES solve the problem with color output in eshell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;eshell-mode-hook</span> (lambda () (setenv <span style="color:#e6db74">&#34;TERM&#34;</span> <span style="color:#e6db74">&#34;xterm-256color&#34;</span>)))
</span></span></code></pre></div><p>Though to get the current directory listing in eshell I prefer to use the eshell
alias <code>d</code> (equivalent to <code>d .</code>), see the list of aliases above.</p>
<p>More on Emacs&rsquo; eshell can be found
<a href="https://www.masteringemacs.org/article/complete-guide-mastering-eshell">here</a>,
thanks again, Mickey.</p>