<p>I spent a bit of time over the Easter break getting my editors configured on <a href="https://www.rousette.org.uk/archives/all-aboard-the-nixos-train-again/">NixOS</a>. Yes, <em>editors</em> plural. Yes, it is overkill. But I can, so I have.</p>
<p>Editors can be one of the trickier things to configure in NixOS, or at least, they present more decisions to be made about how one will configure them. Most editors have their own package managers which handle installing, configuring and updating plugins and packages for the editor, which means that you need to decide whether you will let the editor handle that as usual, or pass the task over to NixOS and its own package manager and configuration language. Alternatively, you can do something that is a kind of half-way house between the two.</p>
<p>On the one hand, letting NixOS deal with it means that you have a nicely declarative environment, and are in control about when things get updated, and you have a single language (<code>nix</code>) in which to configure everything. On the other hand, that means that you have to rebuild your entire system each time you change something in your editor configuration, and translating guides you find online about how to configure things into The Nix Way can be tricky.</p>
<p>Here&rsquo;s how I handled it for my three editors: Helix, Neovim and Emacs.</p>
<h3 id="helix">Helix</h3>
<p>I have only recently started trying out <a href="https://helix-editor.com/">Helix</a> again. When I first tried it, I found it interesting, but a bit lacking in features, but it is now a very capable and self-contained editor. For those who haven&rsquo;t tried it, it is similar to Vim/Neovim, but uses a &lsquo;selection first&rsquo; principle in which you first select the text you want to operate on, then issue your editing commands (modelled on Kakaoune). Moving across text also transiently selects or marks it too. Once you adapt to the difference, it feels very natural. In contrast to the other two editors, Helix does not yet have a plugin system. However, the built-in features are extremely capable, and unless you want to do something unusual, Helix will probably have you covered, including good Language Server support and Tree-sitter integration for programming languages.</p>
<p>My Nix configuration for this is entirely within Nix and only runs to 70 or so lines, tweaking the status line and setting a few key bindings. Helix is great, and I enjoy how quiet it is visually, and how snappy it is. Even the LSP information and pop-ups are very unobtrusive, and let you focus on what you are doing. I find it a very nice editor for quick edits of files of all kinds, but prefer Neovim or Emacs for working with projects or groups of files.</p>
<p>The other advantage of Helix being so easy to set up is that you can use it to edit the configuration of Neovim or Emacs when you break their respective configurations and so can&rsquo;t use either of them to correct the configuration errors!</p>
<h3 id="neovim">Neovim</h3>
<p>Until recently, I was using a <a href="https://www.lazyvim.org/">LazyVim-based</a> Neovim setup. It&rsquo;s a bit like Doom Emacs in that it is extremely full-featured, but can therefore be a bit complicated to maintain or adapt to your needs. However, through LazyVim, I encountered the <a href="https://github.com/echasnovski/mini.nvim">mini.nvim</a> suite of Neovim plugins, and found that I really liked their restrained, minimal design, which reminded me of Helix a bit. So when I came to build my Neovim config in NixOS, I decided to build more or less from scratch, but based on the mini plugin ecosystem.</p>
<p>You have &mdash; for better or worse &mdash; a lot of options to configure Neovim in the NixOS ecosystem. The two biggest are <a href="https://github.com/nix-community/nixvim">nixvim</a> and <a href="https://github.com/NotAShelf/nvf">nvf</a>. Both let you use nix to install and configure Neovim, but differ slightly in their approach and philosophy. I tried both and liked them both, but found that I was having to do quite a bit of the mental translation from the standard Lua configuration to the formats they needed. I slightly preferred nvf because of its flexibility, and still have a module fully configured (but no longer required) in my configuration to fall back to if needed.</p>
<p>I then came across <a href="https://nixcats.org/index.html">nixCats</a>. It can be a bit challenging to get your head around (at least, that was my experience), but it takes the pragmatic approach of separating out the concerns: Nix downloads and manages the Neovim plugins, but Lua is used to configure them and Neovim. It is also extremely flexible in how you can set it up, and this is where some of the challenging aspect comes from, because there are lots of choices to make. You can make it a standalone flake installation from which you can <code>nix run</code> Neovim on any system which has nix (the package manager) installed. Alternatively it can be an integral part of either a NixOS or Home Manager setup. You can even (this is the &lsquo;cats&rsquo; part) configure different categories of configuration/binary so that you effectively have different Neovims installed (each with a custom binary name), each designed for a particular function. So you could have a basic Neovim for general text editing, and another finely tuned for a particular range of programming languages, with all the bells and whistles.</p>
<p>Once I had got my head around it, I found it quite easy to set up Neovim in the way I wanted, based mostly on the mini.nvim suite of plugins. What I ended up with is a very capable (and LSP/Tree-sitter equipped) editor, but with a quieter, more pared back interface than LazyVim.</p>
<h3 id="emacs">Emacs</h3>
<p>This was the biggie. My first thought was to install Doom Emacs again, but to use NixOS to install Emacs only, and then link to config files and the Doom directory outside of NixOS (this seems to be the approach most people take). I tried it and failed totally to get it working. I was obviously missing something, but there were so many moving parts that I was lost and frustrated.</p>
<p>I decided to take a similar approach as with the other editors and build more or less from scratch. As I wanted to stick with evil bindings in Emacs this time (so that I didn&rsquo;t drive myself crazy switching between three editors with two different sets of bindings), I looked for minimal set ups that incorporated evil bindings, and came across <a href="https://github.com/jamescherti/minimal-emacs.d">minimal-emacs.d</a>. This is a very nicely chosen set of defaults provided in an <code>early-init.el</code> and <code>init.el</code> file, and you then put your own configuration in one of four suggested files, each of which is called either before or after each of the provided init files. It sounds complicated, but is actually very straightforward. The GitHub page provides suggested basic configurations for different use cases, which helps you get up to speed quickly. I also had previous configurations that I could pull from, since the actual configuration is just standard Emacs <code>*.el</code> files. This approach has also enabled me to set each editor up with a core of common bindings/UI for common tasks, making it easier to flit between the editors as the mood takes me.</p>
<p>Emacs itself is installed by NixOS, then I use Home Manager to link a folder of lisp config files into my <code>~/.emacs.d/</code> folder. However, what is nice about using NixOS for this (and for all the editors here) is that I have a NixOS module for each editor setup, in which I can also configure all the other bits and bobs that are needed. For example, the Emacs module installs all the little tools you might need (like ripgrep, the &lsquo;all the icons&rsquo; nerd fonts, aspell dictionaries etc.) and configures them so Emacs finds them. I also used it to write and install shell scripts to open an org-mode capture frame and to set up specialised <code>*.desktop</code> entries for capture and agenda display. I plan to also use <code>khal</code> and <code>vdirsyncer</code> to fetch a local copy of my calendars from Fastmail so that I can use them in the org-mode agenda, and display upcoming events on my Hyprland desktop, and that too could go in the Emacs module.</p>
<h3 id="wrapping-up-the-configuration">Wrapping up the configuration</h3>
<p>I really like this as a way of configuring the system, because it means that there is much less of that, &lsquo;oh, I forgot I also needed <code>fd</code> installed to use this&hellip;&rsquo; business that tends to happen, and &mdash; as importantly &mdash; means that the whole configuration and the relationship between the moving parts is documented in the configuration itself. I have spent far too much time (on both macOS and Linux) trying to remember what I installed to make something work, and where it is on my system, but this approach avoids that. You can even specify packages to install in multiple modules (so that you document the fact that they are needed in both), but NixOS will just install it once, without duplication or conflicts.</p>
<p>It&rsquo;s not all sunshine and roses, of course, and there are still things that end up being a bit more tricky than on conventional OSs, but overall, I am really enjoying setting this up and using it. I can see why people become NixOS evangelists&hellip;</p>