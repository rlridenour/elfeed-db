<p>I&rsquo;m trying to get used to Doom Emacs and one issue I have is that LSP (in my case Eglot) starts automatically
when I open up a php project.</p>
<p>I don&rsquo;t really like it because sometimes I open php files that I don&rsquo;t need autocompletion for
and I don&rsquo;t want to remember that there is Eglot process now running that I have to stop to save some resources of my laptop.</p>
<p>It happens because I have defined <code>php</code> module in <code>init.el</code> as <code>(php +lsp)</code>.
The reason I have it defined like this is because I need LSP.
I just don&rsquo;t want to start it automatically every time I open a php file.</p>
<p>I like how easy it is in Doom to inspect the module implementation so I went to Doom&rsquo;s <code>modules/lang/php/config.el</code> and I found
that there is no flag that can force LSP to not start automatically.</p>
<p>What it has though is this line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;php-mode-local-vars-hook</span> <span style="color:#a6e22e">#&#39;</span>lsp! <span style="color:#e6db74">&#39;append</span>)
</span></span></code></pre></div><p>It looks to me like something that starts the LSP automatically. It looks like this mostly because everything else looks pretty much unrelated to LSP.</p>
<p>Since there is no flag, let&rsquo;s solve it in our own config by directly removing that <code>lsp!</code> piece from that variable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(after! php-mode
</span></span><span style="display:flex;"><span> (remove-hook <span style="color:#e6db74">&#39;php-mode-local-vars-hook</span> <span style="color:#a6e22e">#&#39;</span>lsp!))
</span></span></code></pre></div><p>This will remove that <code>lsp!</code> piece from <code>php-mode-local-vars-hook</code> and now LSP won&rsquo;t start automatically.</p>
<p>It would make sense probably to add such a flag so users can easily turn off the auto-LSP but at the same time solution to this
is just one line so maybe it wouldn&rsquo;t make sense to add it.</p>