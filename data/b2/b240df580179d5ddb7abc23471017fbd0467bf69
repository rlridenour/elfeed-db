<figure><img src="https://emacs.dyerdwelling.family/ox-hugo/20250130074049-emacs--Copy-icomplete-candidate-to-clipboard.jpg" width="100%">
</figure>

<p>In my continuing quest to replace all my external use packages with my own elisp versions so I can still follow my current workflow on an air-gapped system, I would like to replace a single function I use often from <code>embark</code></p>
<p><code>embark</code> allows an action in a certain context, and there are a lot of actions to choose from, but I found I was generally using very few, so to remove my reliance on <code>embark</code> I think I can implement these actions myself.</p>
<p>The main one is to copy the current completion candidate.  For example, I might be searching for a function name, so <code>describe-function</code> function for example, ha!, I just did it!, using <code>describe-function</code> to select <code>describe-function</code> and then copying to the clipboard to then paste in to this blog article!</p>
<p>Well that is it, so lets code it up:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun my-icomplete-copy-candidate ()
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Copy the current Icomplete candidate to the kill ring.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive)
</span></span><span style="display:flex;"><span>  (let ((candidate (<span style="color:#a6e22e">car</span> completion-all-sorted-completions)))
</span></span><span style="display:flex;"><span>    (when candidate
</span></span><span style="display:flex;"><span>      (kill-new (<span style="color:#a6e22e">substring-no-properties</span> candidate))
</span></span><span style="display:flex;"><span>      (let ((copied-text candidate))
</span></span><span style="display:flex;"><span>        (run-with-timer <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">nil</span> (lambda ()
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;Copied: %s&#34;</span> copied-text)))
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">abort-recursive-edit</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(global-set-key (kbd <span style="color:#e6db74">&#34;C-c ,&#34;</span>) <span style="color:#e6db74">&#39;find-file-at-point</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">define-key</span> minibuffer-local-completion-map (kbd <span style="color:#e6db74">&#34;C-c ,&#34;</span>) <span style="color:#e6db74">&#39;my-icomplete-copy-candidate</span>)
</span></span></code></pre></div><p>Note of course that I use the built-in <code>fido-mode</code> and therefore <code>icomplete</code> so there might be possibly a different implementation if you were using something like vertico for example.</p>
<p>Also as a bonus, note that I have added another common <code>embark</code> action and that is to navigate to a file at point. Fortunately Emacs has this function built-in so I again bound to my former standard <code>embark</code> activation key.</p>