
<p class="wp-block-paragraph">Your Virtual Private Network isn&#8217;t there to watch geo-blocked content.<br>Once VPNs were used to connect networks, like remote offices of a company.<br>Today they protect your information and&nbsp;<strong>privacy</strong>.<br>This is why your VPN isn&#8217;t an optional tool anymore.<br>It&#8217;s your shield against the unwanted attention and passive monitoring.</p>



<span id="more-8684"></span>



<p class="wp-block-paragraph">Without a VPN your ISP can see a lot:</p>



<ul class="wp-block-list">
<li><em>your browsing habits</em></li>



<li><em>your downloads</em></li>



<li><em>the used protocols</em></li>
</ul>



<p class="wp-block-paragraph">They don&#8217;t see your data. They see patterns. They draw the map.</p>



<p class="wp-block-paragraph">With a consumer VPN you shift your trust to your VPN provider.<br>If you host your own VPN service &#8211; you put your trust in yourself and your hosting provider.</p>



<h3 class="wp-block-heading">Guard Your Wires</h3>



<p class="wp-block-paragraph">WireGuard is a modern VPN protocol.<br>It&#8217;s simple, fast and secure and it&#8217;s part of the Linux kernel.</p>



<p class="wp-block-paragraph">Smaller codebase means easier audits.</p>



<h4 class="wp-block-heading">Server Installation and Configuration</h4>



<p class="wp-block-paragraph">Install the&nbsp;<code>wireguard</code>&nbsp;package with your package manager:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo apt install wireguard
</pre></div>


<p class="wp-block-paragraph">Generate the server keys:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
wg genkey &gt; server_private.key
wg pubkey &lt; server_private.key &gt; server_public.key
sudo mv *.key /etc/wireguard/
</pre></div>


<p class="wp-block-paragraph">Protect the keys with hardened permissions:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo chmod 400 /etc/wireguard/{server_private.key,server_public.key}
sudo chown root:root /etc/wireguard/{server_private.key,server_public.key}
</pre></div>


<p class="wp-block-paragraph">In the following examples:</p>



<ul class="wp-block-list">
<li><em>Replace the IP address with your IP.</em></li>



<li><em>Replace the interface with your LAN interface.</em></li>
</ul>



<p class="wp-block-paragraph">Enable the local IP forwarding:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
echo "net.ipv4.ip_forward=1" | sudo tee /etc/sysctl.d/wireguard.conf
sudo sysctl --system
</pre></div>


<p class="wp-block-paragraph">In the&nbsp;<code>/etc/ufw/sysctl.conf</code>:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
net.ipv4.ip_forward=1
</pre></div>


<p class="wp-block-paragraph">In the&nbsp;<code>/etc/ufw/before.rules</code>&nbsp;before the&nbsp;<code>*filter</code>&nbsp;line:</p>


<div class="is-style-solarized-light wp-block-code">
	<div class="cm-editor">
		<div class="cm-scroller">
			
<pre><code class="language-shell"><div class="cm-line">*nat</div><div class="cm-line">:POSTROUTING ACCEPT [0:0]</div><div class="cm-line"><span class="tok-propertyName">-A</span> POSTROUTING <span class="tok-propertyName">-s</span> <span class="tok-number">10</span>.20.20.0/24 <span class="tok-propertyName">-o</span> enp1s0 <span class="tok-propertyName">-j</span> MASQUERADE</div><div class="cm-line">COMMIT</div></code></pre>
		</div>
	</div>
</div>


<p class="wp-block-paragraph">Allow the routing in UFW:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo ufw route allow in on wg0 out on enp1s0
sudo ufw allow 51820/udp
</pre></div>


<p class="wp-block-paragraph">Reload the UFW configuration:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo ufw disable
sudo ufw enable
</pre></div>


<p class="wp-block-paragraph">WireGuard server configuration:</p>



<p class="wp-block-paragraph">Minimal server configuration&nbsp;<code>/etc/wireguard/wg0.conf</code>.</p>


<div class="is-style-solarized-light wp-block-code">
	<div class="cm-editor">
		<div class="cm-scroller">
			
<pre><code><div class="cm-line"># Server configuration</div><div class="cm-line">[Interface]</div><div class="cm-line">PrivateKey = &lt;server_private_key&gt;</div><div class="cm-line">Address = 10.20.20.1/24</div><div class="cm-line">ListenPort = 51820</div><div class="cm-line">SaveConfig = false</div><div class="cm-line"></div><div class="cm-line"># Client&apos;s config</div><div class="cm-line">[Peer]</div><div class="cm-line">PublicKey = e2V40zdPiX43lqOamcoEI8J10uKaXWBeKwf+spWDWgc=</div><div class="cm-line">AllowedIPs = 10.20.20.2/32</div></code></pre>
		</div>
	</div>
</div>


<p class="wp-block-paragraph">Harden the file permissions:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo chmod 600 /etc/wireguard/wg0.conf
</pre></div>


<p class="wp-block-paragraph">Start and enable the service:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo systemctl enable wg-quick@wg0
sudo systemctl start wg-quick@wg0
</pre></div>


<p class="wp-block-paragraph">Verify the service:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo systemctl status wg-quick@wg0.service
</pre></div>


<h4 class="wp-block-heading">Client Installation and Configuration</h4>



<p class="wp-block-paragraph">Install the&nbsp;<code>wireguard</code>&nbsp;package on the client machine as well.<br>Generate the key pair as you did on the server.<br>Don&#8217;t forget to harden their permissions.</p>



<p class="wp-block-paragraph">Install the&nbsp;<code>resolvconf</code>&nbsp;package (optional on some systems):</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo apt install resolvconf
</pre></div>


<p class="wp-block-paragraph">WireGuard client configuration.</p>



<p class="wp-block-paragraph">Minimal client config in&nbsp;<code>/etc/wireguard/wg-ds.conf</code>:</p>


<div class="is-style-solarized-light wp-block-code">
	<div class="cm-editor">
		<div class="cm-scroller">
			
<pre><code><div class="cm-line"># Client&apos;s configuration</div><div class="cm-line">[Interface]</div><div class="cm-line">PrivateKey = &lt;client_private_key&gt;</div><div class="cm-line">Address = 10.20.20.2/32</div><div class="cm-line">SaveConfig = true</div><div class="cm-line"></div><div class="cm-line"># Server&apos;s configuration</div><div class="cm-line">[Peer]</div><div class="cm-line">PublicKey = tInj/aAAZIkv8RWzAyXq5ngbO9OUPz+Fkbog7LkgQzQ=</div><div class="cm-line">Endpoint = &lt;server_ip&gt;:51820</div><div class="cm-line">AllowedIPs = 10.20.20.0/24, 192.168.100.0/24</div><div class="cm-line">PersistentKeepalive = 25</div></code></pre>
		</div>
	</div>
</div>


<p class="wp-block-paragraph"><code>PersistentKeepalive</code>&nbsp;is crucial for services behind NAT.</p>



<p class="wp-block-paragraph">Don&#8217;t forget the hardening:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo chmod 600 /etc/wireguard/wg-ds.conf
</pre></div>


<p class="wp-block-paragraph">Bring up the connection:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo wg-quick up wg-ds
</pre></div>


<p class="wp-block-paragraph">Verify it:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo wg show
</pre></div>


<p class="wp-block-paragraph">Break down the connection if you don&#8217;t need it:</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: bash; first-line: 1; gutter: false; title: ; notranslate">
sudo wg-quick down wg-ds
</pre></div>


<h3 class="wp-block-heading">Final Thoughts</h3>



<p class="wp-block-paragraph">This configuration protects your browsing only&nbsp;<strong>between</strong>&nbsp;the client and the server.<br>What leaves the server is visible to third parties.<br>The trace leads back to the server &#8211; then to you.</p>



<p class="wp-block-paragraph">Your VPN is&nbsp;<strong>not</strong>&nbsp;anonymity.<br>It&#8217;s your elevated&nbsp;<strong>privacy</strong>.</p>
