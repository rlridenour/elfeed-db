
         
         <p><strong>UPDATE 2024-07-29 12:15 +0300:</strong> Made some minor tweaks to the code
samples.</p>

<hr />

<p>As part of the current development target of my <code class="language-plaintext highlighter-rouge">dired-preview</code>
package, the <code class="language-plaintext highlighter-rouge">dired-preview-with-window</code> macro can be used to run
arbitrary code with the preview window as the selected one. We can use
this to run a command in the previewed buffer. One such case is to
play the media file on display, with the help of the <code class="language-plaintext highlighter-rouge">ready-player</code>
package.</p>

<p>The <code class="language-plaintext highlighter-rouge">ready-player</code> by Alvaro Ramirez is a neat way to access
multimedia files inside of Emacs. When you visit a media file in a
buffer, Emacs will show a thumbnail, relevant metadata, and buttons to
play the file, pause it, et cetera. This is much better than what
Emacs does by default when it cannot read the file, where it presents
a bunch of gibberish characters.</p>

<p>My <code class="language-plaintext highlighter-rouge">dired-preview</code> package will show the current Dired file at point
in a preview window. When that file is among those supported by
<code class="language-plaintext highlighter-rouge">ready-player</code>, the preview will be done in the aforementioned nice
presentation. Demo:</p>

<p><a href="https://protesilaos.com/assets/images/attachments/2024-07-29-emacs-dired-preview-ready-player.png"><img alt="Dired preview of a media file using ready-player" src="https://protesilaos.com/assets/images/attachments/2024-07-29-emacs-dired-preview-ready-player.png" /></a></p>

<p>Using the in-development <code class="language-plaintext highlighter-rouge">dired-preview-with-window</code> macro, we can
start playing the current file using <code class="language-plaintext highlighter-rouge">ready-player</code>:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">prot/ready-player-dired-preview-play-toggle</span> <span class="p">()</span>
  <span class="s">"Call `ready-player-toggle-play-stop' on the currently previewed media file."</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">dired-preview-with-window</span>
   <span class="p">(</span><span class="nv">if-let</span> <span class="p">((</span><span class="nv">file</span> <span class="nv">buffer-file-name</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">media</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"\\."</span> <span class="p">(</span><span class="nv">regexp-opt</span> <span class="nv">ready-player-supported-media</span> <span class="no">t</span><span class="p">)</span> <span class="s">"\\'"</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">_</span> <span class="p">(</span><span class="nv">string-match-p</span> <span class="nv">media</span> <span class="nv">file</span><span class="p">)))</span>
       <span class="p">(</span><span class="nv">call-interactively</span> <span class="nf">#'</span><span class="nv">ready-player-toggle-play-stop</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">user-error</span> <span class="s">"Cannot do something useful with `ready-player' here"</span><span class="p">))))</span>
</code></pre></div></div>

<p>Then we bind <code class="language-plaintext highlighter-rouge">prot/ready-player-dired-preview-play-toggle</code> to a key in
the <code class="language-plaintext highlighter-rouge">dired-preview-mode-map</code>. For example:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">define-key</span> <span class="nv">dired-preview-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c C-p"</span><span class="p">)</span> <span class="nf">#'</span><span class="nv">prot/ready-player-dired-preview-play-toggle</span><span class="p">)</span>
</code></pre></div></div>

<p>Personally, I prefer to just open the file externally at all times.
With <code class="language-plaintext highlighter-rouge">ready-player</code>, we can achieve this using the following command:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">prot/ready-player-dired-preview-open-externally</span> <span class="p">()</span>
  <span class="s">"Call `ready-player-open-externally' on the currently previewed media file."</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">dired-preview-with-window</span>
   <span class="p">(</span><span class="nv">if-let</span> <span class="p">((</span><span class="nv">file</span> <span class="nv">buffer-file-name</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">media</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"\\."</span> <span class="p">(</span><span class="nv">regexp-opt</span> <span class="nv">ready-player-supported-media</span> <span class="no">t</span><span class="p">)</span> <span class="s">"\\'"</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">_</span> <span class="p">(</span><span class="nv">string-match-p</span> <span class="nv">media</span> <span class="nv">file</span><span class="p">)))</span>
       <span class="p">(</span><span class="nv">call-interactively</span> <span class="nf">#'</span><span class="nv">ready-player-open-externally</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">user-error</span> <span class="s">"Cannot do something useful with `ready-player' here"</span><span class="p">))))</span>
</code></pre></div></div>

<p>[ Emacs 30 has the <code class="language-plaintext highlighter-rouge">dired-do-open</code> if you need something more general
  for opening the file externally. ]</p>

<p>Again, bind it to the <code class="language-plaintext highlighter-rouge">dired-preview-mode-map</code> for it to work.</p>

<h2>The <code class="language-plaintext highlighter-rouge">dired-preview-with-window</code> is in development</h2>

<p>Remember that I am still working on the <code class="language-plaintext highlighter-rouge">dired-preview-with-window</code>. I
plan to add some more commands that utilise it and, generally, make
the preview window more useful. The relevant details will be available
in the release notes for the new version, as well as the manual.</p>

<h2>About dired-preview</h2>

<p>This is a simple package to automatically preview in a side window the
file at point in Dired buffers. Preview windows are closed when they
are no longer relevant, while preview buffers are killed if they have
not been used for other purposes beside previewing. The package
provides several customisation options to control its behaviour.</p>

<ul>
  <li>Package name (GNU ELPA): <code class="language-plaintext highlighter-rouge">dired-preview</code></li>
  <li>Official manual: <a href="https://protesilaos.com/emacs/dired-preview">https://protesilaos.com/emacs/dired-preview</a></li>
  <li>Git repositories:
    <ul>
      <li>GitHub: <a href="https://github.com/protesilaos/dired-preview">https://github.com/protesilaos/dired-preview</a></li>
      <li>GitLab: <a href="https://gitlab.com/protesilaos/dired-preview">https://gitlab.com/protesilaos/dired-preview</a></li>
    </ul>
  </li>
  <li>Backronym: Directories Invariably Render Everything Decently; PDFs
Require Extra Viewing Instructions for Emacs to Work.</li>
</ul>
        
      