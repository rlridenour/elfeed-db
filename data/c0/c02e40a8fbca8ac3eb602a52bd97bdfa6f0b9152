<p>Alex Chan published <a href="https://alexwlchan.net/2025/text-fragments-bookmarklet/">a post</a> today that struck me immediately as something I should s̸t̸e̸a̸l̸ adapt for my own use. It’s a bookmarklet that creates a URL linking to the selected text within a web page. The selected text is called a <a href="https://developer.mozilla.org/en-US/docs/Web/URI/Reference/Fragment/Text_fragments"><em>text fragment</em></a>, and a link to it will typically cause your browser to scroll to the text in question and highlight it. Here’s an example on <a href="https://developer.mozilla.org/en-US/docs/Web/URI/Reference/Fragment/Text_fragments#:~:text=highlights%20the%20first%20instance">the MDN page</a> about text fragments.</p>
<p>Chan’s bookmarklet uses this JavaScript:</p>
<pre><code>javascript:
 1:  const selectedText = window.getSelection().toString().trim();
 2:  
 3:  if (!selectedText) {
 4:    alert("You need to select some text!");
 5:    return;
 6:  }
 7:  
 8:  const url = new URL(window.location);
 9:  url.hash = `:~:text=${encodeURIComponent(selectedText)}`;
10:  
11:  alert(url.toString());
</code></pre>
<p>It gets the selected text in Line 1, combines it with the URL of the page and the necessary directives in Lines 8 and 9, and displays it in a alert window in Line 11. If no text is selected, the bookmarklet puts up an error message via Lines 3–6.</p>
<p>This is great, but using it as-is while writing a post would force me to select the fragment URL in the alert window, copy it, and then switch to BBEdit (where I do all my writing) and call a script named <span class="menu">Clipboard Link</span>, which creates a <a href="https://daringfireball.net/projects/markdown/syntax#link">Markdown reference link</a> from the URL on the clipboard.<sup id="fnref:script"><a href="#fn:script" rel="footnote">1</a></sup> I wanted an automation that didn’t require that many steps.</p>
<p>So I made <a href="https://leancrew.com/all-this/downloads/Safari%20text%20fragment%20link.kmmacros">this Keyboard Maestro macro</a>:</p>
<p><img alt="KM Safari text fragment link" class="ss" src="https://leancrew.com/all-this/images2025/20250914-KM%20Safari%20text%20fragment%20link.png" title="KM Safari text fragment link" width="100%"/></p>
<p>As you can see, this macro is meant to be run while BBEdit is the active application and can be called with the ⌃⌥⌘F hotkey. It executes a slightly edited version of Chan’s JavaScript:</p>
<pre><code>javascript:
1:  const selectedText = window.getSelection().toString().trim();
2:  
3:  const url = new URL(window.location);
4:  url.hash = `:~:text=${encodeURIComponent(selectedText)}`;
5:  
6:  return url.toString();
</code></pre>
<p>The differences are that there’s no error handling (that’s done elsewhere in the macro) and it puts the text fragment URL into a Keyboard Maestro variable named <code>InstanceFragmentURL</code> instead of displaying an alert.</p>
<p>If <code>InstanceFragmentURL</code> ends with <code>text=</code>, we know that there was no selected text when the macro was invoked. That’s an error, so the Basso sound is played to tell me I made a mistake, and the macro is canceled. Otherwise, the text fragment URL is put on the clipboard and the <span class="menu">Clipboard Link</span> script is run by choosing it from the <span class="menu">Blogging</span> submenu of BBEdit’s <span class="menu">Scripts</span> menu.</p>
<p>You should know that this macro, like Chan’s bookmarklet, creates only the simplest kind of text fragment URL, and it links to the first instance of the text on the page. That might not be the instance you want to link to. For example, if I select this instance of the word “bookmarklet” on Chan’s page,</p>
<p><img alt="Screenshot of blog post with selected text" class="ss" src="https://leancrew.com/all-this/images2025/20250914-Screenshot%20of%20blog%20post%20with%20selected%20text.png" title="Screenshot of blog post with selected text" width="100%"/></p>
<p>and call the macro, it will make <a href="https://alexwlchan.net/2025/text-fragments-bookmarklet/#:~:text=bookmarklet">this link</a>, which goes to the word “bookmarklet” in the post’s title.</p>
<p>The MDN page on text fragments explains <a href="https://developer.mozilla.org/en-US/docs/Web/URI/Reference/Fragment/Text_fragments#syntax">a set of directives</a> that can be added to the URL to adjust which instance is linked. The <code>prefix-</code> and <code>-suffix</code> directives should be sufficient to uniquely define the fragment. If I need to do so, I’ll add them manually. <a href="https://alexwlchan.net/2025/text-fragments-bookmarklet/#:~:text=small-,bookmarklet">Like this</a>. I doubt there’s a good way to automate the addition of these directives, so I’m not going to waste my time trying.</p>
<p>I always know I’m going to learn something when Chan’s blog appears in my RSS feed. Today I was able to use what I learned right away.</p>
<div class="update">
<p><strong>Update 15 Sep 2025 2:01 PM</strong><br/>
A couple of things I’ve learned since posting:</p>
<p>First, Jeff Johnson <a href="https://mastodon.social/@lapcatsoftware/115206281472814306">asked on Mastodon</a> why I wasn’t using the <span class="menu">Copy Link with Highlight</span> item from Safari’s context menu.</p>
<p><img alt="Context menu with text fragment link" class="ss" src="https://leancrew.com/all-this/images2025/20250915-Context%20menu%20with%20text%20fragment%20link.png" title="Context menu with text fragment link" width="80%"/></p>
<p>The short answer is that I didn’t know it was there. This is what happens when you’ve been using software so long you think you know it all and don’t pay attention to minor updates.</p>
<p>I’m not certain how helpful this will be. Using it will add a step to my fragment-linking workflow, but maybe the extra step is small enough not to worry about. However that falls out, it’s good to know that menu item is there. Chrome has a similar context menu item; Firefox, as far as I can tell, does not.</p>
<p>Also on Mastodon, Juande Santander-Vela <a href="https://mathstodon.xyz/@juandesant/115208111616729673">linked to</a> an <a href="https://sij.law/deepciter/">interesting post</a> by Sangye Ince-Johannsen that talks about the value of text fragment linking and ties it to the wider problem of link rot. There’s no question but that fragment links are more likely to go bad than page links—even minor page edits can ruin a text fragment link. Ince-Johannsen’s solution is a little extreme for me, but it’s worth considering if you really need your links to survive. Me, I’ve kind of resigned myself to a certain degree of impermanence to the web. While I don’t like it when links here go bad, ANIAT is just a blog, and there’s a limit to what I’m willing to do to ensure link stability.</p>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:script">
<p>I thought I’d written a post about <span class="menu">Clipboard Link</span>, but apparently not. I guess I’ll have to do that now. <a href="#fnref:script" rev="footnote">↩</a></p>
</li>
</ol>
</div>
