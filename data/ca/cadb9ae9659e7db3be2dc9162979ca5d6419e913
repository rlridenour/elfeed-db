<p>I use <a href="https://github.com/orgzly-revived/orgzly-android-revived">Orgzly Revived</a> on my phone to capture to-do items, tasks, writing ideas, and projects. Its files are then synced with an ownCloud server. Those same files are also constantly open in Emacs on my computer, which means there can be some gnarly issues with things getting out of sync. It took me a while to figure out a good way to manage this, and in this brief blog post, I would like to share my solution.</p>

<!--more-->

<p>Setting up a remote storage system is outside the scope of this server. Orgzly Revived works well with Dropbox, ownCloud, and nextCloud, though support for the other two is nicer as it can support automatic syncing in more situations. The <a href="https://github.com/orgzly-revived/documentation">Orgzly Revived documentation</a> has an excellent description of how that configuration works.</p>

<p>Note that to keep things simple, I keep my Orgzly Revived files and <em>only</em> those files in a directory on my remote server. On my computer, the location for these files is <code class="language-plaintext highlighter-rouge">~/org/orgzly/</code>, which is how I shall refer to it later on.</p>

<h2 id="configuring-orgzly-revived-auto-sync">Configuring Orgzly Revived Auto-sync</h2>

<p>To configure the auto-sync capabilities in Orgzly Revived, go to the settings screen in the app and then navigate to <strong>Sync &gt; Auto-sync</strong>. Ensure that the following options are toggled on:</p>

<ul>
  <li>Auto-sync</li>
  <li>Note created</li>
  <li>Note updated or deleted</li>
  <li>App started or resumed</li>
</ul>

<p>This ensures that Orgzly Revived is constantly checking your remote storage and both fetching and uploading changes.</p>

<h2 id="configuring-emacs-and-org-mode">Configuring Emacs and Org-mode</h2>

<p>On my computer, I want any changes that Orgzly Revived has updated to be automatically loaded into Emacs. Since I always leave Emacs running, that means it needs to detect changes on the disk for those particular files. I use two different methods to do this. First, in my init file, I have the following piece of code:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">setq</span> <span class="nv">orgzly-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"~/org/orgzly/"</span><span class="p">))</span>
<span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'revert-without-query</span> <span class="p">(</span><span class="nv">rx</span> <span class="nv">bol</span> 
                                       <span class="p">(</span><span class="nb">eval</span> <span class="nv">orgzly-directory</span><span class="p">)</span> 
                                       <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">not</span> <span class="s">"/"</span><span class="p">))</span> <span class="s">".org"</span> 
                                       <span class="nv">eol</span><span class="p">))</span>
</code></pre></div></div>

<p>This uses the <code class="language-plaintext highlighter-rouge">rx</code> macro to easily create a regular expression that matches any filename ending in <code class="language-plaintext highlighter-rouge">".org"</code> in the directory containing Orgzly Revived files. You may need to play around with the regular expression to get the right match. By adding those files to <code class="language-plaintext highlighter-rouge">revert-without-query</code>, Emacs will not bug you with extra questions and confirmations when changes are detected. However, this only works when <code class="language-plaintext highlighter-rouge">auto-revert-mode</code> is enabled!</p>

<p>At first, I thought there may be a way to enable <code class="language-plaintext highlighter-rouge">auto-revert-mode</code> on a file-by-file basis, but quickly realized that this could cause too many problems with creating new files in the Orgzly Revived app. Eventually, I realized that the solution would be to make a <code class="language-plaintext highlighter-rouge">.dir-locals.el</code> file in <code class="language-plaintext highlighter-rouge">~/org/orgzly/</code>. Open that file in Emacs, and stick the following in it.</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">((</span><span class="no">nil</span> <span class="o">.</span> <span class="p">((</span><span class="nb">eval</span> <span class="o">.</span> <span class="p">(</span><span class="nv">auto-revert-mode</span> <span class="mi">1</span><span class="p">)))))</span>
</code></pre></div></div>

<p>That ensures that any file in that directory will have <code class="language-plaintext highlighter-rouge">auto-revert-mode</code> enabled.</p>

<p>Once you have done this, you can add task files or inbox files in <code class="language-plaintext highlighter-rouge">~/org/orgzly</code> to your <code class="language-plaintext highlighter-rouge">org-agenda-files</code> variable, and they will show up in your agenda views as usual.</p>

<p>Hopefully these instructions work for you. Please let me know if you can see any improvements or problems with the way I have implemented this. Happy task tracking!</p>