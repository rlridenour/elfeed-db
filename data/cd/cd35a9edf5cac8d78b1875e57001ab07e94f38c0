<p>What does this program do? At the most reduced level, one could say that a program&rsquo;s behavior is defined by the effect it has on the hardware running it. That&rsquo;s not very useful however; when we&rsquo;re programming, we often have to deal with legacy code and tease out the original intent of the code.</p>
<p>Saying that the meaning of a program is entirely encapsulated by the code is saying that the intent and the implementation are the same. They so rarely are!</p>
<p>Today I found some Elixir code that looked like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elixir" data-lang="elixir"><span style="display:flex;"><span><span style="color:#8fbcbb">@spec</span> all_have_key?<span style="color:#eceff4">(</span>lst <span style="color:#81a1c1">::</span> <span style="color:#eceff4">[%{}],</span> needed_key <span style="color:#81a1c1">::</span> <span style="color:#8fbcbb">String</span><span style="color:#81a1c1">.</span>t<span style="color:#eceff4">())</span> <span style="color:#81a1c1">::</span> boolean<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> all_have_key?<span style="color:#eceff4">(</span>lst<span style="color:#eceff4">,</span> needed_key<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  lst
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">|&gt;</span> <span style="color:#8fbcbb">Enum</span><span style="color:#81a1c1">.</span>map<span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">fn</span> m <span style="color:#81a1c1">-&gt;</span> m <span style="color:#81a1c1">|&gt;</span> <span style="color:#8fbcbb">Map</span><span style="color:#81a1c1">.</span>keys<span style="color:#eceff4">()</span> <span style="color:#81a1c1">|&gt;</span> <span style="color:#8fbcbb">Enum</span><span style="color:#81a1c1">.</span>any?<span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">fn</span> k <span style="color:#81a1c1">-&gt;</span> k <span style="color:#81a1c1">==</span> needed_key <span style="color:#81a1c1;font-weight:bold">end</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">end</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">|&gt;</span> <span style="color:#8fbcbb">Enum</span><span style="color:#81a1c1">.</span>all?<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">end</span>
</span></span></code></pre></div><p>(Note, I just threw that together—possible syntax errors in there.)</p>
<p>What is this code trying to do? It&rsquo;s trying to check that each map in a list has a given key and return true or false on that condition. I don&rsquo;t think the code even had a <code>@spec</code> to help explain that: all I had was the function name (which was not as clear as <code>all_have_key</code>) and the source.</p>
<p>After a few moments of reflection, I rewrote it to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elixir" data-lang="elixir"><span style="display:flex;"><span><span style="color:#8fbcbb">@spec</span> all_have_key?<span style="color:#eceff4">(</span>lst <span style="color:#81a1c1">::</span> <span style="color:#eceff4">[%{}],</span> needed_key <span style="color:#81a1c1">::</span> <span style="color:#8fbcbb">String</span><span style="color:#81a1c1">.</span>t<span style="color:#eceff4">())</span> <span style="color:#81a1c1">::</span> boolean<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> all_have_key?<span style="color:#eceff4">(</span>lst<span style="color:#eceff4">,</span> needed_key<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  lst
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">|&gt;</span> <span style="color:#8fbcbb">Enum</span><span style="color:#81a1c1">.</span>map<span style="color:#eceff4">(</span><span style="color:#81a1c1">&amp;</span><span style="color:#8fbcbb">Map</span><span style="color:#81a1c1">.</span>has_key?<span style="color:#eceff4">(</span><span style="color:#d08770">&amp;1</span><span style="color:#eceff4">,</span> needed_key<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">|&gt;</span> <span style="color:#8fbcbb">Enum</span><span style="color:#81a1c1">.</span>all?<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">end</span>
</span></span></code></pre></div><p>That big long complicated bit has a built-in function. The built-in function is more efficient because it doesn&rsquo;t traverse the entire list of keys searching for a match: with a map, you get O(1) lookup time.</p>
<p>So what does a program mean? I&rsquo;m pretty confident that I preserved the intended meaning of this program. But what&rsquo;s a better way to express that intent?</p>
<p>Tests are useful, but they don&rsquo;t capture everything. While I think this function was tested, no test can ever ensure 100% preservation of intent. <em>Tests can only find witnesses of meaning mismatches.</em></p>
<p>Type systems are helpful too. But types come in varying degrees of precision: some languages give you an <code>Int</code>, while others give you <code>Int</code> or <code>Nat</code> or <code>∈ {1, 2, 3}</code>. More powerful type systems let you express more of your intent in a way that can be mechanically checked, but they tend to also be more burdensome.</p>
<p>This is an open question that I know there&rsquo;s a lot of ongoing research around. I&rsquo;m excited to see what I find!</p>
