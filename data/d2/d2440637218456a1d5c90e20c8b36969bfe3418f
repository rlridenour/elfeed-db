<p><img src="https://xenodium.github.io/images/emacs-smarter-search-and-replace/smarter_replace.gif" alt=""></p>
<p>Not long ago, I made a note to go back and read <a href="https://mac4translators.blogspot.com">Mac for Translators</a>'s <a href="https://mac4translators.blogspot.com/2021/06/regex-with-elisp.html">Emacs regex with Emacs lisp</a> post. The author highlights Emacs's ability to apply additional logic when replacing text during a search-and-replace session. It does so by leveraging elisp expressions.</p>
<p>Coincidentally, a redditor recently asked <a href="https://www.reddit.com/r/emacs/comments/o878am/what_is_the_simplest_way_to_apply_a_math_formula/">What is the simplest way to apply a math formula to all numbers in a buffer/region?</a> Some of the answers also point to <em>search and replace</em> leveraging elisp expressions.</p>
<p>While I rarely need to apply additional logic when replacing matches, it's nice to know we have options available in our Emacs toolbox. This prompted me to check out <a href="https://github.com/emacs-mirror/emacs/blob/b8f9e58ef72402e69a1f0960816184d52e5d2d29/lisp/replace.el#L709">replace-regexp</a>'s documentation (via M-x <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Name-Help.html">describe-function</a> or my favorite M-x <a href="https://github.com/Wilfred/helpful">helpful-callable</a>). There's lots in there. Go check its docs out. You may be pleasantly surprised by all the features packed under this humble function.</p>
<p>For instance, \&amp; expands to the current match. Similarly, \#&amp; expands to the current match, fed through <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/String-Conversion.html">string-to-number</a>. But what if you'd like to feed the match to another function? You can use \, to signal evaluation of an elisp expression. In other words, you could multiply by 3 using \,(* 3 \#&amp;) or inserting whether a number is odd or even with something like \,(if (oddp \#&amp;) &quot;(odd)&quot; &quot;(even)&quot;).</p>
<p>Take the following text:</p>
<pre><code class="language-example">1
2
3
4
5
6
</code></pre>
<p>We can label each value &quot;(odd)&quot; or &quot;(even)&quot; as well as multiply by 3, by invoking <em>replace-regexp</em> as follows:</p>
<blockquote>
<p>M-x replace-regexp</p>
</blockquote>
<p>[PCRE] Replace regex:</p>
<blockquote>
<p>[-0-9.]+</p>
</blockquote>
<p>Replace regex [-0-9.]+:</p>
<blockquote>
<p>\&amp; \,(if (oddp \#&amp;) &quot;(odd)&quot; &quot;(even)&quot;) x 3 = \,(* 3 \#&amp;)</p>
</blockquote>
<pre><code class="language-example">1 (odd) x 3 = 3
2 (even) x 3 = 6
3 (odd) x 3 = 9
4 (even) x 3 = 12
5 (odd) x 3 = 15
6 (even) x 3 = 18
</code></pre>
<p>It's worth noting that <em>replace-regexp</em>'s cousin <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Query-Replace.html">query-replace-regexp</a> also handles all this wonderful magic.</p>
<p>Happy searching and replacing!</p>
