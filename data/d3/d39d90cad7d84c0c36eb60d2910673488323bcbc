<p>If you’re familiar with this blog, you’ll know that I’m a fan of <a href="https://orgmode.org/worg/org-contrib/org-protocol.html">Org protocol</a>, a means of sending data such as web links and content to an Org file from outside of Emacs. Following up on my last <a href="http://yummymelon.com/devnull/announcing-casual-bibtex.html">post on Casual BibTeX</a>, this post will show how to re-purpose Org protocol to send a link from your preferred web browser to a BibTeX file.</p>
<p>This is achieved by adding the following template (named “bib”) to the variable <code>org-capture-templates</code> as shown below:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">(</span><span class="nv">add-to-list</span><span class="w"> </span><span class="nv">org-capture-templates</span>
<span class="w">             </span><span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;bib&quot;</span>
<span class="w">               </span><span class="s">&quot;BibTex Online Entry&quot;</span>
<span class="w">               </span><span class="nv">plain</span>
<span class="w">               </span><span class="p">(</span><span class="nv">file</span><span class="w"> </span><span class="s">&quot;~/org/bib/references.bib&quot;</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="nb">lambda</span><span class="w"> </span><span class="p">()</span>
<span class="w">                           </span><span class="p">(</span><span class="nv">string-join</span>
<span class="w">                            </span><span class="p">(</span><span class="nf">list</span><span class="w"> </span><span class="s">&quot;@Online {,&quot;</span>
<span class="w">                                  </span><span class="s">&quot;author = {%^{Author(s)}},&quot;</span>
<span class="w">                                  </span><span class="s">&quot;organization = {%^{Organization}},&quot;</span>
<span class="w">                                  </span><span class="s">&quot;title = {%:description},&quot;</span>
<span class="w">                                  </span><span class="s">&quot;url = {%:link},&quot;</span>
<span class="w">                                  </span><span class="s">&quot;date = {%&lt;%Y-%m-%d&gt;%?},&quot;</span>
<span class="w">                                  </span><span class="s">&quot;notes = {&quot;</span>
<span class="w">                                  </span><span class="s">&quot;%i&quot;</span>
<span class="w">                                  </span><span class="s">&quot;}&quot;</span>
<span class="w">                                  </span><span class="s">&quot;}&quot;</span><span class="p">)</span>
<span class="w">                            </span><span class="s">&quot;\n&quot;</span><span class="p">)))</span>
<span class="w">               </span><span class="nb">:prepend</span><span class="w"> </span><span class="no">t</span>
<span class="w">               </span><span class="nb">:empty-lines-after</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>

<p>The web link is treated as an BibTeX <code>Online</code> entry type whose fields are populated as follows:</p>
<ul>
<li><code>url</code> field holds the web page link.</li>
<li><code>title</code> field holds the web page title.</li>
<li><code>date</code> is populated with the current day (this should be edited to the actual date).</li>
<li><code>notes</code> is populated with the body value according to the <a href="https://orgmode.org/manual/The-capture-protocol.html">capture protocol</a>.</li>
<li><code>author</code> is populated with the value entered via mini-buffer prompt.</li>
<li><code>organization</code> is populated with the value entered via mini-buffer prompt, typically the name of the website.</li>
</ul>
<p>The template is configured to prepend (via the <code>:prepend</code> property) the captured <code>Online</code> entry to the file “~/org/bib/references.bib”. These values can be adjusted to taste.</p>
<p>When invoking this template via Org protocol, a temporary capture window holding the populated template is created. This entry will not have a citation key, so it is recommended to run <code>M-x</code> <code>bibtex-clean-entry</code> to generate it before committing the capture via <code>C-c C-c</code>. If you have <a href="https://kickingvegas.github.io/casual/BibTeX.html">Casual BibTeX</a> installed, you can invoke the Transient menu <code>casual-bibtex-tmenu</code> with the binding <code>M-m</code> and invoke the clean command from there.</p>
<h1>Closing Thoughts</h1>
<p>Arguably, Org protocol was not designed to support files other than those using Org markup, so the above practice skirts its design intent by sending the capture to a BibTeX file. But as of Emacs 30.2 and Org 9.7.34, this works fine, so YOLO. Users intent on customizing the above “bib” template should be advised that many <a href="https://orgmode.org/manual/Template-elements.html">template properties</a> are not supported, so be advised.</p>
<p>That all said, it’s a nice win to automate the task of writing a BibTeX <code>Online</code> entry.</p>