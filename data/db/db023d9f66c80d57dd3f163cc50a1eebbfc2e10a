<p>I&rsquo;ve been reading <a href="https://lets-go.alexedwards.net/">Let&rsquo;s Go by Alex Edwards</a>
and one of my favourite tips from the book is to write a HTTP middleware to
recover from panics, something like this:</p>
<pre><code>func (app *application) recoverPanic(next http.Handler) http.Handler {
  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
    defer func() {
      if err := recover(); err != nil {
        w.Header().Set(&quot;Connection&quot;, &quot;close&quot;)
        fmt.Println(err)
        debug.PrintStack() // from &quot;runtime/debug&quot;
        app.serverError(w, fmt.Errorf(&quot;%s&quot;, err))
      }
    }()
    next.ServeHTTP(w, r)
  })
}
</code></pre>
<p>Previously my webserver would just crash if there was a panic (not even
returning an error!) and I think this is better.</p>
