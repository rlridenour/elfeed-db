<h2 id="the-reason">The reason</h2>
<p>There are a few things that depend on the context in Mu4e, some of which are mentioned in the documentation&hellip;</p>
<blockquote>
<p>It can be useful to switch between different sets of settings in Mu4e; a typical example is the case where you have different e-mail accounts for private and work email, each with their own values for folders, e-mail addresses, mailservers and so on.</p>
</blockquote>
<p>Personally I need to be in the right context since I use multiple <a href="https://macowners.club/posts/email-emacs-mu4e-macos/">accounts in my setup</a>. For instance:</p>
<ul>
<li>The right sender needs to be selected when composing an email</li>
<li>The right variables <code>mu4e-refile-folder</code> need to be correct when refiling/archiving emails</li>
<li>And more&hellip;</li>
</ul>
<p>As it turns out, the right context is not always selected when switching mailboxes in the way my <a href="https://gitlab.com/aimebertrand/dotemacs/-/blob/main/libraries/timu-mu4e.el#L375">contexts are configured</a>. Meaning I need a more robust solution.</p>
<p>When switching to a mailbox using <code>timu-mu4e-jump-to-maildir</code> – especially into a mailbox of a different account – Mu4e does not switch the context correctly. At least that has been my experience.</p>
<h2 id="the-solution">The solution</h2>
<p>The code I use has a prerequisite however. The email directories (<code>maildir</code>) for each account need to have the exact same name as the account in the Mu4e inside Emacs.</p>
<p>The function uses <code>mu4e~headers-mode-line-label</code> to get the current <code>maildir</code> string and uses REGEXP to obtain the name of the account this then used as the current context using <code>mu4e-context-switch</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">timu-mu4e-switch-context</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Switch context of the current maildir.
</span></span></span><span class="line"><span class="cl"><span class="s">Uses </span><span class="ss">`mu4e~headers-mode-line-label&#39;</span><span class="s"> and regex to get the context.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">new-context</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">input</span> <span class="nv">mu4e~headers-mode-line-label</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;maildir:\&#34;/\\(.+\\)/.*\&#34;&#34;</span> <span class="nv">input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">match-string</span> <span class="mi">1</span> <span class="nv">input</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">new-context</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">mu4e-context-switch</span> <span class="no">t</span> <span class="nv">new-context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">mu4e-context-switch</span> <span class="no">t</span> <span class="s">&#34;icloud&#34;</span><span class="p">))))</span>
</span></span></code></pre></div><p>This function is then used as a <code>mu4e-headers-found-hook</code> which is of course applied whenever I switch to a mailbox, meaning to a headers view.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;mu4e-headers-found-hook</span> <span class="nf">#&#39;</span><span class="nv">timu-mu4e-switch-context</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="the-conclusion">The conclusion</h2>
<p>I am certain that there exists a better solution out there. I could probably rewrite the setup of the Mu4e context in my configuration to make it more robust.</p>
<p>But since the current solution works wonders for me – I know this is hyperbolic – I cannot be bothered to look more into it.</p>
