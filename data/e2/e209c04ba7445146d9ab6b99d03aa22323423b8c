<p><img src="https://cdn3.brettterpstra.com/uploads/2025/12/apex-header-2-rb.7522.jpg" width="800" height="226" style="margin:0 auto;clear:both;" class="header" /></p>

<p>When <a href="https://github.com/ApexMarkdown/apex">Apex</a> reaches 1.0, I&rsquo;m planning to include it in Marked 3. I realized that Marked has a lot of preprocessing
features that were previously handled in Objective-C that
would make sense to have in the core processor for both
speed and accessibility from the command line.</p>

<p>So I&rsquo;ve added a bunch of new flags and C API definitions to
Apex that bring some of Marked&rsquo;s capabilities directly into
the processor. These are all available via command-line
flags, configuration options, and the C API.</p>

<h2 id="hashtags">Hashtags</h2>

<p>The <code class="language-plaintext highlighter-rouge">--hashtags</code> flag converts <code class="language-plaintext highlighter-rouge">#tags</code> in your Markdown into
span-wrapped hashtags. By default, it uses the <code class="language-plaintext highlighter-rouge">mkhashtag</code>
class, but you can use <code class="language-plaintext highlighter-rouge">--style-hashtags</code> to use
<code class="language-plaintext highlighter-rouge">mkstyledtag</code> instead.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight fixed"><code>apex document.md <span class="nt">--hashtags</span>
apex document.md <span class="nt">--hashtags</span> <span class="nt">--style-hashtags</span></code></pre></div></div>

<p>This is smart enough to skip hashtags inside code blocks and
HTML attributes, so you won&rsquo;t get false matches in things
like <code class="language-plaintext highlighter-rouge">href="https://brettterpstra.com#anchor"</code> or code examples.</p>

<p>Hashtags are disabled by default because they would conflict
with headers if you&rsquo;re not in the habit of putting a space
after the <code class="language-plaintext highlighter-rouge">#</code> in an ATX header (e.g. <code class="language-plaintext highlighter-rouge">#Header 1</code>). This
option is only for people who want to convert things like
Bear notes with tag formatting. They can be enabled with
<code class="language-plaintext highlighter-rouge">--hashtags</code> on the command line, by including <code class="language-plaintext highlighter-rouge">hashtags: true</code>
in a config file, or by using the <code class="language-plaintext highlighter-rouge">enable_hashtags</code>
boolean when using the C API.</p>

<h2 id="random-footnote-ids">Random Footnote IDs</h2>

<p>When you&rsquo;re combining multiple documents, footnote ID
collisions can be a problem. The <code class="language-plaintext highlighter-rouge">--random-footnote-ids</code>
flag generates hash-based footnote IDs using an 8-character
hex prefix from the document content.</p>

<p>Instead of <code class="language-plaintext highlighter-rouge">fn-1</code> and <code class="language-plaintext highlighter-rouge">fnref-1</code>, you&rsquo;ll get <code class="language-plaintext highlighter-rouge">fn-a7b3c9d2-1</code>
and <code class="language-plaintext highlighter-rouge">fnref-a7b3c9d2-1</code>. Different documents get different
hash prefixes, so you can safely combine them without
conflicts.</p>

<h2 id="widont-for-headings">Widon&rsquo;t for Headings</h2>

<p>The <code class="language-plaintext highlighter-rouge">--widont</code> flag prevents short widows in headings by
inserting non-breaking spaces between trailing words. It
works backwards from the end of the heading, combining words
until the trailing portion exceeds 10 characters.</p>

<p>So a heading like &ldquo;introduction to the topic&rdquo; becomes
<code class="language-plaintext highlighter-rouge">introduction to&amp;nbsp;the&amp;nbsp;topic</code> &mdash; ensuring that if
the heading wraps, the trailing portion won&rsquo;t be a short,
lonely word on its own line.</p>

<p>Widon&rsquo;t is disabled by default in all modes, as it might
create potentially unexpected results if the user isn&rsquo;t
aware of it. It can be explicitly enabld with <code class="language-plaintext highlighter-rouge">--widont</code>,
<code class="language-plaintext highlighter-rouge">widont: true</code> in config, or with the <code class="language-plaintext highlighter-rouge">enable_widont</code>
boolean in the C API.</p>

<h2 id="code-is-poetry">Code is Poetry</h2>

<p>Code blocks without a programming language specified can be
treated as poetry with the <code class="language-plaintext highlighter-rouge">--code-is-poetry</code> flag. This
adds a <code class="language-plaintext highlighter-rouge">poetry</code> class to code blocks that don&rsquo;t have a
language specified, and automatically enables
<code class="language-plaintext highlighter-rouge">--highlight-language-only</code> so only code blocks with
languages get syntax highlighting.</p>

<p>Works for both fenced code blocks and indented code blocks.</p>

<p>Again, this is disabled by default as it has very specific
use cases.</p>

<h2 id="proofreader-mode">Proofreader Mode</h2>

<p>The <code class="language-plaintext highlighter-rouge">--proofreader</code> flag converts <code class="language-plaintext highlighter-rouge">==highlight==</code> and
<code class="language-plaintext highlighter-rouge">~~delete~~</code> syntax into CriticMarkup highlight and
deletion. It automatically enables CriticMarkup processing,
so you can use this simpler syntax and still get the full
CriticMarkup rendering.</p>

<h2 id="markdown-in-html-toggle">Markdown in HTML Toggle</h2>

<p>Marked has always processed markdown inside HTML blocks with
<code class="language-plaintext highlighter-rouge">markdown</code> attributes. Now you can control this behavior
with <code class="language-plaintext highlighter-rouge">--markdown-in-html</code> and <code class="language-plaintext highlighter-rouge">--no-markdown-in-html</code>. It&rsquo;s
enabled by default in unified mode, but you can toggle it
for other modes or when you need stricter behavior.</p>

<h2 id="page-breaks">Page Breaks</h2>

<p>Two new flags for page break handling:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">--hr-page-break</code> replaces <code class="language-plaintext highlighter-rouge">&lt;hr&gt;</code> elements with
Marked-style page break divs</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">--page-break-before-footnotes</code> inserts a page break
before the footnotes section</p>
  </li>
</ul>

<p>Both use Marked&rsquo;s standard page break format with proper
attributes for styling and identification.</p>

<h2 id="title-from-h1">Title from H1</h2>

<p>When using <code class="language-plaintext highlighter-rouge">--standalone</code>, the <code class="language-plaintext highlighter-rouge">--title-from-h1</code> flag
extracts the text from the first H1 heading and uses it as
the document title if no title is specified via <code class="language-plaintext highlighter-rouge">--title</code> or
metadata. The H1 stays in the document body, but now it&rsquo;s
also in the <code class="language-plaintext highlighter-rouge">&lt;title&gt;</code> tag.</p>

<h2 id="all-available-everywhere">All Available Everywhere</h2>

<p>All of these features are available through:</p>

<ul>
  <li>Command-line flags (as shown above)</li>
  <li>Configuration files (<code class="language-plaintext highlighter-rouge">config.yml</code>, <code class="language-plaintext highlighter-rouge">--meta-file</code>)</li>
  <li>
    <p>Document metadata (YAML front matter, MultiMarkdown
metadata)</p>
  </li>
  <li>The C API (via the <code class="language-plaintext highlighter-rouge">apex_options</code> struct)</li>
</ul>

<p>This means you can set defaults in your config file,
override per-document in metadata, or use command-line flags
for one-off processing. The flexibility is there.</p>

<h2 id="why-build-these-into-apex">Why Build These Into Apex?</h2>

<p>These features were originally preprocessing steps in
Marked&rsquo;s Objective-C code. Moving them into Apex provides:</p>

<ol>
  <li>
    <p><strong>Speed</strong> &mdash; C-based processing is faster than
Objective-C string manipulation</p>
  </li>
  <li>
    <p><strong>Accessibility</strong> &mdash; Available from the command line
without needing Marked</p>
  </li>
  <li>
    <p><strong>Consistency</strong> &mdash; Same behavior whether called from
Marked or directly</p>
  </li>
  <li>
    <p><strong>Extensibility</strong> &mdash; Other tools can use these features
via the C API</p>
  </li>
</ol>

<p>As Apex approaches 1.0, these features will make the
integration with Marked a little easier while also making
some of Marked&rsquo;s capabilities available to anyone using Apex
directly. I know none of these recent changes are killer features for most people, so this is just serving as documentation of the development process.</p>

<p>As always, as Apex develops, I&rsquo;m very interested in what features you&rsquo;d like to see. The goal is to have one universal processor that, at least for HTML output<sup id="fnref:pandoc"><a href="https://brettterpstra.com#fn:pandoc" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>, can do everything that other Markdown flavors can do. If you have ideas or requests, or want to contribute to the development, please <a href="https://github.com/ApexMarkdown/apex">join me on GitHub</a>!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:pandoc">
      <p>I&rsquo;m not going to try to replicate all of Pandoc&rsquo;s powerful conversion features, as you can just pipe Apex HTML output into Pandoc for easy conversion to PDF, DOCX, etc. I&rsquo;m just focusing on making as many extensions for HTML output as possible work.&nbsp;<a href="https://brettterpstra.com#fnref:pandoc" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

<p>Like or share this post <a title="This post on Mastodon" target="_blank" href="https://hachyderm.io/users/ttscoff/statuses/115905169266877317">on Mastodon</a>, <a title="Share on Bluesky" target="_blank" href="https://bsky.app/intent/compose?text=Marked+features+for+Apex%0A%0Ahttps%3A%2F%2Fbrettterpstra.com%2F2026%2F01%2F16%2Fmarked-features-for-apex%2F">Bluesky</a>, or <a class="twitter" target="_blank" rel="nofollow" href="https://twitter.com/intent/tweet?original_referer=https%3A%2F%2Fbrettterpstra.com%2F2026%2F01%2F16%2Fmarked-features-for-apex%2F&text=Marked+features+for+Apex&url=https%3A%2F%2Fbrettterpstra.com%2F2026%2F01%2F16%2Fmarked-features-for-apex%2F&via=ttscoff" title="Tweet this post">Twitter</a>.</p>
<hr style="margin:40px 0">

<p>BrettTerpstra.com is supported by readers like you. <a href="https://brettterpstra.com/support/">Click here if you'd
        like to help out.</a></p>
<p>Find Brett on <a rel="me" href="https://hachyderm.io/@ttscoff">Mastodon</a>, <a
        href="https://bsky.app/profile/ttscoff.bsky.social">Bluesky</a>, <a
        href="https://github.com/ttscoff">GitHub</a>, and <a href="https://brettterpstra.com/elsewhere">everywhere
        else</a>.</p><img src="https://brett.trpstra.net/link/535/17254761.gif" height="1" width="1"/>