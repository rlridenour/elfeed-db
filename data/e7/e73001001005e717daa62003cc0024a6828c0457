
	
<p>
In developed countries, tap water is safe to drink and available cheaply. Even though high-quality drinking water is almost freely available, the consumption of bottled water is increasing every year. Bottled water companies use sophisticated marketing strategies, while water utilities are mostly passive public service providers. Australian marketing expert Russell Howcroft even called water utilities &#34;lazy marketers&#34;. Can we use a tap water sentiment analysis to learn how people feel about tap water? What can we learn about the reasons behind this loss of trust in the municipal water supply?</p>
<figure>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/Cg9YH4bm2Sk?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

<figcaption>
Gruen Transfer (2009).
</figcaption>
</figure>
<p>
This tap water sentiment analysis estimates people&#39;s attitudes towards tap water by analysing tweets. This article explains how to examine tweets about tap water using the R language and the <a href="https://www.tidytextmining.com/sentiment.html">Tidytext package</a>. </p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Sentiment Analysis
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Sentiment indicates the perception a group of people has about a particular topic. Traditionally, assessing the sentiment of a group of people <a href="https://lucidmanager.org/data-science/analysing-the-customer-experience/">requires surveys</a> or interviews. These methods are problematic because it creates an artificial environment where the respondent often answers to meet the perceived expectations of the study or customers exaggerate to get their point across. Using sentiment analysis of ego documents written by consumers can overcome these problems. Ego-documents, i.e. forms of personal writing, are a more direct way to
find out what consumers think, but they are challenging to obtain and analyse.</p>
<p>
With the advent of social media, access to ego documents has become much more straightforward, and many tools exist to collect and interpret this data. Using ego documents brings you closer to the consumer than possible with surveys or focus groups. One medium gaining popularity with market researchers is <a href="https://twitter.com/">Twitter</a>.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Tap Water Sentiment Analysis
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>Each tweet containing &#34;tap water&#34; reveals the author&#39;s attitude towards that topic. Each text expresses a sentiment about the subject it describes. </p>
<p>
<a href="https://en.wikipedia.org/wiki/Sentiment_analysis">Sentiment analysis</a> is a data science technique that extracts personal information from a text. The basic method compares a string of words with a set of words with calibrated sentiments. These calibrated sets are created by asking many people how they feel about a specific term. For example, &#34;stink&#34; expresses a negative sentiment, while &#34;nice&#34; would be a positive sentiment.</p>
<p>
This tap water sentiment analysis consists of three steps. The first step extracts 1000 tweets containing &#34;tap water&#34; from Twitter. The second step cleans the data, and the third step analyses the results.</p>
<p>
The <a href="https://sites.google.com/view/watercoinzerocom/home">Water Data Aggregator</a> is a commercial application of sentiment analysis for tap water. This website sells the regional social credit score to interested parties.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Extracting tweets using the TwitteR package
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>The <a href="https://cran.r-project.org/web/packages/twitteR/index.html">TwitteR package</a> by Geoff Gentry makes it very easy to retrieve tweets using search criteria. You must create an API on Twitter to receive the keys and tokens. In the code below, the actual values have been removed.</p>
<p>
Follow the instructions in <a href="https://www.r-bloggers.com/setting-up-the-twitter-r-package-for-text-analytics/">this article</a> to obtain these codes for yourself. This code snippet calls a private file to load the API codes, extracts the tweets and creates a data frame with a tweet id number and its text.</p>
<p>
The TwitteR package is no longer availabe. A CSV file of tap water tweets is available on the GitHub repository.</p>
<p>
<a href = "https://github.com/pprevos/r4h2o/" target="_blank"
   title="Download r4h2o from GitHub"
   alt="Download r4h2o from GitHub">
  <button class="button is-medium is-primary">
    <span class="icon is-large">
      <i class="fab fa-github"></i>
    </span>
    <span style="font-family: monospace">r4h2o</span>
  </button>
</a>

</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Tapwater tweet sentiment analysis</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(tidyverse)
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">library</span>(tidytext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tapwater_tweets <span style="color:#333">&lt;-</span> <span style="color:#06b;font-weight:bold">read_csv</span>(<span style="color:#06b;font-weight:bold">paste0</span>(<span style="background-color:#fff0f0">&#34;data/tapwater-tweets-&#34;</span>, <span style="color:#06b;font-weight:bold">Sys.time</span>(), <span style="background-color:#fff0f0">&#34;.csv&#34;</span>))</span></span></code></pre></div>
</div>
<p>
When I first extracted these tweets, a tweet by CNN about <a href="https://edition.cnn.com/2018/03/30/health/kentucky-water-crisis/index.html">tap water in Kentucky that smells like diesel</a> was retweeted many times, so I removed all duplicate tweets from the set. Unfortunately, this left less than 300 original tweets in the corpus.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Sentiment analysis with Tidytext
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>Text analysis can be a powerful tool to help to analyse large amounts of text. The R language has an extensive collection of packages to help you undertake such a task. The <a href="https://www.tidytextmining.com/">Tidytext</a> package extends the <a href="http://vita.had.co.nz/papers/tidy-data.html">Tidy Data</a> logic promoted by Hadley Wickham and his Tidyverse software collection.</p>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
Data Cleaning
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>The first step in cleaning the data is to create unigrams, which involve splitting the tweets into individual words that can be analysed. The first step is determining which words are most commonly used in the tap water tweets and visualising the result. The most common phrases are related to drinking and bottled water, which makes sense—also, the recent issues in Kentucky feature in this list.</p>
<figure>
<img src="https://lucidmanager.org/images/hydroinformatics/tapwater-common-words.png" alt="Most common words in tweets about tap water" title="Most common words in tweets about tap water"/>
<figcaption>
Most common words in tweets about tap water.
</figcaption>
</figure>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Tokenise and clean the tweets</span>
</span></span><span style="display:flex;"><span>  tidy_tweets <span style="color:#333">&lt;-</span> tapwater_tweets <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">unnest_tokens</span>(word, text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#06b;font-weight:bold">data</span>(stop_words)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tidy_tweets <span style="color:#333">&lt;-</span> tidy_tweets <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">anti_join</span>(stop_words) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">filter</span>(<span style="color:#333">!</span>word <span style="color:#333">%in%</span> <span style="color:#06b;font-weight:bold">c</span>(<span style="background-color:#fff0f0">&#34;tap&#34;</span>, <span style="background-color:#fff0f0">&#34;water&#34;</span>, <span style="background-color:#fff0f0">&#34;rt&#34;</span>, <span style="background-color:#fff0f0">&#34;https&#34;</span>, <span style="background-color:#fff0f0">&#34;t.co&#34;</span>, <span style="background-color:#fff0f0">&#34;gt&#34;</span>, <span style="background-color:#fff0f0">&#34;amp&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#06b;font-weight:bold">as.character</span>(<span style="color:#60e;font-weight:bold">0</span><span style="color:#333">:</span><span style="color:#60e;font-weight:bold">9</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#888">## Most common words</span>
</span></span><span style="display:flex;"><span>  tidy_tweets <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">count</span>(word, sort <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">TRUE</span>) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">top_n</span>(<span style="color:#60e;font-weight:bold">10</span>) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">mutate</span>(word <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">reorder</span>(word, n)) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">ggplot</span>(<span style="color:#06b;font-weight:bold">aes</span>(word, n)) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">geom_col</span>(fill <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;dodgerblue4&#34;</span>) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">xlab</span>(<span style="color:#080;font-weight:bold">NULL</span>) <span style="color:#333">+</span> <span style="color:#06b;font-weight:bold">coord_flip</span>() <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">theme_bw</span>(base_size <span style="color:#333">=</span> <span style="color:#60e;font-weight:bold">20</span>) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">ggtitle</span>(<span style="background-color:#fff0f0">&#34;Most common words in tap water tweets&#34;</span>)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
Sentiment Analysis
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>The Tidytext package contains three lexicons of thousands of single English words (unigrams) that were manually assessed for their sentiment. The principle of sentiment analysis is to compare the words in the text with the words in the lexicon and analyse the results. For example, the statement: &#34;This tap water tastes horrible&#34; has a sentiment score of -3 in the AFFIN system by <a href="http://www2.imm.dtu.dk/pubdb/views/publication_details.php?id=6010">Finn Årup Nielsen</a> due to the word &#34;horrible&#34;. In this analysis, I have used the &#34;Bing&#34; method published by <a href="https://www.cs.uic.edu/~liub/FBS/sentiment-analysis.html">Liu et al. in 2005</a>. This method assigns a word to either positive, negative or neutral sentiment.</p>
<p>
This method is not foolproof, as words with the same spelling can mean different things. For example, &#34;This tap water contains too much lead&#34; will be assessed as a positive sentiment because the verb lead is seen as positive. The noun lead has no sentiment, as it depends on context.</p>
<p>
The other problem with sentiment analysis is that we only see negative commentary. Very few people contact a water utility about an excellent morning shower or a wonderful glass of water. Tap water resides in the background of everyday life, and people don&#39;t have any opinion about it unless it is unavailable or does not meet their aesthetic expectations.</p>
<p>
This tap water sentiment analysis shows that two-thirds of the words that express a sentiment were negative. The most common negative comments were &#34;smells&#34; and &#34;scared&#34;. This analysis is not a positive result for water utilities. Unfortunately, most tweets were not spatially located, so that I couldn&#39;t determine the origin of the sentiment.</p>
<figure>
<img src="https://lucidmanager.org/images/hydroinformatics/tapwater-sentiment.png" alt="Tap water sentiment analysis" title="Tap water sentiment analysis"/>
<figcaption>
Tap water sentiment analysis.
</figcaption>
</figure>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#888">## Sentiment analysis</span>
</span></span><span style="display:flex;"><span>  sentiment_bing <span style="color:#333">&lt;-</span> tidy_tweets <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">inner_join</span>(<span style="color:#06b;font-weight:bold">get_sentiments</span>(<span style="background-color:#fff0f0">&#34;bing&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  sentiment_bing <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">summarise</span>(Negative <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">sum</span>(sentiment <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;negative&#34;</span>), 
</span></span><span style="display:flex;"><span>              positive <span style="color:#333">=</span> <span style="color:#06b;font-weight:bold">sum</span>(sentiment <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;positive&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  sentiment_bing <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">group_by</span>(sentiment) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">count</span>(word, sort <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">TRUE</span>) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">top_n</span>(<span style="color:#60e;font-weight:bold">10</span>) <span style="color:#333">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">ggplot</span>(<span style="color:#06b;font-weight:bold">aes</span>(word, n, fill <span style="color:#333">=</span> sentiment)) <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">geom_col</span>(show.legend <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">FALSE</span>) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">coord_flip</span>() <span style="color:#333">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">facet_wrap</span>(<span style="color:#333">~</span>sentiment, scales <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;free_y&#34;</span>) <span style="color:#333">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06b;font-weight:bold">labs</span>(title <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;Contribution to sentiment&#34;</span>, x <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NULL</span>, y <span style="color:#333">=</span> <span style="color:#080;font-weight:bold">NULL</span>)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-7" class="outline-2">
<h2 id="headline-7">
Using Tap Water Sentiment Analysis
</h2>
<div id="outline-text-headline-7" class="outline-text-2">
<p>Sentiment analysis is an exciting exploration technique but not an absolute truth. This method cannot detect sarcasm or irony, and words don&#39;t always have the same meaning as described in the dictionary. For example, the algorithm interprets the word &#34;lead&#34; as positive sentiment in its function as a verb. In water, however, the chemical lead is never a positive sentiment. Interpreting tweets as bags of words is exciting but can lead to misunderstanding of the context.</p>
<p>
The critical message for water utilities is that they need to start taking the aesthetic properties of tap water as seriously as the health parameters. A lack of trust will drive consumers to bottled water or less healthy alternatives such as soft drinks are alternative water sources.</p>
<p>

  <div class="box">
    <div class="media">
      <figure class="media-left">
        <p class="image is-128x128">
          <img src="https://lucidmanager.org/images/books/2023_ds4wu.jpg" alt = "Data Science for Water Utilities" title = "Data Science for Water Utilities">
        </p>
      </figure>
      <div class="media-content">
        <div class="content">
          <p class="is-size-5 has-text-weight-bold">Data Science for Water Utilities</p>
          <p class="mb-2">Data Science for Water Utilities published by CRC Press is an applied, practical guide that shows water professionals how to use data science to solve urban water management problems using the R language for statistical computing.</p>
          <div class="buttons">
            <a class="button is-info" href="https://routledge.com/9781032354545" target="_blank">
              <span class="icon">
                <i class="fas fa-shopping-cart"></i>
              </span>
              <span>Routledge</span>
            </a>
            <a class="button is-info" href="https://www.amazon.com/Data-Science-Water-Utilities-Chapman/dp/1032354550" target="_blank">
              <span class="icon">
                <i class="fas fa-shopping-cart"></i>
              </span>
              <span>Amazon</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</p>
<p>
<a href = "https://www.r-bloggers.com/" target="_blank" title="Proudly associated with R-Bloggers">
  <button class="button is-link is-medium">
    <span class="icon is-large">
      <i class="fab fa-r-project"></i>
    </span>
    <span>As seen on R Bloggers</span>
  </button>
</a>
</p>
</div>
</div>

      