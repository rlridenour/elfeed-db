<p>A footnote in <a href="https://leancrew.com/all-this/2025/10/eraserhead/">last night’s post</a> mentioned that the Amazon links therein had been cleaned of cruft. Today, I’ll show the simple automated way I do that.</p>
<p>When I say “cruft,” I mean the unnecessary additions to the URL that are presumably used by Amazon to benefit Amazon rather than you. For example, I just went to Amazon, searched for “homepod,” and clicked the link for a refurbished HomePod mini. This is the URL:</p>
<pre><code>https://www.amazon.com/Apple-HomePod-mini-Black-Renewed/dp/
B0FK8JL74Q/ref=mpsa12?dib=eyJ2IjoiMSJ9.
okyLqpx2YKuwgWlCBKI2sx5DMA0QRhm1CnQPmA4KRzU8prbSTnXdAbE97fG0
tEwplRuboB2VvY5O6X6RZlvBK-MDyqaDNPwuqLUtqglS2gVwxITbCrE-
A5JKngZ9MmPHgucGCJSduRY0Ap3RUqVJy42OrYI9eh-
GcIQn52Fj7NgpN2pv3jyeZBvnCXsUcbFhTREmb2NV66tKI0ccT4OUg.4yYkD
-bBpGy0yyNVWMQnH8ZirFh3NhnFov0B0BZDIQ&amp;dib_tag=se&amp;keywords=
homepod&amp;qid=1760794983&amp;sr=8-2
</code></pre>
<p>I’ve added line breaks to make it easier (sort of) to read. I got this using Vivaldi, a browser I downloaded to my phone a while ago but haven’t used to visit Amazon before. It was definitely not signed into my Amazon account. Even so, I wouldn’t be surprised to learn that some part of this monstrous string is tied to me and my current session at Amazon.</p>
<p>Regardless, virtually none of this URL is needed. The key features are the <code>dp</code> at the end of the first line and the alphanumeric string that starts the second line. That string is the product’s <a href="https://sell.amazon.com/blog/what-is-an-asin">ASIN</a>. This simplified URL,</p>
<pre><code>https://www.amazon.com/dp/B0FK8JL74Q
</code></pre>
<p>is enough to get to the product page. To go from the long URL to the shorter one, I use <a href="https://leancrew.com/all-this/downloads/Clean%20Amazon%20Link.kmmacros">this Keyboard Maestro macro</a>:</p>
<p><img alt="KM Clean Amazon Link" class="ss" src="https://leancrew.com/all-this/images2025/20251018-KM%20Clean%20Amazon%20Link.png" title="KM Clean Amazon Link" width="80%"/></p>
<p>There’s not much to it. It grabs the URL of the current Safari page<sup id="fnref:safari"><a href="#fn:safari" rel="footnote">1</a></sup> and puts it on the clipboard. It then does a search-and-replace on the clipboard using this regular expression for searching:</p>
<pre><code>^.*/(?:dp|gp/product)/([^/?]+).*$
</code></pre>
<p>Over the years, I’ve noticed that some URLs have the ASIN after <code>gp/product</code> instead of <code>dp</code>, which is why you see the alternative there in the first set of parentheses. The <code>?:</code> that follows the opening parenthesis means that this is a <a href="https://www.regular-expressions.info/brackets.html#noncapture">non-capturing group</a>. What <em>is</em> captured is the ASIN that follows, which is why you see <code>$1</code> at the end of the replacement regex:</p>
<pre><code>https://www.amazon.com/dp/$1
</code></pre>
<p>The last part of the macro is a simple bit of error handling. I’ve noticed that I sometimes run this macro when I’m not on an Amazon page, which would put a URL I don’t want on the clipboard. So this checks the clipboard for the proper form. If it’s right, the Glass sound plays; if it’s wrong, the Basso sound plays and the clipboard goes back to what it was before.</p>
<p>If you <a href="https://leancrew.com/all-this/downloads/Clean%20Amazon%20Link.kmmacros">download the macro</a> (right click the link so you can save it with a <code>.kmmacros</code> extension) and import it into Keyboard Maestro, it will appear in the Global Macro Group and will be activated. I have it in the Global group because I sometimes use it in Messages or Mail to keep the URL I’m sending short. It’s not just for writing posts.</p>
<p>I should mention that I wrote about <a href="https://leancrew.com/all-this/2015/06/clean-amazon-links-with-textexpander/">a very similar TextExpander abbreviation</a> a decade ago. In that post, I had TextExpander run JavaScript for Automation to get and simplify the URL. I was also somewhat dismissive of using Keyboard Maestro—which I didn’t own back then—for a task like this. Times have certainly changed.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:safari">
<p>Yes, the long URL is from Vivaldi, not Safari, but I had the same product page open in Safari. The short URL is the same for both because the <code>dp/B0FK8JL74Q</code> part of the long URL is the same for both. <a href="#fnref:safari" rev="footnote">↩</a></p>
</li>
</ol>
</div>
