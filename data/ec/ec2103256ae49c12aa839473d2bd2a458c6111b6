<p><strong>Summary: </strong>
Walking through building Emacs on Linux and then adding OS specific conditionals to improve my general experience.
</p>
        <p>With my 
<cite><a href="https://takeonrules.com/2025/05/05/migrating-to-linux-on-guiding-principles-and-keyboard-bindings/">Migrating to Linux: On Guiding Principles and Keyboard Bindings</a></cite> complete, I moved on to getting tool of my computering: Emacs.</p>
<p>I think my <span><a href="https://en.wikipedia.org/wiki/Emacs">Emacs</a></span> <small><a class="ref" rel="tag opener" aria-label="Other site-wide references of ‚ÄúEmacs‚Äù" title="Other site-wide references of ‚ÄúEmacs‚Äù" href="https://takeonrules.com/site-map/glossary/#abbr-dfn-EMACS">&#128214;</a></small>
 configuration requires at least version 29.1; however I‚Äôm
uncertain.  The package manager had <span>Emacs</span>
 27 available, so I opted to build from
source.</p>
<p>I could either download a released version‚Äôs source code or clone the
repository.  I chose the clone route; as this would be useful as upgrades come
out.</p>
<p>Preliminaries:</p>
<pre><code class="language-shell">sudo apt update &amp;&amp; sudo apt install git --assume-yes
</code></pre>
<p>With <code>git</code> installed I need a copy of the <span>Emacs</span>
 repository, and should build from
a stable ref; as of <span class="timestamp-wrapper"><span class="timestamp">&lt;2025-04-23 Wed&gt; </span></span> that is <code>emacs-30.1</code>.<small class="side-container">
  <span class="side-label"><span class="hidden">(</span>Sidenote<span class="hidden">:</span></span>
  <span class="side" role="note"> I had a copy of the <span>Emacs</span>
git repository on another machine.  So I used the
sneaker net (e.g. a thumbdrive) to copy that over to the <span><a href="https://linux.org/">Linux</a></span> <small><a class="ref" rel="tag opener" aria-label="Other site-wide references of ‚ÄúLinux‚Äù" title="Other site-wide references of ‚ÄúLinux‚Äù" href="https://takeonrules.com/site-map/glossary/#abbr-dfn-LINUX">üìñ</a></small>
machine and then
run <code>git pull</code> so I could get up to date source code.<span class="hidden">)</span></span>
</small>
</p>
<p>I used <a href="https://gist.github.com/zoliky/0445b20676bfa85450d7df006066ceb7">Installing Emacs 29.1 from source on Debian 12 ¬∑ GitHub</a> as my framing.</p>
<p>First, building the dependencies:</p>
<pre><code class="language-shell">sudo apt build-dep emacs
sudo apt install libtree-sitter-dev libgcc-12-dev libgccjit-12-dev
</code></pre>
<p>Then making a home for my new install:</p>
<pre><code class="language-shell">mkdir -p ~/.local/emacs
</code></pre>
<p>In my source directory for Emacs (e.g., <code>~/git/emacs/</code>), I ran the following:</p>
<pre><code class="language-text">./configure \
--prefix=&quot;$HOME/.local/emacs/&quot; \
--without-compress-install \
--with-native-compilation=aot \
--with-x \
--with-x-toolkit=lucid \
--with-gif \
--with-png \
--with-jpeg \
--with-tiff \
--with-imagemagick \
--with-mailutils \
--with-tree-sitter \
CC=gcc-12
</code></pre>
<p>It took a few tries, which is why I have the <code>CC=gcc-12</code> declaration as well as
instructions for installing <code>libgcc-12-dev</code> and <code>libgccjit-12-dev</code>.</p>
<p>Now came time to spin up the fans.  I ran <code>make -j 16</code>; where 16 is the number of
cores on my machine.  And finally <code>make install</code>.</p>
<p>Along the way, I realized that there were terminal commands that I was missing.
But I could hobble along.</p>
<p>Up until I had <span>Emacs</span>
 built, I was using <code>nano</code> to write my notes.  It is quite
serviceable.</p>
<p><em>Note</em>, I could have installed Emacs 30.1 via the Pop Shop, however I chose to
build from source.</p>
<h2 id="toggling-gnome-settings">Toggling Gnome Settings</h2>
<p>There are a few settings that I have found useful to toggle:</p>
<ul>
<li><a href="#trackpad-and-night-light">Trackpad and Night Light</a></li>
<li><a href="#light-dark-theme">Light/Dark Theme</a></li>
<li><a href="#radios">Radios</a></li>
</ul>
<h3 id="trackpad-and-night-light">Trackpad and Night Light</h3>
<p>With my new laptop and how I hold my hands, I‚Äôve noticed that sometimes I
activate my trackpad.  Which is annoying, especially when I‚Äôm in a ‚Äúwriting
mindset.‚Äù</p>
<p>I don‚Äôt like the bright blues of a normal screen.  Instead I prefer to use a
display setting that softens the colors.  In <span><a href="https://en.wikipedia.org/wiki/MacOS">Macintosh Operating System</a></span> (<abbr title="Macintosh Operating System">MacOS</abbr> <small><a class="ref" rel="tag opener" aria-label="Other site-wide references of ‚ÄúMacintosh Operating System‚Äù" title="Other site-wide references of ‚ÄúMacintosh Operating System‚Äù" href="https://takeonrules.com/site-map/glossary/#abbr-dfn-OSX">&#128214;</a></small>)
 this is ‚ÄúNight Shift.‚Äù</p>
<p>I choose a much warmer color, knowing that reds are softer on the retina.<small class="side-container">
  <span class="side-label"><span class="hidden">(</span>Sidenote<span class="hidden">:</span></span>
  <span class="side" role="note"> My mom has a retinal disease and her research and recommendations from
experts leads her to incorporate more red filters in her day to day.<span class="hidden">)</span></span>
</small>
</p>
<p>Both of these settings are similar in how they are toggled.  So I wrote some
<a href="#emacs-commands-for-setting-toggling">Emacs Commands for Setting Toggling</a>.</p>
<h4 id="emacs-commands-for-setting-toggling">Emacs Commands for Setting Toggling</h4>
<p>With the toggles identified, I set about writing the functions and macros to
help with future needs.</p>
<p>To create <a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L358-L362">my Trackpad toggling command</a> I call my <a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L336-L356">jf/linux:gsettings-toggler
Emacs macro</a>.  Below is the code:</p>
<pre><code class="language-emacs-lisp">(jf/linux:gsettings-toggler &quot;Trackpad&quot;
  :property &quot;org.gnome.desktop.peripherals.touchpad send-events&quot;
  :match &quot;'enabled'&quot;
  :on_match &quot;disabled&quot;
  :on_miss &quot;enabled&quot;)

</code></pre>
<p>The first parameter is the named concept (e.g., ‚ÄúTrackpad‚Äù).  The <code>:property</code> is
the <code>gsettings</code> key that I‚Äôm looking to change
(e.g. ‚Äúorg.gnome.desktop.peripherals.touchpad send-events‚Äù).  The <code>:match</code> value
is what I check as the property‚Äôs current state.  When the current value is a
match, I set the property to the <code>:on_match</code> value.</p>
<p>And below is <a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L364-L368">how I generate my Night Light toggling command</a>:</p>
<pre><code class="language-emacs-lisp">(jf/linux:gsettings-toggler &quot;Night Light&quot;
    :property &quot;org.gnome.settings-daemon.plugins.color night-light-enabled&quot;
    :match &quot;true&quot;
    :on_match &quot;false&quot;
    :on_miss &quot;true&quot;)
</code></pre>
<p>As of <span class="timestamp-wrapper"><span class="timestamp">&lt;2025-05-03 Sat&gt; </span></span> the generating macro is as follows:</p>
<pre><code class="language-emacs-lisp">(cl-defmacro jf/linux:gsettings-toggler (name &amp;key property match on_match on_miss)
    &quot;Toggle the NAME setting via the PROPERTY.

When the PROPERTY is a MATCH set the property to ON_MATCH; otherwise set
it to the ON_MISS value.&quot;
    (let ((docstring
            (concat &quot;Toggle &quot; name &quot; for Gnome desktop.&quot;))
           (func-name
             (intern (concat &quot;jf/linux:toggle-&quot; name))))
      `(defun ,func-name ()
         ,docstring
         (interactive)
         (let ((value
                 (if (string= ,match
                       (s-trim
                         (shell-command-to-string
                           (concat &quot;gsettings get &quot; ,property))))
                   ,on_match ,on_miss)))
           (shell-command
             (concat &quot;gsettings set &quot; ,property &quot; &quot; value))
           (message &quot;%s: %s&quot; ,name value)))))
</code></pre>
<h3 id="light-dark-theme">Light/Dark Theme</h3>
<p>Related but different from the Night Light concept is the Light and Dark
theming.  In Emacs I had a script to toggle the theme of both the OS and <span>Emacs</span>

(e.g. my <code>jf/dark</code> function).  I wanted something similar in <span>Linux</span>
.</p>
<p>Yet, as I explored the changes, I realized that there would be a divergence in
implementation based on <abbr title="Macintosh Operating System">MacOS</abbr>
 or <span>Linux</span>
.</p>
<p>Toggling the light and dark theme is a bit different; as this requires
coordination.  <a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L2943-L2958">My jf/color-scheme-system-toggle command</a> handles both the <abbr title="Macintosh Operating System">MacOS</abbr>

and my <span>Linux</span>
 install.</p>
<pre><code class="language-emacs-lisp">(defun jf/color-scheme-system-toggle ()
    &quot;Toggle system-wide Dark or Light setting.&quot;
    (interactive)
    (pcase system-type
      ('darwin
        (progn
          (shell-command
            (concat &quot;osascript -e 'tell application \&quot;System Events\&quot; &quot;
              &quot;to tell appearance preferences &quot;
              &quot;to set dark mode to not dark mode'&quot;))
          (jf/color-scheme-set-for-emacs)))
      (_
        (let ((lightp
                (eq :dark (jf/current-color-scheme-gnome))))
          (dolist (fn jf/color-scheme-system-toggle-functions)
            (funcall fn lightp))))))
</code></pre>
<p>The <span>Linux</span>
 toggling portion determines if the scheme is <code>:dark</code>, and uses that
boolean value to pass to each of the toggling functions.</p>
<p><a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L2901-L2910">My jf/color-scheme-system-toggle-functions variable</a> (which I realized is
misnamed) defines a list of functions that I‚Äôll call, passing <code>true</code> when I want
to set them to the ‚Äúlight‚Äù theme.  Below is that variable‚Äôs definition:</p>
<pre><code class="language-emacs-lisp">(defvar jf/color-scheme-system-toggle-functions
    '(jf/color-scheme:gnome-color-scheme
       jf/color-scheme:gnome-gtk-theme
       jf/color-scheme:copyq-theme
       jf/color-scheme:emacs-theme)
    &quot;A list of arity one functions that set component schemes based on the
input parameter.

When the parameter is non-nil, favor the dark option.  Otherwise favor
the light option.&quot;)
</code></pre>
<p>The four functions that toggle my system scheme are similar but just different
enough:</p>
<ul>
<li><a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L2912-L2917">jf/color-scheme:gnome-color-scheme</a></li>
<li><a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L2919-L2926">jf/color-scheme:gnome-gtk-theme</a></li>
<li><a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L2928-L2935">jf/color-scheme:copyq-theme</a></li>
<li><a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L2937-L2941">jf/color-scheme:emacs-theme</a></li>
</ul>
<p>Below is the definition of those four functions:</p>
<pre><code class="language-emacs-lisp">(defun jf/color-scheme:gnome-color-scheme (lightp)
  &quot;Set the gnome color scheme based on LIGHTP (e.g. light/dark).&quot;
  (shell-command
   (format
    &quot;gsettings set org.gnome.desktop.interface color-scheme prefer-%s&quot;
    (if lightp &quot;light&quot; &quot;dark&quot;))))

(defun  jf/color-scheme:gnome-gtk-theme (lightp)
  &quot;Set the gnome gtk theme based on LIGHTP (e.g. light/dark).&quot;
  (let ((theme
         (if lightp &quot;Adwaita&quot; &quot;Adwaita-dark&quot;)))
    (shell-command
     (format
      &quot;gsettings set org.gnome.desktop.interface gtk-theme %s&quot;
      theme))))

(defun jf/color-scheme:copyq-theme (lightp)
  &quot;Set the copyq theme based on LIGHTP (e.g. light/dark).&quot;
  (shell-command
   (format
    &quot;copyq loadTheme %s/solarized-%s.ini&quot;
    (s-trim
     (shell-command-to-string &quot;copyq info themes&quot;))
    (if lightp &quot;light&quot; &quot;dark&quot;))))

(defun jf/color-scheme:emacs-theme (lightp)
  &quot;Set the emacs theme based on LIGHTP (e.g. light/dark).&quot;
  (ef-themes-select
   (plist-get jf/themes-plist
              (if lightp :light :dark))))
</code></pre>
<p>An astute reader might notice some duplication of my
<code>jf/color-scheme:gnome-color-scheme</code> and <code>jf/color-scheme:gnome-gtk-theme</code> and the
toggling macro.  There‚Äôs a potential refactoring there, but I‚Äôm going to leave
it on the idea shelf.</p>
<h3 id="radios">Radios</h3>
<p>By default, I like to keep my Bluetooth off.  I wanted a way to turn this off
and on via <span>Emacs</span>
.  And also turn off and on my WiFi.</p>
<p>Below are <a href="https://github.com/jeremyf/dotemacs/blob/f69f6c5f8058abc133cbd9d6970d96329e5128af/emacs.d/init.el#L370-L391">my functions to go radio silent and start broadcasting</a>:</p>
<pre><code class="language-emacs-lisp">(defun jf/linux:radio-silence ()
    &quot;Soft block laptop radios (e.g. bluetooth and wlan).

Related to `jf/linux:radio-broadcast'.&quot;
    (interactive)
    (shell-command &quot;rfkill block all&quot;))

  (defun jf/linux:radio-broadcast (&amp;optional all identifiers)
    &quot;Soft unblock laptop radios (e.g. bluetooth and wlan)

When ALL is non-nil unblock all radios.  Other unblock only the wlan.

Related to `jf/linux:radio-silence'.&quot;
    (interactive &quot;P&quot;)
    (let ((identifiers
            (mapconcat
              (lambda (el) el)
              (or identifiers '(&quot;wlan&quot;))
              &quot; &quot;)))
      (shell-command
        (concat &quot;rfkill unblock &quot;
          (if all &quot;all&quot; identifiers)))))

</code></pre>
<p>I don‚Äôt have a physical switch, so I settle for the soft programmatic block.</p>
<h2 id="grabbing-links">Grabbing Links</h2>
<p>Part of my writing workflow is grabbing links from my browser (and <abbr title="Rich Site Summary">RSS</abbr> <small><a class="ref" rel="tag opener" aria-label="Other site-wide references of ‚ÄúRich Site Summary‚Äù" title="Other site-wide references of ‚ÄúRich Site Summary‚Äù" href="https://takeonrules.com/site-map/glossary/#abbr-dfn-RSS">&#128214;</a></small>
 feed).
On <abbr title="Macintosh Operating System">MacOS</abbr>
 I use <a href="https://github.com/xuchunyang/grab-mac-link.el">GitHub - xuchunyang/grab-mac-link.el: Grab link from Mac Apps and
insert it into Emacs</a>.  And I explored <a href="https://github.com/xuchunyang/grab-x-link">GitHub - xuchunyang/grab-x-link: Grab
links from some X11 apps and insert into Emacs</a>.</p>
<p>However, that wasn‚Äôt quite enough.  So I wrote up <a href="https://github.com/jeremyf/dotemacs/blob/943ba0640db5526d5946ec094ab7a4f2d32cfb9b/emacs.d/grab-x-link.el">some changes for my own needs</a>;
namely to address having multiple applications based on Firefox.  Along the way
I learned about <code>xdotool</code> and <code>comm</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>With <span>Emacs</span>
 installed, I could really set about my documentation process.  My next article in this series will be about other applications I use: <span>Virtual Private Networks</span> (<abbr title="Virtual Private Networks">VPNs</abbr> <small><a class="ref" rel="tag opener" aria-label="Other site-wide references of ‚ÄúVirtual Private Networks‚Äù" title="Other site-wide references of ‚ÄúVirtual Private Networks‚Äù" href="https://takeonrules.com/site-map/glossary/#abbr-dfn-VIRTUAL-PRIVATE-NETWORK">&#128214;</a></small>)
, browsers, terminal, and connecting to Github.</p>

	<p><a class="reply-by-email" href="mailto:reply-to@takeonrules.com?subject=RE:Migrating%20to%20Linux%3a%20Getting%20Emacs%20Installed">Reply by Email</a></p>

      