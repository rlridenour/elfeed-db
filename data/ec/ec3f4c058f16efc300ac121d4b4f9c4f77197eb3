<p>While it's only been a few weeks since the <a href="https://xenodium.com/agent-shell-0-5-improvements">last agent-shell post</a>, there are plenty of new updates to share.</p>
<p>What's <a href="https://github.com/xenodium/agent-shell">agent-shell</a> again? A native Emacs shell to interact with any LLM agent powered by ACP (<a href="https://agentclientprotocol.com/">Agent Client Protocol</a>).</p>
<h2>Thank you sponsors</h2>
<p>Before getting to the latest and greatest, I'd like to say thank you to <a href="https://github.com/sponsors/xenodium#sponsors">new and existing sponsors</a> backing my projects.</p>
<p>While the work going in remains largely unsustainable, your contributions are indeed helping me get closer to sustainability. Thank you!</p>
<p>If you benefit from my content and projects, please <a href="https://github.com/sponsors/xenodium">consider sponsoring</a> to make the work sustainable.</p>
<h2>More productive at work?</h2>
<p>Work paying for your LLM tokens and other tools? Why not <a href="https://github.com/sponsors/xenodium">get your employer to sponsor agent-shell</a> also?</p>
<h2>MELPA</h2>
<p>Now on to the very first update‚Ä¶ Both <a href="https://melpa.org/#/agent-shell">agent-shell</a> and <a href="https://melpa.org/#/acp">acp.el</a> are now available on MELPA. As such, <code>agent-shell</code> installation now boils down to:</p>
<pre><code class="language-{.commonlisp">(use-package agent-shell :ensure t)
</code></pre>
<h2>New providers</h2>
<p><a href="https://opencode.ai/">OpenCode</a> and <a href="https://github.com/QwenLM/qwen-code">Qwen Code</a> are two of the latest agents to join <a href="https://github.com/xenodium/agent-shell">agent-shell</a>. Both accessible via <code>M-x agent-shell</code> and <code>M-x agent-shell-new-shell</code> through the agent picker, but also directly from <code>M-x agent-shell-opencode-start-agent</code> and <code>M-x agent-shell-qwen-start</code>.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/qwen.png" alt=""></p>
<h2>Send files - Thanks to Ian Davidson</h2>
<p>Adding files as context has seen quite a few improvements in different shapes. Thank you Ian Davidson for contributing embedded context support.</p>
<h3>Send screenshots</h3>
<p>Invoke <code>M-x agent-shell-send-screenshot</code> to take a screenshot and automatically send it over to <code>agent-shell</code>.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/whos-this.webp" alt=""></p>
<h3>Activity Indicator</h3>
<p>A little side-note, did you notice the activity indicator in the header bar? Yep. That's new too.</p>
<h3>@ completion (experimental)</h3>
<p>While <code>@</code> file completion remains experimental, you can enable via:</p>
<pre><code class="language-{.commonlisp">(setq agent-shell-file-completion-enabled t)
</code></pre>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/at-completion.gif" alt=""></p>
<h3>Send files or regions</h3>
<p>From any file you can now invoke <code>M-x agent-shell-send-file</code> to send the current file to <code>agent-shell</code>. If region is selected, region information is sent also. Fancy sending a different file other than current one? Invoke <code>M-x agent-shell-send-file</code> with <code>C-u prefix</code>, or just use <code>M-x agent-shell-send-other-file</code>.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/send-region.gif" alt=""></p>
<h3>Send <code>dired</code> files</h3>
<p><code>M-x agent-shell-send-file</code>, also operates on <code>dired</code> files (selection or region), <a href="https://xenodium.com/emacs-dwim-do-what-i-mean">DWIM style</a> ;-)</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/send-dired.gif" alt=""></p>
<h2>Shorter paths in titles</h2>
<p>You may have noticed paths in section titles are no longer displayed as absolute paths. We're shortening those relative to project roots.</p>
<h2>Shell creation / handling</h2>
<p>While you can invoke <code>M-x agent-shell</code> with <code>C-u</code> prefix to create new shells, <code>M-x agent-shell-new-shell</code> is now available (and more discoverable than <code>C-u</code>).</p>
<h2>Cancelling sessions</h2>
<p>Cancelling prompt sessions (via <code>C-c C-c</code>) is much more reliable now. If you experienced a shell getting stuck after cancelling a session, that's because we were missing part of the protocol implementation. This is now implemented.</p>
<h2>Shell commands</h2>
<p>Use the new <code>M-x agent-shell-insert-shell-command-output</code> to automatically insert shell (ie. bash) command output.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/ping.gif" alt=""></p>
<h2>Markdown transcripts (experimental) - Thanks to Elle Najt</h2>
<p>Initial work for automatically saving markdown transcripts is now in place. We're still iterating on it, but if keen to try things out, you can enable as follows:</p>
<pre><code class="language-{.commonlisp">(setq agent-shell--transcript-file-path-function #'agent-shell--default-transcript-file-path)
</code></pre>
<h2>Configuration</h2>
<h3>Turn off ASCII welcome banners</h3>
<pre><code class="language-{.commonlisp">(setq agent-shell-show-welcome-message nil)
</code></pre>
<h3>Turn off graphical header</h3>
<p>Text header</p>
<pre><code class="language-{.commonlisp">(setq agent-shell-header-style 'text)
</code></pre>
<p>No header</p>
<pre><code class="language-{.commonlisp">(setq agent-shell-header-style nil)
</code></pre>
<h2>Inline display of historical changes - Thanks to Elle Najt</h2>
<p>Applied changes are now displayed inline.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/inline-historical-diffs.png" alt=""></p>
<h2>Session mode - Thanks to Elle Najt</h2>
<p>The new <code>M-x agent-shell-cycle-session-mode</code> and <code>M-x agent-shell-set-session-mode</code> can now be used to change the session mode.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/cycle.webp" alt=""></p>
<h2>Agent capabilities</h2>
<p>You can now find out what capabilities and session modes are supported by your agent. Expand either of the two sections.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/capabilities.png" alt=""></p>
<h2>Accepting/rejecting changes from diff buffer</h2>
<p>Tired of pressing <code>q</code> and <code>y</code> to accept changes from the diff buffer? Now just press <code>y</code> from the diff viewer to accept all hunks.</p>
<p>Same goes for rejecting. No more <code>q</code> and <code>n</code>. Now just press <code>C-c C-c</code> from the diff buffer.</p>
<h2>Transient menu</h2>
<p>We get a new basic transient menu. Currently available via <code>M-x agent-shell-help-menu</code>.</p>
<p><img src="https://xenodium.github.io/images/agent-shell-017-improvements-melpa/transient.png" alt=""></p>
<h2>Contributions</h2>
<p>We got lots of awesome pull requests from wonderful folks. Thank you for your contributions!</p>
<ul>
<li><strong>Arthur Heymans</strong>: Add a Package-Requires header (<a href="https://github.com/xenodium/agent-shell/pull/78">PR</a>).</li>
<li><strong>Elle Najt</strong>: Execute commands in devcontainer (<a href="https://github.com/xenodium/agent-shell/pull/91">PR</a>).</li>
<li><strong>Elle Najt</strong>: Fix Write tool diff preview for new files (<a href="https://github.com/xenodium/agent-shell/pull/109">PR</a>).</li>
<li><strong>Elle Najt</strong>: Inline display of historical changes (<a href="https://github.com/xenodium/agent-shell/pull/92">PR</a>).</li>
<li><strong>Elle Najt</strong>: Live Markdown transcripts (<a href="https://github.com/xenodium/agent-shell/pull/97">PR</a>).</li>
<li><strong>Elle Najt</strong>: Prompt session mode cycling and modeline display (<a href="https://github.com/xenodium/agent-shell/pull/79">PR</a>).</li>
<li><strong>Fritz Grabo</strong>: Devcontainer fallback workspace (<a href="https://github.com/xenodium/agent-shell/pull/95">PR</a>).</li>
<li><strong>Guilherme Pires</strong>: Codex subscription auth (<a href="https://github.com/xenodium/agent-shell/pull/64">PR</a>).</li>
<li><strong>Hordur Freyr Yngvason</strong>: Make qwen authentication optional (<a href="https://github.com/xenodium/agent-shell/pull/87">PR</a>).</li>
<li><strong>Ian Davidson</strong>: Embedded context support (<a href="https://github.com/xenodium/agent-shell/pull/73">PR</a>).</li>
<li><strong>Julian Hirn</strong>: Fix quick-diff window restoration for full-screen (<a href="https://github.com/xenodium/agent-shell/pull/89">PR</a>).</li>
<li><strong>Ruslan Kamashev</strong>: Hide header line altogether (<a href="https://github.com/xenodium/agent-shell/pull/101">PR</a>).</li>
<li><strong><a href="https://github.com/festive-onion">festive-onion</a></strong>: Show Planning mode more reliably (<a href="https://github.com/xenodium/agent-shell/issues/102">PR</a>).</li>
</ul>
<h2>Lots of other work ‚ù§Ô∏èüòÖ</h2>
<p>Beyond what's been showcased here, much love and effort's been poured into polishing the <code>agent-shell</code> experience. Interested in the nitty-gritty? Have a look through the <a href="https://github.com/xenodium/agent-shell/commits/main/">173 commits</a> since the last blog post.</p>
<h2>Support this work</h2>
<p>If <a href="https://github.com/xenodium/agent-shell">agent-shell</a> or <a href="https://github.com/xenodium/acp.el">acp.el</a> are useful to you, please consider <a href="https://github.com/sponsors/xenodium">sponsoring</a> its development. LLM tokens aren't free, and neither is the time dedicated to building this stuff ;-)</p>
