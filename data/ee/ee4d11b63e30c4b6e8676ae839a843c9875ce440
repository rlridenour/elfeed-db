<p>In <a href="https://davemq.github.io/2025/07/15/gnus-split-subject.html">Splitting the subject in Gnus summary subject lines</a> I showed some
code to split the summary line in Gnus. Today saw an error when trying
to enter a Gnus group, and diagnosed it to a subject that ended in
“]”. The <code class="language-plaintext highlighter-rouge">gnus-user-format-function-s</code> code adds 2 to
that for use as the beginning of second part of the subject, but
that’s beyond the end of the string! Here’s an updated version that
will use the length of the string if its less than <code class="language-plaintext highlighter-rouge">(+ cb 2)</code>:</p>

<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gnus-user-format-function-s</span> <span class="p">(</span><span class="nv">headers</span><span class="p">)</span>
  <span class="s">"Return subject - tag"</span>
  <span class="p">(</span><span class="k">let*</span>
	<span class="p">((</span><span class="nv">subject</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">headers</span> <span class="mi">1</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">cb</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">"]"</span> <span class="nv">subject</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">cb</span>
	  <span class="p">(</span><span class="nv">substring</span> <span class="nv">subject</span> <span class="p">(</span><span class="nb">min</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">cb</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">subject</span><span class="p">)))</span>
	<span class="nv">subject</span>
	<span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>

<p>Of course, this points to the fact that I’ve got no test for this
boundary conditions. No tests at all, other than using the code in
production!</p>