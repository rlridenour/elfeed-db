<figure>
<img src="https://whatacold.io/img/2022-05-23-emacs-duplicate-current-line.jpg" alt="Duplicate the current in Emacs" title="Click to enlarge the image"/>
<figcaption>
Duplicate the current in Emacs
</figcaption>
</figure>
<p>
Duplicating the current line is frequent editing for me when I am
coding. Initially, I copied a snippet as a command in Emacs from the
Internet:</p>
<div class="src src-elisp">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">w/duplicate-line</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Duplicate the current line.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">move-beginning-of-line</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">kill-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">yank</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">open-line</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">next-line</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">yank</span><span class="p">))</span></span></span></code></pre></div>
</div>
<p>
Most of the time, I was happy with it, but it has mainly two drawbacks:</p>
<ol>
<li>It cannot keep the column position when moving to the next line</li>
<li>It messes up with the yank ring as it yanks the text under the hood</li>
</ol>
<p>So today, I took some time to fix these two problems, and I also want
it to be capable of commenting the current line out if I prefix the
command.</p>