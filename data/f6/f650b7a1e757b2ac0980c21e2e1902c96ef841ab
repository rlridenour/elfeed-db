<p>
This blog post is a part of series of posts about my Emacs configuration. I
tried to describe all at once, but with <a href="https://hostux.social/@lfa/114726411888042452">the good advice</a> from
<a href="https://hostux.social/@lfa">@lfa@hostux.social</a> I decided to split my writings to the series of posts.
Instead it will be incredibly longðŸ˜€.
</p>

<p>
In this post I'll describe a <i>common part</i> of my Emacs configuration.
</p>

<p>
This blog post is a part of the <a href="https://christiantietze.de/posts/2025/06/emacs-carnival-2025-06-take-two/">Emacs Carnival 2025-06</a>.
</p>
<div class="outline-2">
<h2>TOC&#xa0;&#xa0;&#xa0;<span class="tag"></span></h2>
<div class="outline-text-2">
<ul class="org-ul">
<li><a href="#preamble">Preamble</a></li>
<li><a href="#emacs-conf-template">Emacs configuration template</a></li>
<li><a href="#emacs-start">How is it starting?</a>
<ul class="org-ul">
<li><a href="#emacs-daemon-free-bsd">Daemon startup script for FreeBSD</a></li>
<li><a href="#emacs-early-initialization">Emacs early initialization</a></li>
<li><a href="#emacs-initialization">Emacs initialization</a></li>
</ul></li>
<li><a href="#some-necessary-plugins">Some necessary plugins first</a></li>
<li><a href="#rc-emacs-el-keybindings">Keybindings</a></li>
<li><a href="#rc-emacs-cursor-minibuffer">Cursor in the minibuffer's prompt</a></li>
<li><a href="#rc-emacs-variables">Common configuration variables</a>
<ul class="org-ul">
<li><a href="#rc-emacs-interface-vars">Interface configuration</a></li>
<li><a href="#rc-emacs-utf8-variables">UTF8-related variables</a></li>
<li><a href="#rc-emacs-history-variables">History preservation variables</a></li>
<li><a href="#rc-emacs-windows-variables">Windows-related variable</a></li>
<li><a href="#rc-emacs-isearch-settings">ISearch settings</a></li>
<li><a href="#rc-emacs-buffer-variables">Buffer-related variables</a></li>
<li><a href="#rc-emacs-misc">Miscellaneous configuration variables</a></li>
<li><a href="#rc-emacs-freebsd">FreeBSD specific</a></li>
</ul></li>
<li><a href="#rc-emacs-enable-custom-commands">Enable hidden commands</a></li>
<li><a href="#rc-emacs-utf8">Enable UTF8 everywhere</a></li>
<li><a href="#rc-emacs-remove-gui-annoyances">Remove annoying GUI elements</a></li>
<li><a href="#rc-emacs-blinking-cursor">Blinking cursor</a></li>
<li><a href="#rc-emacs-newline-eof">Newline at the end of the file</a></li>
<li><a href="#rc-emacs-gui-font">GUI font</a></li>
<li><a href="#rc-emacs-hl-line">Enable line highlighting for some modes</a></li>
<li><a href="#rc-emacs-backup-files">Backup files</a></li>
<li><a href="#rc-emacs-autosave-files">Autosave files</a></li>
<li><a href="#rc-emacs-autorevert-buffer">Autorevert buffer</a></li>
<li><a href="#rc-emacs-save-restore">Save and restore session</a></li>
<li><a href="#rc-emacs-buffer-hacks">Some buffers-related hacks</a>
<ul class="org-ul">
<li><a href="#rc-emacs-ibuffer-hack">IBuffer</a></li>
<li><a href="#rc-emacs-immortal-buffers">Immortal buffers</a></li>
<li><a href="#rc-emacs-hidden-buffers">Hidden buffers</a></li>
<li><a href="#rc-emacs-side-window-bookmarks">Side window for bookmarks</a></li>
<li><a href="#rc-emacs-diff-4-unsaved">Show diff for unsaved changes</a></li>
</ul></li>
<li><a href="#misc">Miscellaneous</a>
<ul class="org-ul">
<li><a href="#text-mode-settings">Text mode settings</a></li>
<li><a href="#rc-emacs-abbrev-mode">Abbrev mode</a></li>
<li><a href="#rc-emacs-remove-trailing-whitespaces">Remove trailing whitespaces</a></li>
<li><a href="#better-tab-in-help">Better TAB in the help windows</a></li>
</ul></li>
<li><a href="#rc-emacs-custom-funcs">Few custom functions</a>
<ul class="org-ul">
<li><a href="#rc-emacs-lang-switch">Switch between keyboard layouts in Emacs way</a></li>
<li><a href="#rc-emacs-pinentry-hack">Hack for Pinentry</a></li>
<li><a href="#C-g-dwim">C-g Do What I Mean</a></li>
</ul></li>
<li><a href="#rc-emacs-custom-faces">Common custom faces</a></li>
<li><a href="#rc-emacs-recentf">Recentf configuration</a></li>
<li><a href="#rc-emacs-tramp">TRAMP configuration</a></li>
<li><a href="#rc-emacs-window-creation">Tweaking the C-x 2 and C-x 3</a></li>
<li><a href="#rc-emacs-nerd-icons">Nerd icons</a>
<ul class="org-ul">
<li><a href="#rc-emacs-nerd-icons-ibuffer">Nerd icons in the IBuffer</a></li>
</ul></li>
<li><a href="#rc-emacs-resize-windows">Resize windows with arrows</a></li>
<li><a href="#rc-emacs-delsel">Delete selected text</a></li>
<li><a href="#rc-emacs-calendar">Calendar</a></li>
<li><a href="#rc-emacs-wgrep">Editable grep buffer</a></li>
<li><a href="#rc-emacs-proced">Process editor</a></li>
<li><a href="#rc-emacs-savehist-mode">Saving history</a></li>
<li><a href="#rc-emacs-completion-icomplete">Completion (IComplete)</a>
<ul class="org-ul">
<li><a href="#rc-emacs-icomplete-nerd-icons">Nerd icons for the completion</a></li>
</ul></li>
<li><a href="#downloads">Downloads</a></li>
<li><a href="#update-2025-07-09">Update 2025-07-09</a></li>
<li><a href="#update-2025-08-10">Update 2025-08-10</a></li>
<li><a href="#update-2025-09-06">Update 2025-09-06</a></li>
<li><a href="#final-gpg-pinentry-fix">Update 2025-10-06 Final GPG Pinentry fix</a></li>
<li><a href="#notes">Notes</a></li>
</ul>
</div>
</div>
<div id="outline-container-preamble" class="outline-2">
<h2 id="preamble">Preamble</h2>
<div class="outline-text-2" id="text-preamble">
<p>
I'm started using Emacs since a long time agoâ€¦ According to my <code>git log</code>, the
<i>journey</i> started at least at <a href="https://codeberg.org/evgandr/dotfiles/commit/4b6f24923140b5314ffe843ac50307155b04e799">2011-11-23</a>, when I was installed CEDET<sup><a id="fnr.cedet" class="footref" href="#fn.cedet" role="doc-backlink">1</a></sup> and
commited these changes to the my <a href="https://codeberg.org/evgandr/dotfiles">dotfiles</a>. After that I made a big pause and
used a Vim for a whileâ€¦
</p>

<p>
Years passed and one day I was returned to reading a SICP<sup><a id="fnr.sicp" class="footref" href="#fn.sicp" role="doc-backlink">2</a></sup>, so I needed
to have an editor connected to the REPL<sup><a id="fnr.repl" class="footref" href="#fn.repl" role="doc-backlink">3</a></sup> and some sort of debugger to
solve programming problems and learn the Lisp at the same time. I remembered
that Emacs has the "Superior Lisp Interaction Mode" aka SLIME<sup><a id="fnr.slime" class="footref" href="#fn.slime" role="doc-backlink">4</a></sup> and a
bunch of plugins which makes the Lisp programming extremely pretty.
</p>

<p>
So, I installed the Emacs back and restored my old configuration. This
happened at <a href="https://codeberg.org/evgandr/dotfiles/commit/f91d65dc7fd482dbb607365118c4088848991445">2018-11-13</a> (according to the same <code>git log</code>) and from this
time I'm polishing and polishing and polishing and polishing my <code>*.el</code>
files. I swear, this process can't be finished, but for now I'm happy
with the current Emacs configuration.
</p>

<p>
I never used <a href="https://github.com/doomemacs/doomemacs">Doom Emacs</a> or any other preconfigured distributions.
First, they didn't exist at 2011 (or weren't widely known). Second, I
prefer to tinker with my configs by myself and to know meaning of
almost an every line in my files as a result.
</p>

<p>
Year by year, with a great help of <a href="https://mas.to/tags/emacs">Emacs community in Fediverse</a>, I
mastered my current configuration. I'm using Emacs to write text,
code, read my e-mails, watch updates from RSS feeds, listen music,
work with command interpreter, control some long-running processes in
the system and so on. For me, it is not a text editorÂ â€” it is some
kind of a Lisp machine (like <a href="https://interlisp.org/">Medley Interlisp</a>) or a very hackable Lisp
interpreter. It is doing one thingÂ â€” allowing me to run different
Emacs Lisp programs (aka plugins) inside the interpreterÂ â€” and it is
doing it pretty well.
</p>

<p>
You may be thinking "damn, this Emacs configuration is bloated with tons of
custom plugins and Emacs starts in minutes". But the truth is simple:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #009c8f;">(</span>emacs-init-time<span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">"1.858343 seconds"</span>
</pre>
</div>


<div class="figure">
<p><img src="/assets/static/use-package-statistics.png" alt="Startup time of some packages, gathered via use-package-report. Max time: tramp 0.47 seconds, min time: smtpmail 0.06 seconds. Not all packages are listed." align="center" witdh="80%" />
</p>
</div>

<p>
<i>Note:</i> this startup time is for Emacs running on the Thinkpad X220 laptop with
Intel i7-2620M CPU with maximal frequency at 2000 MHz (set via the
<code>powerd</code><sup><a id="fnr.freebsd-x220" class="footref" href="#fn.freebsd-x220" role="doc-backlink">5</a></sup>) and with SSD. On the faster CPU the resulting startup
time may be smaller.
</p>

<p>
I have near 44 plugins which were separately installed, not shipped
with the Emacs itself (dependencies didn't counted). Most of them are
just extends the functionality of things, shipped with the Emacs
itself. I tried to rely on the functionality of the vanilla Emacs and
use some plugins if there are no any choice to achieve the necessary
functionality.
</p>

<p>
Let's dive in. I'll try to explain almost every line of my configuration.
</p>

<p>
<i>Second note:</i> this post <b>weren't planned</b> as a post for newcomersÂ â€” I'll use a
lot of Emacs-specific terminology and will show a lot of Emacs Lisp code. If
you are new, then I recommend to read <a href="https://www.shaneikennedy.xyz/blog/emacs-intro">this post</a> with a good introduction into
the Emacs <b>first</b>!
</p>
</div>
</div>
<div id="outline-container-emacs-conf-template" class="outline-2">
<h2 id="emacs-conf-template">Emacs configuration template</h2>
<div class="outline-text-2" id="text-emacs-conf-template">
<p>
All my <code>*.el</code> files related to Emacs configuration follows one simple template,
well known for a Emacs Lisp programmers:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #909995;">;;; </span><span style="color: #909995;">rc-file.el --- Sample file with standard header and footer --- -*- lexical-binding: t -*-</span>
<span style="color: #909995;">;;; </span><span style="color: #909995;">Commentary:</span>
<span style="color: #909995;">;;; </span><span style="color: #909995;">Code:</span>

<span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">provide</span> '<span style="color: #0072d4; font-weight: bold;">rc-file</span><span style="color: #009c8f;">)</span>
<span style="color: #909995;">;;; </span><span style="color: #909995;">rc-file.el ends here</span>
</pre>
</div>

<p>
The <code>-*- lexical-binding: t -*-</code> here expicitly enables the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Lexical-Binding.html">lexical binding</a> of
variables, for example in <code>let</code> clauses. Because lexical binding is enabled by
default in the Modern Emacs Lisp dialectÂ â€” this line is necessary mostly to
pleasure <a href="https://www.flycheck.org/en/latest/">flycheck</a>'s linter.
</p>

<p>
The <code>provide</code> clause states that this file provides the <code>rc-file</code> feature. This is
necessary during Emacs initialization to load the <i>features</i> not to simple
call <code>load-path</code> with path to some <code>*.el</code> file every time.
</p>

<p>
Also, <i>features</i> can be used to load some functions from <code>*.el</code> file in time when
they called, not to load the whole <code>*.el</code> file at once during startup. This is
named <i>autoloading</i> and can speed up Emacs startup a bit.
</p>

<p>
In the code <i>autoloading</i> looks like this:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #009c8f;">(</span>autoload 'my--chown-files <span style="color: #009c8f;">"eshell-functions"</span><span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">(</span>autoload 'my--dsync <span style="color: #009c8f;">"eshell-functions"</span><span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">(</span>autoload 'my--safe-backup <span style="color: #009c8f;">"eshell-functions"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here the two files. First file with the name <code>eshell-functions.el</code> contains some
functions. This file lies in the <code>load-path</code> and has <code>(provide 'eshell-functions)</code>
S-exp at the end.
</p>

<p>
And there is the second file with some configuration and with lines from the
code snippet above. This file <i>autoloads</i> some functions from the first file.
During second file evaluation, these functions will not be installed and some
time will not be spent on it. This happens right in time (and right for
specific function) when this function is called.
</p>

<p>
See the <a href="https://www.gnu.org/software/emacs/manual/html_node/eintr/Autoload.html">"Autoloading"</a> section in the Emacs manual for more information about
this feature.
</p>

<p>
<i>Note:</i> all <code>*.el</code> files in my configuration are byte-compiled to slightly
speed up the Emacs startup.
</p>
</div>
</div>
<div id="outline-container-emacs-start" class="outline-2">
<h2 id="emacs-start">How is it starting?</h2>
<div class="outline-text-2" id="text-emacs-start">
<p>
First of all, I'm using Emacs as a daemon. In this case the <code>emacs</code> launched
once at a system startup and works as a server awaiting connections from
multiple <code>emacsclient</code> instances. The advantage of this approach is simpleÂ â€”
Emacs becomes more <i>persistent</i>. I can close all Emacs frames or even logout
from the system, but all my opened buffers and processes, launched inside
Emacs, still stay here.
</p>

<p>
Emacsclient launches with this command line arguments:
</p>
<pre class="example">
emacsclient -a= -c -s /var/run/drag0n/emacs/main
</pre>

<p>
Note the <code>-s</code> options which sets path to the Emacs daemon's socketÂ â€” through it
the emacsclient connects to the daemon. The socket name is the name of the
launched Emacs daemon and set with the <code>--fg-daemon</code> option (see the line
<a href="#coderef-emacsd-fg-daemon" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-fg-daemon');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-fg-daemon');">26</a> in the <code>emacsd</code> script below). With the various <code>-s</code> options I
can connect to the <i>various</i> Emacs daemonsÂ â€” for example, I may run one daemon
for usual operations and the another daemon solely for EXWM (Emacs Window
Manager).
</p>
</div>
<div id="outline-container-emacs-daemon-free-bsd" class="outline-3">
<h3 id="emacs-daemon-free-bsd">Daemon startup script for FreeBSD</h3>
<div class="outline-text-3" id="text-emacs-daemon-free-bsd">
<p>
As I stated before, my Emacs starts at system boot as a system service. There
is no startup script in the FreeBSD package, so I wrote this script my myself.
Despite the RedHat corporate propaganda, it is simple enoughÂ â€” just read the
<code>man 8 rc.subr</code> first and then the <code>man 8 rcorder</code>! For more information you can
read the <a href="https://docs.freebsd.org/en/articles/rc-scripting/">Practical rc.d scripting in BSD</a>.
</p>

<p>
First of all, I wrote a default header to connect startup script to the rc.d
framework:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="linenr">1: </span><span style="color: #909995;">#</span><span style="color: #909995;">!/bin/</span><span style="color: #489100; font-weight: bold;">sh</span>
<span class="linenr">2: </span><span style="color: #909995;">#</span>
<span id="coderef-emacsd-provide" class="coderef-off"><span class="linenr">3: </span><span style="color: #909995;"># </span><span style="color: #909995;">PROVIDE: emacsd</span></span>
<span id="coderef-emacsd-require" class="coderef-off"><span class="linenr">4: </span><span style="color: #909995;"># </span><span style="color: #909995;">REQUIRE: DAEMON</span></span>
<span id="coderef-emacsd-keyword" class="coderef-off"><span class="linenr">5: </span><span style="color: #909995;"># </span><span style="color: #909995;">KEYWORD: nojail shutdown</span></span>
<span class="linenr">6: </span><span style="color: #909995;">#</span>
<span class="linenr">7: </span>
<span class="linenr">8: </span>. /etc/rc.subr
</pre>
</div>

<p>
Here the next things happen:
</p>
<ol class="org-ol">
<li>My script provides an <code>emacsd</code> service, so I could specify in other scripts,
that they should be executed only after <code>emacsd</code> startup (line
<a href="#coderef-emacsd-provide" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-provide');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-provide');">3</a>).</li>
<li>Script should be executed after the script, which configuring the daemon
(<code>man 8 daemon</code>) facilities (line <a href="#coderef-emacsd-require" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-require');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-require');">4</a>). This is necessary
because I use <code>daemon</code> to launch Emacs.</li>
<li>Then, in the line <a href="#coderef-emacsd-keyword" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-keyword');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-keyword');">5</a> I specified two keywords. The <code>nojail</code>
disables this script if it is running inside the jail. The <code>shutdown</code>
directive explicitly states that <code>emacsd</code> should be stopped before the system
shutdown.</li>
<li>And after that I source the <code>rc.subr</code> to use it's facilities to write the
rest of the script.</li>
</ol>

<p>
The next lines contains standard variables, consumed by <code>rc.subr</code> internals:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="linenr">10: </span><span style="color: #0072d4;">name</span>=<span style="color: #009c8f;">"emacsd"</span>
<span class="linenr">11: </span><span style="color: #0072d4;">desc</span>=<span style="color: #009c8f;">"Main Emacs daemon"</span>
<span class="linenr">12: </span><span style="color: #0072d4;">rcvar</span>=<span style="color: #009c8f;">"emacsd_enable"</span>
<span id="coderef-emacsd-precmds" class="coderef-off"><span class="linenr">13: </span><span style="color: #0072d4;">start_precmd</span>=<span style="color: #009c8f;">"${name}_prestart"</span></span>
<span class="linenr">14: </span><span style="color: #0072d4;">stop_precmd</span>=<span style="color: #009c8f;">"${name}_prestop"</span>
<span class="linenr">15: </span>
<span id="coderef-emacsd-load-rc-config" class="coderef-off"><span class="linenr">16: </span>load_rc_config ${<span style="color: #0072d4;">name</span>}</span>
<span class="linenr">17: </span>: ${<span style="color: #0072d4;">emacsd_enable</span>:=<span style="color: #009c8f;">"NO"</span>}
<span class="linenr">18: </span>: ${<span style="color: #0072d4;">emacsd_user</span>:=<span style="color: #009c8f;">"nobody"</span>}
</pre>
</div>

<p>
There are:
</p>
<ol class="org-ol">
<li>Name and description of the service</li>
<li>The string used in the <code>/etc/rc.conf</code> as a key</li>
<li>On the line <a href="#coderef-emacsd-precmds" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-precmds');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-precmds');">13</a> I specify two functions: first will be
run before the service starts, and the second will be run before
the serivce stops. I'll describe them below.</li>
<li><p>
On the line <a href="#coderef-emacsd-load-rc-config" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-load-rc-config');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-load-rc-config');">16</a> I load serivce configuration from
<code>/etc/rc.conf</code> and use some defaults, if user didn't setup anything in this
fileÂ â€” by default <code>emacsd</code> is disabled and Emacs user in <code>nobody</code>. In the real
system corresponding settings from <code>/etc/rc.conf</code> may look like this:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #0072d4;">emacsd_enable</span>=<span style="color: #009c8f;">"YES"</span>
<span style="color: #0072d4;">emacsd_user</span>=<span style="color: #009c8f;">"drag0n"</span>
</pre>
</div></li>
</ol>

<p>
Then, I prepare some variables, which will be used by <code>daemon</code> to launch the
Emacs. You may be asking "why use daemon, when Emacs can daemonize itself"?
Yes it is, but Emacs doesn't do some things, which should do daemon running as
a system service in the Unix system:
</p>

<ul class="org-ul">
<li>It doesn't create the pid-file, necessary to launch only one copy of daemon.</li>
<li>It doesn't read the environment variables properlyÂ â€” all variables should be
set before the Emacs launch.</li>
</ul>

<p>
So that's why I'm using the <code>daemon</code>Â â€” it does these necessary things before
launch an Emacs.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="linenr">20: </span><span style="color: #0072d4;">piddir</span>=<span style="color: #009c8f;">"/var/run/${emacsd_user}"</span>
<span id="coderef-emacsd-pidfile" class="coderef-off"><span class="linenr">21: </span><span style="color: #0072d4;">pidfile</span>=<span style="color: #009c8f;">"${piddir}/${name}_daemon.pid"</span></span>
<span id="coderef-emacsd-pidfile-child" class="coderef-off"><span class="linenr">22: </span><span style="color: #0072d4;">pidfile_child</span>=<span style="color: #009c8f;">"${piddir}/${name}_emacs.pid"</span></span>
<span class="linenr">23: </span><span style="color: #0072d4;">user_id</span>=<span style="color: #009c8f;">"$(id -u ${emacsd_user})"</span>
<span class="linenr">24: </span><span style="color: #0072d4;">emacsd_env</span>=<span style="color: #009c8f;">"$(/usr/bin/env -iL ${emacsd_user} XDG_RUNTIME_DIR=${piddir} HOME=/home/${emacsd_user} LC_ALL=en_US.UTF-8 XLIB_SKIP_ARGB_VISUALS=1 | tr '\n' ' ')"</span>
</pre>
</div>

<p>
Here I define the path to the daemon pidfile and the path to the emacs pidfile
(lines <a href="#coderef-emacsd-pidfile" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-pidfile');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-pidfile');">21</a> and <a href="#coderef-emacsd-pidfile-child" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-pidfile-child');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-pidfile-child');">22</a>). The first is equals to
<code>/var/run/drag0n/emacsd_daemon.pid</code> and the second is
<code>/var/run/drag0n/emacsd_emacs.pid</code> in my system.
</p>

<p>
Why I need the two pidfiles? This is how the <code>daemon</code> worksÂ â€” it watches for
child process and restarts it if process suddenly dies. So the first pidfile
is necessary for the <code>daemon</code> itself to doesn't spawn the second <code>daemon</code> process
which will do the same. The second pidfile is obviously necessary to launch
only one <code>emacs</code> process and no more.
</p>

<p>
If user wants to stop the <code>emacsd</code> serviceÂ â€” well, then <code>daemon</code> will kill the
<code>emacs</code> process, remove it pidfile, then remove own pidfile and stop itself.
</p>

<p>
On the next line I just obtain the <code>emacsd_user</code> ID. And immediately use it to
cook the <code>emacsd_env</code> variable with all necessary environment variables for
Emacs. There the <code>env</code> doing the main work, slurping the valuable things from
<code>/etc/login.conf</code> with some hand-written additions at the end of its arguments:
</p>

<pre class="example">
$ id -u drag0n
1001
$ /usr/bin/env -iL 1001 XDG_RUNTIME_DIR=/var/run/drag0n HOME=/home/drag0n LC_ALL=en_US.UTF-8 XLIB_SKIP_ARGB_VISUALS=1
XLIB_SKIP_ARGB_VISUALS=1
LC_ALL=en_US.UTF-8
HOME=/home/drag0n
XDG_RUNTIME_DIR=/var/run/drag0n
BLOCKSIZE=K
MAIL=/var/mail/drag0n
MM_CHARSET=UTF-8
LANG=ru_RU.UTF-8
PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:/home/drag0n/bin
</pre>

<p>
The next set of variables in <code>emacsd</code> startup script are necessary for rc.d
framework to do it's main jobÂ â€” to launch <code>daemon</code> and start the Emacs inside
it. There are just a four simple lines:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="linenr">25: </span><span style="color: #0072d4;">proc_cmd</span>=<span style="color: #009c8f;">"/usr/local/bin/emacs"</span>
<span id="coderef-emacsd-fg-daemon" class="coderef-off"><span class="linenr">26: </span><span style="color: #0072d4;">proc_args</span>=<span style="color: #009c8f;">"--fg-daemon=main -u ${emacsd_user} --chdir /home/${emacsd_user}"</span></span>
<span class="linenr">27: </span><span style="color: #0072d4;">command</span>=<span style="color: #009c8f;">"/usr/sbin/daemon"</span>
<span class="linenr">28: </span><span style="color: #0072d4;">command_args</span>=<span style="color: #009c8f;">"-f -P ${pidfile} -p ${pidfile_child} -r ${proc_cmd} ${proc_args}"</span>
</pre>
</div>

<p>
First two lines are sent as arguments to the <code>daemon</code>, so it knows what
and with which arguments should be executed. Note the <code>--fg-daemon</code>
argument at the <a href="#coderef-emacsd-fg-daemon" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-fg-daemon');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-fg-daemon');">26</a> lineÂ â€” it sets the name of the
running Emacs daemon which is used by emacsclient to know where to
connect (see the <a href="#emacs-start">"How is it starting?"</a> section).
</p>

<p>
And the last two lines are used by rc.d framework to execute <code>daemon</code> with given
arguments during the system startup, or when the user execute <code>sudo service
emacsd start</code> or <code>sudo service emacsd stop</code>.
</p>

<p>
The last non-described parts of this startup script are the pre-startup and
pre-shutdown functions, which were specified at the line <a href="#coderef-emacsd-precmds" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-precmds');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-precmds');">13</a>.
Here their definitions:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="linenr">30: </span><span style="color: #0072d4;">emacsd_prestart</span>()
<span class="linenr">31: </span>{
<span class="linenr">32: </span>    <span style="color: #ad8900; font-weight: bold;">!</span> [ -d <span style="color: #009c8f;">"${piddir}"</span> ] &amp;&amp; <span style="color: #ad8900; font-weight: bold;">\</span>
<span class="linenr">33: </span>        install -d -o <span style="color: #009c8f;">"${user_id}"</span> -g <span style="color: #009c8f;">"${user_id}"</span> <span style="color: #009c8f;">"${piddir}"</span> -
<span class="linenr">34: </span>    <span style="color: #489100; font-weight: bold;">return</span> 0
<span class="linenr">35: </span>}
<span class="linenr">36: </span>
<span class="linenr">37: </span><span style="color: #0072d4;">emacsd_prestop</span>()
<span class="linenr">38: </span>{
<span class="linenr">39: </span>    [ -e <span style="color: #009c8f;">"${piddir}/emacs/main"</span> ] &amp;&amp; <span style="color: #ad8900; font-weight: bold;">\</span>
<span class="linenr">40: </span>        /usr/local/bin/emacsclient -a= -s <span style="color: #009c8f;">"${piddir}/emacs/main"</span> --eval <span style="color: #009c8f;">"(kill-emacs)"</span>
<span class="linenr">41: </span>    <span style="color: #489100; font-weight: bold;">return</span> 0
<span class="linenr">42: </span>}
<span class="linenr">43: </span>
<span id="coderef-emacsd-run-rc-command" class="coderef-off"><span class="linenr">44: </span>run_rc_command <span style="color: #009c8f;">"$1"</span></span>
</pre>
</div>

<p>
The <code>emacsd_prestart</code> function creates directory, specified in the <code>piddir</code>
variable if it is not exists yet.
</p>

<p>
The <code>emacsd_prestop</code> function trying to kill Emacs daemon with it's own function
<code>(kill-emacs)</code>. Without this function the rc.d framework will kill Emacs itself
by sending first <code>SIGTERM</code> signal and then (after the pause and only if Emacs
daemon still alive) the <code>SIGKILL</code> signal. All these actions take some time and
slow down the shutdown/reboot process, so the <code>emacsd_prestop</code> function is
necessary.
</p>

<p>
At the line <a href="#coderef-emacsd-run-rc-command" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacsd-run-rc-command');" onmouseout="CodeHighlightOff(this, 'coderef-emacsd-run-rc-command');">44</a> there is a last line of codeÂ â€” it
executes all machinery, defined above, within the rc.d framework.
</p>
</div>
</div>
<div id="outline-container-emacs-early-initialization" class="outline-3">
<h3 id="emacs-early-initialization">Emacs early initialization</h3>
<div class="outline-text-3" id="text-emacs-early-initialization">
<p>
According to the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Startup-Summary.html">"43.1.1 Summary: Sequence of Actions at Startup"</a> from Emacs
manual, there are a lot of various things happen during the startup. The point
of interest for this section is the <code>early-init.el</code> file (see the <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Early-Init-File.html#Early-Init-File">"51.4.6 The
Early Init File"</a>), which will be executed first, during the startup (see the
item #6 from 43.1.1 section).
</p>

<p>
In this file I placed parts from different tricky configs taken from the
links, provided by <a href="https://social.sachachua.com/@sacha">Sacha Chua</a> in her weekly <a href="https://sachachua.com/blog/category/emacs-news/">"Emacs News"</a>.
</p>

<p>
The initialization process starts from the some GC related tricks,
which I took from the <a href="https://jackjamison.xyz/about-me/">Jack Jamison's</a> blogpost <a href="https://jackjamison.xyz/blog/emacs-garbage-collection/">"A Solution to Emacs
Garbage Collection Stutters"</a>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr"> 1: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">early-init.el --- Early initialization code --- -*- lexical-binding: t -*-</span>
<span class="linenr"> 2: </span><span style="color: #909995;">;;;</span>
<span class="linenr"> 3: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Commentary:</span>
<span class="linenr"> 4: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Special Emacs configuration which shlould be executed</span>
<span class="linenr"> 5: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">before any other actions. For example: GC tweaks and etc.</span>
<span class="linenr"> 6: </span><span style="color: #909995;">;;;</span>
<span class="linenr"> 7: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Code:</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Setup GC</span>
<span class="linenr">10: </span><span style="color: #909995;">;; </span><span style="color: #909995;">https://jackjamison.xyz/blog/emacs-garbage-collection/</span>
<span class="linenr">11: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">my-minibuffer-setup-hook</span> <span style="color: #ad8900;">()</span>
<span class="linenr">12: </span>  <span style="color: #009c8f;">"Set `</span><span style="color: #0072d4; font-weight: bold;">gc-cons-threshold</span><span style="color: #009c8f;">' to 800 Mb for minibuffer window."</span>
<span class="linenr">13: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setq</span> gc-cons-threshold 800000000<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">14: </span><span style="color: #009c8f;">(</span>add-hook 'minibuffer-setup-hook #'my-minibuffer-setup-hook<span style="color: #009c8f;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">my-minibuffer-exit-hook</span> <span style="color: #ad8900;">()</span>
<span class="linenr">17: </span>  <span style="color: #009c8f;">"Default `</span><span style="color: #0072d4; font-weight: bold;">gc-cons-threshold</span><span style="color: #009c8f;">' is 80 Mb."</span>
<span class="linenr">18: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setq</span> gc-cons-threshold 80000000<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">19: </span><span style="color: #009c8f;">(</span>add-hook 'minibuffer-exit-hook #'my-minibuffer-exit-hook<span style="color: #009c8f;">)</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Default `</span><span style="color: #0072d4; font-weight: bold;">gc-cons-threshold</span><span style="color: #909995;">' is 80 Mb:</span>
<span class="linenr">22: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> gc-cons-threshold 80000000<span style="color: #009c8f;">)</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Run GC after 15 seconds of inactivity:</span>
<span class="linenr">25: </span><span style="color: #009c8f;">(</span>run-with-idle-timer 15 t 'garbage-collect<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here I just trade the system's memory with the responsivness of Emacs. When
there is 16Â Gb of RAM in my system and Emacs uses less than 1â€° of itÂ â€” then I
can do this trade, I think. As a result the GC will be executed not so often
and only after 15 seconds of user inactivity, but while I pressing the keys I
will not meet the irritating delays causes by sudden GC wake up.
</p>

<p>
I also have been tried some other GC hacks from other configs, but I
found these hacks unusable. Still don't know why but my custom build
of Emacs in the Gentoo (and sometimes in the FreeBSD too) tends to
suddenly crash for unknown reasons with these hacks. Or became
unresponsive while GC is doing it's job. So I removed them and use
only the Jack Jamison's solution.
</p>

<p>
Then, in the same file, there are some tricks taken from different Emacs
configs to speed up Emacs startup. Can't say that they literally speed up
Emacs, but also they are disabling some unnecessary for me functionality, so I
left them in the file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">27: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Don't resize frame during startup:</span>
<span class="linenr">28: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> frame-inhibit-implied-resize t<span style="color: #009c8f;">)</span>
<span class="linenr">29: </span>
<span class="linenr">30: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Ignore X resources processing</span>
<span class="linenr">31: </span><span style="color: #009c8f;">(</span>advice-add #'x-apply-session-resources <span style="color: #53676d; font-weight: bold;">:override</span> #'ignore<span style="color: #009c8f;">)</span>
<span class="linenr">32: </span>
<span class="linenr">33: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Remove "for information about gnu emacs..." message at startup</span>
<span class="linenr">34: </span><span style="color: #009c8f;">(</span>advice-add #'display-startup-echo-area-message <span style="color: #53676d; font-weight: bold;">:override</span> #'ignore<span style="color: #009c8f;">)</span>
<span class="linenr">35: </span>
<span class="linenr">36: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Suppress the vanilla startup screen completely</span>
<span class="linenr">37: </span><span style="color: #009c8f;">(</span>advice-add #'display-startup-screen <span style="color: #53676d; font-weight: bold;">:override</span> #'ignore<span style="color: #009c8f;">)</span>
<span class="linenr">38: </span>
<span class="linenr">39: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Never show the hello file</span>
<span class="linenr">40: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">defalias</span> #'view-hello-file #'ignore<span style="color: #009c8f;">)</span>
<span class="linenr">41: </span>
<span class="linenr">42: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Unset `</span><span style="color: #0072d4; font-weight: bold;">file-name-handler-alist</span><span style="color: #909995;">' temporarily. Every file opened and</span>
<span class="linenr">43: </span><span style="color: #909995;">;; </span><span style="color: #909995;">loaded by Emacs will run through this list to check for a proper</span>
<span class="linenr">44: </span><span style="color: #909995;">;; </span><span style="color: #909995;">handler for the file, but during startup, it won&#8217;t need any of</span>
<span class="linenr">45: </span><span style="color: #909995;">;; </span><span style="color: #909995;">them.</span>
<span class="linenr">46: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">defvar</span> <span style="color: #0072d4;">file-name-handler-alist-old</span> file-name-handler-alist<span style="color: #009c8f;">)</span>
<span class="linenr">47: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> file-name-handler-alist nil<span style="color: #009c8f;">)</span>
<span class="linenr">48: </span><span style="color: #009c8f;">(</span>add-hook 'emacs-startup-hook
<span class="linenr">49: </span>          <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #0072d4;">()</span>
<span class="linenr">50: </span>            <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> file-name-handler-alist file-name-handler-alist-old<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">51: </span>
<span class="linenr">52: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Disable bidirectional text processing</span>
<span class="linenr">53: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> bidi-inhibit-bpa t<span style="color: #009c8f;">)</span>
<span class="linenr">54: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setq-default</span> bidi-display-reordering 'left-to-right
<span class="linenr">55: </span>              bidi-paragraph-direction 'left-to-right<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
And at the end I change the <code>load-path</code> variable. All my main configuration
files lies in the <code>~/.emacs.d/configs/</code> directory, so I add it to the <code>load-path</code>
variable and Emacs could load necessary files with the <code>require</code> function:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">57: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Loading main configuration</span>
<span class="linenr">58: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> load-path <span style="color: #ad8900;">(</span>cons
<span class="linenr">59: </span>                   <span style="color: #0072d4;">(</span>concat <span style="color: #8762c6;">(</span>expand-file-name user-emacs-directory<span style="color: #8762c6;">)</span> <span style="color: #009c8f;">"configs/"</span><span style="color: #0072d4;">)</span>
<span class="linenr">60: </span>                   load-path<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">61: </span>
<span class="linenr">62: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">provide</span> '<span style="color: #0072d4; font-weight: bold;">.early-init-el</span><span style="color: #009c8f;">)</span>
<span class="linenr">63: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">early-init.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-emacs-initialization" class="outline-3">
<h3 id="emacs-initialization">Emacs initialization</h3>
<div class="outline-text-3" id="text-emacs-initialization">
<p>
The Emacs offers a lot of places where the main configuration file can be
placed. I chose the <code>~/.emacs.d/init.el</code> so it looks like the my
StumpWM<sup><a id="fnr.stumpwm" class="footref" href="#fn.stumpwm" role="doc-backlink">6</a></sup> configuration, which is placed in the <code>~/.stumpwm.d/init.lisp</code>.
</p>

<p>
The <code>init.el</code> divided into two parts. On the first part I configure
<code>package</code><sup><a id="fnr.package-el" class="footref" href="#fn.package-el" role="doc-backlink">7</a></sup> and <code>use-package</code><sup><a id="fnr.use-package" class="footref" href="#fn.use-package" role="doc-backlink">8</a></sup>. The second part just loads
all necessary <i>featues</i> from my configuration with the use of previously
described <code>provide</code>, <code>feature</code> and <code>require</code> functions (see the <a href="#emacs-conf-template">"Emacs configuration
template"</a> chapter).
</p>

<p>
Package configuration looks like this:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr"> 1: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">init.el --- Main configuration file for Emacs --- -*- lexical-binding: t -*-</span>
<span class="linenr"> 2: </span><span style="color: #909995;">;;;</span>
<span class="linenr"> 3: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Commentary:</span>
<span class="linenr"> 4: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Load main Emacs configuration via features.</span>
<span class="linenr"> 5: </span><span style="color: #909995;">;;;</span>
<span class="linenr"> 6: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Code:</span>
<span class="linenr"> 7: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">First, setup `</span><span style="color: #0072d4; font-weight: bold;">package</span><span style="color: #909995;">':</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">package</span><span style="color: #009c8f;">)</span>
<span class="linenr">10: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">List of manually installed packages</span>
<span class="linenr">11: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Used by package-autoremove</span>
<span class="linenr">12: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> package-selected-packages '<span style="color: #ad8900;">(</span>auctex
<span class="linenr">13: </span>                                    cheatsheet
<span class="linenr">14: </span>                                    delight
<span class="linenr">15: </span>                                    delsel
<span class="linenr">16: </span>                                    dired
<span class="linenr">17: </span>                                    dired-hide-dotfiles
<span class="linenr">18: </span>                                    dired-open
<span class="linenr">19: </span>                                    dired-subtree
<span class="linenr">20: </span>                                    dired-rsync
<span class="linenr">21: </span>                                    dumb-jump
<span class="linenr">22: </span>                                    emacs-everywhere
<span class="linenr">23: </span>                                    emms
<span class="linenr">24: </span>                                    eshell-prompt-extras
<span class="linenr">25: </span>                                    esh-help
<span class="linenr">26: </span>                                    fb2-reader
<span class="linenr">27: </span>                                    flycheck
<span class="linenr">28: </span>                                    git-gutter
<span class="linenr">29: </span>                                    git-gutter-fringe
<span class="linenr">30: </span>                                    highlight-thing
<span class="linenr">31: </span>                                    htmlize
<span class="linenr">32: </span>                                    image-dired
<span class="linenr">33: </span>                                    imenu-list
<span class="linenr">34: </span>                                    langtool
<span class="linenr">35: </span>                                    langtool-popup
<span class="linenr">36: </span>                                    magit
<span class="linenr">37: </span>                                    magit-todos
<span class="linenr">38: </span>                                    mu4e
<span class="linenr">39: </span>                                    nerd-icons
<span class="linenr">40: </span>                                    nerd-icons-completion
<span class="linenr">41: </span>                                    nerd-icons-dired
<span class="linenr">42: </span>                                    nerd-icons-ibuffer
<span class="linenr">43: </span>                                    nov
<span class="linenr">44: </span>                                    olivetti
<span class="linenr">45: </span>                                    org
<span class="linenr">46: </span>                                    org-alert
<span class="linenr">47: </span>                                    org-contacts
<span class="linenr">48: </span>                                    org-modern
<span class="linenr">49: </span>                                    paredit
<span class="linenr">50: </span>                                    pass
<span class="linenr">51: </span>                                    password-store
<span class="linenr">52: </span>                                    password-store-otp
<span class="linenr">53: </span>                                    pdf-tools
<span class="linenr">54: </span>                                    pdf-view-restore
<span class="linenr">55: </span>                                    pinentry
<span class="linenr">56: </span>                                    prodigy
<span class="linenr">57: </span>                                    rainbow-delimiters
<span class="linenr">58: </span>                                    slime
<span class="linenr">59: </span>                                    smtpmail
<span class="linenr">60: </span>                                    solarized-theme
<span class="linenr">61: </span>                                    sql-indent
<span class="linenr">62: </span>                                    toc-org
<span class="linenr">63: </span>                                    wgrep
<span class="linenr">64: </span>                                    windresize
<span class="linenr">65: </span>                                    use-package<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span id="coderef-init-el-package-archives" class="coderef-off"><span class="linenr">66: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> package-archives '<span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span><span style="color: #009c8f;">"melpa-stable"</span> . <span style="color: #009c8f;">"https://stable.melpa.org/packages/"</span><span style="color: #0072d4;">)</span></span>
<span class="linenr">67: </span>                           <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"gnu"</span> . <span style="color: #009c8f;">"https://elpa.gnu.org/packages/"</span><span style="color: #0072d4;">)</span>
<span class="linenr">68: </span>                           <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"nongnu"</span> . <span style="color: #009c8f;">"https://elpa.nongnu.org/nongnu/"</span><span style="color: #0072d4;">)</span>
<span class="linenr">69: </span>                           <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"melpa"</span> . <span style="color: #009c8f;">"https://melpa.org/packages/"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">70: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> package-archive-priorities '<span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span><span style="color: #009c8f;">"gnu"</span> . 10<span style="color: #0072d4;">)</span>
<span class="linenr">71: </span>                                     <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"nongnu"</span> . 9<span style="color: #0072d4;">)</span>
<span class="linenr">72: </span>                                     <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"melpa"</span> . 2<span style="color: #0072d4;">)</span>
<span class="linenr">73: </span>                                     <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"melpa-stable"</span> . 1<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span id="coderef-init-el-built-in" class="coderef-off"><span class="linenr">74: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> package-install-upgrade-built-in t<span style="color: #009c8f;">)</span></span>
<span id="coderef-init-el-nativ-comp" class="coderef-off"><span class="linenr">75: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> package-native-compile t<span style="color: #009c8f;">)</span></span>
</pre>
</div>

<p>
First, I add the manually created list of installed packages. This list is
necessary for <code>package-autoremove</code> commandÂ â€” to not delete these packages in any
case!
</p>

<p>
On the line <a href="#coderef-init-el-package-archives" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-init-el-package-archives');" onmouseout="CodeHighlightOff(this, 'coderef-init-el-package-archives');">66</a> I added some sources of Emacs
plugins, like: <a href="https://melpa.org/">MELPA</a> (Milkypostmanâ€™s Emacs Lisp Package Archive),
<a href="https://stable.melpa.org/">MELPA Stable</a>, <a href="https://elpa.gnu.org/">ELPA</a> (GNU Emacs Lisp Package Archive) and <a href="https://elpa.nongnu.org/">ELPA (non-GNU
variant)</a>. And I specified that I want to use ELPA and Non-GNU ELPA
first; the other repositories will be used only if some plugin is not
found in these two repositories. By the way, usually I have most of
the necessary plugins right in ELPA or Non-GNU ELPAÂ â€” so the other 2
repositories out of use.
</p>

<p>
Then, on the line <a href="#coderef-init-el-built-in" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-init-el-built-in');" onmouseout="CodeHighlightOff(this, 'coderef-init-el-built-in');">74</a> I instruct <code>package.el</code> to update even the
built-in packages, if there are some updates. And, on the line
<a href="#coderef-init-el-nativ-comp" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-init-el-nativ-comp');" onmouseout="CodeHighlightOff(this, 'coderef-init-el-nativ-comp');">75</a> the byte-compilation of packages after their
installation is enabled. This setting was made also to slightly speed up the
system.
</p>

<p>
For now all is ready to setup <code>use-package</code>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">77: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Then, setup `</span><span style="color: #0072d4; font-weight: bold;">use-package</span><span style="color: #909995;">':</span>
<span class="linenr">78: </span>
<span class="linenr">79: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">condition-case</span> nil
<span class="linenr">80: </span>    <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">use-package</span><span style="color: #ad8900;">)</span>
<span class="linenr">81: </span>  <span style="color: #ad8900;">(</span>file-error
<span class="linenr">82: </span>   <span style="color: #0072d4;">(</span>package-refresh-contents<span style="color: #0072d4;">)</span>
<span class="linenr">83: </span>   <span style="color: #0072d4;">(</span>package-install 'use-package<span style="color: #0072d4;">)</span>
<span class="linenr">84: </span>   <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">use-package</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">85: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> use-package
<span class="linenr">86: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">87: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span id="coderef-init-el-stats" class="coderef-off"><span class="linenr">88: </span>  <span style="color: #ad8900;">(</span>use-package-compute-statistics t <span style="color: #009c8f;">"Gather statistics for use-package-report"</span><span style="color: #ad8900;">)</span></span>
<span class="linenr">89: </span>  <span style="color: #ad8900;">(</span>use-package-always-ensure t <span style="color: #009c8f;">"Always download package if not exists"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here, on the line <a href="#coderef-init-el-stats" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-init-el-stats');" onmouseout="CodeHighlightOff(this, 'coderef-init-el-stats');">88</a> I enable gathering statistics for
<code>(use-package-report)</code> â€” the screenshot of this report you can see at the <a href="#preamble">"Preamble"</a>. It is very useful to search for and fix packages slowing down
Emacs loading.
</p>

<p>
After all these preparations I just load all my <i>features</i>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr"> 91: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Load my features:</span>
<span class="linenr"> 92: </span>
<span class="linenr"> 93: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-emacs</span><span style="color: #009c8f;">)</span>
<span class="linenr"> 94: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-dired</span><span style="color: #009c8f;">)</span>
<span class="linenr"> 95: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-theme</span><span style="color: #009c8f;">)</span>
<span class="linenr"> 96: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-document-viewers</span><span style="color: #009c8f;">)</span>
<span class="linenr"> 97: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-emacs-everywhere</span><span style="color: #009c8f;">)</span>
<span class="linenr"> 98: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-eshell</span><span style="color: #009c8f;">)</span>
<span class="linenr"> 99: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-emms</span><span style="color: #009c8f;">)</span>
<span class="linenr">100: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-programming</span><span style="color: #009c8f;">)</span>
<span class="linenr">101: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-olivetti</span><span style="color: #009c8f;">)</span>
<span class="linenr">102: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-langtool</span><span style="color: #009c8f;">)</span>
<span class="linenr">103: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-git</span><span style="color: #009c8f;">)</span>
<span class="linenr">104: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-org</span><span style="color: #009c8f;">)</span>
<span class="linenr">105: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-gnus</span><span style="color: #009c8f;">)</span>
<span class="linenr">106: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-pass</span><span style="color: #009c8f;">)</span>
<span class="linenr">107: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-auctex</span><span style="color: #009c8f;">)</span>
<span class="linenr">108: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-prodigy</span><span style="color: #009c8f;">)</span>
<span class="linenr">109: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">rc-cheatsheet</span><span style="color: #009c8f;">)</span>
<span class="linenr">110: </span>
<span class="linenr">111: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">provide</span> '<span style="color: #0072d4; font-weight: bold;">.init-el</span><span style="color: #009c8f;">)</span>
<span class="linenr">112: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">init.el ends here</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-some-necessary-plugins" class="outline-2">
<h2 id="some-necessary-plugins">Some necessary plugins first</h2>
<div class="outline-text-2" id="text-some-necessary-plugins">
<p>
As you can see I divided my configuration to:
</p>
<ul class="org-ul">
<li>something related to viewing different documents: EPUB, FB2, PDF, web pages
and so on (<code>rc-document-viewers.el</code>)</li>
<li>something related to the programming (<code>rc-programming.el</code>)</li>
<li>and a bunch of <code>*.el</code> files related to a big and valuable plugins, like
<a href="https://www.gnu.org/software/auctex/">AUCTeX</a>, Dired, OrgMode and so on.</li>
</ul>

<p>
But there are some lines which should be applied to the whole Emacs like
IComplete configuration. And some lines, which I cannot relate neither to some
plugin, nor to some activity like programming. So I add these lines right to
the <code>rc-emacs.el</code>. Lets look to the contents of this file.
</p>

<p>
At the start of common configuration, the two packages are loading
immediately:
</p>
<ul class="org-ul">
<li>delightÂ â€” used to hide unnecessary minor modes from the modeline. By
default there are <b>a lot</b> of names printed, which create a big visual
mess. So I tend to hide most of the enabled minor modes from
modeline, if they don't provide any information valuable for me.</li>
<li>pinentryÂ â€” necessary to use Emacs as a <code>pinentry</code> program for GnuPG.
It provides a popping-up minibiuffer prompt with request to enter a
passphrase, when I try to unlock and use a GPG-key.</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr"> 1: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">rc-emacs.el --- Main configuration of Emacs --- -*- lexical-binding: t -*-</span>
<span class="linenr"> 2: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Commentary:</span>
<span class="linenr"> 3: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Here the main Emacs configuration, common for any Emacs usage.  Also the</span>
<span class="linenr"> 4: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">some common and small packages also setup here.</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Code:</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Load these packages before all other Emacs Lisp code will be loaded:</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> delight
<span class="linenr">11: </span>  <span style="color: #53676d; font-weight: bold;">:demand</span>
<span class="linenr">12: </span>  <span style="color: #53676d; font-weight: bold;">:pin</span> gnu
<span class="linenr">13: </span>  <span style="color: #53676d; font-weight: bold;">:requires</span> use-package
<span class="linenr">14: </span>  <span style="color: #53676d; font-weight: bold;">:after</span> use-package<span style="color: #009c8f;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> pinentry
<span class="linenr">17: </span>  <span style="color: #53676d; font-weight: bold;">:pin</span> gnu
<span class="linenr">18: </span>  <span style="color: #53676d; font-weight: bold;">:defer</span> nil<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
The <code>:pin gnu</code> lines tells the <code>package.el</code> that these packages should be
installed from ELPA (see the <a href="#coderef-init-el-package-archives" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-init-el-package-archives');" onmouseout="CodeHighlightOff(this, 'coderef-init-el-package-archives');">66</a> from the <code>early-init.el</code>
for abbreviations used for various Emacs repositories).
</p>
</div>
</div>
<div id="outline-container-rc-emacs-el-keybindings" class="outline-2">
<h2 id="rc-emacs-el-keybindings">Keybindings</h2>
<div class="outline-text-2" id="text-rc-emacs-el-keybindings">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">20: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Main Emacs configuration</span>
<span class="linenr">21: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">(not related to other packages)</span>
<span class="linenr">22: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> emacs
<span id="coderef-rc-emacs-emacs-func" class="coderef-off"><span class="linenr">23: </span>  <span style="color: #53676d; font-weight: bold;">:functions</span> <span style="color: #ad8900;">(</span>ibuffer-switch-to-saved-filter-groups</span>
<span class="linenr">24: </span>              pinentry-start
<span class="linenr">25: </span>              pinentry-stop
<span class="linenr">26: </span>              my/keyboard-quit-dwim<span style="color: #ad8900;">)</span>
<span class="linenr">27: </span>  <span style="color: #53676d; font-weight: bold;">:bind</span>
<span id="coderef-rc-emacs-pixel-scroll-remap" class="coderef-off"><span class="linenr">28: </span>  <span style="color: #ad8900;">(</span><span style="color: #0072d4;">[</span>remap scroll-up-command<span style="color: #0072d4;">]</span>   . pixel-scroll-interpolate-down<span style="color: #ad8900;">)</span></span>
<span class="linenr">29: </span>  <span style="color: #ad8900;">(</span><span style="color: #0072d4;">[</span>remap scroll-down-command<span style="color: #0072d4;">]</span> . pixel-scroll-interpolate-up<span style="color: #ad8900;">)</span>
<span class="linenr">30: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"M-g"</span> . goto-line<span style="color: #ad8900;">)</span>
<span class="linenr">31: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-c &lt;left&gt;"</span> .  windmove-left<span style="color: #ad8900;">)</span>
<span class="linenr">32: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-c &lt;up&gt;"</span> . windmove-up<span style="color: #ad8900;">)</span>
<span class="linenr">33: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-c &lt;down&gt;"</span> . windmove-down<span style="color: #ad8900;">)</span>
<span class="linenr">34: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-c &lt;right&gt;"</span> . windmove-right<span style="color: #ad8900;">)</span>
<span class="linenr">35: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-x C-b"</span> . ibuffer<span style="color: #ad8900;">)</span>
<span class="linenr">36: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"M-j"</span> . <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #8762c6;">()</span>
<span class="linenr">37: </span>             <span style="color: #8762c6;">(</span><span style="color: #489100; font-weight: bold;">interactive</span><span style="color: #8762c6;">)</span>
<span class="linenr">38: </span>             <span style="color: #8762c6;">(</span>join-line -1<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">39: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-x f"</span> . nil<span style="color: #ad8900;">)</span>
<span class="linenr">40: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Reverse C-x o</span>
<span class="linenr">41: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-x O"</span> . <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #8762c6;">()</span> <span style="color: #8762c6;">(</span><span style="color: #489100; font-weight: bold;">interactive</span><span style="color: #8762c6;">)</span>
<span class="linenr">42: </span>               <span style="color: #8762c6;">(</span>other-window -1<span style="color: #8762c6;">)</span>
<span class="linenr">43: </span>               <span style="color: #8762c6;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> this-command 'other-window<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">44: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"&lt;Scroll_Lock&gt;"</span> . read-only-mode<span style="color: #ad8900;">)</span>
<span class="linenr">45: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-x C-z"</span> . nil<span style="color: #ad8900;">)</span>
<span id="coderef-rc-emacs-toggle-input-method" class="coderef-off"><span class="linenr">46: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-z"</span> . toggle-input-method<span style="color: #ad8900;">)</span></span>
</pre>
</div>

<p>
Two lines after <a href="#coderef-rc-emacs-pixel-scroll-remap" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-pixel-scroll-remap');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-pixel-scroll-remap');">28</a> were added to have a nice
scrolling with third mouse button plus ThinkPad's trackpoint (or with mouse
wheel). This feature was added in the Emacs 29 (see <a href="https://www.gnu.org/software/emacs/manual/html_node/efaq/New-in-Emacs-29.html">ChangeLog</a>).
</p>

<p>
Description of my common keybinding listed above:
</p>

<table border="2" cellspacing="0" cellpadding="6" frame="void">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Keybinding</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">M-g</td>
<td class="org-left">Used to go to the specified line. I'm used to this keybinding since beginning, so I don't change it.</td>
</tr>

<tr>
<td class="org-left">C-c â†â†‘â†“â†’</td>
<td class="org-left">To jump between windows.</td>
</tr>

<tr>
<td class="org-left">C-x C-b</td>
<td class="org-left">Opens IBuffer window to interactively switch between or kill the buffers.</td>
</tr>

<tr>
<td class="org-left">M-j</td>
<td class="org-left">Joins line below the cursor with the current line.</td>
</tr>

<tr>
<td class="org-left">C-x f</td>
<td class="org-left">Sometimes I enter this keychord when want to enter C-x C-f, so I unmapped the first.</td>
</tr>

<tr>
<td class="org-left">C-x O</td>
<td class="org-left">Since C-x o used to cycle between windows in one way, the C-x O will switch between windows in other way.</td>
</tr>

<tr>
<td class="org-left">Scroll Lock</td>
<td class="org-left">Sometimes I use this key to make the buffer read-only.</td>
</tr>

<tr>
<td class="org-left">C-x C-z</td>
<td class="org-left">I disabled this keychord to use Emacs in tiling WM without interruptions :-)</td>
</tr>

<tr>
<td class="org-left">C-z</td>
<td class="org-left">Using this chord to switch between languages inside Emacs.</td>
</tr>
</tbody>
</table>

<p>
Section on the line <a href="#coderef-rc-emacs-emacs-func" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-emacs-func');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-emacs-func');">23</a> is necessary just to
pleasure flycheck's linter, which thinks that some functions are not
defined, but they are definitely defined in the initialization time.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-cursor-minibuffer" class="outline-2">
<h2 id="rc-emacs-cursor-minibuffer">Cursor in the minibuffer's prompt</h2>
<div class="outline-text-2" id="text-rc-emacs-cursor-minibuffer">
<p>
By default, the Emacs allows to place the cursor in the minibuffer's
prompt which is obviously read-only. So when user presses some keys in
this area, he will got a message about read-only text and should move
cursor out of this area.
</p>

<p>
This irritated me a lot, so I just disallowed to place cursor in such regions:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">48: </span><span style="color: #53676d; font-weight: bold;">:init</span>
<span class="linenr">49: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Do not allow the cursor in the minibuffer prompt</span>
<span class="linenr">50: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> minibuffer-prompt-properties
<span class="linenr">51: </span>        '<span style="color: #ad8900;">(</span>read-only t cursor-intangible t face minibuffer-prompt<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">52: </span><span style="color: #009c8f;">(</span>add-hook 'minibuffer-setup-hook #'cursor-intangible-mode<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
So I can press <code>Backspace</code> in such prompts a lot of times but the cursor
will never go inside the read-only area:
</p>


<div class="figure">
<p><img src="/assets/static/minibuffer-no-edits.png" alt="Cursor can't move inside the read-only area in the minibufer" align="center -width 50%" />
</p>
</div>

<p>
This code runs first, before any configuration from the rest of file
were applied.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-variables" class="outline-2">
<h2 id="rc-emacs-variables">Common configuration variables</h2>
<div class="outline-text-2" id="text-rc-emacs-variables">
<p>
In this section I'll describe different variables which I set to configure
Emacs in my way. These variables are set inside the <code>:custom</code> section of
<code>use-package</code> so they will be applied during the startup.
</p>
</div>
<div id="outline-container-rc-emacs-interface-vars" class="outline-3">
<h3 id="rc-emacs-interface-vars">Interface configuration</h3>
<div class="outline-text-3" id="text-rc-emacs-interface-vars">
<p>
First, I remove all unnecessary noise at the startup. If there is no saved
session, then the <code>*scratch*</code> buffer will be openedÂ â€” and any welcome message in
this buffer is also turned off.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">54: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span class="linenr">55: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">56: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Interface configuration ;;;</span>
<span class="linenr">57: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">58: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Startup</span>
<span class="linenr">59: </span>  <span style="color: #009c8f;">(</span>inhibit-startup-screen t <span style="color: #009c8f;">"Disable startup screen"</span><span style="color: #009c8f;">)</span>
<span class="linenr">60: </span>  <span style="color: #009c8f;">(</span>inhibit-startup-echo-area-message t <span style="color: #009c8f;">"Disable startup message"</span><span style="color: #009c8f;">)</span>
<span class="linenr">61: </span>  <span style="color: #009c8f;">(</span>inhibit-splash-screen t <span style="color: #009c8f;">"Disable startup screens and messages"</span><span style="color: #009c8f;">)</span>
<span class="linenr">62: </span>  <span style="color: #009c8f;">(</span>inhibit-startup-buffer-menu t <span style="color: #009c8f;">"Don't show buffer menu then there are 2 or more files loaded"</span><span style="color: #009c8f;">)</span>
<span class="linenr">63: </span>  <span style="color: #009c8f;">(</span>inhibit-startup-message t<span style="color: #009c8f;">)</span>
<span class="linenr">64: </span>  <span style="color: #009c8f;">(</span>initial-buffer-choice t <span style="color: #009c8f;">"Always start from *scratch* buffer"</span><span style="color: #009c8f;">)</span>
<span class="linenr">65: </span>  <span style="color: #009c8f;">(</span>initial-scratch-message nil <span style="color: #009c8f;">"Remove message in *scratch*"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Any GUI dialogs are disabledÂ â€” I prefer to use usual text prompts in the
minibuffer:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">66: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Use text prompts as dialogs</span>
<span class="linenr">67: </span><span style="color: #009c8f;">(</span>use-file-dialog nil <span style="color: #009c8f;">"Don't use GUI file dialog"</span><span style="color: #009c8f;">)</span>
<span class="linenr">68: </span><span style="color: #009c8f;">(</span>use-dialog-box nil <span style="color: #009c8f;">"Don't use GUI dialog boxes"</span><span style="color: #009c8f;">)</span>
<span class="linenr">69: </span><span style="color: #009c8f;">(</span>use-short-answers t <span style="color: #009c8f;">"Replace yes/no with y/n"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
And any questions with implied <code>yes</code> or <code>no</code> answers now accept much
shorter <code>y</code> or <code>n</code> answers.
</p>

<p>
Then the scrolling configuration starts. The default configuration causes a
lot of screen twitching from my PoV, so I spent some time to get a nicer
scrolling:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">70: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Scrolling</span>
<span class="linenr">71: </span><span style="color: #009c8f;">(</span>auto-window-vscroll nil <span style="color: #009c8f;">"Nicer scrolling without random half-screen jumps"</span><span style="color: #009c8f;">)</span>
<span id="coderef-rc-emacs-scroll-conservatively" class="coderef-off"><span class="linenr">72: </span><span style="color: #009c8f;">(</span>scroll-conservatively 100000 <span style="color: #009c8f;">"Dont jump to center"</span><span style="color: #009c8f;">)</span></span>
<span class="linenr">73: </span><span style="color: #009c8f;">(</span>scroll-margin 1 <span style="color: #009c8f;">"Start scrolling when marker almost at top/bottom"</span><span style="color: #009c8f;">)</span>
<span class="linenr">74: </span><span style="color: #009c8f;">(</span>scroll-preserve-screen-position 'always <span style="color: #009c8f;">"Point doesn't jumping around"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
The next variable speeds up a scrolling in the large buffers. The nice fonts
and fontification<sup><a id="fnr.fontification" class="footref" href="#fn.fontification" role="doc-backlink">9</a></sup> may not show immediately if I scrolling fast,
but I prefer to trade this with a speed of scrolling.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">75: </span><span style="color: #009c8f;">(</span>fast-but-imprecise-scrolling t <span style="color: #009c8f;">"More rapid scrolling through unfontified regions"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
I prefer to scroll buffer only if there is one line (or one character) before
the buffer boundaries, not 5 or 10. Also, I don't like when cursor jumps to
the center of the screen, so the next lines and the line
<a href="#coderef-rc-emacs-scroll-conservatively" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-scroll-conservatively');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-scroll-conservatively');">72</a> do the necessary trick:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">76: </span><span style="color: #009c8f;">(</span>hscroll-margin 1 <span style="color: #009c8f;">"Reduce margin triggering hscrolling"</span><span style="color: #009c8f;">)</span>
<span class="linenr">77: </span><span style="color: #009c8f;">(</span>hscroll-step 1 <span style="color: #009c8f;">"Slower horizontal scrolling"</span><span style="color: #009c8f;">)</span>
<span class="linenr">78: </span><span style="color: #009c8f;">(</span>scroll-step 1 <span style="color: #009c8f;">"Default scroll step"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Then there are some settings for middle buttom + ThinkPad's trackpoint (or
mouse) scrolling come in place. I don't use this type of scrolling most of the
time (I prefer <code>C-v</code> and <code>M-v</code> to scroll through big buffer) but it is nice to
have these settings:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">79: </span><span style="color: #009c8f;">(</span>mouse-wheel-scroll-amount '<span style="color: #ad8900;">(</span>1<span style="color: #ad8900;">)</span> <span style="color: #009c8f;">"Mouse scroll moves 1 line at a time"</span><span style="color: #009c8f;">)</span>
<span class="linenr">80: </span><span style="color: #009c8f;">(</span>mouse-wheel-scroll-amount-horizontal 2 <span style="color: #009c8f;">"Horizontal scroll speed by mouse"</span><span style="color: #009c8f;">)</span>
<span class="linenr">81: </span><span style="color: #009c8f;">(</span>mouse-wheel-progressive-speed nil <span style="color: #009c8f;">"Don't use progressive speed when scrolling with mouse"</span><span style="color: #009c8f;">)</span>
<span class="linenr">82: </span><span style="color: #009c8f;">(</span>pixel-scroll-precision-mode t <span style="color: #009c8f;">"Enable pixel-precision scrolling"</span><span style="color: #009c8f;">)</span>
<span class="linenr">83: </span><span style="color: #009c8f;">(</span>pixel-scroll-precision-interpolate-page t <span style="color: #009c8f;">"For pixel-precision scrolling"</span><span style="color: #009c8f;">)</span>
<span class="linenr">84: </span><span style="color: #009c8f;">(</span>pixel-scroll-precision-use-momentum t <span style="color: #009c8f;">"For large buffers"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
With this settings when I scroll through the buffer with trackpoint or
with a mouse wheelÂ â€” I see the smooth and nice scrolling.
</p>

<p>
The next big chunk of variables related to the user interface. First,
the line and column numbers are enabled in the modeline:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">85: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">UI tweaks</span>
<span class="linenr">86: </span><span style="color: #009c8f;">(</span>line-number-mode t <span style="color: #009c8f;">"Show line number in modeline"</span><span style="color: #009c8f;">)</span>
<span class="linenr">87: </span><span style="color: #009c8f;">(</span>column-number-mode t <span style="color: #009c8f;">"Show column number in modeline"</span><span style="color: #009c8f;">)</span>
<span class="linenr">88: </span><span style="color: #009c8f;">(</span>column-number-indicator-zero-based nil <span style="color: #009c8f;">"Start column number from 1"</span><span style="color: #009c8f;">)</span>
<span class="linenr">89: </span><span style="color: #009c8f;">(</span>size-indication-mode t <span style="color: #009c8f;">"Show file size in modeline"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Note, the column numbering starts from 1 not from 0 (default value).
Also, the size of an opened file is displayed on the modeline. And a
current position in buffer in percents:
</p>


<div class="figure">
<p><img src="/assets/static/modeline-size.png" alt="Screenshot of Emacs modeline with the next items: encoding, file name, percent of passed lines in the buffer, file size and a line/column values" align="center" width="50%" />
</p>
</div>

<p>
The next variable is unnecessary in my WM<sup><a id="fnr.stumpwm.6" class="footref" href="#fn.stumpwm" role="doc-backlink">6</a></sup>, but I kept it just in
case. It sets the title of the Emacs frame and in WM/DE with visible window
title it can be useful.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">90: </span><span style="color: #009c8f;">(</span>frame-title-format '<span style="color: #ad8900;">(</span><span style="color: #009c8f;">"(%+) %b on %F"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here the same format as for <code>mode-line-format</code><sup><a id="fnr.mode-line-format" class="footref" href="#fn.mode-line-format" role="doc-backlink">10</a></sup> is used:
</p>
<ul class="org-ul">
<li><code>%+</code> is for buffer mode: <code>(*)</code> for modifed buffer, <code>(-)</code> for unmodified buffer, <code>(%)</code>
for read-only buffer and <code>(%*)</code> for read-only modified buffer (if buffer was
changed and then <code>Scroll Lock</code> is pressed to make the buffer read-only)</li>
<li><code>%b</code> is for buffer name</li>
<li><code>%F</code> is for name of the frame (usually it is equals to "Emacs").</li>
</ul>

<p>
For example for opened <code>rc-emacs.el</code> the <code>(-) rc-emacs.el on Emacs</code> will be
displayed, for buffer with interactive help the <code>(%) *Help* on Emacs</code> will be
displayed.
</p>

<p>
The next variable is set to <code>t</code> to display real filenames and use real path when
visiting a file via symlink. I heavily use <code>stow</code><sup><a id="fnr.stow" class="footref" href="#fn.stow" role="doc-backlink">11</a></sup> for my dotfiles, so when
I open <code>~/.profile</code> I want to have <code>~/git_repos/dotfiles/cmd/.profile</code> opened,
with the corresponding path set as the working path for buffer (see the
<code>(file-name-directory buffer-file-name)</code> output).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">91: </span><span style="color: #009c8f;">(</span>find-file-visit-truename t <span style="color: #009c8f;">"Show real filename when visit symlink"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
When Emacs plugins are byte-compiling, then sometimes a lot of warnings will
be displayed in the popped up buffer. This looks distracting and doesn't help
because I wouldn't manually edit each plugin to get rid of this buffer. So, I
disabled this behaviourÂ â€” only the emergency errors will be displayed:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">92: </span><span style="color: #009c8f;">(</span>warning-minimum-level <span style="color: #53676d; font-weight: bold;">:emergency</span> <span style="color: #009c8f;">"Don't show warnings in buffer"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
All other errors/warnings with the level less than "emergency" will be logged
into the <code>*Warnings*</code> buffer, so they will not be completely lost.
</p>

<p>
Next three lines are used to speed up Emacs GUI a bit: by displaying a cursor,
a selection and a current line highlight only for the window in use:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">93: </span><span style="color: #009c8f;">(</span>hl-line-sticky-flag nil <span style="color: #009c8f;">"Don't show hl-line on unfocused windows"</span><span style="color: #009c8f;">)</span>
<span class="linenr">94: </span><span style="color: #009c8f;">(</span>cursor-in-non-selected-windows nil <span style="color: #009c8f;">"Don't render cursor in inactive window"</span><span style="color: #009c8f;">)</span>
<span class="linenr">95: </span><span style="color: #009c8f;">(</span>highlight-nonselected-windows nil <span style="color: #009c8f;">"Don't render selection in inactive window"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
The next line appeared in the configuration since the Emacs on the one of my
machines (with Gentoo) didn't display entered keychords immediately below the
modeline:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">96: </span><span style="color: #009c8f;">(</span>echo-keystrokes 0.01 <span style="color: #009c8f;">"Show keystroke in echo area as fast as possible"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Then the specific for X server settings are coming:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span id="coderef-rc-emacs-no-stretch-cursor" class="coderef-off"><span class="linenr">97: </span><span style="color: #009c8f;">(</span>x-stretch-cursor nil <span style="color: #009c8f;">"Do not stretch cursor for wide characters"</span><span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-enable-clipboard" class="coderef-off"><span class="linenr">98: </span><span style="color: #009c8f;">(</span>select-enable-clipboard t <span style="color: #009c8f;">"Copy/paste uses clipboard"</span><span style="color: #009c8f;">)</span></span>
</pre>
</div>

<p>
By default Emacs stretches cursor if character in buffer (for example,
tabulation) is wider than usual character (for example, letter). I found this
ugly and disabled such behavior (see the line <a href="#coderef-rc-emacs-no-stretch-cursor" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-no-stretch-cursor');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-no-stretch-cursor');">97</a>).
</p>


<div class="figure">
<p><img src="/assets/static/x-stretch-cursor.png" alt="On the left: the cursor has width equals to the tabulation width with the default x-stretch-cursor value; on the right: the cursor has usual width with x-stretch-cursor equals to nil." align="center" width="50%" />
</p>
<p class="fignum"><i>The default behavior on the left, the x-stretch-cursor set to nil on the right</i></p>
</div>

<p>
On the line <a href="#coderef-rc-emacs-enable-clipboard" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-enable-clipboard');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-enable-clipboard');">98</a> I set the X clipboard in use when user
copies and pastes within Emacs with <code>C-w</code>, <code>M-w</code>, <code>C-y</code> or <code>M-y</code>. So, I can copy some
text in browser and yank it in Emacs as usual.
</p>

<p>
The last two lines setup two things for minibuffer:
</p>
<ol class="org-ol">
<li>Enable recrursive minibuffers, so I can do <code>M-x</code> while I'm already doing <code>M-x</code></li>
<li>Hide commands which are unacceptable for current mode, so they are not
displayed in completion results.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr"> 99: </span><span style="color: #009c8f;">(</span>enable-recursive-minibuffers t<span style="color: #009c8f;">)</span>
<span class="linenr">100: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Emacs 28 and newer: Hide commands in M-x which do not work in the current</span>
<span class="linenr">101: </span><span style="color: #909995;">;; </span><span style="color: #909995;">mode.</span>
<span class="linenr">102: </span><span style="color: #009c8f;">(</span>read-extended-command-predicate #'command-completion-default-include-p<span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-utf8-variables" class="outline-3">
<h3 id="rc-emacs-utf8-variables">UTF8-related variables</h3>
<div class="outline-text-3" id="text-rc-emacs-utf8-variables">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">104: </span><span style="color: #909995;">;;;;;;;;;;;;;</span>
<span class="linenr">105: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">UTF8: ;;;</span>
<span class="linenr">106: </span><span style="color: #909995;">;;;;;;;;;;;;;</span>
<span class="linenr">107: </span>  <span style="color: #009c8f;">(</span>buffer-file-coding-system 'utf-8-unix <span style="color: #009c8f;">"Preferrable file coding system"</span><span style="color: #009c8f;">)</span>
<span class="linenr">108: </span>  <span style="color: #009c8f;">(</span>locale-coding-system 'utf-8 <span style="color: #009c8f;">"Code system for system messages"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here I just specify UTF-8 as my default character encoding.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-history-variables" class="outline-3">
<h3 id="rc-emacs-history-variables">History preservation variables</h3>
<div class="outline-text-3" id="text-rc-emacs-history-variables">
<p>
The Emacs has an <b>extremely rich</b> capabilities to save and restore it's state
between sessions. I can reboot the computer, open a Emacs frame after it and
all my file buffers and frames will be restored. All entered commands and
recently visited files also will not be lost.
</p>

<p>
I'll describe most of the necessary settings in the <a href="#rc-emacs-save-restore">"Save and restore
session"</a> section. And here I'll cover just a three options:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">110: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">111: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Files/history save/restore ;;;</span>
<span class="linenr">112: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">113: </span>  <span style="color: #009c8f;">(</span>delete-old-versions t <span style="color: #009c8f;">"Delete old backup versions"</span><span style="color: #009c8f;">)</span>
<span class="linenr">114: </span>  <span style="color: #009c8f;">(</span>history-length 100 <span style="color: #009c8f;">"Minibuffer history length"</span><span style="color: #009c8f;">)</span>
<span class="linenr">115: </span>  <span style="color: #009c8f;">(</span>save-place-mode 1 <span style="color: #009c8f;">"Save last place in file"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<ol class="org-ol">
<li>I prefer to delete numbered file backups without any question. Only
one backup is enough for me. Obviously, all important files will be
backed up via <i>other ways</i>.</li>
<li>The minibuffer history will remember 100 entered commands.</li>
<li>Enables <code>save-place-mode</code> globally. This mode enables saving cursor position
for each visited file. Then, if user opens this file again, the cursor will
be set to the same position, not to the start of the file.</li>
</ol>
</div>
</div>
<div id="outline-container-rc-emacs-windows-variables" class="outline-3">
<h3 id="rc-emacs-windows-variables">Windows-related variable</h3>
<div class="outline-text-3" id="text-rc-emacs-windows-variables">
<p>
This section is about Emacs windows ðŸ™‚. Here just the one variable in use:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">117: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">118: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Windows configuration ;;;</span>
<span class="linenr">119: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">120: </span>  <span style="color: #009c8f;">(</span>window-combination-resize t <span style="color: #009c8f;">"Take new window space from ALL other windows, not the current one"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
By default this variable is set to <code>nil</code>, so after creation of 3 horizontal
windows the frame will look like this:
</p>


<div class="figure">
<p><img src="/assets/static/window-combination-resize-nil.png" alt="Three horizontal windows, one takes 1/2 vertical space of frame, the two others uses 1/4 of frame each." align="center" width="90%" />
</p>
<p class="fignum"><i>3 horizontal windows in Emacs frame with window-combination-resize set to nil</i></p>
</div>

<p>
Here, after creation of second window it will take the 1/2 of vertical
space of Emacs frame. And the first window will take the 1/2 of
vertical space too. So the newly created window take half of vertical
space from the first sole window.
</p>

<p>
After creation of third window it will take 1/2 of vertical space of
the <b>second</b> window! So at the end the 1st window will take 1/2 of
frame's vertical space, and the 2nd, and 3rd window will both take 1/4
of vertical space of Emacs frame.
</p>

<p>
This is not that I like. The vertical space on the "modern" display with 16:9
ratio is expensive and I want to use it more accurate. So the variable
<code>window-combination-resize</code> will change how the vertical space is used when new
windows are created. If it is set to <code>t</code>, then each created window will take
vertical space from the whole Emacs frame. So, if I create 3 windows, then
each will use 1/3 of vertical space of the frame:
</p>


<div class="figure">
<p><img src="/assets/static/window-combination-resize-t.png" alt="Three horizontal windows, each takes 1/3 vertical space of the frame." align="center" width="90%" />
</p>
<p class="fignum"><i>3 horizontal windows in Emacs frame with window-combination-resize set to t</i></p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-isearch-settings" class="outline-3">
<h3 id="rc-emacs-isearch-settings">ISearch settings</h3>
<div class="outline-text-3" id="text-rc-emacs-isearch-settings">
<p>
The ISearch<sup><a id="fnr.isearch" class="footref" href="#fn.isearch" role="doc-backlink">12</a></sup> is that in use when user is searching for some
text with <code>C-s</code> (or <code>C-r</code>, etc) keys.
</p>

<p>
Here I tweak not so much configuration variables:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">122: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">123: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">isearch configuration ;;;</span>
<span class="linenr">124: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">125: </span>  <span style="color: #009c8f;">(</span>isearch-lazy-count t <span style="color: #009c8f;">"Show size of search results"</span><span style="color: #009c8f;">)</span>
<span class="linenr">126: </span>  <span style="color: #009c8f;">(</span>lazy-count-prefix-format <span style="color: #009c8f;">"(%s/%s) "</span> <span style="color: #009c8f;">"Format of search results"</span><span style="color: #009c8f;">)</span>
<span class="linenr">127: </span>  <span style="color: #009c8f;">(</span>lazy-highlight-initial-delay 0 <span style="color: #009c8f;">"No delay before highlight search matches"</span><span style="color: #009c8f;">)</span>
<span class="linenr">128: </span>  <span style="color: #009c8f;">(</span>isearch-allow-scroll t <span style="color: #009c8f;">"Allow scrolling while searching"</span><span style="color: #009c8f;">)</span>
<span class="linenr">129: </span>  <span style="color: #009c8f;">(</span>isearch-allow-motion t <span style="color: #009c8f;">"Allow movement commands while searching"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Just enable showing count of search results in form of <code>number of currently
selected item</code> / <code>overall count of found items</code>:
</p>


<div class="figure">
<p><img src="/assets/static/isearch.png" alt="Isearch prompt in minibuffer with the next text: &quot;(6/32) I-search: Emacs&quot;." align="center" width="50%" />
</p>
</div>

<p>
Also, I enable scrolling/moving via <code>M-&gt;</code> or <code>M-&lt;</code> commands while searching, so
search will not be interrupted by these movements. And remove delay before
highlighting search results in buffer.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-buffer-variables" class="outline-3">
<h3 id="rc-emacs-buffer-variables">Buffer-related variables</h3>
<div class="outline-text-3" id="text-rc-emacs-buffer-variables">
<p>
Buffer-related configuration starts from two variables:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">131: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">132: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Buffers configuration ;;;</span>
<span class="linenr">133: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">134: </span>  <span style="color: #009c8f;">(</span>global-auto-revert-non-file-buffers t <span style="color: #009c8f;">"Auto revert non-file buffers"</span><span style="color: #009c8f;">)</span>
<span class="linenr">135: </span>  <span style="color: #009c8f;">(</span>switch-to-buffer-obey-display-actions t <span style="color: #009c8f;">"Don't distuingish automatic and manual window switching"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
First variable enables auto-reverting on buffers where no files are
openedÂ â€” for example on Dired buffers. So, if I open some catalog in
buffer and then add or delete some filesÂ â€” the changes will be
immediately shown in the corresponding Dired buffer.
</p>

<p>
This feature work in conjunction with <code>global-auto-revert-mode</code> which is enabled
below, in other lines of the <code>rc-emacs.el</code>.
</p>

<p>
Second variable was taken from the <a href="https://www.masteringemacs.org/article/demystifying-emacs-window-manager">"Demystifying Emacsâ€™s Window Manager"</a> post:
</p>

<blockquote>
<p>
By default Emacs distinguishes between automatic and manual window switching.
If you effect a window switch yourself with C-x b, itâ€™s manualÂ â€” and exempt
from any display action rules you create yourself.
</p>
</blockquote>

<p>
Then, the configuration of IBuffer starts. The IBuffer shows a list of
Emacs buffers in a separate window. And it allows to group different
buffers by name or by mode, etc. This is very useful to quickly find
by eyes the necessary buffer and can be configured with the next
lines:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">136: </span><span style="color: #009c8f;">(</span>ibuffer-saved-filter-groups
<span class="linenr">137: </span> <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">quote</span> <span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span><span style="color: #009c8f;">"default"</span>
<span class="linenr">138: </span>          <span style="color: #489100;">(</span><span style="color: #009c8f;">"Org"</span> <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">or</span>
<span class="linenr">139: </span>                  <span style="color: #0072d4;">(</span>mode . org-mode<span style="color: #0072d4;">)</span>
<span class="linenr">140: </span>                  <span style="color: #0072d4;">(</span>name . <span style="color: #009c8f;">"^\\*Org Src"</span><span style="color: #0072d4;">)</span>
<span class="linenr">141: </span>                  <span style="color: #0072d4;">(</span>name . <span style="color: #009c8f;">"^\\*Org Agenda\\*$"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #489100;">)</span>
<span class="linenr">142: </span>          <span style="color: #489100;">(</span><span style="color: #009c8f;">"LaTeX"</span> <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">or</span>
<span class="linenr">143: </span>                    <span style="color: #0072d4;">(</span>mode . LaTeX-mode<span style="color: #0072d4;">)</span>
<span class="linenr">144: </span>                    <span style="color: #0072d4;">(</span>mode . bibtex-mode<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #489100;">)</span>
<span class="linenr">145: </span>          <span style="color: #489100;">(</span><span style="color: #009c8f;">"C"</span> <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">or</span>
<span class="linenr">146: </span>                <span style="color: #0072d4;">(</span>mode . c-mode<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #489100;">)</span>
<span class="linenr">147: </span>          <span style="color: #489100;">(</span><span style="color: #009c8f;">"LISP"</span> <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">or</span>
<span class="linenr">148: </span>                   <span style="color: #0072d4;">(</span>mode . emacs-lisp-mode<span style="color: #0072d4;">)</span>
<span class="linenr">149: </span>                   <span style="color: #0072d4;">(</span>mode . ielm-mode<span style="color: #0072d4;">)</span>
<span class="linenr">150: </span>                   <span style="color: #0072d4;">(</span>name . <span style="color: #009c8f;">"^\\*scratch\\*$"</span><span style="color: #0072d4;">)</span>
<span class="linenr">151: </span>                   <span style="color: #0072d4;">(</span>mode . lisp-mode<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #489100;">)</span>
<span class="linenr">152: </span>          <span style="color: #489100;">(</span><span style="color: #009c8f;">"Dired"</span> <span style="color: #ad8900;">(</span>mode . dired-mode<span style="color: #ad8900;">)</span><span style="color: #489100;">)</span>
<span class="linenr">153: </span>          <span style="color: #489100;">(</span><span style="color: #009c8f;">"Term"</span> <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">or</span>
<span class="linenr">154: </span>                   <span style="color: #0072d4;">(</span>mode . term-mode<span style="color: #0072d4;">)</span>
<span class="linenr">155: </span>                   <span style="color: #0072d4;">(</span>mode . eshell-mode<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #489100;">)</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here I define the next groups:
</p>
<ul class="org-ul">
<li>"Org"Â â€” the buffers with enabled OrgMode, and Org Babel related
buffer, and Agenda buffers will be listed in this group.</li>
<li>"LaTeX"Â â€” the group for LaTeX-related buffers.</li>
<li>"C"Â â€” for C sources. The <code>*.c</code> and <code>*.h</code> files will be listed here.</li>
<li>"LISP"Â â€” group for different Lisp-related buffers:
<ul class="org-ul">
<li>Buffers with Emacs Lisp files (<code>emacs-lisp-mode</code> enabled)</li>
<li>Buffer(s) with IELM<sup><a id="fnr.ielm" class="footref" href="#fn.ielm" role="doc-backlink">13</a></sup>.</li>
<li><code>*scratch*</code> buffer with the <code>lisp-interaction-mode</code> enabled in it.</li>
<li>Buffers with <code>lisp-mode</code> enabled (for <code>*.lisp</code> files with Common Lisp sources)</li>
</ul></li>
<li>"Dired"Â â€” for different Dired buffers with opened directories.</li>
<li>"Term"Â â€” group for eshell buffers or <code>ansi-term</code> buffers.</li>
</ul>

<p>
As visible from the code above, I distinguish buffers by its name or by
enabled mode.
</p>

<p>
The resulting IBuffer's window will look like this (but without the icons,
they are configured separately):
</p>


<div class="figure">
<p><img src="/assets/static/ibuffer.png" alt="Opened IBuffer buffer in the Emacs. There are grouped list of opened buffers." align="center" width="90%" />
</p>
</div>

<p>
Also, I hide some buffers from IBuffer with the next variable:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">156: </span><span style="color: #009c8f;">(</span>ibuffer-never-show-predicates '<span style="color: #ad8900;">(</span><span style="color: #009c8f;">"*Messages\\*"</span> <span style="color: #009c8f;">"*Help\\*"</span> <span style="color: #009c8f;">"*Quick Help\\*"</span>
<span class="linenr">157: </span>                                 <span style="color: #009c8f;">"*Quail Completions\\*"</span> <span style="color: #009c8f;">"*Warnings\\*"</span>
<span class="linenr">158: </span>                                 <span style="color: #009c8f;">"*Calc Trail\\*"</span> <span style="color: #009c8f;">"*Compile-Log\\*"</span>
<span class="linenr">159: </span>                                 <span style="color: #009c8f;">"*Async-native-compile-log\\*"</span>
<span class="linenr">160: </span>                                 <span style="color: #009c8f;">"*Native-compile-log\\*"</span>
<span class="linenr">161: </span>                                 <span style="color: #009c8f;">"*Calculator\\*"</span> <span style="color: #009c8f;">"*Calendar\\*"</span>
<span class="linenr">162: </span>                                 <span style="color: #009c8f;">"*Warning\\*"</span> <span style="color: #009c8f;">"*prodigy.*"</span> <span style="color: #009c8f;">"magit:.*"</span>
<span class="linenr">163: </span>                                 <span style="color: #009c8f;">"*Org Help\\*"</span> <span style="color: #009c8f;">"*info\\*"</span>
<span class="linenr">164: </span>                                 <span style="color: #009c8f;">"*Flycheck error messages\\*"</span> <span style="color: #009c8f;">"TAGS"</span>
<span class="linenr">165: </span>                                 <span style="color: #009c8f;">"*Shell Command Output\\*"</span>
<span class="linenr">166: </span>                                 <span style="color: #009c8f;">"*Async Shell Command\\*"</span>
<span class="linenr">167: </span>                                 <span style="color: #009c8f;">"*Completions\\*"</span> <span style="color: #009c8f;">"^magit.+"</span> <span style="color: #009c8f;">"diary"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-misc" class="outline-3">
<h3 id="rc-emacs-misc">Miscellaneous configuration variables</h3>
<div class="outline-text-3" id="text-rc-emacs-misc">
<p>
Some variables don't match with any aforementioned sections. There are:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">169: </span><span style="color: #909995;">;;;;;;;;;;;;</span>
<span class="linenr">170: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Misc ;;;</span>
<span class="linenr">171: </span><span style="color: #909995;">;;;;;;;;;;;;</span>
<span id="coderef-rc-emacs-epg-mode" class="coderef-off"><span class="linenr">172: </span>  <span style="color: #009c8f;">(</span>epg-pinentry-mode 'loopback<span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-follow-symlinks" class="coderef-off"><span class="linenr">173: </span>  <span style="color: #009c8f;">(</span>vc-follow-symlinks t <span style="color: #009c8f;">"Do not ask when follow symlink"</span><span style="color: #009c8f;">)</span></span>
<span class="linenr">174: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Disable writing custom options to the end of ~/.emacs</span>
<span id="coderef-rc-emacs-custom-tmp" class="coderef-off"><span class="linenr">175: </span>  <span style="color: #009c8f;">(</span>custom-file <span style="color: #ad8900;">(</span>make-temp-file <span style="color: #009c8f;">"emacs-custom-"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-ad-redefinition" class="coderef-off"><span class="linenr">176: </span>  <span style="color: #009c8f;">(</span>ad-redefinition-action 'accept <span style="color: #009c8f;">"Turn off defadvice warnings during startup"</span><span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-load-prefer-newer" class="coderef-off"><span class="linenr">177: </span>  <span style="color: #009c8f;">(</span>load-prefer-newer t <span style="color: #009c8f;">"Prefer newer .el file"</span><span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-confirm-kill-proc" class="coderef-off"><span class="linenr">178: </span>  <span style="color: #009c8f;">(</span>confirm-kill-processes nil <span style="color: #009c8f;">"Kil subprocesses on exit wout confirmation"</span><span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-large-file-warn" class="coderef-off"><span class="linenr">179: </span>  <span style="color: #009c8f;">(</span>large-file-warning-threshold <span style="color: #ad8900;">(</span>* 100 1024 1024<span style="color: #ad8900;">)</span> <span style="color: #009c8f;">"Large file is file &gt;= 100 MB"</span><span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-sentence-one-space" class="coderef-off"><span class="linenr">180: </span>  <span style="color: #009c8f;">(</span>sentence-end-double-space nil <span style="color: #009c8f;">"Sentence ends with period and one space after"</span><span style="color: #009c8f;">)</span></span>
</pre>
</div>

<p>
The line <a href="#coderef-rc-emacs-epg-mode" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-epg-mode');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-epg-mode');">172</a> necessary to use Emacs as a pinentry for GnuPG.
</p>

<p>
When I visit some symlink, which links to the dotfile from my repository, then
Emacs by default asks do I really want to follow this symlink? Of course,
every time I answer <code>y</code> and to get rid of that unnecessary for me question, the
line <a href="#coderef-rc-emacs-follow-symlinks" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-follow-symlinks');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-follow-symlinks');">173</a> was added.
</p>

<p>
When I (rarely) used <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Easy-Customization.html">Easy Customization</a> buffer, then all made changes were
saved right into the <code>~/.emacs</code> by default. This behaviour creates a lot of mess
in my precious configuration because different changes for different plugins
lay in the same place, not in my <code>rc-name-of-plugin.el</code> files. To avoid it, I
force Emacs to store customization in the temporary <code>/tmp/emacs-custom-XXXXX</code>
files at the line <a href="#coderef-rc-emacs-custom-tmp" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-custom-tmp');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-custom-tmp');">175</a>.
</p>

<p>
After end of customization I just open the created temporary file
and move added changes to the corresponding <code>use-package</code> macro in my
files. The created temporary files will be removed by FreeBSD during
rebootÂ â€” because the <code>clear_tmp_enable</code> is set to <code>"YES"</code> in the
<code>/etc/rc.conf</code>.
</p>

<p>
The <code>defadvice</code> was marked as obsolete since <a href="https://cgit.git.savannah.gnu.org/cgit/emacs.git/tree/etc/NEWS?h=emacs-30#n2121">Emacs 30.1 release</a>. So, while I was
moving from <code>defadvice</code> to <code>advice-add</code><sup><a id="fnr.advice-add" class="footref" href="#fn.advice-add" role="doc-backlink">14</a></sup>, I added line <a href="#coderef-rc-emacs-ad-redefinition" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-ad-redefinition');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-ad-redefinition');">176</a>
to get rid of warnings about using the obsolete function.
</p>

<p>
The variable on the line <a href="#coderef-rc-emacs-load-prefer-newer" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-load-prefer-newer');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-load-prefer-newer');">177</a> was added since I
started to byte-compile my configuration. When it is set to <code>t</code> the Emacs will
choose the newest file between the given <code>*.el</code> and <code>*.elc</code> file.
</p>

<p>
The line <a href="#coderef-rc-emacs-confirm-kill-proc" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-confirm-kill-proc');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-confirm-kill-proc');">178</a> is necessary since I use Emacs as a
system service. If some process, like VNC client, is running under the Emacs
and I forgot to shutdown it and try to stop <code>emacsd</code> service, then Emacs daemon
will fail to stop in usual way. This is happens because Emacs asks user about
killing the subprocess that is still running, but any interaction with user is
impossible during the service (or system) shutdown. So after some waiting
<code>emacsd</code> will be killed by rc.d framework. To avoid this, the aforementioned
line was added, so Emacs will kill subprocesses during shutdown procedure by
itself, without asking the user.
</p>

<p>
The line <a href="#coderef-rc-emacs-large-file-warn" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-large-file-warn');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-large-file-warn');">179</a> was added since I started to use Emacs to
view PDF, EPUB and other files. By default, Emacs asks me every time when I
tried to open file with size greater than 10Â MiB. Obviously, some PDF files
exceeds this restriction and I need to type <code>y</code> every time. So, I raised the
minimal size of the file, which will trigger the warning, to the 100Â Mb.
</p>

<p>
And at the end, the line <a href="#coderef-rc-emacs-sentence-one-space" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-sentence-one-space');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-sentence-one-space');">180</a> changes the behaviour
of commands to move between sentences and manipulate with sentences:
</p>
<ul class="org-ul">
<li><code>M-a</code>: move to the start of the sentence.</li>
<li><code>M-e</code>: move the end of the sentence.</li>
<li><code>M-k</code>: kill letters between the current cursor position and the end of the
current sentence.</li>
<li><code>C-x DEL</code>: kill letters between the current cursor poisiton and the start of
the current sentence.</li>
</ul>

<p>
By default, these commands treat dot followed by <b>two</b> spaces as the end of the
sentence. With the variable at the line <a href="#coderef-rc-emacs-sentence-one-space" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-sentence-one-space');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-sentence-one-space');">180</a> set to
<code>nil</code>, the Emacs start to treat dot followed by <b>one</b> space as the end of the
sentence. This is more convenient, I think.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-freebsd" class="outline-3">
<h3 id="rc-emacs-freebsd">FreeBSD specific</h3>
<div class="outline-text-3" id="text-rc-emacs-freebsd">
<p>
The latest customization variable in this section is the
FreeBSD-specific one. In the most of the Unix, and GNU/Linux, and
SystemD/Linux distributions the Emacs in repositories was built with
the support of GTK+ toolkit.
</p>

<p>
In the FreeBSD and inside the <a href="https://i3wm.org/">i3wm</a> this causes an interesting problem.
When I try to use Compose key to type something like
Â«â€”â‡’â†’Â°â‚½â‚¬Â½Â»<sup><a id="fnr.compose-key" class="footref" href="#fn.compose-key" role="doc-backlink">15</a></sup> in the buffer, then I got the strange error
message: "&lt;Multi_key&gt; is undefined".
</p>

<p>
Solution is simple:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">182: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">183: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">FreeBSD-specific ;;;</span>
<span class="linenr">184: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">185: </span>  <span style="color: #009c8f;">(</span>x-gtk-use-native-input t <span style="color: #009c8f;">"Fix '&lt;Multi_key&gt; is undefined' on FreeBSD"</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Just one variable, specific for GTK toolkit fix the Compose key behaviour.
</p>

<p>
Since I started to use Poudriere<sup><a id="fnr.poudriere" class="footref" href="#fn.poudriere" role="doc-backlink">16</a></sup>, I immediately rebuilt Emacs with
the Athena toolkit and the problem disappeared by itself. I kept this line
just in case.
</p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-enable-custom-commands" class="outline-2">
<h2 id="rc-emacs-enable-custom-commands">Enable hidden commands</h2>
<div class="outline-text-2" id="text-rc-emacs-enable-custom-commands">
<p>
Let's switch from the variables to the Emacs Lisp code, which is also
configures Emacs.
</p>

<p>
There are some commands, which is disabled in Emacs (see the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Disabling-Commands.html">"22.14 Disabling
Commands"</a> in Emacs manual) by default, to protect the newbie users from
potentially destructive nature of these commands. I've enabled two of these
commands for myself:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">187: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">188: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">189: </span>
<span class="linenr">190: </span>  <span style="color: #53676d; font-weight: bold;">:config</span>
<span class="linenr">191: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">192: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Enable some commands ;;;</span>
<span class="linenr">193: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">194: </span>  <span style="color: #009c8f;">(</span>put 'list-threads 'disabled nil<span style="color: #009c8f;">)</span>
<span class="linenr">195: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Enable region narrowing</span>
<span class="linenr">196: </span>  <span style="color: #009c8f;">(</span>put 'narrow-to-region 'disabled nil<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here I enable <code>list-thread</code> to work with Emacs threads. And enable narrowing in
buffersÂ â€” a very useful feature to focus on some part of the code or text, for
example.
</p>

<p>
There are set of keybindings for narrowing which I use:
</p>

<table border="2" cellspacing="0" cellpadding="6" frame="void">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Keybinding</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">C-x n n</td>
<td class="org-left">Narrow to the selected region</td>
</tr>

<tr>
<td class="org-left">C-x n d</td>
<td class="org-left">Narrow to the current function</td>
</tr>

<tr>
<td class="org-left">C-x n w</td>
<td class="org-left">Widen the buffer</td>
</tr>
</tbody>
</table>

<p>
The first keybinding works in the next way. For example, I'm editing a file
with a lot of text inside:
</p>


<div class="figure">
<p><img src="/assets/static/buffer-wide.png" alt="Emacs buffer with a lot of OrgMode text inside, separated to paragraphs." align="center" width="90%" />
</p>
</div>

<p>
And I want to work <b>only</b> with second paragraph without messing with the other
text in the bufferÂ â€” I want to be able to see and to operate only with this
paragraph. So, I selected this paragraph and press <code>C-x n n</code> ("narrowing"
operation):
</p>


<div class="figure">
<p><img src="/assets/static/buffer-narrow.png" alt="Emacs narrowed buffer with only the text of second paragraph in it." align="center" width="90%" />
</p>
</div>

<p>
The rest of the text from the buffer become unaccesible and now I can
work only with selected region like there is no other text in the
file. The file contents on the disk is not changed with this action,
only the representation of the file in the Emacs buffer is changed.
All edits made inside this "narrowed" buffer will be saved in the
right place in the file and the invisible content will not be harmed.
</p>

<p>
To view the full contents of the file in the buffer againÂ â€” the keybinding <code>C-x
n w</code> ("widen" operation) exists.
</p>

<p>
The same technique is available for any programming language. With one
additionÂ â€” because Emacs understands that is the function in the
opened source code, I can easily narrow to the function, there is my
cursor located, by pressing <code>C-x n d</code>. And there is no need to select
the region with the function before narrowing it.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-utf8" class="outline-2">
<h2 id="rc-emacs-utf8">Enable UTF8 everywhere</h2>
<div class="outline-text-2" id="text-rc-emacs-utf8">
<p>
I struggled for some time with some tricky files that contain both UTF8 text
and some non-printed symbols. And I've added a lot of commands instructing
Emacs to use UTF-8 without any exceptions:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">198: </span><span style="color: #909995;">;;;;;;;;;;;;</span>
<span class="linenr">199: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">UTF8 ;;;</span>
<span class="linenr">200: </span><span style="color: #909995;">;;;;;;;;;;;;</span>
<span class="linenr">201: </span>  <span style="color: #009c8f;">(</span>prefer-coding-system 'utf-8<span style="color: #009c8f;">)</span>
<span class="linenr">202: </span>  <span style="color: #009c8f;">(</span>set-default-coding-systems 'utf-8<span style="color: #009c8f;">)</span>
<span class="linenr">203: </span>  <span style="color: #009c8f;">(</span>set-terminal-coding-system 'utf-8<span style="color: #009c8f;">)</span>
<span class="linenr">204: </span>  <span style="color: #009c8f;">(</span>set-keyboard-coding-system 'utf-8<span style="color: #009c8f;">)</span>
<span class="linenr">205: </span>  <span style="color: #009c8f;">(</span>set-language-environment <span style="color: #009c8f;">"UTF-8"</span><span style="color: #009c8f;">)</span>
<span class="linenr">206: </span>  <span style="color: #009c8f;">(</span>set-selection-coding-system 'utf-8<span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-remove-gui-annoyances" class="outline-2">
<h2 id="rc-emacs-remove-gui-annoyances">Remove annoying GUI elements</h2>
<div class="outline-text-2" id="text-rc-emacs-remove-gui-annoyances">
<p>
Emacs GUI shows an usual menu and a tool bar at the top of the it's
frames. I never used both of themÂ â€” the keybindings is enough for meÂ â€”
so I immediately turned off the menu and the tool bar:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">208: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">209: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Interface configuration ;;;</span>
<span class="linenr">210: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">211: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Turn off the panel</span>
<span class="linenr">212: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">when</span> <span style="color: #ad8900;">(</span>fboundp 'tool-bar-mode<span style="color: #ad8900;">)</span>
<span class="linenr">213: </span>    <span style="color: #ad8900;">(</span>tool-bar-mode -1<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">214: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Turn off the menu</span>
<span class="linenr">215: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">when</span> <span style="color: #ad8900;">(</span>fboundp 'menu-bar-mode<span style="color: #ad8900;">)</span>
<span class="linenr">216: </span>    <span style="color: #ad8900;">(</span>menu-bar-mode -1<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here the <code>fboundp</code> is used to determine is given mode symbol declared (so the
mode is enabled) or not? If the mode is enabled then it will be disabled with
the corresponding S-expression.
</p>

<p>
Also, I disabled the scroll bars.
</p>

<p>
Of course, the modern "War on Scrollbars" is the curse of the modern
IT. Scrollbars are extremely useful for determining the length of a
document or web page. And for determining your position within a text
document. And for accessibililty.
</p>

<p>
Literally, just look at the height and position of the scroll bar, and
you will know this information. Also, scrollbars are extremely useful
with the two-button mouse.
</p>

<p>
Nowadays, the scrollbars are nearly extinct because modern corporate
designers rather focused on the visually attractive interfaces than on
the interfaces, that are comfortable for users.
</p>

<p>
But, Emacs is an another beast from a more civilized era. It has a lot of
commands and hotkeys to browse the document structure and to jump between the
different parts of the document. Also it provides all necessary information in
the modelineÂ â€” current position in percents, and column, and line numbers:
</p>


<div class="figure">
<p><img src="/assets/static/modeline-size.png" alt="Screenshot of Emacs modeline with the next items: encoding, file name, percent of passed lines in the buffer, file size and a line/column values" align="center" width="50%" />
</p>
</div>

<p>
So, I disabled scrollbars in the Emacs and never looked back:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">217: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Disable scrollbars</span>
<span class="linenr">218: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">when</span> <span style="color: #ad8900;">(</span>fboundp 'scroll-bar-mode<span style="color: #ad8900;">)</span>
<span class="linenr">219: </span>  <span style="color: #ad8900;">(</span>scroll-bar-mode -1<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
The next fixed thing are a thicc vertical borders between windows:
</p>


<div class="figure">
<p><img src="/assets/static/thicc-borders.png" alt="Thicc vertical border between two Emacs windows in the frame." align="center" width="90%" />
</p>
</div>

<p>
The next code is successfully replaces them with a thin borders:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">220: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Setup borders width</span>
<span class="linenr">221: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">let</span> <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>no-border '<span style="color: #8762c6;">(</span>internal-border-width . 0<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">222: </span>  <span style="color: #ad8900;">(</span>add-to-list 'default-frame-alist no-border<span style="color: #ad8900;">)</span>
<span class="linenr">223: </span>  <span style="color: #ad8900;">(</span>add-to-list 'initial-frame-alist no-border<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>


<div class="figure">
<p><img src="/assets/static/thin-borders.png" alt="Thin vertical border netween two Emacs windows in the frame." align="center" width="90%" />
</p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-blinking-cursor" class="outline-2">
<h2 id="rc-emacs-blinking-cursor">Blinking cursor</h2>
<div class="outline-text-2" id="text-rc-emacs-blinking-cursor">
<p>
The next line just enables the blinking cursor:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">224: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Use blinking cursor</span>
<span class="linenr">225: </span><span style="color: #009c8f;">(</span>blink-cursor-mode t<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
For me it is simpler to visially find the cursor when it is blinking:
</p>


<div class="figure">
<p><img src="/assets/static/blinking-cursor.gif" alt="Blinking cursor in Emacs window" align="center" width="90%" />
</p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-newline-eof" class="outline-2">
<h2 id="rc-emacs-newline-eof">Newline at the end of the file</h2>
<div class="outline-text-2" id="text-rc-emacs-newline-eof">
<p>
Here I just instruct Emacs to insert the newline after the end of the file.
This will happen only when the file is about to be saved.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">226: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Insert newline at the EOF</span>
<span class="linenr">227: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setq-default</span> require-final-newline t<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
I enabled this just because I like to have newline at the EOF.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-gui-font" class="outline-2">
<h2 id="rc-emacs-gui-font">GUI font</h2>
<div class="outline-text-2" id="text-rc-emacs-gui-font">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">228: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Font for GUI</span>
<span class="linenr">229: </span><span style="color: #009c8f;">(</span>add-to-list 'default-frame-alist '<span style="color: #ad8900;">(</span>font . <span style="color: #009c8f;">"DejaVuSansMono-16"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
This line sets DejaVu Mono font as a default font for the any Emacs frame.
</p>

<p>
I tried some fonts:
</p>
<ul class="org-ul">
<li><a href="https://terminus-font.sourceforge.net/">Terminus</a></li>
<li><a href="https://www.myfonts.com/collections/droid-serif-pro-font-ascender-corp">Droid Sans Mono</a></li>
<li><a href="https://notofonts.github.io/">Noto Mono</a></li>
<li><a href="https://github.com/tonsky/FiraCode">Fira Code</a></li>
<li><a href="https://sourcefoundry.org/hack/">Hack</a></li>
<li>and some moreâ€¦</li>
</ul>

<p>
Finally, I found that these fonts are nice, but I'm fine with one
font, which comes "by default" with X server package from repositoryÂ â€”
<a href="https://dejavu-fonts.github.io/">DejaVu</a> font. It has a nice and a "letters-rich" Serif typeface, a Sans
and a Sans Mono typefaces which I use system-wide.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-hl-line" class="outline-2">
<h2 id="rc-emacs-hl-line">Enable line highlighting for some modes</h2>
<div class="outline-text-2" id="text-rc-emacs-hl-line">
<p>
The Emacs has a <code>hl-line-mode</code> minor mode to highlight current line in the
buffer. For example:
</p>


<div class="figure">
<p><img src="/assets/static/hl-line-mode.png" alt="Part of Emacs buffer with current line highlighted." align="center" width="90%" />
</p>
<p class="fignum"><i>Buffer with Emacs Lisp code with current line highlighted</i></p>
</div>

<p>
In some buffers this is useful to quickly find a cursor or a current line, in
some other buffers this is creates a visual mess. With the help of the next
lines I enable <code>hl-line-mode</code> for:
</p>
<ul class="org-ul">
<li><p>
IBufferÂ â€” to quickly find a current line with a buffer in the list of the
buffers:
</p>

<div class="figure">
<p><img src="/assets/static/ibuffer2.png" alt="Emacs ibuffer with selected init.el buffer" align="center" width="90%" />
</p>
<p class="fignum"><i>Emacs IBuffer window with cursor on the line with init.el buffer name</i></p>
</div></li>
<li><p>
Occur modeÂ â€”buffer with results of <code>M-x occur</code><sup><a id="fnr.occur" class="footref" href="#fn.occur" role="doc-backlink">17</a></sup>:
</p>

<div class="figure">
<p><img src="/assets/static/occur-mode-buffer.png" alt="Emacs window with Occur buffer opened. Buffer shows results with &quot;emacs&quot; string for another buffer." align="center" width="90%" />
</p>
<p class="fignum"><i>Results of search for "emacs" word in Occur</i></p>
</div></li>
<li><p>
Grep modeÂ â€” buffer with results of <code>M-x grep</code><sup><a id="fnr.grep" class="footref" href="#fn.grep" role="doc-backlink">18</a></sup>, <code>M-x rgrep</code>, etc:
</p>

<div class="figure">
<p><img src="/assets/static/grep-mode-buffer.png" alt="Emacs window with Grep buffer opened with results of search for &quot;occur&quot; string." align="center" width="90%" />
</p>
<p class="fignum"><i>Result of greping for "occur" word</i></p>
</div></li>
<li><p>
Buffer with list of packages (see the <code>M-x package-list-packages</code>):
</p>

<div class="figure">
<p><img src="/assets/static/package-list-packages.png" alt="Emacs buffer with a list of packages" align="center" width="90%" />
</p>
<p class="fignum"><i>Opened list of packages for Emacs</i></p>
</div></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">230: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Use hl-line-mode in some buffers</span>
<span class="linenr">231: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">dolist</span> <span style="color: #ad8900;">(</span>mode '<span style="color: #0072d4;">(</span>ibuffer-mode-hook
<span class="linenr">232: </span>                occur-mode-hook
<span class="linenr">233: </span>                grep-mode-hook
<span class="linenr">234: </span>                package-menu-mode-hook<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">235: </span>  <span style="color: #ad8900;">(</span>add-hook mode <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #8762c6;">()</span> <span style="color: #8762c6;">(</span>hl-line-mode 1<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Of course, I'm using <code>hl-line-mode</code> for other various major modes, especially
for programming-related modes. But I'll cover this part of configuration in
other blog posts, because corresponding Emacs Lisp lines not related to the
<i>common</i> configuration.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-backup-files" class="outline-2">
<h2 id="rc-emacs-backup-files">Backup files</h2>
<div class="outline-text-2" id="text-rc-emacs-backup-files">
<p>
By default Emacs creates backup for opened file in the current catalog. This
behaviour creates a lot of <code>filename~</code> files inside a lot of directories, so
some users completely disabling this feature.
</p>

<p>
But I found this feature usefulÂ â€” sometimes it saves my texts and edits. For
example, when I completely messed with my configuration while experimenting,
killed the Emacs daemon with <code>SIGKILL</code> and â€¦ found that I forgot to save my
writings in another buffer. The backup file, created by Emacs before, saved me
in these situations!
</p>

<p>
So, with the help of the next lines, I created a special catalog for
backups (in the <code>~/.emacs.d/backups/</code>, if it doesn't exists) and the all
backup files are saved right in this directory:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">237: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">238: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Backups/autorevert ;;;</span>
<span class="linenr">239: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">240: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Save all backups to "~/.emacs.d/backups/"</span>
<span class="linenr">241: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">when</span> <span style="color: #ad8900;">(</span>not <span style="color: #0072d4;">(</span>file-directory-p <span style="color: #009c8f;">"~/.emacs.d/backups"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">242: </span>    <span style="color: #ad8900;">(</span>make-directory <span style="color: #009c8f;">"~/.emacs.d/backups"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">243: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">if</span> <span style="color: #ad8900;">(</span>file-directory-p <span style="color: #009c8f;">"~/.emacs.d/backups"</span><span style="color: #ad8900;">)</span>
<span class="linenr">244: </span>      <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> backup-directory-alist '<span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span><span style="color: #009c8f;">"."</span> . <span style="color: #009c8f;">"~/.emacs.d/backups"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-autosave-files" class="outline-2">
<h2 id="rc-emacs-autosave-files">Autosave files</h2>
<div class="outline-text-2" id="text-rc-emacs-autosave-files">
<p>
Also, Emacs creates a special <i>autosave</i> files for each opened, edited and not
saved file. By default, these files also lies in the working directory and
named like <code>#filename#</code>. Or in <code>/tmp/</code>, which is cleared during startup in my
system.
</p>

<p>
Sometimes, this feature also saved me, when I made some edits, <b>didn't save</b> the
buffer and then something bad happenedÂ â€” for example, laptop's battery
completely drained and my machine turned off. After restoring the power, I can
easily restore my unsaved edits with the <code>M-x recover-this-file</code> command.
</p>

<p>
With the next code I save all my autosave files not in the working directory,
but in the <code>~/.emacs.d/autosave/</code> directory:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">245: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Save all auto save files to "~/.emacs.d/autosave/"</span>
<span class="linenr">246: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">when</span> <span style="color: #ad8900;">(</span>not <span style="color: #0072d4;">(</span>file-directory-p <span style="color: #009c8f;">"~/.emacs.d/autosave"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">247: </span>  <span style="color: #ad8900;">(</span>make-directory <span style="color: #009c8f;">"~/.emacs.d/autosave"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">248: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">if</span> <span style="color: #ad8900;">(</span>file-directory-p <span style="color: #009c8f;">"~/.emacs.d/autosave"</span><span style="color: #ad8900;">)</span>
<span class="linenr">249: </span>    <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> auto-save-file-name-transforms '<span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span><span style="color: #009c8f;">".*"</span> <span style="color: #009c8f;">"~/.emacs.d/autosave/"</span> t<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Directory <code>~/.emacs.d/autosave/</code> will be created during the Emacs daemon startup
if it is not exists.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-autorevert-buffer" class="outline-2">
<h2 id="rc-emacs-autorevert-buffer">Autorevert buffer</h2>
<div class="outline-text-2" id="text-rc-emacs-autorevert-buffer">
<p>
This line just enable autoreverting the buffer if it was edited outside of
Emacs:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">250: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Auto-revert buffer</span>
<span class="linenr">251: </span><span style="color: #009c8f;">(</span>global-auto-revert-mode t<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
If I edit some file outside of Emacs, with the help of <code>sed</code> or <code>awk</code>, I want to
see changes immediately without <code>C-x C-f</code> for this file again.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-save-restore" class="outline-2">
<h2 id="rc-emacs-save-restore">Save and restore session</h2>
<div class="outline-text-2" id="text-rc-emacs-save-restore">
<p>
As I wrote before (in the <a href="#rc-emacs-history-variables">"History preservation variables"</a> section),
the Emacs has an <b>extremely rich</b> capabilities to save and restore it's
state between restarts. The next section in my <code>rc-emacs.el</code> file
configures these capabilities:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">253: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">254: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Desktop save/restore ;;;</span>
<span class="linenr">255: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span id="coderef-rc-emacs-desktop-dirname" class="coderef-off"><span class="linenr">256: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-dirname <span style="color: #009c8f;">"~/.emacs.d/desktop"</span><span style="color: #009c8f;">)</span></span>
<span class="linenr">257: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-path <span style="color: #ad8900;">(</span>list <span style="color: #009c8f;">"~/.emacs.d/desktop"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span id="coderef-rc-emacs-desktop-file-name" class="coderef-off"><span class="linenr">258: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-base-file-name <span style="color: #009c8f;">"emacs.desktop"</span><span style="color: #009c8f;">)</span></span>
<span class="linenr">259: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-base-lock-name <span style="color: #009c8f;">"emacs.desktop.lock"</span><span style="color: #009c8f;">)</span>
<span id="coderef-rc-emacs-desktop-save" class="coderef-off"><span class="linenr">260: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-save t<span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-locked-desktop" class="coderef-off"><span class="linenr">261: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-load-locked-desktop t<span style="color: #009c8f;">)</span></span>
<span id="coderef-rc-emacs-autosave-timeout" class="coderef-off"><span class="linenr">262: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-auto-save-timeout 60<span style="color: #009c8f;">)</span></span>
<span class="linenr">263: </span>  <span style="color: #909995;">;; </span><span style="color: #909995;">Next three lines to avoid "Error (frameset): Wrong type argument"</span>
<span class="linenr">264: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-restore-frames t<span style="color: #009c8f;">)</span>
<span class="linenr">265: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-restore-in-current-display t<span style="color: #009c8f;">)</span>
<span class="linenr">266: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> desktop-restore-forces-onscreen nil<span style="color: #009c8f;">)</span>
<span class="linenr">267: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Restore desktop</span>
<span id="coderef-rc-emacs-desktop-load" class="coderef-off"><span class="linenr">268: </span>  <span style="color: #009c8f;">(</span>add-hook 'server-after-make-frame-hook <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #0072d4;">()</span></span>
<span class="linenr">269: </span>                                            <span style="color: #0072d4;">(</span>desktop-read<span style="color: #0072d4;">)</span>
<span class="linenr">270: </span>                                            <span style="color: #0072d4;">(</span>desktop-save-mode 1<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span id="coderef-rc-emacs-desktop-frame-del" class="coderef-off"><span class="linenr">271: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">save-desktop-on-frame-delete</span> <span style="color: #ad8900;">(</span>_<span style="color: #ad8900;">)</span></span>
<span class="linenr">272: </span>    <span style="color: #ad8900;">(</span>desktop-save-in-desktop-dir<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">273: </span>  <span style="color: #009c8f;">(</span>add-to-list 'delete-frame-functions 'save-desktop-on-frame-delete<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
First, I prepare some configuration values to instruct Emacs where to
save file with saved session and from which catalog (and file) it
should read saved session during startup.
</p>

<p>
Here on the line <a href="#coderef-rc-emacs-desktop-dirname" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-desktop-dirname');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-desktop-dirname');">256</a> the path to the catalog to
store session data is set. The next line sets the list with catalogs
where Emacs will search for the session data to load during startup.
Because previously I instructed Emacs to store session data right in
the <code>~/.emacs.d/desktop/</code>, then I have only one element in this listÂ â€”
the mentioned directory.
</p>

<p>
By default, the session will be saved in the <code>.emacs.desktop</code> file and it will
be locked with <code>.emacs.desktop.lock</code> file. On the line
<a href="#coderef-rc-emacs-desktop-file-name" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-desktop-file-name');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-desktop-file-name');">258</a> I just remove the leading dot from these file
names, to see these files without the <code>ls -a</code>.
</p>

<p>
Then, I setup session save/load in the lines <a href="#coderef-rc-emacs-desktop-load" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-desktop-load');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-desktop-load');">268</a>
and <a href="#coderef-rc-emacs-desktop-save" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-desktop-save');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-desktop-save');">260</a>. On the line <a href="#coderef-rc-emacs-desktop-load" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-desktop-load');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-desktop-load');">268</a>:
</p>
<ul class="org-ul">
<li>I load the previously saved session with <code>(desktop-read)</code> function.</li>
<li><p>
I enable the <code>desktop-save-mode</code>. Without this mode enabled the session <b>will
not be saved</b> in the <code>~/.emacs.d/desktop/emacs.desktop</code> file!
</p>

<p>
With the code at line <a href="#coderef-rc-emacs-desktop-save" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-desktop-save');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-desktop-save');">260</a> Emacs will save session
without any questions.
</p></li>
</ul>

<p>
All these actions happens right after first Emacs frame created. So, when
daemon is startedÂ â€” there are no session restoration. First, it will slower
the startup. And second, this is meaningless because I have only the daemon
launched; since there are no framesÂ â€” user obviously doesn't using Emacs and
there is no need to restore session.
</p>

<p>
There are some settings to make session's save/restore more comfortable:
</p>
<ul class="org-ul">
<li>I allow to load locked session file on the <a href="#coderef-rc-emacs-locked-desktop" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-locked-desktop');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-locked-desktop');">261</a>. If I
kill daemon with <code>kill -9</code> (for example), I want to have a loaded session,
even with a lockfile in a <code>~/.emacs.d/desktop/</code> catalog!</li>
<li>The line <a href="#coderef-rc-emacs-autosave-timeout" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-autosave-timeout');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-autosave-timeout');">262</a> enables autosaving of current session
if Emacs is idle (no keyboard or mouse input) for 60 seconds.</li>
<li>Also in the line <a href="#coderef-rc-emacs-desktop-frame-del" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-desktop-frame-del');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-desktop-frame-del');">271</a> I enable saving of current
session if user closed the frame. Just in case, if Emacs weren't idle for 60
seconds for a long period of time.</li>
</ul>
</div>
</div>
<div id="outline-container-rc-emacs-buffer-hacks" class="outline-2">
<h2 id="rc-emacs-buffer-hacks">Some buffers-related hacks</h2>
<div class="outline-text-2" id="text-rc-emacs-buffer-hacks">
</div>
<div id="outline-container-rc-emacs-ibuffer-hack" class="outline-3">
<h3 id="rc-emacs-ibuffer-hack">IBuffer</h3>
<div class="outline-text-3" id="text-rc-emacs-ibuffer-hack">
<p>
First hack is for the IBuffer (see the <a href="#rc-emacs-buffer-variables">"Buffer-related variables"</a> section).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">275: </span><span style="color: #909995;">;;;;;;;;;;;;;;;</span>
<span class="linenr">276: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Buffers ;;;</span>
<span class="linenr">277: </span><span style="color: #909995;">;;;;;;;;;;;;;;;</span>
<span class="linenr">278: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Smart buffer handling</span>
<span class="linenr">279: </span>  <span style="color: #009c8f;">(</span>add-hook 'ibuffer-mode-hook
<span class="linenr">280: </span>            <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #0072d4;">()</span>
<span class="linenr">281: </span>              <span style="color: #0072d4;">(</span>ibuffer-switch-to-saved-filter-groups <span style="color: #009c8f;">"default"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
The IBuffer allows to filter list of buffers inside it by a regular
expression, size of the buffer, by mode, file extension, etc. See the
"Filtering commands" section in the IBuffer help (press <code>?</code> inside the IBuffer
to see it):
</p>


<div class="figure">
<p><img src="/assets/static/ibuffer-filtering.png" alt="Two Emacs windows, first with IBuffer, second with IBuffer help on the &quot;Filtering commands&quot; section." align="center" width="90%" />
</p>
</div>

<p>
And with the lines above, all filters in use will be saved in the <code>"default"</code>
filter group, so they will be restored on the next visit of IBuffer.
</p>

<p>
To restore to the normal view there is a <code>/ /</code> hotkey.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-immortal-buffers" class="outline-3">
<h3 id="rc-emacs-immortal-buffers">Immortal buffers</h3>
<div class="outline-text-3" id="text-rc-emacs-immortal-buffers">
<p>
There are some buffers, which I want to be persistent. I wouldn't kill
them even accidentally, because they are contains an important lines
for me. There are:
</p>
<ul class="org-ul">
<li><code>*Messages*</code> bufferÂ â€” it contains main log of Emacs, since startup.</li>
<li><code>*scratch*</code> bufferÂ â€” I'm heavily using this buffer during Emacs Lisp
programming or while I'm hacking Emacs. So I won't to lost code from this
buffer by accident.</li>
</ul>

<p>
With the next two lines these buffers became locked and if I'll try to kill
one of themÂ â€” I'll receive a message <code>Buffer "*scratch*" is locked and cannot be
killed</code> in the minibuffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">282: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Prevent killing of some buffers</span>
<span class="linenr">283: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">with-current-buffer</span> <span style="color: #009c8f;">"*Messages*"</span> <span style="color: #ad8900;">(</span>emacs-lock-mode 'kill<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">284: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">with-current-buffer</span> <span style="color: #009c8f;">"*scratch*"</span> <span style="color: #ad8900;">(</span>emacs-lock-mode 'kill<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
As you can see from the IBuffer screenshots above, such buffers are marked with
the <code>L</code> symbol.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-hidden-buffers" class="outline-3">
<h3 id="rc-emacs-hidden-buffers">Hidden buffers</h3>
<div class="outline-text-3" id="text-rc-emacs-hidden-buffers">
<p>
The code in this and in the next section were created with the help of
<a href="https://www.masteringemacs.org/article/demystifying-emacs-window-manager">" Demystifying Emacsâ€™s Window Manager"</a> post.
</p>

<p>
Some buffers may be hidden and not displayed in the Emacs frame
completely. While just editing the files this feature may looks like a
bit strange. But for <i>other activities</i> inside Emacs it is extremely
useful!
</p>

<p>
For example, I often select some images in Dired buffer and then launch the
Gimp or <a href="https://nsxiv.codeberg.page/">nsxiv</a> for these images with <code>!</code> or <code>&amp;</code> hotkey. First launches the entered
command synchronously and the second does it asynchronously. But, when the
command finished, the buffer with console output for this command will pop up.
</p>

<p>
But I don't need this information and want to hide these popping up buffers
completely! Here the hack with <code>display-buffer-alist</code> and
<code>(display-buffer-no-window)</code> comes in:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">285: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Hide some unwanted buffers from user</span>
<span class="linenr">286: </span><span style="color: #009c8f;">(</span>add-to-list 'display-buffer-alist
<span class="linenr">287: </span>             '<span style="color: #ad8900;">(</span><span style="color: #009c8f;">"\\*Async Shell Command\\*.*"</span>
<span class="linenr">288: </span>               <span style="color: #0072d4;">(</span>cons #'display-buffer-no-window nil<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">289: </span><span style="color: #009c8f;">(</span>add-to-list 'display-buffer-alist
<span class="linenr">290: </span>             '<span style="color: #ad8900;">(</span><span style="color: #009c8f;">"\\*Shell Command Output\\*.*"</span>
<span class="linenr">291: </span>               <span style="color: #0072d4;">(</span>cons #'display-buffer-no-window nil<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
These lines of code just instructs Emacs to not show the buffers with names,
matched with given regular expressions. First regular expression matches with
<code>*Async Shell Command*</code>, <code>*Async Shell Command*&lt;2&gt;</code>, <code>*Async Shell Command*WTF</code>
buffers. And the second does the same but for synchronously executed commands.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-side-window-bookmarks" class="outline-3">
<h3 id="rc-emacs-side-window-bookmarks">Side window for bookmarks</h3>
<div class="outline-text-3" id="text-rc-emacs-side-window-bookmarks">
<p>
The same trick I used for a buffer with a list of bookmarks. But here I don't
want to hide the buffer with bookmarks completely, I just want to open in the
<i>side window</i>.
</p>

<p>
Side window<sup><a id="fnr.side-window" class="footref" href="#fn.side-window" role="doc-backlink">19</a></sup> is a special type of window which don't mess with
windows' sizes in the frame. It just pops up on the one of the four sides of a
Emacs frame to display some information. And after a close, the original
windows' sizes will be restored.
</p>

<p>
So I instructed Emacs to open buffer with my bookmarks in such <i>side window</i>
with this S-expression:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">292: </span><span style="color: #009c8f;">(</span>add-to-list 'display-buffer-alist
<span class="linenr">293: </span>             '<span style="color: #ad8900;">(</span><span style="color: #009c8f;">"\\`</span><span style="color: #0072d4; font-weight: bold;">\\*Bookmark List\\*\\</span><span style="color: #009c8f;">'"</span>
<span class="linenr">294: </span>               <span style="color: #0072d4;">(</span>display-buffer-in-side-window<span style="color: #0072d4;">)</span>
<span class="linenr">295: </span>               <span style="color: #0072d4;">(</span>side . bottom<span style="color: #0072d4;">)</span>
<span class="linenr">296: </span>               <span style="color: #0072d4;">(</span>slot . 0<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>


<div class="figure">
<p><img src="/assets/static/bookmarks-side-window.png" alt="Emacs with opened rc-emacs.el file and with a side window with a bookmarks' buffer" align="center" width="90%" />
</p>
<p class="fignum"><i>List of bookmarks opened in the side window</i></p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-diff-4-unsaved" class="outline-3">
<h3 id="rc-emacs-diff-4-unsaved">Show diff for unsaved changes</h3>
<div class="outline-text-3" id="text-rc-emacs-diff-4-unsaved">
<p>
If user press <code>C-x C-c</code> to quit Emacs (or close all opened frames in case of
Emacs daemon) and there is any opened file with unsaved changesÂ â€” then Emacs
will ask the user in the minibuffer: <code>Save file /your/important/file.txt? (y,
n, !, ., q, C-r, C-f, d or C-h)</code>.
</p>

<p>
It is good that Emacs asks me when I trying to lost all my unsaved work. But I
can't see <i>what</i> I changed and <i>which</i> changes I'll save. I found the next code
snippet somewhere, which add the new key to the question mentioned aboveÂ â€” the
<code>d</code> key, to show diff between the file on the disk and the unsaved buffer:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">297: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">If asked to save buffer on C-x C-c - show diff of changes with d key</span>
<span class="linenr">298: </span><span style="color: #009c8f;">(</span>add-to-list 'save-some-buffers-action-alist
<span class="linenr">299: </span>             '<span style="color: #ad8900;">(</span><span style="color: #009c8f;">"d"</span> <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #8762c6;">(</span>buffer<span style="color: #8762c6;">)</span>
<span class="linenr">300: </span>                     <span style="color: #8762c6;">(</span>diff-buffer-with-file <span style="color: #489100;">(</span>buffer-file-name buffer<span style="color: #489100;">)</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span>
<span class="linenr">301: </span>               <span style="color: #009c8f;">"Show diff of changes"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
The diff for unsaved changes will look like this:
</p>


<div class="figure">
<p><img src="/assets/static/diff-for-unsaved-buffer.png" alt="Emacs frame with diff for unsaved changes" align="center" width="90%" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-misc" class="outline-2">
<h2 id="misc">Miscellaneous</h2>
<div class="outline-text-2" id="text-misc">
<p>
Here are some ELisp code which also are used widely but don't fit to the any
sections above:
</p>
</div>
<div id="outline-container-text-mode-settings" class="outline-3">
<h3 id="text-mode-settings">Text mode settings</h3>
<div class="outline-text-3" id="text-text-mode-settings">
<p>
For new buffers and files without determined major mode<sup><a id="fnr.major-mode" class="footref" href="#fn.major-mode" role="doc-backlink">20</a></sup> the
default mode is set to <code>text-mode</code> instead of <code>fundamental-mode</code>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">303: </span><span style="color: #909995;">;;;;;;;;;;;;</span>
<span class="linenr">304: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Misc ;;;</span>
<span class="linenr">305: </span><span style="color: #909995;">;;;;;;;;;;;;</span>
<span class="linenr">306: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Default mode for text</span>
<span class="linenr">307: </span>  <span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setq-default</span> major-mode 'text-mode<span style="color: #009c8f;">)</span>
<span class="linenr">308: </span>  <span style="color: #009c8f;">(</span>add-hook 'text-mode-hook 'visual-line-mode<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
For <code>text-mode</code> I enabled <code>visual-line-mode</code> for text buffer. With it the really
long lines will be wrapped <b>and</b> the movement/editing commands will be act on
the <i>visual</i> lines (what I see on the screen). Compare the text buffer without
this mode:
</p>


<div class="figure">
<p><img src="/assets/static/visual-line-mode-off.png" alt="Text buffer with visual-line-mode disabled. The first long line is not wrapped on enlarges outside of the buffer." align="center" width="50%" />
</p>
<p class="fignum"><i>First line is not wrapped</i></p>
</div>

<p>
And with <code>visual-line-mode</code> enabled:
</p>


<div class="figure">
<p><img src="/assets/static/visual-line-mode-on.gif" alt="Text buffer with visual-line-mode enabled. The first long line is wrapped and movement commands work with visual line, not the real one" align="center" width="50%" />
</p>
<p class="fignum"><i>Cursor moves between 3 visual lines, which are just a one big line</i></p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-abbrev-mode" class="outline-3">
<h3 id="rc-emacs-abbrev-mode">Abbrev mode</h3>
<div class="outline-text-3" id="text-rc-emacs-abbrev-mode">
<p>
For almost all modes, aka all modes derived from <code>text-mode</code> and <code>prog-mode</code>, I
enabled the Abbrev mode:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">309: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Enable Abbrev almost everywhere</span>
<span class="linenr">310: </span><span style="color: #009c8f;">(</span>add-hook 'text-mode-hook 'abbrev-mode<span style="color: #009c8f;">)</span>
<span class="linenr">311: </span><span style="color: #009c8f;">(</span>add-hook 'prog-mode-hook 'abbrev-mode<span style="color: #009c8f;">)</span>
<span class="linenr">312: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> save-abbrevs 'silently<span style="color: #009c8f;">)</span>
<span class="linenr">313: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> abbrev-suggest t<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Why is this mode so important for me? Because it is incredibly cool and
useful!ðŸ˜Ž I can define tons of abbreviations for some mode(s) (<code>C-x a l</code>) or
globally (<code>C-x a g</code>) which will expand to the long and boring lines right after
I type the abbreviation and press Space or Enter! Of course there are some
abbreviations, provided by the modes itself, for example by Sql Mode (to see
the list of currently available abbreviations type <code>M-x list-abbrevs</code>).
</p>

<p>
For more information about Abbrev mode I recommend read the <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Abbrevs.html">"31 Abbrevs"</a>
section in the Emacs manual.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-remove-trailing-whitespaces" class="outline-3">
<h3 id="rc-emacs-remove-trailing-whitespaces">Remove trailing whitespaces</h3>
<div class="outline-text-3" id="text-rc-emacs-remove-trailing-whitespaces">
<p>
I HATE TRAILING WHITESPACES IN MY PRECIOUS LINES!!!1ðŸ˜¡
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">314: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Remove trailing whitespaces on save</span>
<span class="linenr">315: </span><span style="color: #009c8f;">(</span>add-hook 'before-save-hook #'delete-trailing-whitespace<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
With this code the trailing whitespaces in the buffer will be deleted before
each save!
</p>
</div>
</div>
<div id="outline-container-better-tab-in-help" class="outline-3">
<h3 id="better-tab-in-help">Better TAB in the help windows</h3>
<div class="outline-text-3" id="text-better-tab-in-help">
<p>
This code snippet was taken from the <a href="https://fosstodon.org/@zrzz">@zrzz@@fosstodon.org</a> <a href="https://fosstodon.org/@zrzz/114389844587469729">toot</a>:
</p>
<blockquote>
<p>
In the #emacs help buffer after "C-h f somefunc RET" the first TAB used to
consistently take me to the definition link. Since the introduction of
nativecomp there is often a pesky "native-comp-function" help-type button in
the way requiring an extra TAB. I never want to select this so I am now using
the following to make TAB skip it:
</p>

<p>
(button-type-put 'help-type 'skip t)
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">316: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Skip type of function when TAB in the help window</span>
<span class="linenr">317: </span><span style="color: #009c8f;">(</span>button-type-put 'help-type 'skip t<span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-custom-funcs" class="outline-2">
<h2 id="rc-emacs-custom-funcs">Few custom functions</h2>
<div class="outline-text-2" id="text-rc-emacs-custom-funcs">
<p>
Of course, there are some custom functions in the <code>:config</code> section of
<code>use-package</code> for Emacs.
</p>
</div>
<div id="outline-container-rc-emacs-lang-switch" class="outline-3">
<h3 id="rc-emacs-lang-switch">Switch between keyboard layouts in Emacs way</h3>
<div class="outline-text-3" id="text-rc-emacs-lang-switch">
<p>
The usual way to setup switching between keyboard layout in the graphical
environment is like this:
</p>

<pre class="example">
setxkbmap -model "thinkpad" -layout us,ru -option grp:menu_toggle -option grp_led:caps
</pre>

<p>
Or perform the same settings somewhere in the DE.
</p>

<p>
It works well, but here lies one problem. For example, if I try to save the
file using the <i>EN</i> keyboard layout then I'll send to the Emacs next keypresses:
<code>C-x C-s</code>Â â€” and my buffer will be saved as well. But if I switch to the <i>RU</i>
keyboard layout and press the same keys then Emacs will receive other
keychords: <code>C-Ñ‡ C-Ñ‹</code>Â â€” and no buffer will be saved. Instead, I'll receive next
messages in the minibuffer:
</p>

<pre class="example">
C-Ñ‡ is undefined
C-Ñ‹ is undefined
</pre>

<p>
A long time ago, people found two solutions for this problem. <i>First solution</i>:
add tons of mapping to the Emacs configuration, like:
</p>
<ul class="org-ul">
<li><code>C-Ñ‡</code> â‡’ <code>C-x</code></li>
<li><code>C-Ñ‹</code> â‡’ <code>C-s</code></li>
<li>and so onâ€¦</li>
</ul>

<p>
It works, but requires to add tons of keybindings in the Emacs config. So I
used another solution.
</p>

<p>
<i>The second solution</i>: use input method<sup><a id="fnr.input-method" class="footref" href="#fn.input-method" role="doc-backlink">21</a></sup> "russian-computer" inside
the Emacs as a default:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">319: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">320: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Custom functions ;;;</span>
<span class="linenr">321: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">322: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Setup language switching</span>
<span class="linenr">323: </span>  <span style="color: #009c8f;">(</span>add-hook 'server-after-make-frame-hook
<span class="linenr">324: </span>            <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #0072d4;">()</span>
<span class="linenr">325: </span>              <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> default-input-method <span style="color: #009c8f;">"russian-computer"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
I setup this input method right after new frame creationÂ â€” it is meaningless
to do it when we have only lone server; also it is slow down server
initialization.
</p>

<p>
With this method I don't need to switch keyboard layout with X-server or DE
mechanismsÂ â€” I can stay with the <i>EN</i> keyboard layout the whole time. If I need
to switch between lanugages, I just use <code>C-z</code> keybinding (see the
<a href="#coderef-rc-emacs-toggle-input-method" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-toggle-input-method');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-toggle-input-method');">46</a> line in the <code>rc-emacs.el</code>). After that I'm able
to type Cyrillic characters in the buffer. <b>But</b>, all keybindings, like <code>C-x C-s</code>,
<code>C-x p p</code>, <code>C-c C-c</code> and so onÂ â€” work as usual!
</p>

<p>
The selected language is displayed on the left part of modeline:
</p>
<ul class="org-ul">
<li><code>U:@--- filename.txt</code> for Latin symbols</li>
<li><code>RUU:@--- filename.txt</code> for Cyrillic symbols.</li>
</ul>

<p>
For more info about "russian-computer" or any other input method you can type
<code>C-h I method-name</code>:
</p>


<div class="figure">
<p><img src="/assets/static/russian-computer.png" alt="Emacs buffer with opened manual for &quot;russian-computer&quot; input method." align="center" width="90%" />
</p>
<p class="fignum"><i>Manual page for "russian-computer" input method</i></p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-pinentry-hack" class="outline-3">
<h3 id="rc-emacs-pinentry-hack">Hack for Pinentry</h3>
<div class="outline-text-3" id="text-rc-emacs-pinentry-hack">
<p>
The next lambda function provides a hack to use Emacs as a pinentry
(previously configured at <a href="#coderef-rc-emacs-epg-mode" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-epg-mode');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-epg-mode');">172</a> line):
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">326: </span>                                      <span style="color: #909995;">; </span><span style="color: #909995;">Enable emacs-pinentry</span>
<span class="linenr">327: </span><span style="color: #009c8f;">(</span>add-hook 'desktop-after-read-hook <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #0072d4;">()</span>
<span class="linenr">328: </span>                                     <span style="color: #0072d4;">(</span>pinentry-stop<span style="color: #0072d4;">)</span>
<span class="linenr">329: </span>                                     <span style="color: #0072d4;">(</span>pinentry-start<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
As I found, Emacs won't act as pinentry without restarting the corresponding
plugin after restoring the desktop.
</p>
</div>
</div>
<div id="outline-container-C-g-dwim" class="outline-3">
<h3 id="C-g-dwim">C-g Do What I Mean</h3>
<div class="outline-text-3" id="text-C-g-dwim">
<p>
Sometimes when I pressed <code>C-g</code> to get rid of <i>something</i> in the minibufferÂ â€” I
didn't succeded. The cursor still stays in the minibuffer and Emacs still
wants some input from me. This behaviour was irritating for me and with some
RSS update I found the blog post with solution!
</p>

<p>
There is a <a href="https://protesilaos.com/">Protesilaos Stavrou blog</a> where lies the post about Emacs
configuration: <a href="https://protesilaos.com/codelog/2024-11-28-basic-emacs-configuration/">"Emacs: a basic and capable configuration"</a>. And inside it there
is a section <a href="https://protesilaos.com/codelog/2024-11-28-basic-emacs-configuration/#h:1e468b2a-9bee-4571-8454-e3f5462d9321">"Make C-g a bit more helpful"</a> which includes the solution to my
problem. I immediately paste it to my config and forgot about <code>C-g</code> not doing
<code>C-g</code> in some cases:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">331: </span><span style="color: #909995;">;; </span><span style="color: #909995;">Taken from https://protesilaos.com/codelog/2024-11-28-basic-emacs-configuration/</span>
<span class="linenr">332: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">my/keyboard-quit-dwim</span> <span style="color: #ad8900;">()</span>
<span class="linenr">333: </span>  <span style="color: #009c8f;">"Do-What-I-Mean behaviour for a general `</span><span style="color: #0072d4; font-weight: bold;">keyboard-quit</span><span style="color: #009c8f;">'.</span>
<span class="linenr">334: </span>
<span class="linenr">335: </span><span style="color: #009c8f;">The generic `</span><span style="color: #0072d4; font-weight: bold;">keyboard-quit</span><span style="color: #009c8f;">' does not do the expected thing when</span>
<span class="linenr">336: </span><span style="color: #009c8f;">the minibuffer is open.  Whereas we want it to close the</span>
<span class="linenr">337: </span><span style="color: #009c8f;">minibuffer, even without explicitly focusing it.</span>
<span class="linenr">338: </span>
<span class="linenr">339: </span><span style="color: #009c8f;">The DWIM behaviour of this command is as follows:</span>
<span class="linenr">340: </span>
<span class="linenr">341: </span><span style="color: #009c8f;">- When the region is active, disable it.</span>
<span class="linenr">342: </span><span style="color: #009c8f;">- When a minibuffer is open, but not focused, close the minibuffer.</span>
<span class="linenr">343: </span><span style="color: #009c8f;">- When the Completions buffer is selected, close it.</span>
<span class="linenr">344: </span><span style="color: #009c8f;">- In every other case use the regular `</span><span style="color: #0072d4; font-weight: bold;">keyboard-quit</span><span style="color: #009c8f;">'."</span>
<span class="linenr">345: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">interactive</span><span style="color: #ad8900;">)</span>
<span class="linenr">346: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">cond</span>
<span class="linenr">347: </span>   <span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span>region-active-p<span style="color: #8762c6;">)</span>
<span class="linenr">348: </span>    <span style="color: #8762c6;">(</span>keyboard-quit<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span>
<span class="linenr">349: </span>   <span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span>derived-mode-p 'completion-list-mode<span style="color: #8762c6;">)</span>
<span class="linenr">350: </span>    <span style="color: #8762c6;">(</span>delete-completion-window<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span>
<span class="linenr">351: </span>   <span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span>&gt; <span style="color: #489100;">(</span>minibuffer-depth<span style="color: #489100;">)</span> 0<span style="color: #8762c6;">)</span>
<span class="linenr">352: </span>    <span style="color: #8762c6;">(</span>abort-recursive-edit<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span>
<span class="linenr">353: </span>   <span style="color: #0072d4;">(</span>t
<span class="linenr">354: </span>    <span style="color: #8762c6;">(</span>keyboard-quit<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">355: </span><span style="color: #009c8f;">(</span>define-key global-map <span style="color: #ad8900;">(</span>kbd <span style="color: #009c8f;">"C-g"</span><span style="color: #ad8900;">)</span> #'my/keyboard-quit-dwim<span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-custom-faces" class="outline-2">
<h2 id="rc-emacs-custom-faces">Common custom faces</h2>
<div class="outline-text-2" id="text-rc-emacs-custom-faces">
<p>
Now the time for the joy. As I wrote before in the <a href="#rc-emacs-gui-font">"GUI font"</a> sectionÂ â€” I'm
using the DejaVu font. But I'm not specified which typefaces and sizes I'm
using. And where I'm use them.
</p>

<p>
The Emacs has <i>faces</i><sup><a id="fnr.faces" class="footref" href="#fn.faces" role="doc-backlink">22</a></sup>Â â€” aka predefined styles for different
letters/string. One style for the modeline, second style for OrgMode first
heading, third for OrgMode second heading, fourth for C functions' names and
so on. There are <b>a lot</b> of different faces, thats why almost <b>everything</b> can be
styled in the necessary way!
</p>

<p>
You can look to the list of faces with the <code>M-x list-faces-display</code> command:
</p>


<div class="figure">
<p><img src="/assets/static/list-faces-display.png" alt="Window with the list of available faces in the Emacs" align="center" width="90%" />
</p>
</div>

<p>
Also, in the same buffer you can press <code>Enter</code> on the selected face and read
it's description in the opened window.
</p>

<p>
The <code>use-package</code>, incorporated in the Emacs, has the <code>:custom-faces</code> section,
used to customize these <i>faces</i> in the easy way. See the <a href="https://www.gnu.org/software/emacs/manual/html_node/use-package/Faces.html">"4.7 Faces"</a> section in
the use-package manual.
</p>

<p>
I use this section to customize some faces:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">357: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">358: </span><span style="color: #909995;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">359: </span>
<span class="linenr">360: </span>  <span style="color: #53676d; font-weight: bold;">:custom-face</span>
<span id="coderef-rc-emacs-default-faces" class="coderef-off"><span class="linenr">361: </span>  <span style="color: #009c8f;">(</span>default <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSansMono"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 100<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span></span>
<span class="linenr">362: </span>  <span style="color: #009c8f;">(</span>variable-pitch <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.0<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">363: </span>  <span style="color: #009c8f;">(</span>fixed-pitch <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSansMono"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.0<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">364: </span>  <span style="color: #009c8f;">(</span>italic <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:slant</span> italic <span style="color: #53676d; font-weight: bold;">:height</span> 1.0 <span style="color: #53676d; font-weight: bold;">:width</span> normal <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSansMono"</span> <span style="color: #53676d; font-weight: bold;">:spacing</span> proportional<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">365: </span>  <span style="color: #009c8f;">(</span>mode-line <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">366: </span>  <span style="color: #009c8f;">(</span>mode-line-active <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span id="coderef-rc-emacs-default-faces-end" class="coderef-off"><span class="linenr">367: </span>  <span style="color: #009c8f;">(</span>mode-line-inactive <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span></span>
<span class="linenr">368: </span>  <span style="color: #009c8f;">(</span>outline-1 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-1 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.2<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">369: </span>  <span style="color: #009c8f;">(</span>outline-2 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-2 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.2<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">370: </span>  <span style="color: #009c8f;">(</span>outline-3 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-3 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.1<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">371: </span>  <span style="color: #009c8f;">(</span>outline-4 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-4 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.1<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">372: </span>  <span style="color: #009c8f;">(</span>outline-5 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-5 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.0<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">373: </span>  <span style="color: #009c8f;">(</span>outline-6 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-6 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.0<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">374: </span>  <span style="color: #009c8f;">(</span>outline-7 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-7 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.0<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">375: </span>  <span style="color: #009c8f;">(</span>outline-8 <span style="color: #ad8900;">(</span><span style="color: #0072d4;">(</span>t <span style="color: #8762c6;">(</span><span style="color: #53676d; font-weight: bold;">:inherit</span> outline-8 <span style="color: #53676d; font-weight: bold;">:family</span> <span style="color: #009c8f;">"DejaVuSerif"</span> <span style="color: #53676d; font-weight: bold;">:height</span> 1.0<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span><span style="color: #53676d; background-color: #fbf3db;">)</span>
</pre>
</div>

<p>
From the line <a href="#coderef-rc-emacs-default-faces" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-default-faces');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-default-faces');">361</a> to line <a href="#coderef-rc-emacs-default-faces-end" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-default-faces-end');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-default-faces-end');">367</a> I
set the fonts for some <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Standard-Faces.html">standard faces</a>:
</p>
<ul class="org-ul">
<li><code>default</code>Â â€” basic default face, used for ordinary text. Here the DejaVu Sans
Mono font is used.</li>
<li><code>variable-pitch</code>Â â€” face for lines, which should be displayed with
<a href="https://en.wikipedia.org/wiki/Typeface#Proportion">variable-width font</a>. Here I use DejaVu Serif as a such font.</li>
<li><code>fixed-pitch</code>Â â€” describes font for lines, which should be displayed with
fixed-width font. The same DejaVu Sans Mono is in use.</li>
<li><code>italic</code>Â â€” obiously for italic variant for the font used in the <code>default</code> face.
Here I use the same DejaVu Sans Mono with additional and nicer (IMO)
properties.</li>
<li><p>
<code>mode-line</code>, <code>mode-line-active</code>, <code>mode-line-inactive</code>Â â€” describe faces
used for modeline. As you can see from a lot of screenshots above, I
use DejaVu Serif for the modeline.
</p>

<p>
For a long time the simple monospaced or Sans Serif fonts were used
in the interfacesÂ â€” because computer displays don't have a good
resolution these days.
</p>

<p>
But now, when we have precious HD, 2K, 4K displaysÂ â€” no one stops me from
using traditional fonts with serifs, well-tested and proved as mature in a
centuries of typography!
</p></li>
</ul>

<p>
Next lines just describes how different <i>outlines</i> (aka headers) will be
displayed in the Emacs:
</p>


<div class="figure">
<p><img src="/assets/static/outline-faces.png" alt="Display faces from outline-1 to outline-8 in various colors and big sized fonts." align="center" width="90%" />
</p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-recentf" class="outline-2">
<h2 id="rc-emacs-recentf">Recentf configuration</h2>
<div class="outline-text-2" id="text-rc-emacs-recentf">
<p>
Next <code>use-package</code> macro configures recentfÂ â€” it provides a list of
previously opened files.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">377: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> recentf
<span class="linenr">378: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">379: </span>  <span style="color: #53676d; font-weight: bold;">:functions</span> recentf-track-opened-file
<span class="linenr">380: </span>  <span style="color: #53676d; font-weight: bold;">:bind</span>
<span id="coderef-recentf-keybinding" class="coderef-off"><span class="linenr">381: </span>  <span style="color: #ad8900;">(</span><span style="color: #009c8f;">"C-x C-r"</span> . recentf-open-files<span style="color: #ad8900;">)</span></span>
<span class="linenr">382: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span class="linenr">383: </span>  <span style="color: #ad8900;">(</span>recentf-max-menu-items 25<span style="color: #ad8900;">)</span>
<span class="linenr">384: </span>  <span style="color: #ad8900;">(</span>recentf-max-saved-items 25<span style="color: #ad8900;">)</span>
<span class="linenr">385: </span>  <span style="color: #ad8900;">(</span>recentf-keep '<span style="color: #0072d4;">(</span>file-readable-p<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span id="coderef-recentf-regex" class="coderef-off"><span class="linenr">386: </span>  <span style="color: #ad8900;">(</span>recentf-exclude `<span style="color: #0072d4;">(</span>,<span style="color: #8762c6;">(</span>concat <span style="color: #009c8f;">"</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">(</span><span style="color: #009c8f;">^/</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">(?:</span><span style="color: #009c8f;">ssh</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">|</span><span style="color: #009c8f;">su</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">|</span><span style="color: #009c8f;">sudo</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">)</span><span style="color: #009c8f;">?:</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">)</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">|</span><span style="color: #009c8f;">"</span></span>
<span class="linenr">387: </span>                            <span style="color: #009c8f;">".+/blog/_posts.+</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">|</span><span style="color: #009c8f;">.+/blog/_articles.+</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">|</span><span style="color: #009c8f;">"</span>
<span class="linenr">388: </span>                            <span style="color: #009c8f;">".+TAGS</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">|</span><span style="color: #009c8f;">"</span>
<span class="linenr">389: </span>                            <span style="color: #009c8f;">".+emms/history</span><span style="color: #489100; font-weight: bold;">\\</span><span style="color: #ad8900; font-weight: bold;">|</span><span style="color: #009c8f;">~/\\.emacs\\.d/bookmarks"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">390: </span>  <span style="color: #53676d; font-weight: bold;">:config</span>
<span class="linenr">391: </span>  <span style="color: #ad8900;">(</span>add-hook 'buffer-list-update-hook #'recentf-track-opened-file<span style="color: #ad8900;">)</span>
<span class="linenr">392: </span>  <span style="color: #53676d; font-weight: bold;">:hook</span> after-init<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Provided list of recently opened files can be used as:
</p>
<ol class="org-ol">
<li><p>
a menu in the minibuffer via <code>M-x recentf</code>:
</p>

<div class="figure">
<p><img src="/assets/static/recentf-minibuffer.png" alt="List of recently opened files in the minibuffer" align="center" width="90%" />
</p>
</div></li>
<li><p>
a separate buffer, which can be opened via <code>M-x recent-open-files</code>:
</p>

<div class="figure">
<p><img src="/assets/static/recentf-buffer.png" alt="List of recently opened files in the buffer" align="center" width="90%" />
</p>
</div>

<p>
Or via <code>C-x C-r</code> hotkey, added in the <a href="#coderef-recentf-keybinding" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-recentf-keybinding');" onmouseout="CodeHighlightOff(this, 'coderef-recentf-keybinding');">381</a> line.
</p></li>
</ol>

<p>
The custom variables just configures count of recently opened files to
save and which files should be savedÂ â€” for example, various remote
files, opened via TRAMP, will not be saved. The hook in the <code>:config</code>
section saves current file to the recentf when I switch between
buffers. This is necessary because recentf saves files on modification
or save but when I just open the file to view itÂ â€” it will not be
saved in the recentf list. And this is not a desired behaviour for me,
so I changed it.
</p>

<p>
The interesting part is in the line <a href="#coderef-recentf-regex" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-recentf-regex');" onmouseout="CodeHighlightOff(this, 'coderef-recentf-regex');">386</a>. Here the regexp
which is used by <code>(recentf-cleanup)</code> to remove matched files from the
list of recently opened files (two previous screenshots were made
without this regexp).
</p>

<p>
This regexp removes from the recently opened files:
</p>
<ul class="org-ul">
<li>Remote files (shouldn't be saved with the help of <code>recentf-keep</code>
variable).</li>
<li>Some temporary opened files by my plugin used to generate this
blog<sup><a id="fnr.org-jekyll" class="footref" href="#fn.org-jekyll" role="doc-backlink">23</a></sup>.</li>
<li>Any <code>TAGS</code> files.</li>
<li>Some files from <code>~/.emacs.d/</code> which will be opened by Emacs in each
startup.</li>
</ul>
</div>
</div>
<div id="outline-container-rc-emacs-tramp" class="outline-2">
<h2 id="rc-emacs-tramp">TRAMP configuration</h2>
<div class="outline-text-2" id="text-rc-emacs-tramp">
<p>
TRAMP is the Transparent Remote (file) Access, Mutliple
Protocol<sup><a id="fnr.tramp" class="footref" href="#fn.tramp" role="doc-backlink">24</a></sup>Â â€” a killing feature of Emacs. With it I can open
remote files via various protocols, call remote shell, use different
Emacs plugins on the remote machineÂ â€” like these all remote files and
shell are on my local machine.
</p>

<p>
For example, I can open some XML file from the work machine via the
ssh, then check changes via the Magit, open Dired on the remote
machine to do some things and also open a remote shell via the usual
<code>M-x eshell</code> command. All work with remote machine will happen in the
background, hidden from the user.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">394: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> tramp
<span class="linenr">395: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">396: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span class="linenr">397: </span>  <span style="color: #ad8900;">(</span>tramp-show-ad-hoc-proxies t<span style="color: #ad8900;">)</span>
<span class="linenr">398: </span>  <span style="color: #ad8900;">(</span>tramp-use-connection-share t <span style="color: #009c8f;">"Share ssh connection"</span><span style="color: #ad8900;">)</span>
<span class="linenr">399: </span>  <span style="color: #ad8900;">(</span>tramp-use-scp-direct-remote-copying t <span style="color: #009c8f;">"Use scp to copy files &#8212; to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
<span class="linenr">400: </span>  <span style="color: #ad8900;">(</span>tramp-verbose 2 <span style="color: #009c8f;">"Decrease verbosity &#8212; to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
<span class="linenr">401: </span>  <span style="color: #ad8900;">(</span>remote-file-name-access-timeout 10 <span style="color: #009c8f;">"Timeout when restoring session with remote file. In seconds"</span><span style="color: #ad8900;">)</span>
<span class="linenr">402: </span>  <span style="color: #ad8900;">(</span>remote-file-name-inhibit-locks t <span style="color: #009c8f;">"Don't use lock files to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
<span class="linenr">403: </span>  <span style="color: #ad8900;">(</span>remote-file-name-inhibit-auto-save-visited t <span style="color: #009c8f;">"Don't autosave remote files"</span><span style="color: #ad8900;">)</span>
<span class="linenr">404: </span>  <span style="color: #ad8900;">(</span>vc-handled-backends '<span style="color: #0072d4;">(</span>Git<span style="color: #0072d4;">)</span> <span style="color: #009c8f;">"VCS backends in use list &#8212; to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
<span id="coderef-rc-emacs-auth-sources" class="coderef-off"><span class="linenr">405: </span>  <span style="color: #ad8900;">(</span>auth-sources '<span style="color: #0072d4;">(</span><span style="color: #009c8f;">"~/.authinfo.gpg"</span> <span style="color: #009c8f;">"~/.netrc"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span></span>
<span class="linenr">406: </span>  <span style="color: #53676d; font-weight: bold;">:config</span>
<span class="linenr">407: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Use direct async processes for TRAMP</span>
<span class="linenr">408: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">https://www.gnu.org/software/tramp/#Improving-performance-of-asynchronous-remote-processes-1</span>
<span class="linenr">409: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">https://coredumped.dev/2025/06/18/making-tramp-go-brrrr./</span>
<span class="linenr">410: </span>  <span style="color: #ad8900;">(</span>connection-local-set-profile-variables
<span class="linenr">411: </span>   'remote-direct-async-process
<span class="linenr">412: </span>   '<span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span>tramp-direct-async-process . t<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">413: </span>  <span style="color: #ad8900;">(</span>connection-local-set-profiles
<span class="linenr">414: </span>   '<span style="color: #0072d4;">(</span><span style="color: #53676d; font-weight: bold;">:application</span> tramp <span style="color: #53676d; font-weight: bold;">:protocol</span> <span style="color: #009c8f;">"scp"</span><span style="color: #0072d4;">)</span>
<span class="linenr">415: </span>   'remote-direct-async-process<span style="color: #ad8900;">)</span>
<span class="linenr">416: </span>  <span style="color: #ad8900;">(</span>connection-local-set-profiles
<span class="linenr">417: </span>   '<span style="color: #0072d4;">(</span><span style="color: #53676d; font-weight: bold;">:application</span> tramp <span style="color: #53676d; font-weight: bold;">:protocol</span> <span style="color: #009c8f;">"ssh"</span><span style="color: #0072d4;">)</span>
<span class="linenr">418: </span>   'remote-direct-async-process<span style="color: #ad8900;">)</span>
<span class="linenr">419: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> magit-tramp-pipe-stty-settings 'pty<span style="color: #ad8900;">)</span>
<span class="linenr">420: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Custom sudo function</span>
<span id="coderef-rc-emacs-tramp-sudo" class="coderef-off"><span class="linenr">421: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">sudo</span> <span style="color: #0072d4;">(</span><span style="color: #ad8900;">&amp;optional</span> arg<span style="color: #0072d4;">)</span></span>
<span class="linenr">422: </span>    <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">interactive</span> <span style="color: #009c8f;">"P"</span><span style="color: #0072d4;">)</span>
<span class="linenr">423: </span>    <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">if</span> <span style="color: #8762c6;">(</span><span style="color: #489100; font-weight: bold;">or</span> arg <span style="color: #489100;">(</span>not buffer-file-name<span style="color: #489100;">)</span><span style="color: #8762c6;">)</span>
<span class="linenr">424: </span>        <span style="color: #8762c6;">(</span>find-file <span style="color: #489100;">(</span>concat <span style="color: #009c8f;">"/sudo:root@localhost:"</span>
<span class="linenr">425: </span>                           <span style="color: #ad8900;">(</span>expand-file-name
<span class="linenr">426: </span>                            <span style="color: #0072d4;">(</span>read-file-name <span style="color: #009c8f;">"Find file (as root): "</span> nil nil t nil nil<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #489100;">)</span><span style="color: #8762c6;">)</span>
<span class="linenr">427: </span>      <span style="color: #8762c6;">(</span>find-alternate-file <span style="color: #489100;">(</span>concat <span style="color: #009c8f;">"/sudo:root@localhost:"</span> buffer-file-name<span style="color: #489100;">)</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">428: </span>                                        <span style="color: #909995;">; </span><span style="color: #909995;">Disable backups for files, opened via TRAMP</span>
<span id="coderef-rc-emacs-tramp-no-backups" class="coderef-off"><span class="linenr">429: </span>  <span style="color: #ad8900;">(</span>add-to-list 'backup-directory-alist</span>
<span class="linenr">430: </span>               <span style="color: #0072d4;">(</span>cons tramp-file-name-regexp nil<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Most of the settings on the <code>:custom</code> section are necessary to speed up
TRAMP itself because by default on the slow connection it can do some
unnecessary things like creating autosave/lock files on the remote
machine, do a lot of calls for some plugin like Magit, etc. Most of
the lines were taken from a <a href="https://coredumped.dev/2025/06/18/making-tramp-go-brrrr./">"Making TRAMP go Brrrrâ€¦."</a> post.
</p>

<p>
Creation of remote backup files also disabled on the line
<a href="#coderef-rc-emacs-tramp-no-backups" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-tramp-no-backups');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-tramp-no-backups');">429</a> to reduce count of actions with the remote
connection and speed up TRAMP a bit for the slow connections.
</p>

<p>
On the line <a href="#coderef-rc-emacs-auth-sources" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-auth-sources');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-auth-sources');">405</a> I specify that <code>~/.authinfo.gpg</code>
will be used to store credentials. By default, Emacs will save some
credentials (for example, for SSH) in the plaintext <code>~/.authinfo</code> file.
But, if I remove it and create an <code>~/.authinfo.gpg</code> file)Â â€” then all
login/password pairs will be securely saved with my public GPG key. So
only I, as an owner of my private GPG key, can access this file.
</p>

<p>
There is a custom <code>sudo</code> function on the <a href="#coderef-rc-emacs-tramp-sudo" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-tramp-sudo');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-tramp-sudo');">421</a> line,
which I took from someone's blog post. The TRAMP can be used not only
for remote files editing but also inside the local machine! It could
be used to open file as rootÂ â€” for example to edit some config in the
<code>/usr/local/etc</code>. Before, I used the string like
<code>/sudo::/usr/local/etc/myconfig.toedit</code> in the minibuffer after <code>C-x C-f</code>.
But typing the necessary <code>C-x C-f /sudo::</code> each time when I forgot to
open currently opened file as rootÂ â€” was not very pleasuring
experience for me.
</p>

<p>
By the way, I found this cool function which doing two simple things:
</p>
<ol class="org-ol">
<li>If it was called (via <code>M-x sudo</code>) in buffer with opened fileÂ â€” then
this file will be reopened with <code>/sudo:root@localhost:</code> prefix, so
TRAMP will invoke sudo to open this file as root.</li>
<li>If it was called in buffer without the opened file (for example,
from eshell)Â â€” then it will ask for path to file to open it as
root.</li>
</ol>
</div>
</div>
<div id="outline-container-rc-emacs-window-creation" class="outline-2">
<h2 id="rc-emacs-window-creation">Tweaking the C-x 2 and C-x 3</h2>
<div class="outline-text-2" id="text-rc-emacs-window-creation">
<p>
By default the keybindings <code>C-x 2</code> (creates new horizontal window) and
<code>C-x 3</code> (creates new vertical window) don't move the cursor to the newly
created window. The cursor stays in the current window and most of the
time I just move it to the new window manually, by <code>C-x o</code>.
</p>

<p>
So, by the next lines of code I slightly changed this behaviour. Now
the cursor jumps to the newly created window and it become active:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">432: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> window
<span class="linenr">433: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">434: </span>  <span style="color: #53676d; font-weight: bold;">:preface</span>
<span class="linenr">435: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">hsplit-last-buffer</span> <span style="color: #0072d4;">()</span>
<span class="linenr">436: </span>    <span style="color: #009c8f;">"Focus to the last created horizontal window."</span>
<span class="linenr">437: </span>    <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">interactive</span><span style="color: #0072d4;">)</span>
<span class="linenr">438: </span>    <span style="color: #0072d4;">(</span>split-window-horizontally<span style="color: #0072d4;">)</span>
<span class="linenr">439: </span>    <span style="color: #0072d4;">(</span>other-window 1<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">440: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">vsplit-last-buffer</span> <span style="color: #0072d4;">()</span>
<span class="linenr">441: </span>    <span style="color: #009c8f;">"Focus to the last created vertical window."</span>
<span class="linenr">442: </span>    <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">interactive</span><span style="color: #0072d4;">)</span>
<span class="linenr">443: </span>    <span style="color: #0072d4;">(</span>split-window-vertically<span style="color: #0072d4;">)</span>
<span class="linenr">444: </span>    <span style="color: #0072d4;">(</span>other-window 1<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">445: </span>  <span style="color: #ad8900;">(</span>global-set-key <span style="color: #0072d4;">(</span>kbd <span style="color: #009c8f;">"C-x 2"</span><span style="color: #0072d4;">)</span> #'vsplit-last-buffer<span style="color: #ad8900;">)</span>
<span class="linenr">446: </span>  <span style="color: #ad8900;">(</span>global-set-key <span style="color: #0072d4;">(</span>kbd <span style="color: #009c8f;">"C-x 3"</span><span style="color: #0072d4;">)</span> #'hsplit-last-buffer<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-nerd-icons" class="outline-2">
<h2 id="rc-emacs-nerd-icons">Nerd icons</h2>
<div class="outline-text-2" id="text-rc-emacs-nerd-icons">
<p>
All of the packages about which I've written before (except pinentry)
are already comes within the Emacs package. Now it's time to add some
nice icons and I used an external package for it.
</p>

<p>
I selected the <a href="https://www.nerdfonts.com/">Nerd Icons</a> font to use it's glyphs as icons. It's
configuration and installation is pretty simple via the <a href="https://github.com/emacsmirror/nerd-icons">nerd-icons
plugin</a>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">448: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Setup nerd-icons</span>
<span class="linenr">449: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">M-x nerd-icons-install-fonts</span>
<span class="linenr">450: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">Installation path: ~/.local/share/fonts/</span>
<span class="linenr">451: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> nerd-icons
<span class="linenr">452: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span id="coderef-rc-emacs-no-color-icons" class="coderef-off"><span class="linenr">453: </span>  <span style="color: #ad8900;">(</span>nerd-icons-color-icons nil<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span></span>
</pre>
</div>

<p>
Just restart Emacs after adding these lines to the configuration. Or
select this <code>use-package</code> S-expression and run <code>M-x eval-region</code>. The
plugin should download fonts, and place it to the right placeÂ â€”
<code>~/.local/share/fonts/</code>, and call <code>fc-cache</code> automatically. After that
just restart the Emacs daemon to apply the changes.
</p>

<p>
If this is not happened:
</p>
<ol class="org-ol">
<li>Call <code>M-x nerd-icons-install-fonts</code> to install fonts.</li>
<li>Execute <code>fc-cache -f -v ~/.local/share/fonts/</code> if plugin didn't done
this by itself.</li>
<li>Restart Emacs daemon.</li>
</ol>

<p>
One small thing that I added to my configurationÂ â€” I disabled the
color icons on the line <a href="#coderef-rc-emacs-no-color-icons" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-no-color-icons');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-no-color-icons');">453</a>.
</p>

<p>
<i>Note:</i> this plugin just adds some functions to insert selected glyph
from Nerd font to a current buffer without pain. There are a bunch of
plugins exist to add Nerd icons to the IBuffer, Magit, Dired, etcâ€¦ All
of them depends on these functions.
</p>
</div>
<div id="outline-container-rc-emacs-nerd-icons-ibuffer" class="outline-3">
<h3 id="rc-emacs-nerd-icons-ibuffer">Nerd icons in the IBuffer</h3>
<div class="outline-text-3" id="text-rc-emacs-nerd-icons-ibuffer">
<p>
To add icons to the IBuffer there is an another <a href="https://github.com/seagle0128/nerd-icons-ibuffer">damn simple plugin</a>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">455: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> nerd-icons-ibuffer
<span class="linenr">456: </span>  <span style="color: #53676d; font-weight: bold;">:requires</span> nerd-icons
<span class="linenr">457: </span>  <span style="color: #53676d; font-weight: bold;">:hook</span> ibuffer-mode<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
There are almost no configurationÂ â€” except some <code>use-package</code> related
stuff. The plugin will be loaded only when we will be in the
<code>ibuffer-mode</code> (i.e. in the IBuffer)Â â€” so this is also speeds up Emacs a
bit, because <code>nerd-icons-ibuffer</code> won't load during the Emacs daemon
startup. Instead it will be <i>lazy loaded</i>.
</p>

<p>
The result will looks like this:
</p>


<div class="figure">
<p><img src="/assets/static/ibuffer2.png" alt="Ibuffer with a Nerd icons on the left of buffer names" align="center" width="90%" />
</p>
<p class="fignum"><i>IBuffer with Nerd icons</i></p>
</div>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-resize-windows" class="outline-2">
<h2 id="rc-emacs-resize-windows">Resize windows with arrows</h2>
<div class="outline-text-2" id="text-rc-emacs-resize-windows">
<p>
<a href="https://elpa.gnu.org/packages/windresize.html">There is a small plugin</a> which allows me to resize windows just by
using <code>â†â†‘â†“â†’</code> keys.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">1: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> windresize
<span class="linenr">2: </span>  <span style="color: #53676d; font-weight: bold;">:pin</span> gnu
<span class="linenr">3: </span>  <span style="color: #53676d; font-weight: bold;">:bind</span>
<span class="linenr">4: </span>  <span style="color: #ad8900;">(</span><span style="color: #53676d; font-weight: bold;">:map</span> global-map
<span class="linenr">5: </span>        <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"C-x C-w"</span> . windresize<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
I bound <code>C-x C-w</code> keybinding to start the window resizing.
</p>

<p>
In action it looks like this (I tried to record my screen with ffmpeg
and then create gif from a created videoÂ â€” can't say that I succeedâ€¦):
</p>


<div class="figure">
<p><img src="/assets/static/windresize.gif" alt="One horizontal and one verital window are created, when they resized with the C-x C-w and then arrows. Enter was pressed at the end" align="center" width="90%" />
</p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-delsel" class="outline-2">
<h2 id="rc-emacs-delsel">Delete selected text</h2>
<div class="outline-text-2" id="text-rc-emacs-delsel">
<p>
With the next code I just enable <code>delete-selection-mode</code>Â â€” so when I
select some text and start typing, then the selected text will be
replaced by the new textÂ â€” like in usual text editors (by default the
new text will be just added, and selected text <b>will not</b> be replaced):
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">465: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> delsel
<span class="linenr">466: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">467: </span>  <span style="color: #53676d; font-weight: bold;">:delight</span>
<span class="linenr">468: </span>  <span style="color: #53676d; font-weight: bold;">:hook</span> <span style="color: #ad8900;">(</span>after-init . delete-selection-mode<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Why I'm using <code>use-package</code> here instead of simply add the <code>(add-hook â€¦)</code>
in the <code>use-package emacs</code> section? The reason is in <code>:delight</code> lineÂ â€”
with it, the <code>delete-selection-mode</code> from the <code>delsel.el</code> will not be
appear in the list of enabled modes in the modeline. So my modeline
will stay visually clean.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-calendar" class="outline-2">
<h2 id="rc-emacs-calendar">Calendar</h2>
<div class="outline-text-2" id="text-rc-emacs-calendar">
<p>
Emacs has an integrated calendar which can be opened via the <code>M-x
calendar</code> in the separate window:
</p>


<div class="figure">
<p><img src="/assets/static/calendar.png" alt="Emacs calendar window" align="center" width="90%" />
</p>
</div>

<p>
It has some neat features which I'm using twice a day. First, it can
calculate count of days between selected datesÂ â€” I use it every time
when I write a new budget. Just select a start date with <code>C-SPC</code> then
place the cursor to the end date and press <code>M-=</code>. The resulting count of
days between the two days will appear in the minibuffer:
</p>


<div class="figure">
<p><img src="/assets/static/calendar-qty-of-days.gif" alt="Emacs Calendar buffer with May, June and July 2025 months in it. The cursor first selects the June 19, then the June 27. At the end the resulting inclusive count of days between these to dates is 9." width="90%" />
</p>
<p class="fignum"><i>Count of days between June 19 and the June 27 (inclusive)</i></p>
</div>

<p>
Second cool feature is the hotkeys to display time of sunrise and
sunset and a Moon phases. Just press this keys <b>inside</b> the Calendar
buffer:
</p>
<ul class="org-ul">
<li><code>M</code> to display Moon phases</li>
<li><code>S</code> to display sunrise/sunset times.</li>
</ul>

<p>
I use these hotkeys when planning for some photos involving the
desired conditions of Sun or Moon.
</p>


<div class="figure">
<p><img src="/assets/static/calendar-sunrise-sunset.png" alt="Sunrise and sunset times in the minibuffer for the June 19th." align="center" width="90%" />
</p>
<p class="fignum"><i>Sunrise and sunset times displayed in the minibuffer</i></p>
</div>


<div class="figure">
<p><img src="/assets/static/calendar-moon-phases.png" alt="Moon phases computed by the calendar." width="90%" />
</p>
<p class="fignum"><i>Moon phases on the Calendar</i></p>
</div>

<p>
All these features provided by this configuration:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">470: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> calendar
<span class="linenr">471: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">472: </span>  <span style="color: #53676d; font-weight: bold;">:functions</span> mycal--get-geocoords-data
<span class="linenr">473: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span class="linenr">474: </span>  <span style="color: #ad8900;">(</span>calendar-week-start-day 1 <span style="color: #009c8f;">"Monday is the start of the week"</span><span style="color: #ad8900;">)</span>
<span class="linenr">475: </span>  <span style="color: #ad8900;">(</span>calendar-date-style 'iso<span style="color: #ad8900;">)</span>
<span class="linenr">476: </span>  <span style="color: #ad8900;">(</span>calendar-time-zone-style 'numeric<span style="color: #ad8900;">)</span>
<span class="linenr">477: </span>  <span style="color: #ad8900;">(</span>calendar-view-diary-initially-flag t<span style="color: #ad8900;">)</span>
<span class="linenr">478: </span>  <span style="color: #ad8900;">(</span>calendar-mark-holidays-flag nil<span style="color: #ad8900;">)</span>
<span class="linenr">479: </span>  <span style="color: #ad8900;">(</span>calendar-mark-diary-entries-flag t<span style="color: #ad8900;">)</span>
<span id="coderef-rc-emacs-calendar-time-display" class="coderef-off"><span class="linenr">480: </span>  <span style="color: #ad8900;">(</span>calendar-time-display-form '<span style="color: #0072d4;">(</span>24-hours <span style="color: #009c8f;">":"</span> minutes</span>
<span class="linenr">481: </span>                                         <span style="color: #8762c6;">(</span><span style="color: #489100; font-weight: bold;">if</span> time-zone <span style="color: #009c8f;">" ("</span><span style="color: #8762c6;">)</span>
<span class="linenr">482: </span>                                         time-zone
<span class="linenr">483: </span>                                         <span style="color: #8762c6;">(</span><span style="color: #489100; font-weight: bold;">if</span> time-zone <span style="color: #009c8f;">")"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">484: </span>  <span style="color: #53676d; font-weight: bold;">:config</span>
<span class="linenr">485: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">defun</span> <span style="color: #0072d4;">mycal--get-geocoords-data</span> <span style="color: #0072d4;">(</span>keyword<span style="color: #0072d4;">)</span>
<span class="linenr">486: </span>    <span style="color: #009c8f;">"Get geographical data from geocoords.sh script.</span>
<span class="linenr">487: </span>
<span class="linenr">488: </span><span style="color: #009c8f;">KEYWORD sets which data to get. Possible values:</span>
<span class="linenr">489: </span>
<span class="linenr">490: </span><span style="color: #009c8f;">- lon - for longitude</span>
<span class="linenr">491: </span><span style="color: #009c8f;">- lat - for latitude</span>
<span class="linenr">492: </span><span style="color: #009c8f;">- loc - for current location as string."</span>
<span class="linenr">493: </span>    <span style="color: #0072d4;">(</span>string-chop-newline
<span class="linenr">494: </span>     <span style="color: #8762c6;">(</span>shell-command-to-string
<span class="linenr">495: </span>      <span style="color: #489100;">(</span>concat <span style="color: #ad8900;">(</span>expand-file-name <span style="color: #009c8f;">"~/.bin/geocoords.sh"</span><span style="color: #ad8900;">)</span>
<span class="linenr">496: </span>              <span style="color: #009c8f;">" "</span>
<span class="linenr">497: </span>              keyword<span style="color: #489100;">)</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">498: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> calendar-longitude
<span class="linenr">499: </span>          <span style="color: #0072d4;">(</span>string-to-number <span style="color: #8762c6;">(</span>mycal--get-geocoords-data <span style="color: #009c8f;">"lon"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">500: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> calendar-latitude
<span class="linenr">501: </span>          <span style="color: #0072d4;">(</span>string-to-number <span style="color: #8762c6;">(</span>mycal--get-geocoords-data <span style="color: #009c8f;">"lat"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
<span class="linenr">502: </span>  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> calendar-location-name
<span class="linenr">503: </span>          <span style="color: #0072d4;">(</span>mycal--get-geocoords-data <span style="color: #009c8f;">"loc"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
It starts from some personal-related settingsÂ â€” my week starts from
Monday, I prefer ISO date style and so on. On the line
<a href="#coderef-rc-emacs-calendar-time-display" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-calendar-time-display');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-calendar-time-display');">480</a> I tweaked the display of timeÂ â€” if
there is a time zone data then I want to see it within brackets in
numeric form (like <code>+0300</code>), not as an abbreviation (like <code>MSK</code>).
</p>

<p>
To get the moon phases and sunrise/sunset times workingÂ â€” I need to
setup my location for the Calendar. There are three variables:
</p>
<ul class="org-ul">
<li><code>calendar-longitude</code></li>
<li><code>calendar-latitude</code></li>
<li><code>calendar-location-name</code>Â â€” it is used to print location name in the
string about sunrise/sunset times.</li>
</ul>

<p>
It is ok to put the necessary values right in the config. But I need
the same variables for the redshift, so there is a little <code>geocoords.sh</code>
script which is used system wide to provide location data. The
function <code>mycal--get-geocoords-data</code> just calls the script and and
returns a simple string without newline at the end.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-wgrep" class="outline-2">
<h2 id="rc-emacs-wgrep">Editable grep buffer</h2>
<div class="outline-text-2" id="text-rc-emacs-wgrep">
<p>
The contents of "Grep" buffer can be edited in line, so it is not
necessary to jump to the each occurence to edit it. But there is
necessary to install a <code>wgrep</code> plugin first!
</p>


<div class="figure">
<p><img src="/assets/static/wgrep.png" alt="Grep buffer with wgrep mode enabled" align="center" width="90%" />
</p>
</div>

<p>
I achieve this with the next lines:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">505: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> wgrep
<span class="linenr">506: </span>  <span style="color: #53676d; font-weight: bold;">:pin</span> nongnu
<span class="linenr">507: </span>  <span style="color: #53676d; font-weight: bold;">:commands</span> <span style="color: #ad8900;">(</span>grep rgrep<span style="color: #ad8900;">)</span>
<span class="linenr">508: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span id="coderef-rc-emacs-wgrep-autosave" class="coderef-off"><span class="linenr">509: </span>  <span style="color: #ad8900;">(</span>wgrep-auto-save-buffer t <span style="color: #009c8f;">"Autosave buffer after edit"</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span></span>
</pre>
</div>

<p>
To start edit in the Grep buffer there is a <code>C-c C-p</code> hotkey and to save
changes there is a common <code>C-x C-s</code> hotkey. The line
<a href="#coderef-rc-emacs-wgrep-autosave" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rc-emacs-wgrep-autosave');" onmouseout="CodeHighlightOff(this, 'coderef-rc-emacs-wgrep-autosave');">509</a> turns on saving changes when editing via
wgrep is finished.
</p>
</div>
</div>
<div id="outline-container-rc-emacs-proced" class="outline-2">
<h2 id="rc-emacs-proced">Process editor</h2>
<div class="outline-text-2" id="text-rc-emacs-proced">
<p>
Instead of <code>top</code> I'm using <code>proced</code> in the Emacs. It is included in the
Emacs package (at least for FreeBSD) so I just need to tweak some
variables before using it:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">511: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> proced
<span class="linenr">512: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">513: </span>  <span style="color: #53676d; font-weight: bold;">:custom</span>
<span class="linenr">514: </span>  <span style="color: #ad8900;">(</span>proced-enable-color-flag t<span style="color: #ad8900;">)</span>
<span class="linenr">515: </span>  <span style="color: #ad8900;">(</span>proced-auto-update-flag 'visible <span style="color: #009c8f;">"Update only visible buffers"</span><span style="color: #ad8900;">)</span>
<span class="linenr">516: </span>  <span style="color: #ad8900;">(</span>proced-tree-flag t<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
As a result Proced buffer looks like this:
</p>


<div class="figure">
<p><img src="/assets/static/proced.png" alt="Proced buffer with the tree-like list of system processes." align="center" width="90%" />
</p>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-savehist-mode" class="outline-2">
<h2 id="rc-emacs-savehist-mode">Saving history</h2>
<div class="outline-text-2" id="text-rc-emacs-savehist-mode">
<p>
With the next lines I just enable <code>savehist-mode</code> to store minibuffer's
history. Possibly, these lines can be placed as an <code>(add-hook â€¦)</code>
S-expressions inside the <code>(use-package emacs â€¦)</code> section, but I placed
them here
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">518: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> savehist
<span class="linenr">519: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">520: </span>  <span style="color: #53676d; font-weight: bold;">:init</span>
<span class="linenr">521: </span>  <span style="color: #ad8900;">(</span>savehist-mode<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-rc-emacs-completion-icomplete" class="outline-2">
<h2 id="rc-emacs-completion-icomplete">Completion (IComplete)</h2>
<div class="outline-text-2" id="text-rc-emacs-completion-icomplete">
<p>
During programming on C or Emacs Lisp I used a well-known <a href="https://company-mode.github.io/">CompanyMode
framework</a> for completion. It works but for me it was sooo complicated!
There are so many bells and whistles, backends, frontends and so onâ€¦ I
think that <code>company-mode</code> works with my C code just because of pure
luckÂ â€” I've just managed to combine different config lines in the
right way to get a working configuration somehow.
</p>

<p>
When I found another well-known set of <i>simple enough</i> plugins: <a href="https://github.com/minad/corfu">Corfu</a>
and <a href="https://github.com/minad/cape">Cape</a>Â â€” I immediately switched to them and never looked back.
Documentation and configuration process were simple enough and I setup
autocompletion in the Emacs with the help of <code>ctags</code> utility.
</p>

<p>
At the same time I started to use <a href="https://github.com/minad/vertico">Vertico</a> with <a href="https://github.com/oantolin/orderless">Orderless</a> and
<a href="https://github.com/minad/marginalia">Marginalia</a> to get a nice and annotated vertical list of completion
candidates in the minibuffer.
</p>

<p>
All these plugins works pretty well except the one irritating thingÂ â€”
if I have Corfu or Vertico enabled then the Emacs will crash in the
random time. I tried to debug it but didn't succeedÂ â€” for unknown
reasons my Emacs daemon will crash at least once a day if I using
these plugins. But when I disabled themÂ â€” Emacs started to work
without any crashes again.
</p>

<p>
During this time, the Emacs 30.1 was released. And this release
brings to me the two nice features:
</p>
<ol class="org-ol">
<li>Automatic <code>TAGS</code> file regeneration with <code>etags</code> on every buffer save.
So I don't need the <code>ctags</code> and don't need to add it to each <code>Makefile</code>
to have a working completion system. I can rely solely on the
internal Emacs mechanism and it works pretty well.</li>
<li>Nice <code>completion-preview-mode</code> which suggests a completions right in
buffer while I'm typing something.</li>
</ol>

<p>
These features were the reason why I decided to go deeper and learn
how to use standard Emacs features for my autocompletion. I removed
Corfu and Vertico, got rid of sudden Emacs crashes and started to
investigateÂ â€” which features the "vanilla" Emacs provides.
</p>

<p>
I'll write about programming-related autocompletion in the separate
post. Now, I'll concentrate on the minibuffer autocompletion.
</p>

<p>
First, I recommend to read this great article about minibuffer's
autocompletion: <a href="https://www.masteringemacs.org/article/understanding-minibuffer-completion">"Understanding Minibuffer Completion"</a>Â â€” it will give
some clues about how autocompletion works in vanilla Emacs without
third party frameworks and how it all apply to the minibuffer.
</p>

<p>
Second, let's look to the code:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">523: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> icomplete
<span class="linenr">524: </span>  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
<span class="linenr">525: </span>  <span style="color: #53676d; font-weight: bold;">:bind</span>
<span class="linenr">526: </span>  <span style="color: #ad8900;">(</span><span style="color: #53676d; font-weight: bold;">:map</span> icomplete-minibuffer-map
<span class="linenr">527: </span>        <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"C-n"</span> . icomplete-forward-completions<span style="color: #0072d4;">)</span>
<span class="linenr">528: </span>        <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"C-p"</span> . icomplete-backward-completions<span style="color: #0072d4;">)</span>
<span class="linenr">529: </span>        <span style="color: #0072d4;">(</span><span style="color: #009c8f;">"RET"</span> . icomplete-force-complete-and-exit<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
</pre>
</div>

<p>
I setup some preferred keybindings here. If first two keybindings just
reuses the same keys to move between lines in the bufferÂ â€” to go
forward and backward in the completion list, then the latest
keybinding is very important.
</p>

<p>
By default IComplete wants a fully matched string (except
file/directory autocomplete) to accept it as a completion result. For
example, if I type <code>M-x package</code> and press Enter the <code>package-delete</code>
will not be executedÂ â€” because there are a lot of another completion
candidates which matches with the same substring:
</p>


<div class="figure">
<p><img src="/assets/static/minibuffer-comp-package-delete.png" alt="Minibuffer completion with IComplete with the &quot;package-&quot; typed in the minibuffer and the list of completion candidates below." align="center" width="50%" />
</p>
</div>

<p>
So I need to continue typing while the only one completion candidate
will last. Or press <code>M-j</code> to force completion. This is not what I used
for. Thats why the last keybinding rebinds <code>M-j</code> to <code>RET</code>. With it I can
select the necessary candidate from the list (for example
<code>package-install</code> then press <code>Enter</code> and the selected candidate will be
executed without any questions.
</p>

<p>
On the <code>:hook</code> section I just enable necessary IComplete mode and
disable unnecessary modes from the start:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">530: </span><span style="color: #53676d; font-weight: bold;">:hook</span>
<span class="linenr">531: </span><span style="color: #009c8f;">(</span>after-init . <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #0072d4;">()</span>
<span class="linenr">532: </span>                <span style="color: #0072d4;">(</span>fido-mode -1<span style="color: #0072d4;">)</span>
<span class="linenr">533: </span>                <span style="color: #0072d4;">(</span>icomplete-mode 1<span style="color: #0072d4;">)</span>
<span class="linenr">534: </span>                <span style="color: #0072d4;">(</span>icomplete-vertical-mode 1<span style="color: #0072d4;">)</span>
<span class="linenr">535: </span>                <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> icomplete-scroll t<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Here I using the <code>icomplete-vertical-mode</code> which displays completion
candidates in mutliple verical lines the minibuffer (look at the
previous screenshot).
</p>

<p>
The last line changes the minibuffer behaviour when I move between the
completion candidates. By default, if <code>icomplete-scroll</code> is set to <code>nil</code>,
then the cursor position doesn't change and the list of candidates
rotates itself:
</p>


<div class="figure">
<p><img src="/assets/static/icomplete-scroll-nil.gif" alt="Rotating list of completion candidates in the minibuffer." align="center" width="50%" />
</p>
<p class="fignum"><i>(setopt icomplete-scroll nil)</i></p>
</div>

<p>
But when I set <code>icomplete-scroll</code> to <code>t</code> things changeÂ â€” now the
completion list doesn't move and the cursor moves itselfÂ â€” like a
common dropdown list in a common GUI:
</p>


<div class="figure">
<p><img src="/assets/static/icomplete-scroll-t.gif" alt="Scrolling cursor in the list of completion candidates in the minibuffer." align="center" width="50%" />
</p>
<p class="fignum"><i>(setopt icomplete-scroll t)</i></p>
</div>

<p>
The next lines slightly tweaks IComplete so it will display completion
candidates in my way, with:
</p>
<ul class="org-ul">
<li>Show matches from start even if user enters nothing in the
minibuffer. So if I want just to repeat the latest command I may do
<code>M-x RET</code>.</li>
<li>Limits height of completions' list in the minibuffer to 10 lines.</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">536: </span><span style="color: #53676d; font-weight: bold;">:custom</span>
<span class="linenr">537: </span><span style="color: #009c8f;">(</span>icomplete-show-matches-on-no-input t <span style="color: #009c8f;">"Show completion from start"</span><span style="color: #009c8f;">)</span>
<span class="linenr">538: </span><span style="color: #009c8f;">(</span>icomplete-hide-common-prefix nil <span style="color: #009c8f;">"Don't hide anything from me"</span><span style="color: #009c8f;">)</span>
<span class="linenr">539: </span><span style="color: #009c8f;">(</span>icomplete-prospects-height 10 <span style="color: #009c8f;">"Max number of lines used in minibuffer"</span><span style="color: #009c8f;">)</span>
<span class="linenr">540: </span><span style="color: #009c8f;">(</span>icomplete-with-completion-tables t <span style="color: #009c8f;">"Use completion tables"</span><span style="color: #009c8f;">)</span>
<span class="linenr">541: </span><span style="color: #009c8f;">(</span>icomplete-in-buffer t <span style="color: #009c8f;">"Use IComplete also in ordinary buffers"</span><span style="color: #009c8f;">)</span>
<span class="linenr">542: </span><span style="color: #009c8f;">(</span>icomplete-max-delay-chars 0 <span style="color: #009c8f;">"Max number of chars to start completion"</span><span style="color: #009c8f;">)</span><span style="color: #53676d; background-color: #fbf3db;">)</span>
</pre>
</div>

<p>
Also here some setup performed to use IComplete right in the ordinary
buffers with <code>M-TAB</code> and with the same hotkeys and behaviour:
</p>


<div class="figure">
<p><img src="/assets/static/icomplete-in-buffer.png" alt="Autocompletion with IComplete in the ordinary buffer." align="center" width="90%" />
</p>
<p class="fignum"><i>Completion in the Emacs Lisp buffer with M-TAB</i></p>
</div>
</div>
<div id="outline-container-rc-emacs-icomplete-nerd-icons" class="outline-3">
<h3 id="rc-emacs-icomplete-nerd-icons">Nerd icons for the completion</h3>
<div class="outline-text-3" id="text-rc-emacs-icomplete-nerd-icons">
<p>
For completion candidates I can use the Nerd icons (see the <a href="#rc-emacs-nerd-icons">"Nerd
icons"</a> section) too! The necessary magic is performed by the
<a href="https://github.com/rainstormstudio/nerd-icons-completion">nerd-icons-completion</a> plugin:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr">544: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> nerd-icons-completion
<span class="linenr">545: </span>  <span style="color: #53676d; font-weight: bold;">:pin</span> melpa
<span class="linenr">546: </span>  <span style="color: #53676d; font-weight: bold;">:functions</span> nerd-icons-completion-mode
<span class="linenr">547: </span>  <span style="color: #53676d; font-weight: bold;">:after</span> nerd-icons
<span class="linenr">548: </span>  <span style="color: #53676d; font-weight: bold;">:requires</span> nerd-icons
<span class="linenr">549: </span>  <span style="color: #53676d; font-weight: bold;">:hook</span> <span style="color: #ad8900;">(</span>minibuffer-mode icomplete-mode<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
<span class="linenr">550: </span>
<span class="linenr">551: </span><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">provide</span> '<span style="color: #0072d4; font-weight: bold;">rc-emacs</span><span style="color: #009c8f;">)</span>
<span class="linenr">552: </span><span style="color: #909995;">;;; </span><span style="color: #909995;">rc-emacs.el ends here</span>
</pre>
</div>

<p>
With this plugin I receive nice icons in the:
</p>


<div class="figure">
<p><img src="/assets/static/nerd-icons-c-x-c-f.png" alt="Nerd icons in the minibuffer after C-x C-f" align="center" width="90%" />
</p>
<p class="fignum"><i>Minibuffer after C-x C-f</i></p>
</div>


<div class="figure">
<p><img src="/assets/static/nerd-icons-in-project.png" alt="Nerd icons in the minibuffer after C-x p p to select my project" align="center" width="90%" />
</p>
<p class="fignum"><i>List of my projects provided by project.el</i></p>
</div>


<div class="figure">
<p><img src="/assets/static/nerd-icons-in-completions-buffer.png" alt="Nerd icons in the *Completions* buffer with a list of completions for some Emacs Lisp code." align="center" width="90%" />
</p>
<p class="fignum"><i><code>*Completions*</code> buffer</i></p>
</div>
</div>
</div>
</div>
<div id="outline-container-downloads" class="outline-2">
<h2 id="downloads">Downloads</h2>
<div class="outline-text-2" id="text-downloads">
<p>
All code, described in the post, are concatenated to the files in "literate
programming" manner and uploaded here with the great help of Org Babel and Org
Publish. <i>Note:</i> some lines' indentation are broken ðŸ™.
</p>

<p>
These files can be downloaded by these links:
</p>
<ul class="org-ul">
<li><a href="/assets/static/emacsd.txt">emacsd startup script</a></li>
<li><a href="/assets/static/early-init.el.txt">early-init.el</a></li>
<li><a href="/assets/static/init.el.txt">init.el</a></li>
<li><a href="/assets/static/rc-emacs.el.txt">rc-emacs.el</a></li>
</ul>
</div>
</div>
<div id="outline-container-update-2025-07-09" class="outline-2">
<h2 id="update-2025-07-09">Update 2025-07-09</h2>
<div class="outline-text-2" id="text-update-2025-07-09">
<p>
Looks like this line from <code>rc-emacs.el</code> doesn't work properly with Emacs
in daemon mode:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">                                        <span style="color: #909995;">; </span><span style="color: #909995;">Skip type of function when TAB in the help window</span>
<span style="color: #009c8f;">(</span>button-type-put 'help-type 'skip t<span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
So I moved it to the <code>server-after-make-frame-hook</code>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">                                        <span style="color: #909995;">; </span><span style="color: #909995;">Skip type of function when TAB in the help window</span>
<span style="color: #009c8f;">(</span>add-hook 'server-after-make-frame-hook
          <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #0072d4;">()</span>
            <span style="color: #0072d4;">(</span>button-type-put 'help-type 'skip t<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-update-2025-08-10" class="outline-2">
<h2 id="update-2025-08-10">Update 2025-08-10</h2>
<div class="outline-text-2" id="text-update-2025-08-10">
<p>
The <code>pinentry</code> configuration didn't work correctlyÂ â€” the <code>pinentry-start</code>
wasn't called during the Emacs startup at the right time. So, now it
is called right after first frame creation, when user definitely
logged in and gpg, D-Bus and other necessary things already started.
All <code>pinentry</code> related things were moved to the separate <code>use-package</code>
clause:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> pinentry
  <span style="color: #53676d; font-weight: bold;">:pin</span> gnu
  <span style="color: #53676d; font-weight: bold;">:custom</span>
  <span style="color: #ad8900;">(</span>epg-pinentry-mode 'loopback<span style="color: #ad8900;">)</span>
  <span style="color: #53676d; font-weight: bold;">:config</span>
  <span style="color: #ad8900;">(</span>add-hook 'server-after-make-frame-hook
            <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #8762c6;">()</span>
              <span style="color: #8762c6;">(</span>pinentry-start<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
Lines for <code>tramp</code> were changed too. Now there is a <code>sudo</code> alias to call
<code>tramp-revert-buffer-with-sudo</code> instead of corresponding hand-written
function:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> tramp
  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
  <span style="color: #53676d; font-weight: bold;">:init</span>
  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">defalias</span> '<span style="color: #0072d4;">sudo</span> 'tramp-revert-buffer-with-sudo
    <span style="color: #009c8f;">"Simpler `</span><span style="color: #0072d4; font-weight: bold;">tramp-revert-buffer-with-sudo</span><span style="color: #009c8f;">' function."</span><span style="color: #ad8900;">)</span>
  <span style="color: #53676d; font-weight: bold;">:custom</span>
  <span style="color: #ad8900;">(</span>tramp-show-ad-hoc-proxies t<span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>tramp-use-connection-share t <span style="color: #009c8f;">"Share ssh connection"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>tramp-use-scp-direct-remote-copying t <span style="color: #009c8f;">"Use scp to copy files &#8212; to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>tramp-verbose 2 <span style="color: #009c8f;">"Decrease verbosity &#8212; to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>remote-file-name-access-timeout 10 <span style="color: #009c8f;">"Timeout when restoring session with remote file. In seconds"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>remote-file-name-inhibit-locks t <span style="color: #009c8f;">"Don't use lock files to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>remote-file-name-inhibit-auto-save-visited t <span style="color: #009c8f;">"Don't autosave remote files"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>vc-handled-backends '<span style="color: #0072d4;">(</span>Git<span style="color: #0072d4;">)</span> <span style="color: #009c8f;">"VCS backends in use list &#8212; to speed up TRAMP"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>auth-sources '<span style="color: #0072d4;">(</span><span style="color: #009c8f;">"~/.authinfo.gpg"</span> <span style="color: #009c8f;">"~/.netrc"</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
  <span style="color: #53676d; font-weight: bold;">:config</span>
                                        <span style="color: #909995;">; </span><span style="color: #909995;">Use direct async processes for TRAMP</span>
                                        <span style="color: #909995;">; </span><span style="color: #909995;">https://www.gnu.org/software/tramp/#Improving-performance-of-asynchronous-remote-processes-1</span>
                                        <span style="color: #909995;">; </span><span style="color: #909995;">https://coredumped.dev/2025/06/18/making-tramp-go-brrrr./</span>
  <span style="color: #ad8900;">(</span>connection-local-set-profile-variables
   'remote-direct-async-process
   '<span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span>tramp-direct-async-process . t<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>connection-local-set-profiles
   '<span style="color: #0072d4;">(</span><span style="color: #53676d; font-weight: bold;">:application</span> tramp <span style="color: #53676d; font-weight: bold;">:protocol</span> <span style="color: #009c8f;">"scp"</span><span style="color: #0072d4;">)</span>
   'remote-direct-async-process<span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>connection-local-set-profiles
   '<span style="color: #0072d4;">(</span><span style="color: #53676d; font-weight: bold;">:application</span> tramp <span style="color: #53676d; font-weight: bold;">:protocol</span> <span style="color: #009c8f;">"ssh"</span><span style="color: #0072d4;">)</span>
   'remote-direct-async-process<span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> magit-tramp-pipe-stty-settings 'pty<span style="color: #ad8900;">)</span>
                                        <span style="color: #909995;">; </span><span style="color: #909995;">Disable backups for files, opened via TRAMP</span>
  <span style="color: #ad8900;">(</span>add-to-list 'backup-directory-alist
               <span style="color: #0072d4;">(</span>cons tramp-file-name-regexp nil<span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-update-2025-09-06" class="outline-2">
<h2 id="update-2025-09-06">Update 2025-09-06</h2>
<div class="outline-text-2" id="text-update-2025-09-06">
<p>
Oh, writing the working configuration for pinentry, TRAMP and some
elisp functions, like <code>eshell/sudo</code>, which are working with
<code>~/.authsources.gpg</code> (and all of these are working with
<code>desktop-save=/=desktop-read</code>) is such a pain!
</p>

<p>
Finally, I wrote some lines for pinentryÂ â€” with it asking for GPG-key
passphrase <i>almost</i> every time I work with my GPG-keys. Except the fresh
start of Emacs daemon, when the saved Emacs state is loaded via
<code>desktop-read</code>. <i>Sometimes</i> it works without problems and <i>sometimes</i> I
should manually run <code>M-x pinentry-start</code> to avoid errors like this:
</p>

<pre class="example">
Error while decrypting with "/usr/local/bin/gpg2":

gpg: encrypted with rsa4096 key, ID 5FBD082A4D359793, created 2018-08-31
      "Eugene &lt;evg.andrienko@gmail.com&gt;"
gpg: public key decryption failed: Operation cancelled
gpg: decryption failed: Operation cancelled
</pre>

<p>
The configuration:
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> pinentry
  <span style="color: #53676d; font-weight: bold;">:demand</span> t
  <span style="color: #53676d; font-weight: bold;">:pin</span> gnu
  <span style="color: #53676d; font-weight: bold;">:init</span>
  <span style="color: #ad8900;">(</span>add-hook 'server-after-make-frame-hook
            <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #8762c6;">()</span>
              <span style="color: #8762c6;">(</span>pinentry-start<span style="color: #8762c6;">)</span>
              <span style="color: #8762c6;">(</span>shell-command <span style="color: #009c8f;">"gpg-connect-agent /bye"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>add-hook 'desktop-after-read-hook
            <span style="color: #0072d4;">(</span><span style="color: #489100; font-weight: bold;">lambda</span> <span style="color: #8762c6;">()</span>
              <span style="color: #8762c6;">(</span>pinentry-start<span style="color: #8762c6;">)</span>
              <span style="color: #8762c6;">(</span>shell-command <span style="color: #009c8f;">"gpg-connect-agent /bye"</span><span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
  <span style="color: #53676d; font-weight: bold;">:custom</span>
  <span style="color: #ad8900;">(</span>epg-pinentry-mode 'loopback<span style="color: #ad8900;">)</span>
  <span style="color: #53676d; font-weight: bold;">:config</span>
  <span style="color: #ad8900;">(</span>pinentry-start<span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>shell-command <span style="color: #009c8f;">"gpg-connect-agent /bye"</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>setenv <span style="color: #009c8f;">"GPG_AGENT_INFO"</span> nil<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
About TRAMP. Looks like, it was a bad idea to store credentials for my
local machine in the <code>~/.authinfo.gpg</code> to load them with previously
unlocked GPG-key, to avoid typing a user's password. It will fail if
pinentry wasn't started. And, much worse, it <b>will hang</b> the whole Emacs
daemon even if pinentry was started but key was locked (but sometimes,
rarely, this doesn't happen).
</p>

<p>
So, my solution is to instruct TRAMP to ask for my user password and
don't use <code>~/.authinfo.gpg</code>, if I'm working with elisp versions of
<code>su/sudo/doas</code> (from Eshell) on the local machine:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> tramp
  <span style="color: #53676d; font-weight: bold;">:ensure</span> nil
  <span style="color: #909995;">;; </span><span style="color: #909995;">...</span>
  <span style="color: #909995;">;; </span><span style="color: #909995;">Skipped</span>
  <span style="color: #909995;">;; </span><span style="color: #909995;">...</span>
  <span style="color: #53676d; font-weight: bold;">:config</span>
  <span style="color: #909995;">;; </span><span style="color: #909995;">...</span>
  <span style="color: #909995;">;; </span><span style="color: #909995;">Skipped</span>
  <span style="color: #909995;">;; </span><span style="color: #909995;">...</span>
                                        <span style="color: #909995;">; </span><span style="color: #909995;">Don't use ~/.authinfo.gpg for su/sudo/doas connections</span>
  <span style="color: #ad8900;">(</span>connection-local-set-profile-variables
   'remote-without-auth-sources
   '<span style="color: #0072d4;">(</span><span style="color: #8762c6;">(</span>auth-sources . nil<span style="color: #8762c6;">)</span><span style="color: #0072d4;">)</span><span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>connection-local-set-profiles
   '<span style="color: #0072d4;">(</span><span style="color: #53676d; font-weight: bold;">:application</span> tramp <span style="color: #53676d; font-weight: bold;">:protocol</span> <span style="color: #009c8f;">"sudo"</span><span style="color: #0072d4;">)</span>
   'remote-without-auth-sources<span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>connection-local-set-profiles
   '<span style="color: #0072d4;">(</span><span style="color: #53676d; font-weight: bold;">:application</span> tramp <span style="color: #53676d; font-weight: bold;">:protocol</span> <span style="color: #009c8f;">"su"</span><span style="color: #0072d4;">)</span>
   'remote-without-auth-sources<span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span>connection-local-set-profiles
   '<span style="color: #0072d4;">(</span><span style="color: #53676d; font-weight: bold;">:application</span> tramp <span style="color: #53676d; font-weight: bold;">:protocol</span> <span style="color: #009c8f;">"doas"</span><span style="color: #0072d4;">)</span>
   'remote-without-auth-sources<span style="color: #ad8900;">)</span>
  <span style="color: #ad8900;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> magit-tramp-pipe-stty-settings 'pty<span style="color: #ad8900;">)</span><span style="color: #009c8f;">)</span>
</pre>
</div>

<p>
But beware! If hostname of your machine, set in the <code>/etc/rc.conf</code>
doesn't match with hostname for 127.0.0.1 specified in the <code>/etc/hosts</code>,
then TRAMP <b>will hang</b> the whole Emacs daemon even with settings from
above.
</p>
</div>
</div>
<div id="outline-container-final-gpg-pinentry-fix" class="outline-2">
<h2 id="final-gpg-pinentry-fix">Update 2025-10-06 Final GPG Pinentry fix</h2>
<div class="outline-text-2" id="text-final-gpg-pinentry-fix">
<p>
The previous fix for using Emacs as <code>pinentry</code> was failedÂ â€” sometimes,
for example in <code>vc-mode</code>, the GPG still tries to use tty pinenty to ask
about passphrase, not the Emacs, itself. After examining some
information in the Internet, I found only one solution which works.
</p>

<p>
Emacs-pinentry should not be configured with <code>use-package</code>. The next
simple configuration is works without any problems:
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">use-package</span> pinentry
  <span style="color: #53676d; font-weight: bold;">:demand</span> t
  <span style="color: #53676d; font-weight: bold;">:pin</span> gnu<span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">require</span> '<span style="color: #0072d4; font-weight: bold;">pinentry</span><span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">(</span><span style="color: #489100; font-weight: bold;">setopt</span> epg-pinentry-mode 'loopback<span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">(</span>call-process-shell-command <span style="color: #009c8f;">"/usr/local/bin/gpgconf --launch-agent"</span> nil nil 't<span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">(</span>call-process-shell-command <span style="color: #009c8f;">"/usr/local/bin/gpg-connect-agent updatestartuptty /bye"</span> nil nil 't<span style="color: #009c8f;">)</span>
<span style="color: #009c8f;">(</span>pinentry-start<span style="color: #009c8f;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-notes" class="outline-2">
<h2 id="notes">Notes</h2>
<div class="outline-text-2" id="text-notes">
</div>
</div>
<div id="footnotes">

<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.cedet" class="footnum" href="#fnr.cedet" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Collection of Emacs Development Environment Tools.
<a href="https://cedet.sourceforge.net/">https://cedet.sourceforge.net/</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.sicp" class="footnum" href="#fnr.sicp" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
SICPÂ â€” Structure and Interpretation of Computer Programs. <a href="https://mitpress.mit.edu/9780262510875/structure-and-interpretation-of-computer-programs/">https://mitpress.mit.edu/9780262510875/structure-and-interpretation-of-computer-programs/</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.repl" class="footnum" href="#fnr.repl" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
REPLÂ â€” read-eval-print loop:
<a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.slime" class="footnum" href="#fnr.slime" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://slime.common-lisp.dev/">https://slime.common-lisp.dev/</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.freebsd-x220" class="footnum" href="#fnr.freebsd-x220" role="doc-backlink">5</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
More details can be found in this post: <a href="https://eugene-andrienko.com/en/it/2025/03/10/freebsd14-2-thinkpad-x220#power-management">FreeBSD 14.2 and
Thinkpad X220</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.stumpwm" class="footnum" href="#fnr.stumpwm" role="doc-backlink">6</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Tiling window manager written in the Common Lisp.
<a href="https://stumpwm.github.io/">https://stumpwm.github.io/</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.package-el" class="footnum" href="#fnr.package-el" role="doc-backlink">7</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Emacs has something like package manager which helps to
install various plugins from different repositories. For more
information see <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Packages.html">"50 Emacs Lisp Packages"</a> in the Emacs manual.
</p></div></div>

<div class="footdef"><sup><a id="fn.use-package" class="footnum" href="#fnr.use-package" role="doc-backlink">8</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
use-package library provides a very useful <code>use-package</code> macro,
which helps to organize different plugins' configuration. And, that is more
valuable, it helps to speed up the Emacs loading a lot. It is possible because
<code>use-package</code> can defer the loading of some pluginÂ â€” it will be loaded only in
that time when we user start to use this plugin.
</p>

<p class="footpara">
For more information look to the <a href="https://www.gnu.org/software/emacs/manual/html_mono/use-package.html">"use-package User Manual"</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.fontification" class="footnum" href="#fnr.fontification" role="doc-backlink">9</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Different fonts can be applied to the different parts of
buffer.
</p></div></div>

<div class="footdef"><sup><a id="fn.mode-line-format" class="footnum" href="#fnr.mode-line-format" role="doc-backlink">10</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/_0025_002dConstructs.html">"24.4.5 %-Constructs in the Mode Line"</a> from Emacs
manual.
</p></div></div>

<div class="footdef"><sup><a id="fn.stow" class="footnum" href="#fnr.stow" role="doc-backlink">11</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
GNU Stow: <a href="https://www.gnu.org/software/stow/">https://www.gnu.org/software/stow/</a>. It helps to install
different files from different places as a symlinks.
</p></div></div>

<div class="footdef"><sup><a id="fn.isearch" class="footnum" href="#fnr.isearch" role="doc-backlink">12</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Incremental Search. See <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Incremental-Search.html">"17.1 Incremental Search"</a> in the Emacs
manual.
</p></div></div>

<div class="footdef"><sup><a id="fn.ielm" class="footnum" href="#fnr.ielm" role="doc-backlink">13</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Inferior Emacs Lisp mode: <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Lisp-Interaction.html">"29.10 Lisp Interaction Buffers"</a>. I use it as
a REPL for Emacs Lisp when I don't use <code>*scratch*</code> buffer for some reason.
</p></div></div>

<div class="footdef"><sup><a id="fn.advice-add" class="footnum" href="#fnr.advice-add" role="doc-backlink">14</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Porting-Old-Advice.html">"13.12.4 Adapting code using the old defadvice"</a> in the
Emacs manual.
</p></div></div>

<div class="footdef"><sup><a id="fn.compose-key" class="footnum" href="#fnr.compose-key" role="doc-backlink">15</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
The Compose key (also named as Multi_key) is a very neat feature
of X server. It allows to enter a lot of nice character used in typography,
which are not exists on the keyboard keys. First, press and release the
Compose key (usually it is binded to AltGr or Right Alt key), then press some
two or three keys to print a necessary symbol.
</p>

<p class="footpara">
For example:
</p>
<table border="2" cellspacing="0" cellpadding="6" frame="void">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Keys to press</th>
<th scope="col" class="org-left">Resulting symbol</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Compose - - -</td>
<td class="org-left">â€”</td>
</tr>

<tr>
<td class="org-left">Compose 1 2</td>
<td class="org-left">Â½</td>
</tr>

<tr>
<td class="org-left">Compose &lt; &lt;</td>
<td class="org-left">Â«</td>
</tr>

<tr>
<td class="org-left">Compose &gt; &gt;</td>
<td class="org-left">Â»</td>
</tr>

<tr>
<td class="org-left">Compose o o</td>
<td class="org-left">Â°</td>
</tr>
</tbody>
</table>

<p class="footpara">
Small and non-complete list of possible combinations can be found <a href="https://andyf.me/compose-key.html">here</a>. A
complete list can be found in this file:
<code>/usr/local/lib/X11/locale/en_US.UTF-8/Compose</code> in the FreeBSD system.
</p></div></div>

<div class="footdef"><sup><a id="fn.poudriere" class="footnum" href="#fnr.poudriere" role="doc-backlink">16</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See my another blog post:
<a href="https://eugene-andrienko.com/en/it/2025/03/30/freebsd-pkgs-wout-unwanted-deps">My way to remove "Linuxisms" from FreeBSD</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.occur" class="footnum" href="#fnr.occur" role="doc-backlink">17</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<code>M-x occur</code> searches for given substring in current Emacs buffer. It
allows to quickly start editing found occurrencies at once with the <code>e</code> hotkey
and save changes made with <code>C-c C-c</code> hotkey.
</p></div></div>

<div class="footdef"><sup><a id="fn.grep" class="footnum" href="#fnr.grep" role="doc-backlink">18</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<code>M-x grep</code> searches for given regexp with <code>grep</code> in current Emacs buffer or
in given file. It also allows to edit search results in line with the <code>wgrep</code>
plugin.
</p></div></div>

<div class="footdef"><sup><a id="fn.side-window" class="footnum" href="#fnr.side-window" role="doc-backlink">19</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
For more information about <i>side windows</i> see the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Side-Windows.html">"29.17 Side
Windows"</a> section in the Emacs manual.
</p></div></div>

<div class="footdef"><sup><a id="fn.major-mode" class="footnum" href="#fnr.major-mode" role="doc-backlink">20</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
For more info about major modes and how they are selected see:
<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Major-Modes.html">"25.1 Major Modes"</a> in the Emacs manual.
</p></div></div>

<div class="footdef"><sup><a id="fn.input-method" class="footnum" href="#fnr.input-method" role="doc-backlink">21</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Emacs <i>input methods</i> could convert usual Latin
characters to the something another. For example, for input method
"russian-computer" if I type <code>q</code>, then Emacs will print <code>Ð¹</code>; the <code>g</code> will be
converted to <code>Ð¿</code> and so on. There are tons of different <i>input methods</i>,
even for entering emojis, see the <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Input-Methods.html">"24.3 Input Methods"</a> for more
information.
</p></div></div>

<div class="footdef"><sup><a id="fn.faces" class="footnum" href="#fnr.faces" role="doc-backlink">22</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See the <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Faces.html">"16.8 Text Faces"</a> in the manual for some information about
<i>faces</i> in the Emacs.
</p></div></div>

<div class="footdef"><sup><a id="fn.org-jekyll" class="footnum" href="#fnr.org-jekyll" role="doc-backlink">23</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See my blog post about blog generation in Emacs: <a href="https://eugene-andrienko.com/en/it/2024/12/01/emacs-plugin-jekyll-blog.html">"How I
wrote an Emacs plugin to build my blog"</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.tramp" class="footnum" href="#fnr.tramp" role="doc-backlink">24</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See the <a href="https://www.gnu.org/software/tramp/">"TRAMP 2.7.2 User Manual"</a>.
</p></div></div>


</div>
</div>