<p>I have been thinking about setting up network attached storage (a NAS) for a while. The largest collection of files in my home folder on all my machines is in the Music and Photos folders, and since they are on both my Linux box and my Mac mini, that felt like unnecessary duplication and complexity. I need to sync the contents of both and back them up separately, which &mdash; given their size &mdash; is not a trivial matter. Moving these folders to a NAS share and then mounting the share on each of the computers that needed access would make much more sense, and I could also point my Roon Server at the Music folder to play local files.</p>
<p>My first thought was just to buy one of the well known pre-built NAS units (Synology or QNAP), but then I found out that there are several software projects to enable you to run a NAS on almost any hardware. Shortly after that, I discovered that small business servers (meant for small businesses, but also physically small) go for very reasonable prices used on ebay. And so, a plan formed. I would semi-DIY a NAS.</p>
<p>As I read more about setting up a NAS, I realised that I could do more than just serve files. Most NAS operating systems allow you to run Docker containers (to run applications in a &lsquo;sandboxed&rsquo; way), and also let you run whole other operating systems in a VM. As many online services become expensive, AI-infested, privacy-intruding nightmares, having the ability to self-host some simple services for myself becomes more and more attractive, so I wanted hardware and software which would make this easier.</p>
<h3 id="the-operating-system">The operating system</h3>
<p>The three main candidates were:</p>
<ul>
<li><a href="https://www.truenas.com/freenas/">TrueNAS Community Edition</a> (Open Source)</li>
<li><a href="https://www.proxmox.com/en/">Proxmox</a> (Open Source)</li>
<li><a href="https://unraid.net">Unraid</a></li>
</ul>
<p>The first two have free (as in beer) editions, while you need to pay for a licence for Unraid. However, it is not too expensive (currently $49 for a non-expiring licence, with free updates for a year, and cheaper upgrade costs in subsequent years). All seemed like very capable operating systems. TrueNAS focuses on the NAS aspect, while Proxmox leans more on VM hosting. Unraid was, for me, the &lsquo;mummy bear&rsquo; of the Goldilocks&rsquo; choices, with a balance between all those elements. It also seemed like there was a very helpful community around it too, which is always reassuring.</p>
<h3 id="the-hardware">The hardware</h3>
<p>I noticed that quite a few people seemed to be using various models of HP&rsquo;s ProLiant MicroServers as home NAS units, and that there are <em>lots</em> of them on ebay, at low prices. They are reasonably quiet and energy efficient, and while kind of boring looking, they don&rsquo;t stand out in a home environment.</p>
<p>After mooching about on ebay for a bit, I came across a gen10 unit, complete with 32GB of RAM, four 3TB Western Digital NAS hard drives, and one 1TB SSD, with Proxmox installed, all for less than I would pay for an empty 4-bay Synology NAS. It also had expansion capabilities via PCI slots, so there were options to upgrade things later.</p>
<h3 id="building-the-system">Building the system</h3>
<p>Unraid installs and runs from a USB thumb drive, which is unusual, but works fine in practice. It means that you can install the Unraid OS to the drive from another machine, and pre-set a few parameters. As it happens, the MicroServer has a socket for a USB thumb drive inside the casing, which means that there is no danger of the OS drive being pulled out or knocked accidentally. I hooked the DisplayPort output up to my monitor, and mashed the delete key to enter the BIOS. Then I just had to check a few settings, and change the boot order so that a USB stick would boot first.</p>
<p>From there, it was relatively plain sailing. Once I had established that it booted correctly, I shut it down, moved it back to its proper place in the TV cabinet, and I could then access the interface through a browser. Thursday (as I named it)<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> is a little beauty, and the Unraid OS is pretty easy to find your way around once you get your bearings. You can run a ZFS array of disks, but the standard setup with Unraid is to have one disk as your parity drive, and the rest as your array. Once you have defined your drives in their roles, and started the array, it automatically sets them up correctly. It takes quite a few hours for the parity check, but it is an ingenious system. Basically, for each corresponding sector on the drives, the system tallies up whether each drive has a one or a zero in that sector. If the total is an odd number (say, I forget which way round it works), a one is stored in that sector of the parity drive, and if it is an even number, a zero is stored. If one of the drives in the array fails, the parity information allows the system to reconstruct the data on that drive by inference, and it can reconstruct it when you insert a replacement drive.</p>
<p>There is a Community app store, from which you can install plugins and Docker containers for an enormous variety of self-hosted apps and services. Again, this is pretty straightforward, and the interface makes it easy to stop, start or edit containers once installed. You can also set up scheduled checks of the parity drive and the SMART status of the array drives, which is important to pick up any problems quickly. Hard drives don&rsquo;t last forever, and I looked on the set I got with the MicroServer as a nice bonus rather than a long term solution. I expected that I would have to replace them all in due course, but it was a cheap way of getting started.</p>
<p>After a couple of weeks, a scheduled parity check showed up read/write errors in the Parity drive. I wasn&rsquo;t too upset about this, as this was the first drive I planned to replace anyway. The size of the parity drive defines the maximum size that any of the array drives can be. Since 3TB NAS-quality drives are a bit harder to find these days as drives get larger, I thought that going up to 6TB would give me more options when replacing the others in due course.</p>
<p>Again, replacing this drive was pretty easy: stop the array, power down the server, pull out the dead drive, insert the new one, power up and select the new drive as parity, start the array. It is all humming along nicely again now.</p>
<h3 id="what-im-self-hosting">What I&rsquo;m self hosting</h3>
<p>The first job was to set up shares for the Music and Photos, which I have now done. Now that I can mount the remote shares, it considerably reduces the size of the home folders on my devices. I don&rsquo;t have the fastest wired network in the world, but playing even high resolution audio files over the network via the network share works very smoothly with no buffering problems. In the process of moving my photos across, I also consolidated them into date-based folders. I&rsquo;ve used Aperture, Lightroom and Capture One previously, so the RAW files and sidecar files were scattered all over. It feels good to have them more organised now.</p>
<p>I then turned my attention to getting some self-hosted stuff set up. Unraid recently officially incorporated Tailscale into the Docker container set up. If you haven&rsquo;t come across <a href="https://tailscale.com">Tailscale</a> (I hadn&rsquo;t before I started listening to Linux podcasts &mdash; they seem to sponsor <em>all of them</em>), it is a VPN of sorts, but one that creates a secure mesh network between your devices, without needing to mess around opening ports on your router. So, if you add your desktops, laptops, phones, NAS, and even docker containers running on your NAS, you can connect securely to the other devices using a Tailnet IP address or domain name. They even set up HTTPS certificates automatically. Tailscale lets you choose a memorable but random &lsquo;Tailnet name&rsquo; like &lsquo;wombat-slipper.ts.net&rsquo; which forms the domain name for your Tailnet. This means that from anywhere (not just on my local network) I can access the NAS dashboard with a URL like <code>https://thursday.wombat-slipper.ts.net/</code>. Everything is secure because I have no open ports on my home router, and I can only access that URL if I am logged in with Tailscale on my device.</p>
<p>So, with Tailscale in place to protect my self-hosted services and enable me to connect to them when out and about, I set up a few useful things. I should mention that I have set up all the Docker containers to run from the 1TB SSD for slightly better performance. It also separates things out nicely between the drives, and makes managing them a bit easier.</p>
<p>I had Syncthing installed before, syncing several folder between my Linux box, Macs and my iPhone, but swapping things around so that Thursday acts as the hub and all the other devices sync only with Thursday makes things much more efficient because the NAS is always running.</p>
<p>I have been using Inoreader recently for my RSS reader, but I figured that this was something which I could certainly usefully self-host. <a href="https://miniflux.app">Miniflux</a> turned out to be minimal but very functional, with nice keyboard navigation and integration of other services like Raindrop.io for saving articles to read later. Again, having it connected with Tailscale means that I can set up Uread on iOS to connect to my Miniflux app and read it in a different interface on the phone. If you try this yourself, you need to use the Fever API on Miniflux, but it works very smoothly. I will end my subscription with Inoreader and save myself some money, as I get all I need with Miniflux. Miniflux also needs a Postgres database to operate, but that too was installed via a Docker container, and may well be useful for other apps that I install.</p>
<p>Finally (for now, I&rsquo;m sure I will install other stuff), I added <a href="https://github.com/pawelmalak/flame">Flame</a> which is a minimal start page for the browser that you can also use for new tabs. This is a little luxury, but I have set it up with icons for my most used apps (such as Thursday&rsquo;s dashboard and Miniflux), plus bookmarks for sites that I use daily, all of which are keyboard accessible by hitting escape then typing to filter the name and then hitting enter. It&rsquo;s a calm and functional page to land on when I open a new tab.</p>
<h3 id="thoughts-so-far">Thoughts so far</h3>
<p>I&rsquo;ve been really impressed with both the MicroServer and Unraid. Unraid is deceptively flexible and powerful, and I think the licence fee is very reasonable for what it provides. I am sure that it would be possible to do the same thing on either TrueNAS or Proxmox, but I found Unraid very approachable as a NAS newbie. One other consideration is that Unraid allows you to have different capacities of drives in the array, as long as the parity drive is at least as large as the largest of the array drives. I don&rsquo;t think this is the case for TrueNAS (I&rsquo;m not sure about Proxmox). This is a very useful thing for a home NAS enthusiast, because it means that you can gradually build up (or replace) drives, buying perhaps one new drive every year or so, and taking advantage of falling prices and greater capacities in the process.</p>
<p>I haven&rsquo;t tried setting up any VMs yet, but that might be the next adventure!</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>You may remember that my Linux box has the hostname &lsquo;Morse&rsquo;. If you have seen the series &lsquo;Endeavour&rsquo;, you will get the dorky reference.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>