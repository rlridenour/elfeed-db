<p>I recently wanted a few images stitched together. A perfect job for <a href="https://imagemagick.org/">ImageMagick</a>. A quick search yielded the magical incantation:</p>
<pre><code class="language-{.bash">convert image1.jpg image2.jpg image3.jpg +append joined.jpg
</code></pre>
<p>Great, now I know, but I'll rarely use it and will soon forget it. I may as well add it to my <a href="https://github.com/xenodium/dwim-shell-command/blob/main/dwim-shell-commands.el">repository</a> of <a href="https://en.wikipedia.org/wiki/DWIM">DWIM</a> command line utilities, wrapped in a convenient Emacs function, applicable from different contextsâ€¦ <a href="https://xenodium.com/emacs-dwim-do-what-i-mean/">know what I mean</a>? ðŸ™ƒ</p>
<p>I built <a href="https://github.com/xenodium/dwim-shell-command">dwim-shell-command</a> for this purpose. You can take the above command and easily turn it into an interactive Emacs command with something like the following:</p>
<pre><code class="language-{.commonlisp">(require 'dwim-shell-command)

(defun dwim-shell-commands-join-images-horizontally ()
  &quot;Join all marked images horizontally as a single image.&quot;
  (interactive)
  (dwim-shell-command-on-marked-files
   &quot;Join images horizontally&quot;
   &quot;convert -verbose '&lt;&lt;*&gt;&gt;' +append 'joined.jpg'&quot;
   :utils &quot;convert&quot;))
</code></pre>
<p>You can select as many images as you'd like from the comfort of your dired and <em>make the ImageMagick happen</em>.</p>
<p><img src="https://xenodium.github.io/images/joining-images-from-the-comfort-of-dired/burgers.gif" alt=""></p>
<p>The snippet does the job just fine, but we can make it smarter. For starters, let's not hardcode the output filename. We'll ask the user instead. While we're asking, let's offer a default filename, but let's not assume the output extension is <code>.jpg</code>. Let's guess based on the image selection. While we're at it, let's not override the output file if already exists. Uniquify it.</p>
<p>Most of the above can be achieved by either using <a href="https://github.com/xenodium/dwim-shell-command">dwim-shell-command</a> helpers or its templating language. For example, <code>&lt;&lt;joined.png(u)&gt;&gt;</code> ensures that if <code>joined.png</code> already exists, it automatically generates <code>joined(1).png</code> instead.</p>
<pre><code class="language-{.commonlisp">(require 'dwim-shell-command)

(defun dwim-shell-commands-join-images-horizontally ()
  &quot;Join all marked images horizontally as a single image.&quot;
  (interactive)
  (let ((filename (format &quot;joined.%s&quot;
                          (or (seq-first (dwim-shell-command--file-extensions)) &quot;png&quot;))))
    (dwim-shell-command-on-marked-files
     &quot;Join images horizontally&quot;
     (format &quot;convert -verbose '&lt;&lt;*&gt;&gt;' +append '&lt;&lt;%s(u)&gt;&gt;'&quot;
             (dwim-shell-command-read-file-name
              (format &quot;Join as image named (default \&quot;%s\&quot;): &quot; filename)
              :default filename))
     :utils &quot;convert&quot;)))
</code></pre>
<p>Here's the new horizontal command in actionâ€¦</p>
<p><img src="https://xenodium.github.io/images/joining-images-from-the-comfort-of-dired/burger_row_x1.5_optimized.gif" alt=""></p>
<p>Notice how this time we didn't mark the images using <code>dired-mark</code>, typically bound to <code>m</code>. Instead, we made our selection using the region. Also, if you haven't gotten your junk food fix yet, here's the fries equivalent ;)</p>
<p><img src="https://xenodium.github.io/images/joining-images-from-the-comfort-of-dired/fries_row_x1.5_optimized.gif" alt=""></p>
<p>We'll rinse all and repeat to get the vertical command equivalent. I know, I know, there's fair amount of duplication but c'est la vie.</p>
<pre><code class="language-{.commonlisp">(require 'dwim-shell-command)

(defun dwim-shell-commands-join-images-vertically ()
  &quot;Join all marked images vertically as a single image.&quot;
  (interactive)
  (let ((filename (format &quot;joined.%s&quot;
                          (or (seq-first (dwim-shell-command--file-extensions)) &quot;png&quot;))))
    (dwim-shell-command-on-marked-files
     &quot;Join images vertically&quot;
     (format &quot;convert -verbose '&lt;&lt;*&gt;&gt;' -append '&lt;&lt;%s(u)&gt;&gt;'&quot;
             (dwim-shell-command-read-file-name
              (format &quot;Join as image named (default \&quot;%s\&quot;): &quot; filename)
              :default filename))
     :utils &quot;convert&quot;)))
</code></pre>
<p>â€¦and for our grand finale, we'll vertically join our burgers and fries. Behold!</p>
<p><img src="https://xenodium.github.io/images/joining-images-from-the-comfort-of-dired/finale_x1.5_optimized.gif" alt=""></p>
<p>These commands are now part of <a href="https://github.com/xenodium/dwim-shell-command">dwim-shell-command</a>. To get them, load the optional commands via <code>(require 'dwim-shell-commands)</code>.</p>
