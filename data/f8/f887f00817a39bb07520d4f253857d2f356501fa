<p>If you’re using Emacs long enough sooner or later you’ll run into some
Emacs command that’s misbehaving and you’ll need to debug it somehow.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>

<p>If the command is just blowing up, probably you’ll be able to figure out
what’s going on by looking at its backtrace. To get meaningful backtraces
you can either run <code class="language-plaintext highlighter-rouge">M-x toggle-debug-on-error</code> or add this to your Emacs config:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">setq</span> <span class="nv">debug-on-error</span> <span class="no">t</span><span class="p">)</span>
</code></pre></div></div>

<p>Sometimes that will be enough, but other times you’ll need to dig deeper…
Fortunately for us Emacs features a super powerful built-in
<a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Edebug.html">Emacs Lisp debugger</a>
and using it is the best way to diagnose problems of any kind.<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup></p>

<p>To debug some command you need to do the following:</p>

<ul>
  <li>Figure out the name of the command you want to debug (e.g. by using <code class="language-plaintext highlighter-rouge">C-h k</code>
to see which command is associated with some keybinding)</li>
  <li>Find the source of the command (e.g. by using <code class="language-plaintext highlighter-rouge">M-x find-function RET function-name</code>)</li>
  <li>Press <code class="language-plaintext highlighter-rouge">C-u C-M-x</code> while in the body of the function</li>
  <li>Run the command again</li>
</ul>

<p>At this point you’ll be dropped in the debugger and you can step forward (by
pressing <code class="language-plaintext highlighter-rouge">n</code>) until you find the problem. The debugger is quite powerful and you
can do way more than just stepping through the code, though. Here are some of
the most useful commands to run in it:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">n</code> (next): Step over the next expression</li>
  <li><code class="language-plaintext highlighter-rouge">d</code> (step): Step into a function call</li>
  <li><code class="language-plaintext highlighter-rouge">c</code> (continue): Continue execution until the next breakpoint</li>
  <li><code class="language-plaintext highlighter-rouge">e</code> (eval): Evaluate a Lisp expression in the current context</li>
  <li><code class="language-plaintext highlighter-rouge">b</code> (break): Set a breakpoint at a specific line or function</li>
  <li><code class="language-plaintext highlighter-rouge">u</code> (unset): Remove a breakpoint</li>
  <li><code class="language-plaintext highlighter-rouge">q</code> (quit): Exit the debugger</li>
  <li><code class="language-plaintext highlighter-rouge">r</code> (return): Specify a return value and continue execution</li>
  <li><code class="language-plaintext highlighter-rouge">?</code> (help): Shows the full list of debugger commands.</li>
</ul>

<p>You can read more about the debugger commands <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Debugger-Commands.html">here</a>.
I would also suggest reading the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Using-Edebug.html">short tutorial</a> in Emacs’s
manual.</p>

<p>I use this approach all time and it’s very efficient. It’s also not specific to
commands and works great for all Emacs Lisp code. Every Emacs user will do well
to invest a bit of time into learning the basics of debugging Emacs Lisp code.</p>

<p>By the way, it’s probably not super obvious but when an error happens and you’ve
enabled <code class="language-plaintext highlighter-rouge">debug-on-error</code> (e.g. with <code class="language-plaintext highlighter-rouge">M-x toggle-debug-on-error</code>), you’re not just
getting a backtrace, but a backtrace - that’s actually another way in which you
can interact with the Emacs debugger. Press <code class="language-plaintext highlighter-rouge">?</code> while in this buffer or
check out <a href="/blog/2025/03/01/debugging-errors-in-emacs/">this short article</a> for more details.</p>

<p>That’s all I have for you today. Keep hacking!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Emacs commands are simply Emacs Lisp functions that can be invoked interactively with <code class="language-plaintext highlighter-rouge">M-x</code>. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>Here’s a <a href="https://www.youtube.com/watch?v=odkYXXYOxpo">great crash course</a> on using the debugger. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>