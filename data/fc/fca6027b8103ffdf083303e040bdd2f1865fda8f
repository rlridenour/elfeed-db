<p>I thought I would provide an example of how I typically use elisp to make my life easier (well eventually - I still need to write the function after all!)</p>
<figure><img src="https://emacs.dyerdwelling.family/ox-hugo/20240516070645-emacs--Elisp-Help-Find-Free-Bindings-In-Sway.jpg" width="100%">
</figure>

<p>In the example below, I wanted to find a simple elispy method to determine which Sway keybindings are available, specifically those that utilize the $mod key (typically Mod4/Super). Running out of available $mod keybindings in Sway, and then realizing upon reload that I have inadvertently added a duplicate keybinding, can be quite frustrating.</p>
<p>When this happens, I usually then have to resort to scrolling through the config file or using `isearch` to determine which keybindings are available.  This can be tedious and is made more difficult in that my keybindings are not listed alphabetically but are grouped by function.</p>
<p>I am having a similar problem with Emacs but that is where the package <strong>free-keys</strong> comes in handy, listing the free and available keybindings.</p>
<hr>
<p>I initially wanted to create something similar to <strong>free-keys</strong> for Sway, but by parsing the Sway configuration file and generating a report.</p>
<p>A Sway config file is typically defined in the following format:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#75715e"># Set Defaults</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set $mod Mod4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set $left h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set $down j</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set $up k</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set $right l</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Key bindings</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+b exec toggle_waybar.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+c exec screen-record.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+e exec thunar ~/DCIM/Camera</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+m exec emacs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+n exec firefox</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+p exec wl-color-picker</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+q kill</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+return exec $term</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Change window focus</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+Left focus left</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+Down focus down</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+Up focus up</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+Right focus right</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+$left focus left</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+$down focus down</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+$up focus up</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bindsym $mod+$right focus right</span>
</span></span></code></pre></div><p>For now, to keep things simple, I will focus solely on writing elisp to list the current Sway keybindings that use Mod4 or any alias for Mod4 in alphabetical order. Then, by visually scanning and leveraging the human brain&rsquo;s familiarity with the alphabet, I can determine which keybindings are unused!</p>
<p>For example, my new elisp function could yield the following typical output for the sway snippet defined above:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+Down</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+Left</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+Right</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+Up</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+b</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+c</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+e</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+j</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+k</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+l</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+m</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+n</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+p</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+q</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mod4+return</span>
</span></span></code></pre></div><p>Now I should be able to more easily gauge which bindings are not used.</p>
<p>Of course my full Sway config has many more Mod4 keybindings and when running the elisp function defined below I realised I now only have 3 alphabetical mappings left for $mod - eeek!, but at least I now know what they are and don&rsquo;t have to go trawling through the config anymore.</p>
<p>&hellip;wait, um, just as a side note, while I&rsquo;m editing this blog post, it has just occurred to me (pardon the pun), can I use <strong>occur</strong>, push to a buffer then re-order, mmmm&hellip;.., well lets ignore that thought for now, I want to dig into some elisp, its a learning experience after all!!</p>
<p>Here is the elisp:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun swaywm-list-mod-bindsyms (path)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;List all bindsyms that start with $mod or its resolved value in the SwayWM config file at PATH.&#34;</span>
</span></span><span style="display:flex;"><span>  (interactive <span style="color:#e6db74">&#34;fSway config file path: &#34;</span>)
</span></span><span style="display:flex;"><span>  (with-temp-buffer
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">insert-file-contents</span> path)
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">goto-char</span> (<span style="color:#a6e22e">point-min</span>))
</span></span><span style="display:flex;"><span>    (let ((vars <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>          (bindsyms <span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">;; Collect variable definitions</span>
</span></span><span style="display:flex;"><span>      (while (<span style="color:#a6e22e">re-search-forward</span> <span style="color:#e6db74">&#34;^set \\$\\([a-zA-Z0-9_]+\\) \\(.*\\)$&#34;</span> <span style="color:#66d9ef">nil</span> <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>        (let ((var (match-string-no-properties <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>              (value (match-string-no-properties <span style="color:#ae81ff">2</span>)))
</span></span><span style="display:flex;"><span>          (setq vars (<span style="color:#a6e22e">cons</span> (<span style="color:#a6e22e">cons</span> var value) vars))))
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">;; Prepare to translate $mod and other keys</span>
</span></span><span style="display:flex;"><span>      (let* ((<span style="color:#a6e22e">mod</span> (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#34;mod&#34;</span> vars)))
</span></span><span style="display:flex;"><span>             (left (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#34;left&#34;</span> vars)))
</span></span><span style="display:flex;"><span>             (down (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#34;down&#34;</span> vars)))
</span></span><span style="display:flex;"><span>             (up (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#34;up&#34;</span> vars)))
</span></span><span style="display:flex;"><span>             (right (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#34;right&#34;</span> vars)))
</span></span><span style="display:flex;"><span>             (mod-re (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;\\(%s\\|$mod\\)&#34;</span> (<span style="color:#a6e22e">regexp-quote</span> <span style="color:#a6e22e">mod</span>))))
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">goto-char</span> (<span style="color:#a6e22e">point-min</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">;; Collect all bindings that start with $mod or its resolved value</span>
</span></span><span style="display:flex;"><span>        (while (<span style="color:#a6e22e">re-search-forward</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;^bindsym %s\\+\\([^ ]+\\) \\(.*\\)$&#34;</span> mod-re) <span style="color:#66d9ef">nil</span> <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>         (let* ((mod-key (match-string-no-properties <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>                 (action (match-string-no-properties <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>                 (full-key (<span style="color:#a6e22e">concat</span> <span style="color:#a6e22e">mod</span> <span style="color:#e6db74">&#34;+&#34;</span> action)))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">;; Replace variable references in keys</span>
</span></span><span style="display:flex;"><span>            (setq full-key (replace-regexp-in-string <span style="color:#e6db74">&#34;\\$left&#34;</span> left full-key))
</span></span><span style="display:flex;"><span>            (setq full-key (replace-regexp-in-string <span style="color:#e6db74">&#34;\\$down&#34;</span> down full-key))
</span></span><span style="display:flex;"><span>            (setq full-key (replace-regexp-in-string <span style="color:#e6db74">&#34;\\$up&#34;</span> up full-key))
</span></span><span style="display:flex;"><span>            (setq full-key (replace-regexp-in-string <span style="color:#e6db74">&#34;\\$right&#34;</span> right full-key))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">;; Replace $mod with the actual mod key or keep as $mod for clarity</span>
</span></span><span style="display:flex;"><span>            (setq full-key (replace-regexp-in-string <span style="color:#e6db74">&#34;\\$mod&#34;</span> <span style="color:#a6e22e">mod</span> full-key))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">;; Collect the key-action pair</span>
</span></span><span style="display:flex;"><span>            (setq bindsyms (<span style="color:#a6e22e">cons</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%s&#34;</span> full-key) bindsyms)))))
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">;; Return reversed to maintain order</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">mapconcat</span> <span style="color:#e6db74">&#39;identity</span> (<span style="color:#a6e22e">sort</span> (<span style="color:#a6e22e">nreverse</span> bindsyms) <span style="color:#e6db74">&#39;string-lessp</span>) <span style="color:#e6db74">&#34;\n&#34;</span>))))
</span></span></code></pre></div><p>and to call just by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(swaywm-list-mod-bindsyms <span style="color:#e6db74">&#34;~/.config/sway/config.d/default&#34;</span>)
</span></span></code></pre></div><p>or interactively.</p>
<p>I might evolve this a little more over the coming weeks (and actually maybe this is where <strong>occur</strong> and in-house Emacsing may at last have its limitations!).  There is potentially a lot to do, for example some such improvements could be :</p>
<ul>
<li>iterate over multiple files to accommodate a typical distributed Sway configuration set</li>
<li>show bindings that are free - just like <strong>free-keys</strong></li>
<li>make more generic for multiple different types of config files containing bindings such as :
<ul>
<li>hyprland</li>
<li>other tiling window managers that typically define bindings in config files</li>
<li>emacs ?!</li>
</ul>
</li>
<li>translate all aliases not just the common $left, $right, $up, $down</li>
</ul>
<hr>
<p>Here is a mini manual for this function :</p>
<hr>
<div class="ox-hugo-toc toc local">
<ul>
<li><a href="https://emacs.dyerdwelling.family/emacs/20240516070645-emacs--elisp-help-find-free-bindings-in-sway/#manual-for-swaywm-list-mod-bindsyms">Manual for swaywm-list-mod-bindsyms</a>
<ul>
<li><a href="https://emacs.dyerdwelling.family/emacs/20240516070645-emacs--elisp-help-find-free-bindings-in-sway/#synopsis">Synopsis</a></li>
<li><a href="https://emacs.dyerdwelling.family/emacs/20240516070645-emacs--elisp-help-find-free-bindings-in-sway/#description">Description</a></li>
<li><a href="https://emacs.dyerdwelling.family/emacs/20240516070645-emacs--elisp-help-find-free-bindings-in-sway/#parameters">Parameters</a></li>
<li><a href="https://emacs.dyerdwelling.family/emacs/20240516070645-emacs--elisp-help-find-free-bindings-in-sway/#usage">Usage</a></li>
<li><a href="https://emacs.dyerdwelling.family/emacs/20240516070645-emacs--elisp-help-find-free-bindings-in-sway/#example">Example</a></li>
<li><a href="https://emacs.dyerdwelling.family/emacs/20240516070645-emacs--elisp-help-find-free-bindings-in-sway/#notes">Notes</a></li>
</ul>
</li>
</ul>
</div>
<!--endtoc-->
<hr>
<h2 id="manual-for-swaywm-list-mod-bindsyms">Manual for swaywm-list-mod-bindsyms</h2>
<p>List and sort bindsym commands from a SwayWM configuration file that are assigned to the mod key.</p>
<h3 id="synopsis">Synopsis</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(swaywm-list-mod-bindsyms PATH)
</span></span></code></pre></div><h3 id="description">Description</h3>
<p>The `swaywm-list-mod-bindsyms` function parses a specified SwayWM configuration file and extracts all `bindsym` commands that begin with the modifier key (usually designated as `$mod` in SwayWM configurations). The resolution of the `$mod` key, along with other potential sway variables like `$left`, `$down`, `$up`, and `$right`, is dynamically handled according to their definitions within the file. The commands are then returned as a single string, with each bindsym command on a new line, sorted alphabetically.</p>
<p>This function is particularly useful for users of the Sway Window Manager who wish to quickly audit their keybindings associated with the mod key â€” a common requirement for optimizing workflow efficiency or for documentation purposes.</p>
<h3 id="parameters">Parameters</h3>
<ul>
<li>`PATH`: Path to the SwayWM configuration file to be parsed.</li>
</ul>
<h3 id="usage">Usage</h3>
<p>To use `swaywm-list-mod-bindsyms`, call the function with the path to your SwayWM configuration file as its argument. For interactive use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>M-x swaywm-list-mod-bindsyms
</span></span></code></pre></div><p>When prompted, enter the full path to your SwayWM configuration file. The output will be shown, depending on the Emacs settings, either directly in the minibuffer (for shorter lists) or in a separate buffer for longer outputs.</p>
<h3 id="example">Example</h3>
<p>Assuming there&rsquo;s a SwayWM configuration file located at `~/sway/config`, you would use the function as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>M-x swaywm-list-mod-bindsyms RET ~/sway/config RET
</span></span></code></pre></div><p>The returned value will be a sorted list of all `bindsym` commands associated with the `$mod` key or its resolved value (e.g., `Mod4`) from the file, neatly formatted for easy inspection.</p>
<h3 id="notes">Notes</h3>
<ul>
<li>
<p>This function assumes a standard formatting of the SwayWM configuration file, as deviations might affect the parsing logic.</p>
</li>
<li>
<p>The sorting is done in a case-sensitive alphabetical order, following Emacs&rsquo; `string-lessp` function conventions.</p>
</li>
<li>
<p>All modifications to variables like `$mod`, `$left`, `$down`, `$up`, and `$right` are dynamically accounted for based on their set values in the configuration file.</p>
<hr>
</li>
</ul>