<p>[Equations in this post may not look right (or appear at all) in your RSS reader. Go to <a href="https://leancrew.com/all-this/2025/05/pandas-and-html-tables/">the original article</a> to see them rendered properly.]</p>
  <hr />
  <p>The <a href="https://talkpython.fm/">Talk Python To Me</a> podcast is one that underscores the value of <a href="https://castro.fm/">Castro</a>’s two-stage management system. Unlike, say, <a href="https://99percentinvisible.org/">99% Invisible</a> and <a href="https://www.relay.fm/upgrade">Upgrade</a>, Talk Python is a show I don’t listen to every week because many of its topics are just too far afield from my interests. So its episodes go into my Inbox for vetting instead of directly into my Queue. The <a href="https://talkpython.fm/episodes/show/503/the-pyarrow-revolution">latest episode</a>, about <a href="https://arrow.apache.org/docs/python/index.html">PyArrow</a> and its movement into the internals of Pandas, is one that I immediately promoted to the Queue.</p>
<p>But this post isn’t about Castro or PyArrow (inverted pyramid? what’s that?). It’s a feature of Pandas that was mentioned offhandedly by Michael Kennedy—Pandas can take the URL of a web page and turn the tables on that page into data frames. I didn’t know about this and wanted to try it out immediately.</p>
<p>After writing <a href="https://leancrew.com/all-this/2025/03/a-sciam-bolt-puzzle/">these</a> <a href="https://leancrew.com/all-this/2025/03/bolts-in-mathematica/">two</a> posts on bolts, I wondered about how the <a href="https://en.wikipedia.org/wiki/Lead_(engineering)">lead angle</a> of bolt threads changes with bolt size. I didn’t do anything about it at the time, but now I figured it would make a good test case, as there are plenty of web pages out there with tables of bolt dimensions. I chose <a href="https://www.fastenere.com/blog/bolt-size-chart">this one</a> from bolt supplier <a href="https://www.fastenere.com/">Fastenere</a>. There are two tables on the page, one for US dimensions and the other for metric. Here’s a screenshot of the US table:</p>
<p><img alt="US bolt table from Fastenere" class="ss" src="https://leancrew.com/all-this/images2025/20250501-US%20bolt%20table%20from%20Fastenere.png" title="US bolt table from Fastenere" width="100%"/></p>
<p>I wanted to pull this table into a data frame, create two new data frames, one for coarse threads and the other for fine threads, and then add a column for lead angle to each data frame.</p>
<p>The lead angle is a bit of geometry that comes from unrolling the screw thread at the pitch diameter, <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>d</mi><mn>2</mn></msub></math>:</p>
<p><img alt="Lead angle definition" class="ss" src="https://leancrew.com/all-this/images2025/20250501-Lead%20angle%20definition.png" title="Lead angle definition" width="70%"/></p>
<p>The pitch diameter isn’t given in the table, but it’s easily calculated from</p>
<math display="block" style="font-size: 110%" xmlns="http://www.w3.org/1998/Math/MathML">
<msub><mi>d</mi><mn>2</mn></msub>
<mo>=</mo>
<mi>d</mi><mo>-</mo><mn>0.64951905</mn>
<mspace width=".125em"></mspace>
<mi>P</mi>
</math>
<p>where <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math> is the major diameter in the table and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> is the pitch or lead,<sup id="fnref:pitch"><a href="#fn:pitch" rel="footnote">1</a></sup> which is the inverse of the “threads per inch” value. This formula comes from <a href="https://webstore.ansi.org/standards/asme/asmeb12024">ANSI Standard ASME B1.1</a>, <em>Unified Inch Screw Threads</em>.</p>
<p>Here are the results for coarse threads,</p>
<table>
<thead>
<tr>
<th align="right">Size</th>
<th align="right">Diameter</th>
<th align="right">TPI</th>
<th align="right">Angle</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">#2</td>
<td align="right">0.0860</td>
<td align="right">56</td>
<td align="right">4.37</td>
</tr>
<tr>
<td align="right">#4</td>
<td align="right">0.1120</td>
<td align="right">40</td>
<td align="right">4.75</td>
</tr>
<tr>
<td align="right">#5</td>
<td align="right">0.1250</td>
<td align="right">40</td>
<td align="right">4.18</td>
</tr>
<tr>
<td align="right">#6</td>
<td align="right">0.1380</td>
<td align="right">32</td>
<td align="right">4.83</td>
</tr>
<tr>
<td align="right">#8</td>
<td align="right">0.1640</td>
<td align="right">32</td>
<td align="right">3.96</td>
</tr>
<tr>
<td align="right">#10</td>
<td align="right">0.1900</td>
<td align="right">24</td>
<td align="right">4.65</td>
</tr>
<tr>
<td align="right">1/4″</td>
<td align="right">0.2500</td>
<td align="right">20</td>
<td align="right">4.18</td>
</tr>
<tr>
<td align="right">5/16″</td>
<td align="right">0.3125</td>
<td align="right">18</td>
<td align="right">3.66</td>
</tr>
<tr>
<td align="right">3/8″</td>
<td align="right">0.3750</td>
<td align="right">16</td>
<td align="right">3.40</td>
</tr>
<tr>
<td align="right">7/16″</td>
<td align="right">0.4375</td>
<td align="right">14</td>
<td align="right">3.33</td>
</tr>
<tr>
<td align="right">1/2″</td>
<td align="right">0.5000</td>
<td align="right">13</td>
<td align="right">3.11</td>
</tr>
<tr>
<td align="right">9/16″</td>
<td align="right">0.5625</td>
<td align="right">12</td>
<td align="right">2.99</td>
</tr>
<tr>
<td align="right">5/8″</td>
<td align="right">0.6250</td>
<td align="right">11</td>
<td align="right">2.93</td>
</tr>
<tr>
<td align="right">3/4″</td>
<td align="right">0.7500</td>
<td align="right">10</td>
<td align="right">2.66</td>
</tr>
<tr>
<td align="right">7/8″</td>
<td align="right">0.8750</td>
<td align="right">9</td>
<td align="right">2.52</td>
</tr>
<tr>
<td align="right">1″</td>
<td align="right">1.0000</td>
<td align="right">8</td>
<td align="right">2.48</td>
</tr>
<tr>
<td align="right">1-1/8″</td>
<td align="right">1.1250</td>
<td align="right">7</td>
<td align="right">2.52</td>
</tr>
<tr>
<td align="right">1-1/4″</td>
<td align="right">1.2500</td>
<td align="right">7</td>
<td align="right">2.25</td>
</tr>
<tr>
<td align="right">1-3/8″</td>
<td align="right">1.3750</td>
<td align="right">6</td>
<td align="right">2.40</td>
</tr>
<tr>
<td align="right">1-1/2″</td>
<td align="right">1.5000</td>
<td align="right">6</td>
<td align="right">2.18</td>
</tr>
<tr>
<td align="right">1-3/4″</td>
<td align="right">1.7500</td>
<td align="right">5</td>
<td align="right">2.25</td>
</tr>
<tr>
<td align="right">2″</td>
<td align="right">2.0000</td>
<td align="right">4.5</td>
<td align="right">2.18</td>
</tr>
</tbody>
</table>
<p>The diameter is given in inches and the angle is in degrees. Similarly, here are the results for fine threads:</p>
<table>
<thead>
<tr>
<th align="right">Size</th>
<th align="right">Diameter</th>
<th align="right">TPI</th>
<th align="right">Angle</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">#0</td>
<td align="right">0.0600</td>
<td align="right">80</td>
<td align="right">4.39</td>
</tr>
<tr>
<td align="right">#2</td>
<td align="right">0.0860</td>
<td align="right">64</td>
<td align="right">3.75</td>
</tr>
<tr>
<td align="right">#4</td>
<td align="right">0.1120</td>
<td align="right">48</td>
<td align="right">3.85</td>
</tr>
<tr>
<td align="right">#5</td>
<td align="right">0.1250</td>
<td align="right">44</td>
<td align="right">3.75</td>
</tr>
<tr>
<td align="right">#6</td>
<td align="right">0.1380</td>
<td align="right">40</td>
<td align="right">3.74</td>
</tr>
<tr>
<td align="right">#8</td>
<td align="right">0.1640</td>
<td align="right">36</td>
<td align="right">3.47</td>
</tr>
<tr>
<td align="right">#10</td>
<td align="right">0.1900</td>
<td align="right">32</td>
<td align="right">3.35</td>
</tr>
<tr>
<td align="right">1/4″</td>
<td align="right">0.2500</td>
<td align="right">28</td>
<td align="right">2.87</td>
</tr>
<tr>
<td align="right">5/16″</td>
<td align="right">0.3125</td>
<td align="right">24</td>
<td align="right">2.66</td>
</tr>
<tr>
<td align="right">3/8″</td>
<td align="right">0.3750</td>
<td align="right">24</td>
<td align="right">2.18</td>
</tr>
<tr>
<td align="right">7/16″</td>
<td align="right">0.4375</td>
<td align="right">20</td>
<td align="right">2.25</td>
</tr>
<tr>
<td align="right">1/2″</td>
<td align="right">0.5000</td>
<td align="right">20</td>
<td align="right">1.95</td>
</tr>
<tr>
<td align="right">9/16″</td>
<td align="right">0.5625</td>
<td align="right">18</td>
<td align="right">1.92</td>
</tr>
<tr>
<td align="right">5/8″</td>
<td align="right">0.6250</td>
<td align="right">18</td>
<td align="right">1.72</td>
</tr>
<tr>
<td align="right">3/4″</td>
<td align="right">0.7500</td>
<td align="right">16</td>
<td align="right">1.61</td>
</tr>
<tr>
<td align="right">7/8″</td>
<td align="right">0.8750</td>
<td align="right">14</td>
<td align="right">1.57</td>
</tr>
<tr>
<td align="right">1″</td>
<td align="right">1.0000</td>
<td align="right">12</td>
<td align="right">1.61</td>
</tr>
<tr>
<td align="right">1-1/8″</td>
<td align="right">1.1250</td>
<td align="right">12</td>
<td align="right">1.42</td>
</tr>
<tr>
<td align="right">1-1/4″</td>
<td align="right">1.2500</td>
<td align="right">12</td>
<td align="right">1.27</td>
</tr>
<tr>
<td align="right">1-3/8″</td>
<td align="right">1.3750</td>
<td align="right">12</td>
<td align="right">1.15</td>
</tr>
<tr>
<td align="right">1-1/2″</td>
<td align="right">1.5000</td>
<td align="right">12</td>
<td align="right">1.05</td>
</tr>
</tbody>
</table>
<p>The lead angles are all pretty small, even for tiny screws that don’t have much room for threads. And we haven’t even considered extra fine threads.</p>
<p>Here’s the code that produced the tables:</p>
<pre><code>python:
 1:  #!/usr/bin/env python3
 2:  
 3:  import pandas as pd
 4:  import numpy as np
 5:  import sys
 6:  
 7:  # Get the first table from https://www.fastenere.com/blog/bolt-size-chart
 8:  # Don't include the two header rows
 9:  dfBoth = pd.read_html('https://www.fastenere.com/blog/bolt-size-chart', skiprows=2, na_values='---')[0]
10:  
11:  # We don't need any other columns
12:  colnames = 'Size Diameter TPI'.split()
13:  
14:  # Make a table for the coarse threads
15:  dfCoarse = dfBoth.drop(columns=[3, 4, 5, 6, 7]).drop(index=0)
16:  dfCoarse.columns = colnames
17:  dfCoarse['Angle'] = np.round(np.rad2deg(np.atan2(1/dfCoarse.TPI, np.pi*(dfCoarse.Diameter- 0.64951905/dfCoarse.TPI))), decimals=2)
18:  print("US Coarse Threads")
19:  print(dfCoarse)
20:  print()
21:  
22:  # Make a table for the fine threads
23:  dfFine = dfBoth.drop(columns=[2, 3, 4, 6, 7]).drop(index=[21, 22])
24:  dfFine.columns = colnames
25:  dfFine['Angle'] = np.round(np.rad2deg(np.atan2(1/dfFine.TPI, np.pi*(dfFine.Diameter- 0.64951905/dfFine.TPI))), decimals=2)
26:  print("US Fine Threads")
27:  print(dfFine)
28:  print()
29:  
</code></pre>
<p>Line 8 is what was new to me. The <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_html.html#pandas.read_html"><code>read_html</code> function</a> reads all the tables on the referenced page (you can also provide a local HTML file or an HTML string wrapped in <a href="https://docs.python.org/3.13/library/io.html#text-i-o"><code>io.StringIO</code></a>) and returns a list of data frames. Since the US bolt table is the first one on the page, the list is indexed by <code>[0]</code>. The first two rows in the HTML table are headers, so I used <code>skiprows=2</code> to keep them out of the data frame; I add my own column names later via Lines 12, 16, and 24. The <code>na_values='---'</code> parameter handles the missing values, which are indicated in the HTML table by three hyphens.</p>
<p>The rest of the code is pretty straightforward. I make the coarse data frame by dropping the columns associated with fine threads, and vice versa. I also drop the columns for area because they don’t matter for what I’m doing. Rows with missing values are dropped, too. The calculation of the lead angle (Lines 17 and 25) is kind of long, but that’s mainly because I wanted the results in degrees instead of radians and rounded to the nearest hundredth of a degree.</p>
<p>The output tables are in Pandas’ native format, which looks like this:</p>
<pre><code>      Size  Diameter   TPI  Angle
1       #2    0.0860  56.0   4.37
2       #4    0.1120  40.0   4.75
3       #5    0.1250  40.0   4.18
4       #6    0.1380  32.0   4.83
5       #8    0.1640  32.0   3.96
6      #10    0.1900  24.0   4.65
7     1/4"    0.2500  20.0   4.18
[etc]
</code></pre>
<p>I did some simple <a href="https://www.barebones.com/support/bbedit/faqs.html#rectangle">rectangular editing</a> in BBEdit to turn this into a Markdown table for posting here:</p>
<pre><code>|   Size | Diameter |  TPI | Angle |
|-------:|---------:|-----:|------:|
|     #2 |   0.0860 |   56 |  4.37 |
|     #4 |   0.1120 |   40 |  4.75 |
|     #5 |   0.1250 |   40 |  4.18 |
|     #6 |   0.1380 |   32 |  4.83 |
|     #8 |   0.1640 |   32 |  3.96 |
|    #10 |   0.1900 |   24 |  4.65 |
|   1/4″ |   0.2500 |   20 |  4.18 |
[etc]
</code></pre>
<p>Pandas has a <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_markdown.html#pandas.DataFrame.to_markdown"><code>to_markdown</code> function</a>, which is sometimes the best way to go, but in this case that didn’t give the same number of decimal places for all the items in the Diameter column, which ruined the alignment. It was faster to add the pipe characters to the output than change the code to make <code>to_markdown</code> print the way I wanted it to.</p>
<p>Between <code>read_html</code> and <a href="https://tabula.technology/">Tabula</a>, which extracts tabular data from PDFs,<sup id="fnref:tabula"><a href="#fn:tabula" rel="footnote">2</a></sup> I can pull in almost any data I can find on the internet that isn’t already in a convenient format like CSV.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:pitch">
<p>For double-threaded (and other multiply-threaded) bolts, the pitch and lead are not the same, but we’re considering only single-threaded bolts here. <a href="#fnref:pitch" rev="footnote">↩</a></p>
</li>
<li id="fn:tabula">
<p>There’s also <a href="https://pypi.org/project/tabula-py/"><code>tabula-py</code></a>, a Python wrapper around Tabula. This is a more direct way of getting a PDF table into a data frame, but I’ve always used Tabula itself to make a CSV file, which I then read into a data frame. It’s slightly longer, but it’s always felt safer because it lets me see what I’m doing as I do it. <a href="#fnref:tabula" rev="footnote">↩</a></p>
</li>
</ol>
</div>
  
