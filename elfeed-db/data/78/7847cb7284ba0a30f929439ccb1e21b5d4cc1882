<div class="update" id="org86fa9bf">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2025-02-28 Fri]</span></span>: Added link to <a href="https://sachachua.com/dotemacs#spookfox-fragment">elisp code to link to currently-selected text using Spookfox</a>
</p>

</div>
<div class="sticky-toc" id="org716b66d">
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="https://sachachua.com/blog/feed/index.xml#org3b93973">Adding anchors to paragraphs</a></li>
<li><a href="https://sachachua.com/blog/feed/index.xml#org69e5d77">Anchor links</a></li>
<li><a href="https://sachachua.com/blog/feed/index.xml#orgadd31c9">Text fragments</a></li>
</ul>
</div>

</div>

<p>
I write my blog posts in <a href="https://orgmode.org/">Org Mode</a> and export them
to <a href="https://www.11ty.dev/">Eleventy</a> with <a href="https://github.com/sachac/ox-11ty">ox-11ty</a>, which is derived from
the ox-html backend.
</p>

<p>
Sometimes I want to link to something in a
different blog post. This lets me build on
thoughts that are part of a post instead of being
a whole post on their own.
</p>

<p>
If I haven't added an anchor to the blog post yet,
I can add one so that I can link to that section.
For really old posts where I don't have an Org
source file, I can edit the HTML file directly and
add an <code>id="some-id"</code> so that I can link to it
with <code>/url/to/post#some-id</code>. Most of my new posts
have Org source, though. I have a
<code>my-blog-edit-org</code> function and a
<code>my-blog-edit-html</code> function in my <a href="https://sachachua.com/dotemacs">Emacs
configuration</a> to make it easier to jump to the Org
file or HTML for a blog post.
</p>

<p>
If the section has a heading, then it's easy to
make that linkable with a custom name. I can use
<code>org-set-property</code> to set the <code>CUSTOM_ID</code> property
to the anchor name. For example, this <a href="https://sachachua.com/blog/2025/01/controlling-my-android-phone-by-voice/#controlling-my-android-phone-by-voice-voice-access">voice access</a>
section has a heading that has <code>CUSTOM_ID</code>, as you
can see in the . If I don't mind having
long anchor names, I can use the
<code>my-assign-custom-ids</code> function from my config to
automatically set them based on the outline path.
</p>

<p>
</p><details><summary>my-assign-custom-ids</summary><div class="org-src-container"><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-assign-custom-ids</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((custom-ids
         (org-map-entries (<span class="org-keyword">lambda</span> () (org-entry-get (point) <span class="org-string">"CUSTOM_ID"</span>)) <span class="org-string">"CUSTOM_ID={.}"</span>)))
    (org-map-entries
     (<span class="org-keyword">lambda</span> ()
       (<span class="org-keyword">let</span> ((slug
              (replace-regexp-in-string
               <span class="org-string">"^-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">-$"</span> <span class="org-string">""</span>
               (replace-regexp-in-string <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">A-Za-z0-9]+"</span> <span class="org-string">"-"</span>
                                         (downcase (string-join (org-get-outline-path t) <span class="org-string">" "</span>))))))
         (<span class="org-keyword">while</span> (member slug custom-ids)
           (<span class="org-keyword">setq</span> slug (read-string <span class="org-string">"Manually set custom ID: "</span>)))
         (org-entry-put (point) <span class="org-string">"CUSTOM_ID"</span> slug)))
     <span class="org-string">"-CUSTOM_ID={.}"</span>)))

</pre></div></details>
<p></p>
<div id="outline-container-org3b93973" class="outline-2">
<h2 id="org3b93973">Adding anchors to paragraphs</h2>
<div class="outline-text-2" id="text-org3b93973">
<p>
If the part that I want to link to is not a
heading, I can add an ID by using the
<code>#+ATTR_HTML: :id ...</code> directive, like <a href="https://sachachua.com/blog/2025/02/looking-at-landscapes-art-and-iteration/#interest-development">this snippet from my reflection on landscapes and art</a>:
</p>


<div class="org-src-container">
<pre class="src src-org"><span class="org-org-meta-line">  #+ATTR_HTML: :id interest-development</span>
  That reminds me a little of another reflection
  I've been noodling around on interest development...
</pre>
</div>

</div>
</div>
<div id="outline-container-org69e5d77" class="outline-2">
<h2 id="org69e5d77">Anchor links</h2>
<div class="outline-text-2" id="text-org69e5d77">
<p>
It might be fun to have a little margin note with
ðŸ”— to indicate that that's a specially-linkable
section, which could be handy when I want to link
when mobile. It feels like that would be a left
margin thing on a large screen, so it'll just have
to squeeze in there with the sticky table of
contents. I've been meaning to add link icons to
sub-headings with IDs, anyway, so I can probably solve
both with a bit of Javascript.
</p>


<div class="org-src-container">
<pre class="src src-js"><span class="org-comment-delimiter">/* </span><span class="org-comment">Add link icons to headings and anchored paragraphs</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">function</span> <span class="org-function-name">addLinkIcons</span>() {
  document.querySelectorAll(<span class="org-string">'h1[id], h2[id], h3[id], p[id]'</span>).forEach((o) =&gt; {
    <span class="org-keyword">const</span> <span class="org-variable-name">link</span> = document.createElement(<span class="org-string">'a'</span>);
    <span class="org-keyword">const</span> <span class="org-variable-name">article</span> = o.closest(<span class="org-string">'article[data-url]'</span>);
    link.href = window.location.origin + (article?.getAttribute(<span class="org-string">'data-url'</span>) || window.location.pathname) + <span class="org-string">'#'</span> + o.getAttribute(<span class="org-string">'id'</span>);
    link.innerHTML = <span class="org-string">'&amp;#x1F517;'</span>;  <span class="org-comment-delimiter">// </span><span class="org-comment">link icon</span>
    link.title = <span class="org-string">'anchor'</span>;
    link.classList.add(<span class="org-string">'anchor-icon'</span>);
    link.addEventListener(<span class="org-string">'click'</span>, copyLink);
    o.prepend(link);
  });
}

addLinkIcons();
</pre>
</div>


<p>
And some CSS:
</p>


<div class="org-src-container">
<pre class="src src-css"><span class="org-css-selector">.entry h2, .entry h3, .entry h4, .entry p, .content h2, .content h3, .content h4, .content p</span> { <span class="org-css-property">position</span>: relative }
<span class="org-css-selector">.content a.anchor-icon:link, .entry a.anchor-icon:link</span> { <span class="org-css-property">font-size</span>: 60%; <span class="org-css-property">text-decoration</span>: none <span class="org-builtin">!important</span>; <span class="org-css-property">font-size</span>: small; <span class="org-css-property">float</span>: right }
<span class="org-builtin">@media</span> only screen and (min-width: 95rem) {
   <span class="org-css-selector">.content a.anchor-icon:link, .entry a.anchor-icon:link</span> { <span class="org-css-property">display</span>: block; <span class="org-css-property">position</span>: absolute; <span class="org-css-property">left</span>: -2em; <span class="org-css-property">top</span>: 0.2em; <span class="org-css-property">float</span>: none}
}
</pre>
</div>

</div>
</div>
<div id="outline-container-orgadd31c9" class="outline-2">
<h2 id="orgadd31c9">Text fragments</h2>
<div class="outline-text-2" id="text-orgadd31c9">
<p>
<a href="https://developer.mozilla.org/en-US/docs/Web/URI/Reference/Fragment/Text_fragments">Text fragments</a> are even more powerful, because I
can link to a specific part of a paragraph. I can
link to one segment with something like
<code>#:</code>:text=text+to+highlight~. I can specify
multiple text fragments to highlight by using
<code>#:</code>:text=first+text+to+highlight&amp;text=second+text~,
and the browser will automatically scroll to the
first highlighted section. I can specify a longer
section by using text=textStart,textEnd. Example:
<a href="https://sachachua.com/blog/2025/02/looking-at-landscapes-art-and-iteration/#:~:text=That%20is%20the%20gap,described">#:~:text=That%20is%20the%20gap,described</a> The <a href="https://developer.mozilla.org/en-US/docs/Web/URI/Reference/Fragment/Text_fragments">text
fragments documentation</a> has more options,
including using prefixes and suffixes to
disambiguate matches.
</p>

<p>
Text fragment links require <code>rel="noopener"</code> for
security, so I added
<a href="https://github.com/JKC-Codes/eleventy-plugin-automatic-noopener">JKC-Codes/eleventy-plugin-automatic-noopener</a> to my
11ty config.
</p>

<p>
If I find myself using this a lot, it might be
interesting to figure out how to make it easier,
maybe with something like the <a href="https://addons.mozilla.org/en-US/firefox/addon/text-fragment/">Text Fragment
extension for Firefox</a>.
</p>

<div class="update" id="org4c5ffe3">
<p>
Update 2025-02-28: Ah, it turns out I already have <a href="https://sachachua.com/dotemacs#spookfox-fragment">some Emacs Lisp to link to currently-selected text using Spookfox</a>. <a href="https://github.com/bitspook/spookfox">Spookfox</a> connects Emacs to Firefox using a browser extension. Once it's properly set up and connected, it allows Emacs to evaluate things in the Firefox context.
</p>

</div>

<p>
These seem like good starting points for
addressing smaller chunks of thoughts.
</p>
</div>
</div>
<div><a href="https://sachachua.com/blog/2025/02/adding-an-anchor-to-a-paragraph-in-org-mode-html-export/index.org">View org source for this post</a></div>